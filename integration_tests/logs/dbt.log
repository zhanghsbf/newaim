[0m20:12:24.580756 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4845a8fe10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4845a8e8d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4845a8f350>]}


============================== 20:12:24.583154 | bbe1806f-7c8a-4c13-94f3-2f89d1d589c4 ==============================
[0m20:12:24.583154 [info ] [MainThread]: Running with dbt=1.7.8
[0m20:12:24.583637 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/root/option1-customer360/integration_tests/logs', 'debug': 'False', 'profiles_dir': '/root/option1-customer360/integration_tests', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True'}
[0m20:12:24.741813 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'bbe1806f-7c8a-4c13-94f3-2f89d1d589c4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f48459f4510>]}
[0m20:12:24.815503 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'bbe1806f-7c8a-4c13-94f3-2f89d1d589c4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4845b01e50>]}
[0m20:12:24.816155 [info ] [MainThread]: Registered adapter: postgres=1.7.8
[0m20:12:24.816974 [error] [MainThread]: Encountered an error:
Compilation Error
  dbt found 1 package(s) specified in packages.yml, but only 0 package(s) installed in dbt_packages. Run "dbt deps" to install package dependencies.
[0m20:12:24.817703 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 0.27248305, "process_user_time": 1.756308, "process_kernel_time": 0.079968, "process_mem_max_rss": "95112", "process_in_blocks": "9304", "process_out_blocks": "8", "command_success": false}
[0m20:12:24.818161 [debug] [MainThread]: Command `dbt run` failed at 20:12:24.818044 after 0.27 seconds
[0m20:12:24.818497 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4845bbc950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f484a080f50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f484a081290>]}
[0m20:12:24.818808 [debug] [MainThread]: Flushing usage events
[0m20:12:42.470086 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7c3c42bd50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7c3c429ed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7c3c43b710>]}


============================== 20:12:42.472508 | fbb54c4e-09f1-4095-aaed-6e64cdc3d198 ==============================
[0m20:12:42.472508 [info ] [MainThread]: Running with dbt=1.7.8
[0m20:12:42.472968 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/root/option1-customer360/integration_tests', 'debug': 'False', 'warn_error': 'None', 'log_path': '/root/option1-customer360/integration_tests/logs', 'version_check': 'True', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'invocation_command': 'dbt deps', 'introspect': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m20:12:42.546306 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'fbb54c4e-09f1-4095-aaed-6e64cdc3d198', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7c3c305450>]}
[0m20:12:42.548265 [debug] [MainThread]: Set downloads directory='/tmp/dbt-downloads-458qn8j0'
[0m20:12:42.548646 [info ] [MainThread]: Installing ../
[0m20:12:42.549280 [debug] [MainThread]: Creating symlink to local dependency.
[0m20:12:42.549647 [info ] [MainThread]: Installed from <local @ ../>
[0m20:12:42.549993 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'package', 'label': 'fbb54c4e-09f1-4095-aaed-6e64cdc3d198', 'property_': 'install', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7c3c429890>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7c3c34dad0>]}
[0m20:12:42.550772 [debug] [MainThread]: Resource report: {"command_name": "deps", "command_success": true, "command_wall_clock_time": 0.11579685, "process_user_time": 1.634613, "process_kernel_time": 0.070983, "process_mem_max_rss": "90232", "process_out_blocks": "16", "process_in_blocks": "0"}
[0m20:12:42.551214 [debug] [MainThread]: Command `dbt deps` succeeded at 20:12:42.551099 after 0.12 seconds
[0m20:12:42.551552 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7c3c48c090>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7c3c431890>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7c40a14290>]}
[0m20:12:42.551870 [debug] [MainThread]: Flushing usage events
[0m20:12:47.863640 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8e23374e10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8e23377b50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8e23377810>]}


============================== 20:12:47.866044 | 3f50808d-859d-4392-9645-067ec95e2232 ==============================
[0m20:12:47.866044 [info ] [MainThread]: Running with dbt=1.7.8
[0m20:12:47.866529 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/root/option1-customer360/integration_tests', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/root/option1-customer360/integration_tests/logs', 'warn_error': 'None', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True'}
[0m20:12:48.007657 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '3f50808d-859d-4392-9645-067ec95e2232', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8e219f1490>]}
[0m20:12:48.082201 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '3f50808d-859d-4392-9645-067ec95e2232', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8e21a19610>]}
[0m20:12:48.082896 [info ] [MainThread]: Registered adapter: postgres=1.7.8
[0m20:12:48.094000 [debug] [MainThread]: checksum: 67f0013ca5f0bd43af9a0873dd50792fde83ef69de63b71cacd0b4ac656c52e5, vars: {}, profile: , target: , version: 1.7.8
[0m20:12:48.094462 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m20:12:48.094796 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '3f50808d-859d-4392-9645-067ec95e2232', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8e21a5c550>]}
[0m20:12:49.172405 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '3f50808d-859d-4392-9645-067ec95e2232', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8e21887d10>]}
[0m20:12:49.179701 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '3f50808d-859d-4392-9645-067ec95e2232', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8e21038190>]}
[0m20:12:49.180111 [info ] [MainThread]: Found 2 seeds, 4 models, 6 tests, 2 sources, 0 exposures, 0 metrics, 403 macros, 0 groups, 0 semantic models
[0m20:12:49.180496 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3f50808d-859d-4392-9645-067ec95e2232', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8e2169e210>]}
[0m20:12:49.181967 [info ] [MainThread]: 
[0m20:12:49.182619 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m20:12:49.183649 [debug] [ThreadPool]: Acquiring new postgres connection 'list_dbt'
[0m20:12:49.193351 [debug] [ThreadPool]: Using postgres connection "list_dbt"
[0m20:12:49.193675 [debug] [ThreadPool]: On list_dbt: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "connection_name": "list_dbt"} */

    select distinct nspname from pg_namespace
  
[0m20:12:49.193935 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:12:49.194761 [debug] [ThreadPool]: Postgres adapter: Got a retryable error when attempting to open a postgres connection.
1 attempts remaining. Retrying in 0 seconds.
Error:
connection to server at "localhost" (::1), port 5432 failed: Connection refused
	Is the server running on that host and accepting TCP/IP connections?
connection to server at "localhost" (127.0.0.1), port 5432 failed: Connection refused
	Is the server running on that host and accepting TCP/IP connections?

[0m20:12:49.195398 [debug] [ThreadPool]: Postgres adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "connection_name": "list_dbt"} */

    select distinct nspname from pg_namespace
  
[0m20:12:49.195693 [debug] [ThreadPool]: Postgres adapter: Rolling back transaction.
[0m20:12:49.196012 [debug] [ThreadPool]: Postgres adapter: Error running SQL: macro list_schemas
[0m20:12:49.196272 [debug] [ThreadPool]: Postgres adapter: Rolling back transaction.
[0m20:12:49.196566 [debug] [ThreadPool]: On list_dbt: No close available on handle
[0m20:12:49.197479 [debug] [MainThread]: Connection 'master' was properly closed.
[0m20:12:49.197769 [debug] [MainThread]: Connection 'list_dbt' was properly closed.
[0m20:12:49.198030 [info ] [MainThread]: 
[0m20:12:49.198339 [info ] [MainThread]: Finished running  in 0 hours 0 minutes and 0.02 seconds (0.02s).
[0m20:12:49.198742 [error] [MainThread]: Encountered an error:
Database Error
  connection to server at "localhost" (::1), port 5432 failed: Connection refused
  	Is the server running on that host and accepting TCP/IP connections?
  connection to server at "localhost" (127.0.0.1), port 5432 failed: Connection refused
  	Is the server running on that host and accepting TCP/IP connections?
  
[0m20:12:49.199409 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 1.3711363, "process_user_time": 2.869927, "process_kernel_time": 0.089966, "process_mem_max_rss": "106388", "process_out_blocks": "1640", "command_success": false, "process_in_blocks": "0"}
[0m20:12:49.199854 [debug] [MainThread]: Command `dbt run` failed at 20:12:49.199742 after 1.37 seconds
[0m20:12:49.200175 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8e2488e2d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8e2334b750>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8e20ed0050>]}
[0m20:12:49.200535 [debug] [MainThread]: Flushing usage events
[0m20:14:11.118602 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc830507f10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc8305062d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc8304fab10>]}


============================== 20:14:11.120990 | c0471098-17bc-467d-81f1-83e6a09f1d62 ==============================
[0m20:14:11.120990 [info ] [MainThread]: Running with dbt=1.7.8
[0m20:14:11.121554 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/root/option1-customer360/integration_tests/logs', 'debug': 'False', 'profiles_dir': '/root/option1-customer360/integration_tests', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt run', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m20:14:11.292661 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'c0471098-17bc-467d-81f1-83e6a09f1d62', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc83041d0d0>]}
[0m20:14:11.369643 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'c0471098-17bc-467d-81f1-83e6a09f1d62', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc8304ee8d0>]}
[0m20:14:11.370289 [info ] [MainThread]: Registered adapter: postgres=1.7.8
[0m20:14:11.381264 [debug] [MainThread]: checksum: 67f0013ca5f0bd43af9a0873dd50792fde83ef69de63b71cacd0b4ac656c52e5, vars: {}, profile: , target: , version: 1.7.8
[0m20:14:11.401163 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m20:14:11.401533 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m20:14:11.406934 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'c0471098-17bc-467d-81f1-83e6a09f1d62', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc82e841090>]}
[0m20:14:11.414768 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'c0471098-17bc-467d-81f1-83e6a09f1d62', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc82ead46d0>]}
[0m20:14:11.415184 [info ] [MainThread]: Found 2 seeds, 4 models, 6 tests, 2 sources, 0 exposures, 0 metrics, 403 macros, 0 groups, 0 semantic models
[0m20:14:11.415545 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c0471098-17bc-467d-81f1-83e6a09f1d62', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc82eac8450>]}
[0m20:14:11.417043 [info ] [MainThread]: 
[0m20:14:11.417716 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m20:14:11.418892 [debug] [ThreadPool]: Acquiring new postgres connection 'list_dbt'
[0m20:14:11.428041 [debug] [ThreadPool]: Using postgres connection "list_dbt"
[0m20:14:11.428349 [debug] [ThreadPool]: On list_dbt: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "connection_name": "list_dbt"} */

    select distinct nspname from pg_namespace
  
[0m20:14:11.428630 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:14:11.433185 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.0 seconds
[0m20:14:11.434480 [debug] [ThreadPool]: On list_dbt: Close
[0m20:14:11.436350 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dbt, now list_dbt_public)
[0m20:14:11.441593 [debug] [ThreadPool]: Using postgres connection "list_dbt_public"
[0m20:14:11.441960 [debug] [ThreadPool]: On list_dbt_public: BEGIN
[0m20:14:11.442216 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:14:11.445272 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m20:14:11.445589 [debug] [ThreadPool]: Using postgres connection "list_dbt_public"
[0m20:14:11.445875 [debug] [ThreadPool]: On list_dbt_public: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "connection_name": "list_dbt_public"} */
select
      'dbt' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'dbt' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'dbt' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m20:14:11.448698 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.0 seconds
[0m20:14:11.449946 [debug] [ThreadPool]: On list_dbt_public: ROLLBACK
[0m20:14:11.450438 [debug] [ThreadPool]: On list_dbt_public: Close
[0m20:14:11.455779 [debug] [MainThread]: Using postgres connection "master"
[0m20:14:11.456078 [debug] [MainThread]: On master: BEGIN
[0m20:14:11.456349 [debug] [MainThread]: Opening a new connection, currently in state init
[0m20:14:11.459346 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m20:14:11.459640 [debug] [MainThread]: Using postgres connection "master"
[0m20:14:11.459981 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m20:14:11.462957 [debug] [MainThread]: SQL status: SELECT 0 in 0.0 seconds
[0m20:14:11.463982 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c0471098-17bc-467d-81f1-83e6a09f1d62', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc831a11c50>]}
[0m20:14:11.464419 [debug] [MainThread]: On master: ROLLBACK
[0m20:14:11.464915 [debug] [MainThread]: Using postgres connection "master"
[0m20:14:11.465390 [debug] [MainThread]: On master: BEGIN
[0m20:14:11.466029 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m20:14:11.466340 [debug] [MainThread]: On master: COMMIT
[0m20:14:11.466606 [debug] [MainThread]: Using postgres connection "master"
[0m20:14:11.466851 [debug] [MainThread]: On master: COMMIT
[0m20:14:11.467275 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m20:14:11.467589 [debug] [MainThread]: On master: Close
[0m20:14:11.468331 [info ] [MainThread]: Concurrency: 3 threads (target='local')
[0m20:14:11.468721 [info ] [MainThread]: 
[0m20:14:11.470945 [debug] [Thread-1 (]: Began running node model.customer360.stg_sf__contacts
[0m20:14:11.471363 [debug] [Thread-2 (]: Began running node model.customer360.stg_web__transactions
[0m20:14:11.471805 [info ] [Thread-1 (]: 1 of 4 START sql table model public.stg_sf__contacts ........................... [RUN]
[0m20:14:11.472320 [info ] [Thread-2 (]: 2 of 4 START sql table model public.stg_web__transactions ...................... [RUN]
[0m20:14:11.472968 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dbt_public, now model.customer360.stg_sf__contacts)
[0m20:14:11.473632 [debug] [Thread-2 (]: Acquiring new postgres connection 'model.customer360.stg_web__transactions'
[0m20:14:11.473987 [debug] [Thread-1 (]: Began compiling node model.customer360.stg_sf__contacts
[0m20:14:11.474351 [debug] [Thread-2 (]: Began compiling node model.customer360.stg_web__transactions
[0m20:14:11.480856 [debug] [Thread-1 (]: Writing injected SQL for node "model.customer360.stg_sf__contacts"
[0m20:14:11.484008 [debug] [Thread-2 (]: Writing injected SQL for node "model.customer360.stg_web__transactions"
[0m20:14:11.484818 [debug] [Thread-2 (]: Timing info for model.customer360.stg_web__transactions (compile): 20:14:11.481112 => 20:14:11.484550
[0m20:14:11.485207 [debug] [Thread-2 (]: Began executing node model.customer360.stg_web__transactions
[0m20:14:11.519693 [debug] [Thread-2 (]: Writing runtime sql for node "model.customer360.stg_web__transactions"
[0m20:14:11.520400 [debug] [Thread-2 (]: Using postgres connection "model.customer360.stg_web__transactions"
[0m20:14:11.520726 [debug] [Thread-2 (]: On model.customer360.stg_web__transactions: BEGIN
[0m20:14:11.521022 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m20:14:11.521611 [debug] [Thread-1 (]: Timing info for model.customer360.stg_sf__contacts (compile): 20:14:11.474593 => 20:14:11.521325
[0m20:14:11.522029 [debug] [Thread-1 (]: Began executing node model.customer360.stg_sf__contacts
[0m20:14:11.526759 [debug] [Thread-1 (]: Writing runtime sql for node "model.customer360.stg_sf__contacts"
[0m20:14:11.527478 [debug] [Thread-1 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m20:14:11.528016 [debug] [Thread-1 (]: On model.customer360.stg_sf__contacts: BEGIN
[0m20:14:11.528340 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:14:11.528722 [debug] [Thread-2 (]: SQL status: BEGIN in 0.0 seconds
[0m20:14:11.529261 [debug] [Thread-2 (]: Using postgres connection "model.customer360.stg_web__transactions"
[0m20:14:11.529744 [debug] [Thread-2 (]: On model.customer360.stg_web__transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_web__transactions"} */

  
    

  create  table "dbt"."public"."stg_web__transactions__dbt_tmp"
  
  
    as
  
  (
    with source as (
    select * from "dbt"."public"."transactions"
),

renamed as (
    select
        id,
        contact_id,
        
    to_timestamp(transaction_date,'YYYY-MM-DD HH24:MI:SS.MS') :: timestamp at TIME zone 'UTC'
 as transaction_date,
        amount,
        item_count,
        category, 
        _loaded_at_utc
    from source     
)

select * from renamed
  );
  
[0m20:14:11.535417 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m20:14:11.535872 [debug] [Thread-1 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m20:14:11.536188 [debug] [Thread-1 (]: On model.customer360.stg_sf__contacts: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_sf__contacts"} */

  
    

  create  table "dbt"."public"."stg_sf__contacts__dbt_tmp"
  
  
    as
  
  (
    with source as (
    select * from "dbt"."public"."contacts"
),

renamed as (
    select
        id,
        username as user_name,
        name,
        gender,
        address, 
        mail as email_address,
        birthdate as birth_date,
        _loaded_at_utc
    from source     
)

select * from renamed
  );
  
[0m20:14:11.536763 [debug] [Thread-2 (]: Postgres adapter: Postgres error: relation "public.transactions" does not exist
LINE 13:     select * from "dbt"."public"."transactions"
                           ^

[0m20:14:11.537088 [debug] [Thread-2 (]: On model.customer360.stg_web__transactions: ROLLBACK
[0m20:14:11.537837 [debug] [Thread-1 (]: Postgres adapter: Postgres error: relation "public.contacts" does not exist
LINE 13:     select * from "dbt"."public"."contacts"
                           ^

[0m20:14:11.538382 [debug] [Thread-2 (]: Timing info for model.customer360.stg_web__transactions (execute): 20:14:11.485448 => 20:14:11.538157
[0m20:14:11.538725 [debug] [Thread-1 (]: On model.customer360.stg_sf__contacts: ROLLBACK
[0m20:14:11.539089 [debug] [Thread-2 (]: On model.customer360.stg_web__transactions: Close
[0m20:14:11.541023 [debug] [Thread-1 (]: Timing info for model.customer360.stg_sf__contacts (execute): 20:14:11.522239 => 20:14:11.540751
[0m20:14:11.541464 [debug] [Thread-1 (]: On model.customer360.stg_sf__contacts: Close
[0m20:14:11.553733 [debug] [Thread-1 (]: Database Error in model stg_sf__contacts (models/staging/salesforce/stg_sf__contacts.sql)
  relation "public.contacts" does not exist
  LINE 13:     select * from "dbt"."public"."contacts"
                             ^
  compiled Code at target/run/customer360/models/staging/salesforce/stg_sf__contacts.sql
[0m20:14:11.554327 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c0471098-17bc-467d-81f1-83e6a09f1d62', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc82e761dd0>]}
[0m20:14:11.555394 [debug] [Thread-2 (]: Database Error in model stg_web__transactions (models/staging/web/stg_web__transactions.sql)
  relation "public.transactions" does not exist
  LINE 13:     select * from "dbt"."public"."transactions"
                             ^
  compiled Code at target/run/customer360/models/staging/web/stg_web__transactions.sql
[0m20:14:11.556395 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c0471098-17bc-467d-81f1-83e6a09f1d62', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc82e8430d0>]}
[0m20:14:11.556022 [error] [Thread-1 (]: 1 of 4 ERROR creating sql table model public.stg_sf__contacts .................. [[31mERROR[0m in 0.08s]
[0m20:14:11.557000 [error] [Thread-2 (]: 2 of 4 ERROR creating sql table model public.stg_web__transactions ............. [[31mERROR[0m in 0.08s]
[0m20:14:11.557606 [debug] [Thread-1 (]: Finished running node model.customer360.stg_sf__contacts
[0m20:14:11.558101 [debug] [Thread-2 (]: Finished running node model.customer360.stg_web__transactions
[0m20:14:11.559144 [debug] [Thread-3 (]: Began running node model.customer360.contacts_joined_with_transactions
[0m20:14:11.559552 [info ] [Thread-3 (]: 3 of 4 SKIP relation public.contacts_joined_with_transactions .................. [[33mSKIP[0m]
[0m20:14:11.559937 [debug] [Thread-3 (]: Finished running node model.customer360.contacts_joined_with_transactions
[0m20:14:11.560567 [debug] [Thread-2 (]: Began running node model.customer360.customers
[0m20:14:11.560953 [info ] [Thread-2 (]: 4 of 4 SKIP relation public.customers .......................................... [[33mSKIP[0m]
[0m20:14:11.561341 [debug] [Thread-2 (]: Finished running node model.customer360.customers
[0m20:14:11.562645 [debug] [MainThread]: Using postgres connection "master"
[0m20:14:11.562947 [debug] [MainThread]: On master: BEGIN
[0m20:14:11.563204 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m20:14:11.566373 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m20:14:11.566695 [debug] [MainThread]: On master: COMMIT
[0m20:14:11.566986 [debug] [MainThread]: Using postgres connection "master"
[0m20:14:11.567310 [debug] [MainThread]: On master: COMMIT
[0m20:14:11.567781 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m20:14:11.568070 [debug] [MainThread]: On master: Close
[0m20:14:11.568652 [debug] [MainThread]: Connection 'master' was properly closed.
[0m20:14:11.568901 [debug] [MainThread]: Connection 'model.customer360.stg_sf__contacts' was properly closed.
[0m20:14:11.569148 [debug] [MainThread]: Connection 'model.customer360.stg_web__transactions' was properly closed.
[0m20:14:11.569526 [info ] [MainThread]: 
[0m20:14:11.569920 [info ] [MainThread]: Finished running 3 table models, 1 view model in 0 hours 0 minutes and 0.15 seconds (0.15s).
[0m20:14:11.570939 [debug] [MainThread]: Command end result
[0m20:14:11.578425 [info ] [MainThread]: 
[0m20:14:11.578801 [info ] [MainThread]: [31mCompleted with 2 errors and 0 warnings:[0m
[0m20:14:11.579070 [info ] [MainThread]: 
[0m20:14:11.579376 [error] [MainThread]:   Database Error in model stg_sf__contacts (models/staging/salesforce/stg_sf__contacts.sql)
  relation "public.contacts" does not exist
  LINE 13:     select * from "dbt"."public"."contacts"
                             ^
  compiled Code at target/run/customer360/models/staging/salesforce/stg_sf__contacts.sql
[0m20:14:11.579652 [info ] [MainThread]: 
[0m20:14:11.579911 [error] [MainThread]:   Database Error in model stg_web__transactions (models/staging/web/stg_web__transactions.sql)
  relation "public.transactions" does not exist
  LINE 13:     select * from "dbt"."public"."transactions"
                             ^
  compiled Code at target/run/customer360/models/staging/web/stg_web__transactions.sql
[0m20:14:11.580176 [info ] [MainThread]: 
[0m20:14:11.580492 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=2 SKIP=2 TOTAL=4
[0m20:14:11.581182 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 0.49780232, "process_user_time": 1.995523, "process_kernel_time": 0.076058, "process_mem_max_rss": "102248", "process_in_blocks": "416", "process_out_blocks": "1728", "command_success": false}
[0m20:14:11.581708 [debug] [MainThread]: Command `dbt run` failed at 20:14:11.581597 after 0.50 seconds
[0m20:14:11.582029 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc834ad8f10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc834ad8ed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc8304e7e50>]}
[0m20:14:11.582373 [debug] [MainThread]: Flushing usage events
[0m20:15:06.547745 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5b87a54ed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5b87a94c10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5b87a42490>]}


============================== 20:15:06.550232 | 06c659c2-daea-4d93-b187-35c7e4f33b88 ==============================
[0m20:15:06.550232 [info ] [MainThread]: Running with dbt=1.7.8
[0m20:15:06.550730 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/root/option1-customer360/integration_tests', 'debug': 'False', 'version_check': 'True', 'log_path': '/root/option1-customer360/integration_tests/logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt seed', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m20:15:06.691270 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '06c659c2-daea-4d93-b187-35c7e4f33b88', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5b85fbf2d0>]}
[0m20:15:06.764694 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '06c659c2-daea-4d93-b187-35c7e4f33b88', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5b87989a10>]}
[0m20:15:06.765402 [info ] [MainThread]: Registered adapter: postgres=1.7.8
[0m20:15:06.776333 [debug] [MainThread]: checksum: 67f0013ca5f0bd43af9a0873dd50792fde83ef69de63b71cacd0b4ac656c52e5, vars: {}, profile: , target: , version: 1.7.8
[0m20:15:06.796006 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m20:15:06.796356 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m20:15:06.801718 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '06c659c2-daea-4d93-b187-35c7e4f33b88', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5b85daa410>]}
[0m20:15:06.809543 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '06c659c2-daea-4d93-b187-35c7e4f33b88', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5b85e90ad0>]}
[0m20:15:06.809946 [info ] [MainThread]: Found 2 seeds, 4 models, 6 tests, 2 sources, 0 exposures, 0 metrics, 403 macros, 0 groups, 0 semantic models
[0m20:15:06.810279 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '06c659c2-daea-4d93-b187-35c7e4f33b88', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5b860277d0>]}
[0m20:15:06.811796 [info ] [MainThread]: 
[0m20:15:06.812475 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m20:15:06.813490 [debug] [ThreadPool]: Acquiring new postgres connection 'list_dbt'
[0m20:15:06.822856 [debug] [ThreadPool]: Using postgres connection "list_dbt"
[0m20:15:06.823154 [debug] [ThreadPool]: On list_dbt: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "connection_name": "list_dbt"} */

    select distinct nspname from pg_namespace
  
[0m20:15:06.823478 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:15:06.828046 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.0 seconds
[0m20:15:06.829168 [debug] [ThreadPool]: On list_dbt: Close
[0m20:15:06.831846 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dbt, now list_dbt_public)
[0m20:15:06.837052 [debug] [ThreadPool]: Using postgres connection "list_dbt_public"
[0m20:15:06.837361 [debug] [ThreadPool]: On list_dbt_public: BEGIN
[0m20:15:06.837614 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:15:06.840539 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m20:15:06.840840 [debug] [ThreadPool]: Using postgres connection "list_dbt_public"
[0m20:15:06.841114 [debug] [ThreadPool]: On list_dbt_public: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "connection_name": "list_dbt_public"} */
select
      'dbt' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'dbt' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'dbt' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m20:15:06.843819 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.0 seconds
[0m20:15:06.844875 [debug] [ThreadPool]: On list_dbt_public: ROLLBACK
[0m20:15:06.845377 [debug] [ThreadPool]: On list_dbt_public: Close
[0m20:15:06.850586 [debug] [MainThread]: Using postgres connection "master"
[0m20:15:06.850888 [debug] [MainThread]: On master: BEGIN
[0m20:15:06.851144 [debug] [MainThread]: Opening a new connection, currently in state init
[0m20:15:06.854093 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m20:15:06.854414 [debug] [MainThread]: Using postgres connection "master"
[0m20:15:06.854762 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m20:15:06.857694 [debug] [MainThread]: SQL status: SELECT 0 in 0.0 seconds
[0m20:15:06.858714 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '06c659c2-daea-4d93-b187-35c7e4f33b88', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5b87a6b110>]}
[0m20:15:06.859097 [debug] [MainThread]: On master: ROLLBACK
[0m20:15:06.859582 [debug] [MainThread]: Using postgres connection "master"
[0m20:15:06.859864 [debug] [MainThread]: On master: BEGIN
[0m20:15:06.860541 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m20:15:06.860810 [debug] [MainThread]: On master: COMMIT
[0m20:15:06.861060 [debug] [MainThread]: Using postgres connection "master"
[0m20:15:06.861344 [debug] [MainThread]: On master: COMMIT
[0m20:15:06.861773 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m20:15:06.862046 [debug] [MainThread]: On master: Close
[0m20:15:06.863043 [info ] [MainThread]: Concurrency: 3 threads (target='local')
[0m20:15:06.863392 [info ] [MainThread]: 
[0m20:15:06.866214 [debug] [Thread-1 (]: Began running node seed.integration_tests.contacts
[0m20:15:06.866676 [debug] [Thread-2 (]: Began running node seed.integration_tests.transactions
[0m20:15:06.867090 [info ] [Thread-1 (]: 1 of 2 START seed file public.contacts ......................................... [RUN]
[0m20:15:06.867555 [info ] [Thread-2 (]: 2 of 2 START seed file public.transactions ..................................... [RUN]
[0m20:15:06.868228 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dbt_public, now seed.integration_tests.contacts)
[0m20:15:06.868916 [debug] [Thread-2 (]: Acquiring new postgres connection 'seed.integration_tests.transactions'
[0m20:15:06.869272 [debug] [Thread-1 (]: Began compiling node seed.integration_tests.contacts
[0m20:15:06.869653 [debug] [Thread-2 (]: Began compiling node seed.integration_tests.transactions
[0m20:15:06.870096 [debug] [Thread-1 (]: Timing info for seed.integration_tests.contacts (compile): 20:15:06.869897 => 20:15:06.869900
[0m20:15:06.870512 [debug] [Thread-2 (]: Timing info for seed.integration_tests.transactions (compile): 20:15:06.870325 => 20:15:06.870327
[0m20:15:06.870867 [debug] [Thread-1 (]: Began executing node seed.integration_tests.contacts
[0m20:15:06.871210 [debug] [Thread-2 (]: Began executing node seed.integration_tests.transactions
[0m20:15:06.900495 [debug] [Thread-1 (]: Using postgres connection "seed.integration_tests.contacts"
[0m20:15:06.903068 [debug] [Thread-2 (]: Using postgres connection "seed.integration_tests.transactions"
[0m20:15:06.903450 [debug] [Thread-1 (]: On seed.integration_tests.contacts: BEGIN
[0m20:15:06.903816 [debug] [Thread-2 (]: On seed.integration_tests.transactions: BEGIN
[0m20:15:06.904159 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:15:06.904532 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m20:15:06.909103 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m20:15:06.909570 [debug] [Thread-1 (]: Using postgres connection "seed.integration_tests.contacts"
[0m20:15:06.909904 [debug] [Thread-1 (]: On seed.integration_tests.contacts: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "seed.integration_tests.contacts"} */

    create table "dbt"."public"."contacts" ("id" text,"username" text,"name" text,"gender" text,"address" text,"mail" text,"birthdate" date,"_loaded_at_utc" timestamp)
  
[0m20:15:06.912347 [debug] [Thread-2 (]: SQL status: BEGIN in 0.0 seconds
[0m20:15:06.913849 [debug] [Thread-2 (]: Using postgres connection "seed.integration_tests.transactions"
[0m20:15:06.914203 [debug] [Thread-2 (]: On seed.integration_tests.transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "seed.integration_tests.transactions"} */

    create table "dbt"."public"."transactions" ("contact_id" text,"id" text,"transaction_date" text,"amount" float8,"item_count" integer,"category" text,"_loaded_at_utc" timestamp)
  
[0m20:15:06.914705 [debug] [Thread-1 (]: SQL status: CREATE TABLE in 0.0 seconds
[0m20:15:06.925590 [debug] [Thread-2 (]: SQL status: CREATE TABLE in 0.0 seconds
[0m20:15:06.966169 [debug] [Thread-1 (]: Using postgres connection "seed.integration_tests.contacts"
[0m20:15:06.971709 [debug] [Thread-1 (]: On seed.integration_tests.contacts: 
          insert into "dbt"."public"."contacts" ("id", "username", "name", "gender", "address", "mail", "birthdate", "_loaded_at_utc") values
          (%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s)
      ...
[0m20:15:06.978236 [debug] [Thread-1 (]: SQL status: INSERT 0 10 in 0.0 seconds
[0m20:15:06.993747 [debug] [Thread-1 (]: Writing runtime SQL for node "seed.integration_tests.contacts"
[0m20:15:07.037699 [debug] [Thread-1 (]: On seed.integration_tests.contacts: COMMIT
[0m20:15:07.048472 [debug] [Thread-1 (]: Using postgres connection "seed.integration_tests.contacts"
[0m20:15:07.053942 [debug] [Thread-1 (]: On seed.integration_tests.contacts: COMMIT
[0m20:15:07.072430 [debug] [Thread-1 (]: SQL status: COMMIT in 0.0 seconds
[0m20:15:07.073366 [debug] [Thread-1 (]: Timing info for seed.integration_tests.contacts (execute): 20:15:06.871462 => 20:15:07.073123
[0m20:15:07.078869 [debug] [Thread-1 (]: On seed.integration_tests.contacts: Close
[0m20:15:07.089780 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '06c659c2-daea-4d93-b187-35c7e4f33b88', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5b87996490>]}
[0m20:15:07.094330 [debug] [Thread-2 (]: Using postgres connection "seed.integration_tests.transactions"
[0m20:15:07.094851 [info ] [Thread-1 (]: 1 of 2 OK loaded seed file public.contacts ..................................... [[32mINSERT 10[0m in 0.22s]
[0m20:15:07.095364 [debug] [Thread-2 (]: On seed.integration_tests.transactions: 
          insert into "dbt"."public"."transactions" ("contact_id", "id", "transaction_date", "amount", "item_count", "category", "_loaded_at_utc") values
          (%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%...
[0m20:15:07.095925 [debug] [Thread-1 (]: Finished running node seed.integration_tests.contacts
[0m20:15:07.098260 [debug] [Thread-2 (]: SQL status: INSERT 0 74 in 0.0 seconds
[0m20:15:07.099003 [debug] [Thread-2 (]: Writing runtime SQL for node "seed.integration_tests.transactions"
[0m20:15:07.100873 [debug] [Thread-2 (]: On seed.integration_tests.transactions: COMMIT
[0m20:15:07.101187 [debug] [Thread-2 (]: Using postgres connection "seed.integration_tests.transactions"
[0m20:15:07.101508 [debug] [Thread-2 (]: On seed.integration_tests.transactions: COMMIT
[0m20:15:07.102877 [debug] [Thread-2 (]: SQL status: COMMIT in 0.0 seconds
[0m20:15:07.103647 [debug] [Thread-2 (]: Timing info for seed.integration_tests.transactions (execute): 20:15:06.885654 => 20:15:07.103463
[0m20:15:07.103962 [debug] [Thread-2 (]: On seed.integration_tests.transactions: Close
[0m20:15:07.104598 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '06c659c2-daea-4d93-b187-35c7e4f33b88', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5b85de3810>]}
[0m20:15:07.105018 [info ] [Thread-2 (]: 2 of 2 OK loaded seed file public.transactions ................................. [[32mINSERT 74[0m in 0.24s]
[0m20:15:07.105516 [debug] [Thread-2 (]: Finished running node seed.integration_tests.transactions
[0m20:15:07.107032 [debug] [MainThread]: Using postgres connection "master"
[0m20:15:07.107416 [debug] [MainThread]: On master: BEGIN
[0m20:15:07.107691 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m20:15:07.110820 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m20:15:07.111116 [debug] [MainThread]: On master: COMMIT
[0m20:15:07.111400 [debug] [MainThread]: Using postgres connection "master"
[0m20:15:07.111657 [debug] [MainThread]: On master: COMMIT
[0m20:15:07.112098 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m20:15:07.112397 [debug] [MainThread]: On master: Close
[0m20:15:07.113141 [debug] [MainThread]: Connection 'master' was properly closed.
[0m20:15:07.113462 [debug] [MainThread]: Connection 'seed.integration_tests.contacts' was properly closed.
[0m20:15:07.113798 [debug] [MainThread]: Connection 'seed.integration_tests.transactions' was properly closed.
[0m20:15:07.114176 [info ] [MainThread]: 
[0m20:15:07.114591 [info ] [MainThread]: Finished running 2 seeds in 0 hours 0 minutes and 0.30 seconds (0.30s).
[0m20:15:07.115351 [debug] [MainThread]: Command end result
[0m20:15:07.121829 [info ] [MainThread]: 
[0m20:15:07.122196 [info ] [MainThread]: [32mCompleted successfully[0m
[0m20:15:07.122492 [info ] [MainThread]: 
[0m20:15:07.122777 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
[0m20:15:07.123450 [debug] [MainThread]: Resource report: {"command_name": "seed", "command_success": true, "command_wall_clock_time": 0.6105754, "process_user_time": 2.098342, "process_kernel_time": 0.084053, "process_mem_max_rss": "102904", "process_out_blocks": "1704", "process_in_blocks": "0"}
[0m20:15:07.123888 [debug] [MainThread]: Command `dbt seed` succeeded at 20:15:07.123766 after 0.61 seconds
[0m20:15:07.124230 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5b8604fbd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5b880d1490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5b880d0b50>]}
[0m20:15:07.124597 [debug] [MainThread]: Flushing usage events
[0m20:20:04.984243 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f40ff127150>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f40ff17bb50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f40ff14d8d0>]}


============================== 20:20:04.986682 | fe8c3102-9549-4227-98ca-905dc36c0d34 ==============================
[0m20:20:04.986682 [info ] [MainThread]: Running with dbt=1.7.8
[0m20:20:04.987186 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/root/option1-customer360/integration_tests/logs', 'profiles_dir': '/root/option1-customer360/integration_tests', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'invocation_command': 'dbt run', 'log_format': 'default', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m20:20:05.128538 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'fe8c3102-9549-4227-98ca-905dc36c0d34', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f40ff071610>]}
[0m20:20:05.207338 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'fe8c3102-9549-4227-98ca-905dc36c0d34', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f40ff12efd0>]}
[0m20:20:05.208004 [info ] [MainThread]: Registered adapter: postgres=1.7.8
[0m20:20:05.218831 [debug] [MainThread]: checksum: 67f0013ca5f0bd43af9a0873dd50792fde83ef69de63b71cacd0b4ac656c52e5, vars: {}, profile: , target: , version: 1.7.8
[0m20:20:05.239045 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m20:20:05.239421 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m20:20:05.244786 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'fe8c3102-9549-4227-98ca-905dc36c0d34', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f40fefa8c90>]}
[0m20:20:05.253167 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'fe8c3102-9549-4227-98ca-905dc36c0d34', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f40ff071610>]}
[0m20:20:05.253621 [info ] [MainThread]: Found 2 seeds, 4 models, 6 tests, 2 sources, 0 exposures, 0 metrics, 403 macros, 0 groups, 0 semantic models
[0m20:20:05.253949 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'fe8c3102-9549-4227-98ca-905dc36c0d34', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f40fd708250>]}
[0m20:20:05.255456 [info ] [MainThread]: 
[0m20:20:05.256104 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m20:20:05.257262 [debug] [ThreadPool]: Acquiring new postgres connection 'list_dbt'
[0m20:20:05.266838 [debug] [ThreadPool]: Using postgres connection "list_dbt"
[0m20:20:05.267154 [debug] [ThreadPool]: On list_dbt: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "connection_name": "list_dbt"} */

    select distinct nspname from pg_namespace
  
[0m20:20:05.267457 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:20:05.272249 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.0 seconds
[0m20:20:05.273437 [debug] [ThreadPool]: On list_dbt: Close
[0m20:20:05.275246 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dbt, now list_dbt_public)
[0m20:20:05.280660 [debug] [ThreadPool]: Using postgres connection "list_dbt_public"
[0m20:20:05.280941 [debug] [ThreadPool]: On list_dbt_public: BEGIN
[0m20:20:05.281189 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:20:05.284179 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m20:20:05.284501 [debug] [ThreadPool]: Using postgres connection "list_dbt_public"
[0m20:20:05.284794 [debug] [ThreadPool]: On list_dbt_public: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "connection_name": "list_dbt_public"} */
select
      'dbt' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'dbt' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'dbt' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m20:20:05.287482 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.0 seconds
[0m20:20:05.288666 [debug] [ThreadPool]: On list_dbt_public: ROLLBACK
[0m20:20:05.289146 [debug] [ThreadPool]: On list_dbt_public: Close
[0m20:20:05.294338 [debug] [MainThread]: Using postgres connection "master"
[0m20:20:05.294633 [debug] [MainThread]: On master: BEGIN
[0m20:20:05.294893 [debug] [MainThread]: Opening a new connection, currently in state init
[0m20:20:05.298031 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m20:20:05.298348 [debug] [MainThread]: Using postgres connection "master"
[0m20:20:05.298711 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m20:20:05.305470 [debug] [MainThread]: SQL status: SELECT 0 in 0.0 seconds
[0m20:20:05.306534 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'fe8c3102-9549-4227-98ca-905dc36c0d34', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f40ff071610>]}
[0m20:20:05.306924 [debug] [MainThread]: On master: ROLLBACK
[0m20:20:05.307392 [debug] [MainThread]: Using postgres connection "master"
[0m20:20:05.307662 [debug] [MainThread]: On master: BEGIN
[0m20:20:05.308397 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m20:20:05.308677 [debug] [MainThread]: On master: COMMIT
[0m20:20:05.308958 [debug] [MainThread]: Using postgres connection "master"
[0m20:20:05.309238 [debug] [MainThread]: On master: COMMIT
[0m20:20:05.309686 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m20:20:05.309961 [debug] [MainThread]: On master: Close
[0m20:20:05.310600 [info ] [MainThread]: Concurrency: 3 threads (target='local')
[0m20:20:05.310892 [info ] [MainThread]: 
[0m20:20:05.313766 [debug] [Thread-1 (]: Began running node model.customer360.stg_sf__contacts
[0m20:20:05.314185 [debug] [Thread-2 (]: Began running node model.customer360.stg_web__transactions
[0m20:20:05.314623 [info ] [Thread-1 (]: 1 of 4 START sql table model public.stg_sf__contacts ........................... [RUN]
[0m20:20:05.315134 [info ] [Thread-2 (]: 2 of 4 START sql table model public.stg_web__transactions ...................... [RUN]
[0m20:20:05.315807 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dbt_public, now model.customer360.stg_sf__contacts)
[0m20:20:05.316473 [debug] [Thread-2 (]: Acquiring new postgres connection 'model.customer360.stg_web__transactions'
[0m20:20:05.316831 [debug] [Thread-1 (]: Began compiling node model.customer360.stg_sf__contacts
[0m20:20:05.317193 [debug] [Thread-2 (]: Began compiling node model.customer360.stg_web__transactions
[0m20:20:05.323815 [debug] [Thread-1 (]: Writing injected SQL for node "model.customer360.stg_sf__contacts"
[0m20:20:05.326930 [debug] [Thread-2 (]: Writing injected SQL for node "model.customer360.stg_web__transactions"
[0m20:20:05.327701 [debug] [Thread-1 (]: Timing info for model.customer360.stg_sf__contacts (compile): 20:20:05.317452 => 20:20:05.327407
[0m20:20:05.328156 [debug] [Thread-2 (]: Timing info for model.customer360.stg_web__transactions (compile): 20:20:05.324040 => 20:20:05.327940
[0m20:20:05.328534 [debug] [Thread-1 (]: Began executing node model.customer360.stg_sf__contacts
[0m20:20:05.328895 [debug] [Thread-2 (]: Began executing node model.customer360.stg_web__transactions
[0m20:20:05.382056 [debug] [Thread-1 (]: Writing runtime sql for node "model.customer360.stg_sf__contacts"
[0m20:20:05.382676 [debug] [Thread-2 (]: Writing runtime sql for node "model.customer360.stg_web__transactions"
[0m20:20:05.383494 [debug] [Thread-1 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m20:20:05.383914 [debug] [Thread-2 (]: Using postgres connection "model.customer360.stg_web__transactions"
[0m20:20:05.384240 [debug] [Thread-1 (]: On model.customer360.stg_sf__contacts: BEGIN
[0m20:20:05.384627 [debug] [Thread-2 (]: On model.customer360.stg_web__transactions: BEGIN
[0m20:20:05.384996 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:20:05.385356 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m20:20:05.390585 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m20:20:05.390962 [debug] [Thread-1 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m20:20:05.391281 [debug] [Thread-1 (]: On model.customer360.stg_sf__contacts: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_sf__contacts"} */

  
    

  create  table "dbt"."public"."stg_sf__contacts__dbt_tmp"
  
  
    as
  
  (
    with source as (
    select * from "dbt"."public"."contacts"
),

renamed as (
    select
        id,
        username as user_name,
        name,
        gender,
        address, 
        mail as email_address,
        birthdate as birth_date,
        _loaded_at_utc
    from source     
)

select * from renamed
  );
  
[0m20:20:05.391730 [debug] [Thread-2 (]: SQL status: BEGIN in 0.0 seconds
[0m20:20:05.392164 [debug] [Thread-2 (]: Using postgres connection "model.customer360.stg_web__transactions"
[0m20:20:05.392724 [debug] [Thread-2 (]: On model.customer360.stg_web__transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_web__transactions"} */

  
    

  create  table "dbt"."public"."stg_web__transactions__dbt_tmp"
  
  
    as
  
  (
    with source as (
    select * from "dbt"."public"."transactions"
),

renamed as (
    select
        id,
        contact_id,
        
    to_timestamp(transaction_date,'YYYY-MM-DD HH24:MI:SS.MS') :: timestamp at TIME zone 'UTC'
 as transaction_date,
        amount,
        item_count,
        category, 
        _loaded_at_utc
    from source     
)

select * from renamed
  );
  
[0m20:20:05.397858 [debug] [Thread-1 (]: SQL status: SELECT 10 in 0.0 seconds
[0m20:20:05.404806 [debug] [Thread-1 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m20:20:05.405194 [debug] [Thread-2 (]: SQL status: SELECT 74 in 0.0 seconds
[0m20:20:05.405542 [debug] [Thread-1 (]: On model.customer360.stg_sf__contacts: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_sf__contacts"} */
alter table "dbt"."public"."stg_sf__contacts__dbt_tmp" rename to "stg_sf__contacts"
[0m20:20:05.408206 [debug] [Thread-2 (]: Using postgres connection "model.customer360.stg_web__transactions"
[0m20:20:05.408664 [debug] [Thread-2 (]: On model.customer360.stg_web__transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_web__transactions"} */
alter table "dbt"."public"."stg_web__transactions__dbt_tmp" rename to "stg_web__transactions"
[0m20:20:05.409530 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m20:20:05.409917 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m20:20:05.426161 [debug] [Thread-2 (]: On model.customer360.stg_web__transactions: COMMIT
[0m20:20:05.427901 [debug] [Thread-1 (]: On model.customer360.stg_sf__contacts: COMMIT
[0m20:20:05.428306 [debug] [Thread-2 (]: Using postgres connection "model.customer360.stg_web__transactions"
[0m20:20:05.429045 [debug] [Thread-2 (]: On model.customer360.stg_web__transactions: COMMIT
[0m20:20:05.428681 [debug] [Thread-1 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m20:20:05.429498 [debug] [Thread-1 (]: On model.customer360.stg_sf__contacts: COMMIT
[0m20:20:05.431610 [debug] [Thread-2 (]: SQL status: COMMIT in 0.0 seconds
[0m20:20:05.437418 [debug] [Thread-2 (]: Applying DROP to: "dbt"."public"."stg_web__transactions__dbt_backup"
[0m20:20:05.441798 [debug] [Thread-2 (]: Using postgres connection "model.customer360.stg_web__transactions"
[0m20:20:05.442155 [debug] [Thread-1 (]: SQL status: COMMIT in 0.0 seconds
[0m20:20:05.442529 [debug] [Thread-2 (]: On model.customer360.stg_web__transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_web__transactions"} */
drop table if exists "dbt"."public"."stg_web__transactions__dbt_backup" cascade
[0m20:20:05.444760 [debug] [Thread-1 (]: Applying DROP to: "dbt"."public"."stg_sf__contacts__dbt_backup"
[0m20:20:05.445628 [debug] [Thread-1 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m20:20:05.445946 [debug] [Thread-1 (]: On model.customer360.stg_sf__contacts: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_sf__contacts"} */
drop table if exists "dbt"."public"."stg_sf__contacts__dbt_backup" cascade
[0m20:20:05.446526 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.0 seconds
[0m20:20:05.447863 [debug] [Thread-2 (]: Timing info for model.customer360.stg_web__transactions (execute): 20:20:05.344459 => 20:20:05.447631
[0m20:20:05.448219 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.0 seconds
[0m20:20:05.448701 [debug] [Thread-2 (]: On model.customer360.stg_web__transactions: Close
[0m20:20:05.450040 [debug] [Thread-1 (]: Timing info for model.customer360.stg_sf__contacts (execute): 20:20:05.329143 => 20:20:05.449819
[0m20:20:05.451402 [debug] [Thread-1 (]: On model.customer360.stg_sf__contacts: Close
[0m20:20:05.452233 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fe8c3102-9549-4227-98ca-905dc36c0d34', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f40fd6287d0>]}
[0m20:20:05.452983 [info ] [Thread-1 (]: 1 of 4 OK created sql table model public.stg_sf__contacts ...................... [[32mSELECT 10[0m in 0.14s]
[0m20:20:05.450964 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fe8c3102-9549-4227-98ca-905dc36c0d34', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f40fd560790>]}
[0m20:20:05.453814 [debug] [Thread-1 (]: Finished running node model.customer360.stg_sf__contacts
[0m20:20:05.454330 [info ] [Thread-2 (]: 2 of 4 OK created sql table model public.stg_web__transactions ................. [[32mSELECT 74[0m in 0.13s]
[0m20:20:05.455046 [debug] [Thread-2 (]: Finished running node model.customer360.stg_web__transactions
[0m20:20:05.455825 [debug] [Thread-3 (]: Began running node model.customer360.contacts_joined_with_transactions
[0m20:20:05.456249 [info ] [Thread-3 (]: 3 of 4 START sql view model public.contacts_joined_with_transactions ........... [RUN]
[0m20:20:05.456923 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.customer360.contacts_joined_with_transactions'
[0m20:20:05.457238 [debug] [Thread-3 (]: Began compiling node model.customer360.contacts_joined_with_transactions
[0m20:20:05.459975 [debug] [Thread-3 (]: Writing injected SQL for node "model.customer360.contacts_joined_with_transactions"
[0m20:20:05.460624 [debug] [Thread-3 (]: Timing info for model.customer360.contacts_joined_with_transactions (compile): 20:20:05.457459 => 20:20:05.460362
[0m20:20:05.460959 [debug] [Thread-3 (]: Began executing node model.customer360.contacts_joined_with_transactions
[0m20:20:05.477745 [debug] [Thread-3 (]: Writing runtime sql for node "model.customer360.contacts_joined_with_transactions"
[0m20:20:05.478328 [debug] [Thread-3 (]: Using postgres connection "model.customer360.contacts_joined_with_transactions"
[0m20:20:05.478683 [debug] [Thread-3 (]: On model.customer360.contacts_joined_with_transactions: BEGIN
[0m20:20:05.478981 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m20:20:05.482522 [debug] [Thread-3 (]: SQL status: BEGIN in 0.0 seconds
[0m20:20:05.482859 [debug] [Thread-3 (]: Using postgres connection "model.customer360.contacts_joined_with_transactions"
[0m20:20:05.483236 [debug] [Thread-3 (]: On model.customer360.contacts_joined_with_transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.contacts_joined_with_transactions"} */

  create view "dbt"."public"."contacts_joined_with_transactions__dbt_tmp"
    
    
  as (
    SELECT 
    contacts.*,
    transactions.id as transaction_id,
    transactions.transaction_date,
    transactions.amount,
    transactions.item_count,
    transactions.category
FROM "dbt"."public"."stg_web__transactions" as transactions
LEFT JOIN "dbt"."public"."stg_sf__contacts" as contacts ON contacts.id = transactions.contact_id
  );
[0m20:20:05.485381 [debug] [Thread-3 (]: SQL status: CREATE VIEW in 0.0 seconds
[0m20:20:05.488064 [debug] [Thread-3 (]: Using postgres connection "model.customer360.contacts_joined_with_transactions"
[0m20:20:05.488431 [debug] [Thread-3 (]: On model.customer360.contacts_joined_with_transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.contacts_joined_with_transactions"} */
alter table "dbt"."public"."contacts_joined_with_transactions__dbt_tmp" rename to "contacts_joined_with_transactions"
[0m20:20:05.489122 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m20:20:05.490761 [debug] [Thread-3 (]: On model.customer360.contacts_joined_with_transactions: COMMIT
[0m20:20:05.491085 [debug] [Thread-3 (]: Using postgres connection "model.customer360.contacts_joined_with_transactions"
[0m20:20:05.491423 [debug] [Thread-3 (]: On model.customer360.contacts_joined_with_transactions: COMMIT
[0m20:20:05.492872 [debug] [Thread-3 (]: SQL status: COMMIT in 0.0 seconds
[0m20:20:05.494887 [debug] [Thread-3 (]: Applying DROP to: "dbt"."public"."contacts_joined_with_transactions__dbt_backup"
[0m20:20:05.497818 [debug] [Thread-3 (]: Using postgres connection "model.customer360.contacts_joined_with_transactions"
[0m20:20:05.498150 [debug] [Thread-3 (]: On model.customer360.contacts_joined_with_transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.contacts_joined_with_transactions"} */
drop view if exists "dbt"."public"."contacts_joined_with_transactions__dbt_backup" cascade
[0m20:20:05.498763 [debug] [Thread-3 (]: SQL status: DROP VIEW in 0.0 seconds
[0m20:20:05.499999 [debug] [Thread-3 (]: Timing info for model.customer360.contacts_joined_with_transactions (execute): 20:20:05.461150 => 20:20:05.499801
[0m20:20:05.500350 [debug] [Thread-3 (]: On model.customer360.contacts_joined_with_transactions: Close
[0m20:20:05.501176 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fe8c3102-9549-4227-98ca-905dc36c0d34', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f40fd62d9d0>]}
[0m20:20:05.501853 [info ] [Thread-3 (]: 3 of 4 OK created sql view model public.contacts_joined_with_transactions ...... [[32mCREATE VIEW[0m in 0.04s]
[0m20:20:05.502554 [debug] [Thread-3 (]: Finished running node model.customer360.contacts_joined_with_transactions
[0m20:20:05.503263 [debug] [Thread-2 (]: Began running node model.customer360.customers
[0m20:20:05.503899 [info ] [Thread-2 (]: 4 of 4 START sql table model public.customers .................................. [RUN]
[0m20:20:05.504492 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.customer360.stg_web__transactions, now model.customer360.customers)
[0m20:20:05.504833 [debug] [Thread-2 (]: Began compiling node model.customer360.customers
[0m20:20:05.507932 [debug] [Thread-2 (]: Writing injected SQL for node "model.customer360.customers"
[0m20:20:05.508493 [debug] [Thread-2 (]: Timing info for model.customer360.customers (compile): 20:20:05.505025 => 20:20:05.508228
[0m20:20:05.508820 [debug] [Thread-2 (]: Began executing node model.customer360.customers
[0m20:20:05.513177 [debug] [Thread-2 (]: Writing runtime sql for node "model.customer360.customers"
[0m20:20:05.513694 [debug] [Thread-2 (]: Using postgres connection "model.customer360.customers"
[0m20:20:05.514053 [debug] [Thread-2 (]: On model.customer360.customers: BEGIN
[0m20:20:05.514407 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m20:20:05.517752 [debug] [Thread-2 (]: SQL status: BEGIN in 0.0 seconds
[0m20:20:05.518133 [debug] [Thread-2 (]: Using postgres connection "model.customer360.customers"
[0m20:20:05.518504 [debug] [Thread-2 (]: On model.customer360.customers: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.customers"} */

  
    

  create  table "dbt"."public"."customers__dbt_tmp"
  
  
    as
  
  (
    SELECT
    id,
    gender,
    
    date_part('year', age(current_date, birth_date))
 AS age,
    sum(amount) as total_expense
FROM "dbt"."public"."contacts_joined_with_transactions"
GROUP BY
    1,2,3
  );
  
[0m20:20:05.527401 [debug] [Thread-2 (]: SQL status: SELECT 9 in 0.0 seconds
[0m20:20:05.531559 [debug] [Thread-2 (]: Using postgres connection "model.customer360.customers"
[0m20:20:05.531887 [debug] [Thread-2 (]: On model.customer360.customers: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.customers"} */
alter table "dbt"."public"."customers__dbt_tmp" rename to "customers"
[0m20:20:05.532597 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m20:20:05.534200 [debug] [Thread-2 (]: On model.customer360.customers: COMMIT
[0m20:20:05.534553 [debug] [Thread-2 (]: Using postgres connection "model.customer360.customers"
[0m20:20:05.534844 [debug] [Thread-2 (]: On model.customer360.customers: COMMIT
[0m20:20:05.536190 [debug] [Thread-2 (]: SQL status: COMMIT in 0.0 seconds
[0m20:20:05.538338 [debug] [Thread-2 (]: Applying DROP to: "dbt"."public"."customers__dbt_backup"
[0m20:20:05.539033 [debug] [Thread-2 (]: Using postgres connection "model.customer360.customers"
[0m20:20:05.539367 [debug] [Thread-2 (]: On model.customer360.customers: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.customers"} */
drop table if exists "dbt"."public"."customers__dbt_backup" cascade
[0m20:20:05.539938 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.0 seconds
[0m20:20:05.541135 [debug] [Thread-2 (]: Timing info for model.customer360.customers (execute): 20:20:05.509009 => 20:20:05.540943
[0m20:20:05.541480 [debug] [Thread-2 (]: On model.customer360.customers: Close
[0m20:20:05.542445 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fe8c3102-9549-4227-98ca-905dc36c0d34', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f40fd5b5350>]}
[0m20:20:05.543089 [info ] [Thread-2 (]: 4 of 4 OK created sql table model public.customers ............................. [[32mSELECT 9[0m in 0.04s]
[0m20:20:05.543766 [debug] [Thread-2 (]: Finished running node model.customer360.customers
[0m20:20:05.545241 [debug] [MainThread]: Using postgres connection "master"
[0m20:20:05.545556 [debug] [MainThread]: On master: BEGIN
[0m20:20:05.545806 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m20:20:05.548984 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m20:20:05.549268 [debug] [MainThread]: On master: COMMIT
[0m20:20:05.549577 [debug] [MainThread]: Using postgres connection "master"
[0m20:20:05.549834 [debug] [MainThread]: On master: COMMIT
[0m20:20:05.550254 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m20:20:05.550588 [debug] [MainThread]: On master: Close
[0m20:20:05.551156 [debug] [MainThread]: Connection 'master' was properly closed.
[0m20:20:05.551437 [debug] [MainThread]: Connection 'model.customer360.stg_sf__contacts' was properly closed.
[0m20:20:05.551685 [debug] [MainThread]: Connection 'model.customer360.customers' was properly closed.
[0m20:20:05.551917 [debug] [MainThread]: Connection 'model.customer360.contacts_joined_with_transactions' was properly closed.
[0m20:20:05.552207 [info ] [MainThread]: 
[0m20:20:05.552552 [info ] [MainThread]: Finished running 3 table models, 1 view model in 0 hours 0 minutes and 0.30 seconds (0.30s).
[0m20:20:05.553545 [debug] [MainThread]: Command end result
[0m20:20:05.560423 [info ] [MainThread]: 
[0m20:20:05.560877 [info ] [MainThread]: [32mCompleted successfully[0m
[0m20:20:05.561156 [info ] [MainThread]: 
[0m20:20:05.561469 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 TOTAL=4
[0m20:20:05.562161 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 0.61377734, "process_user_time": 2.104031, "process_kernel_time": 0.089128, "process_mem_max_rss": "103424", "process_out_blocks": "1784", "process_in_blocks": "0"}
[0m20:20:05.562656 [debug] [MainThread]: Command `dbt run` succeeded at 20:20:05.562534 after 0.61 seconds
[0m20:20:05.562972 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f40ff14e210>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f410359ead0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4103718390>]}
[0m20:20:05.563288 [debug] [MainThread]: Flushing usage events
[0m21:25:24.810588 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f62cb431dd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f62cb432590>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f62cb430790>]}


============================== 21:25:24.812989 | 105cceb9-482a-4260-a919-10a6b637940c ==============================
[0m21:25:24.812989 [info ] [MainThread]: Running with dbt=1.7.8
[0m21:25:24.813489 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'profiles_dir': '/root/option1-customer360/integration_tests', 'log_path': '/root/option1-customer360/integration_tests/logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'invocation_command': 'dbt debug', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m21:25:24.813899 [info ] [MainThread]: dbt version: 1.7.8
[0m21:25:24.814204 [info ] [MainThread]: python version: 3.11.5
[0m21:25:24.814522 [info ] [MainThread]: python path: /root/miniconda3/bin/python
[0m21:25:24.814806 [info ] [MainThread]: os info: Linux-3.10.0-1160.99.1.el7.x86_64-x86_64-with-glibc2.17
[0m21:25:24.884607 [info ] [MainThread]: Using profiles dir at /root/option1-customer360/integration_tests
[0m21:25:24.885024 [info ] [MainThread]: Using profiles.yml file at /root/option1-customer360/integration_tests/profiles.yml
[0m21:25:24.885341 [info ] [MainThread]: Using dbt_project.yml file at /root/option1-customer360/integration_tests/dbt_project.yml
[0m21:25:24.885745 [info ] [MainThread]: adapter type: postgres
[0m21:25:24.886011 [info ] [MainThread]: adapter version: 1.7.8
[0m21:25:24.950018 [info ] [MainThread]: Configuration:
[0m21:25:24.950467 [info ] [MainThread]:   profiles.yml file [[32mOK found and valid[0m]
[0m21:25:24.950750 [info ] [MainThread]:   dbt_project.yml file [[32mOK found and valid[0m]
[0m21:25:24.951045 [info ] [MainThread]: Required dependencies:
[0m21:25:24.951366 [debug] [MainThread]: Executing "git --help"
[0m21:25:24.954694 [debug] [MainThread]: STDOUT: "b"usage: git [--version] [--help] [-c name=value]\n           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]\n           [-p|--paginate|--no-pager] [--no-replace-objects] [--bare]\n           [--git-dir=<path>] [--work-tree=<path>] [--namespace=<name>]\n           <command> [<args>]\n\nThe most commonly used git commands are:\n   add        Add file contents to the index\n   bisect     Find by binary search the change that introduced a bug\n   branch     List, create, or delete branches\n   checkout   Checkout a branch or paths to the working tree\n   clone      Clone a repository into a new directory\n   commit     Record changes to the repository\n   diff       Show changes between commits, commit and working tree, etc\n   fetch      Download objects and refs from another repository\n   grep       Print lines matching a pattern\n   init       Create an empty Git repository or reinitialize an existing one\n   log        Show commit logs\n   merge      Join two or more development histories together\n   mv         Move or rename a file, a directory, or a symlink\n   pull       Fetch from and merge with another repository or a local branch\n   push       Update remote refs along with associated objects\n   rebase     Forward-port local commits to the updated upstream head\n   reset      Reset current HEAD to the specified state\n   rm         Remove files from the working tree and from the index\n   show       Show various types of objects\n   status     Show the working tree status\n   tag        Create, list, delete or verify a tag object signed with GPG\n\n'git help -a' and 'git help -g' lists available subcommands and some\nconcept guides. See 'git help <command>' or 'git help <concept>'\nto read about a specific subcommand or concept.\n""
[0m21:25:24.955054 [debug] [MainThread]: STDERR: "b''"
[0m21:25:24.955328 [info ] [MainThread]:  - git [[32mOK found[0m]

[0m21:25:24.955601 [info ] [MainThread]: Connection:
[0m21:25:24.955868 [info ] [MainThread]:   host: localhost
[0m21:25:24.956133 [info ] [MainThread]:   port: 5432
[0m21:25:24.956406 [info ] [MainThread]:   user: dbt
[0m21:25:24.956654 [info ] [MainThread]:   database: dbt
[0m21:25:24.956895 [info ] [MainThread]:   schema: public
[0m21:25:24.957156 [info ] [MainThread]:   connect_timeout: 10
[0m21:25:24.957427 [info ] [MainThread]:   role: None
[0m21:25:24.957674 [info ] [MainThread]:   search_path: None
[0m21:25:24.957917 [info ] [MainThread]:   keepalives_idle: 0
[0m21:25:24.958187 [info ] [MainThread]:   sslmode: None
[0m21:25:24.958465 [info ] [MainThread]:   sslcert: None
[0m21:25:24.958707 [info ] [MainThread]:   sslkey: None
[0m21:25:24.958955 [info ] [MainThread]:   sslrootcert: None
[0m21:25:24.959217 [info ] [MainThread]:   application_name: dbt
[0m21:25:24.959492 [info ] [MainThread]:   retries: 1
[0m21:25:24.959814 [info ] [MainThread]: Registered adapter: postgres=1.7.8
[0m21:25:24.960450 [debug] [MainThread]: Acquiring new postgres connection 'debug'
[0m21:25:24.960725 [debug] [MainThread]: Using postgres connection "debug"
[0m21:25:24.960997 [debug] [MainThread]: On debug: select 1 as id
[0m21:25:24.961388 [debug] [MainThread]: Opening a new connection, currently in state init
[0m21:25:24.965522 [debug] [MainThread]: SQL status: SELECT 1 in 0.0 seconds
[0m21:25:24.966391 [debug] [MainThread]: On debug: Close
[0m21:25:24.966713 [info ] [MainThread]:   Connection test: [[32mOK connection ok[0m]

[0m21:25:24.967016 [info ] [MainThread]: [32mAll checks passed![0m
[0m21:25:24.967711 [debug] [MainThread]: Resource report: {"command_name": "debug", "command_success": true, "command_wall_clock_time": 0.1922662, "process_user_time": 1.715748, "process_kernel_time": 0.061062, "process_mem_max_rss": "94620", "process_out_blocks": "24", "process_in_blocks": "0"}
[0m21:25:24.968157 [debug] [MainThread]: Command `dbt debug` succeeded at 21:25:24.968046 after 0.19 seconds
[0m21:25:24.968453 [debug] [MainThread]: Connection 'debug' was properly closed.
[0m21:25:24.968742 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f62ccda96d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f62c99c4d50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f62cbedff50>]}
[0m21:25:24.969086 [debug] [MainThread]: Flushing usage events
[0m21:25:42.617284 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faadf87ae90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faadfeb4510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faadf83bf50>]}


============================== 21:25:42.619694 | eec61ac7-943f-4cc4-aa21-247b4b00b40c ==============================
[0m21:25:42.619694 [info ] [MainThread]: Running with dbt=1.7.8
[0m21:25:42.620151 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'profiles_dir': '/root/option1-customer360/integration_tests', 'log_path': '/root/option1-customer360/integration_tests/logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'log_format': 'default', 'target_path': 'None', 'invocation_command': 'dbt build', 'send_anonymous_usage_stats': 'True'}
[0m21:25:42.760584 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'eec61ac7-943f-4cc4-aa21-247b4b00b40c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faaddd68a10>]}
[0m21:25:42.835034 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'eec61ac7-943f-4cc4-aa21-247b4b00b40c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faadf76d9d0>]}
[0m21:25:42.835701 [info ] [MainThread]: Registered adapter: postgres=1.7.8
[0m21:25:42.847331 [debug] [MainThread]: checksum: 67f0013ca5f0bd43af9a0873dd50792fde83ef69de63b71cacd0b4ac656c52e5, vars: {}, profile: , target: , version: 1.7.8
[0m21:25:42.867240 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m21:25:42.867997 [debug] [MainThread]: Partial parsing: updated file: customer360://models/staging/web/_web__sources.yml
[0m21:25:43.197702 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'eec61ac7-943f-4cc4-aa21-247b4b00b40c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faadd499990>]}
[0m21:25:43.205737 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'eec61ac7-943f-4cc4-aa21-247b4b00b40c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faaddbd9310>]}
[0m21:25:43.206152 [info ] [MainThread]: Found 2 seeds, 4 models, 7 tests, 2 sources, 0 exposures, 0 metrics, 403 macros, 0 groups, 0 semantic models
[0m21:25:43.208044 [info ] [MainThread]: 
[0m21:25:43.208715 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m21:25:43.209872 [debug] [ThreadPool]: Acquiring new postgres connection 'list_dbt'
[0m21:25:43.218980 [debug] [ThreadPool]: Using postgres connection "list_dbt"
[0m21:25:43.219289 [debug] [ThreadPool]: On list_dbt: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "connection_name": "list_dbt"} */

    select distinct nspname from pg_namespace
  
[0m21:25:43.219571 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:25:43.224048 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.0 seconds
[0m21:25:43.225185 [debug] [ThreadPool]: On list_dbt: Close
[0m21:25:43.226981 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dbt, now list_dbt_public)
[0m21:25:43.232125 [debug] [ThreadPool]: Using postgres connection "list_dbt_public"
[0m21:25:43.232506 [debug] [ThreadPool]: On list_dbt_public: BEGIN
[0m21:25:43.232776 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:25:43.236129 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m21:25:43.236451 [debug] [ThreadPool]: Using postgres connection "list_dbt_public"
[0m21:25:43.236729 [debug] [ThreadPool]: On list_dbt_public: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "connection_name": "list_dbt_public"} */
select
      'dbt' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'dbt' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'dbt' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m21:25:43.239445 [debug] [ThreadPool]: SQL status: SELECT 6 in 0.0 seconds
[0m21:25:43.240690 [debug] [ThreadPool]: On list_dbt_public: ROLLBACK
[0m21:25:43.241171 [debug] [ThreadPool]: On list_dbt_public: Close
[0m21:25:43.246716 [debug] [MainThread]: Using postgres connection "master"
[0m21:25:43.246999 [debug] [MainThread]: On master: BEGIN
[0m21:25:43.247277 [debug] [MainThread]: Opening a new connection, currently in state init
[0m21:25:43.250392 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m21:25:43.250714 [debug] [MainThread]: Using postgres connection "master"
[0m21:25:43.251116 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m21:25:43.260784 [debug] [MainThread]: SQL status: SELECT 2 in 0.0 seconds
[0m21:25:43.262260 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'eec61ac7-943f-4cc4-aa21-247b4b00b40c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faadd3a80d0>]}
[0m21:25:43.262677 [debug] [MainThread]: On master: ROLLBACK
[0m21:25:43.263139 [debug] [MainThread]: Using postgres connection "master"
[0m21:25:43.263429 [debug] [MainThread]: On master: BEGIN
[0m21:25:43.264049 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m21:25:43.264378 [debug] [MainThread]: On master: COMMIT
[0m21:25:43.264646 [debug] [MainThread]: Using postgres connection "master"
[0m21:25:43.264983 [debug] [MainThread]: On master: COMMIT
[0m21:25:43.265457 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m21:25:43.265749 [debug] [MainThread]: On master: Close
[0m21:25:43.266465 [info ] [MainThread]: Concurrency: 3 threads (target='local')
[0m21:25:43.266865 [info ] [MainThread]: 
[0m21:25:43.270026 [debug] [Thread-1 (]: Began running node seed.integration_tests.contacts
[0m21:25:43.270434 [debug] [Thread-2 (]: Began running node seed.integration_tests.transactions
[0m21:25:43.270856 [info ] [Thread-1 (]: 1 of 13 START seed file public.contacts ........................................ [RUN]
[0m21:25:43.271326 [info ] [Thread-2 (]: 2 of 13 START seed file public.transactions .................................... [RUN]
[0m21:25:43.271717 [debug] [Thread-3 (]: Began running node test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247
[0m21:25:43.272375 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dbt_public, now seed.integration_tests.contacts)
[0m21:25:43.273029 [debug] [Thread-2 (]: Acquiring new postgres connection 'seed.integration_tests.transactions'
[0m21:25:43.273423 [info ] [Thread-3 (]: 3 of 13 START test source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors  [RUN]
[0m21:25:43.273844 [debug] [Thread-1 (]: Began compiling node seed.integration_tests.contacts
[0m21:25:43.274186 [debug] [Thread-2 (]: Began compiling node seed.integration_tests.transactions
[0m21:25:43.274868 [debug] [Thread-3 (]: Acquiring new postgres connection 'test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247'
[0m21:25:43.275323 [debug] [Thread-1 (]: Timing info for seed.integration_tests.contacts (compile): 21:25:43.275108 => 21:25:43.275111
[0m21:25:43.275752 [debug] [Thread-2 (]: Timing info for seed.integration_tests.transactions (compile): 21:25:43.275551 => 21:25:43.275553
[0m21:25:43.276119 [debug] [Thread-3 (]: Began compiling node test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247
[0m21:25:43.276469 [debug] [Thread-1 (]: Began executing node seed.integration_tests.contacts
[0m21:25:43.276826 [debug] [Thread-2 (]: Began executing node seed.integration_tests.transactions
[0m21:25:43.341965 [debug] [Thread-3 (]: Writing injected SQL for node "test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247"
[0m21:25:43.370667 [debug] [Thread-3 (]: Timing info for test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247 (compile): 21:25:43.277048 => 21:25:43.370288
[0m21:25:43.371236 [debug] [Thread-3 (]: Began executing node test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247
[0m21:25:43.391893 [debug] [Thread-3 (]: Writing runtime sql for node "test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247"
[0m21:25:43.396012 [debug] [Thread-1 (]: Using postgres connection "seed.integration_tests.contacts"
[0m21:25:43.397027 [debug] [Thread-2 (]: Using postgres connection "seed.integration_tests.transactions"
[0m21:25:43.397797 [debug] [Thread-2 (]: On seed.integration_tests.transactions: BEGIN
[0m21:25:43.397408 [debug] [Thread-1 (]: On seed.integration_tests.contacts: BEGIN
[0m21:25:43.398524 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:25:43.398131 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m21:25:43.399107 [debug] [Thread-3 (]: Using postgres connection "test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247"
[0m21:25:43.400136 [debug] [Thread-3 (]: On test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247: BEGIN
[0m21:25:43.400694 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m21:25:43.403633 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m21:25:43.404101 [debug] [Thread-1 (]: Using postgres connection "seed.integration_tests.contacts"
[0m21:25:43.404597 [debug] [Thread-1 (]: On seed.integration_tests.contacts: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "seed.integration_tests.contacts"} */
truncate table "dbt"."public"."contacts"
[0m21:25:43.406166 [debug] [Thread-2 (]: SQL status: BEGIN in 0.0 seconds
[0m21:25:43.406672 [debug] [Thread-3 (]: SQL status: BEGIN in 0.0 seconds
[0m21:25:43.407398 [debug] [Thread-3 (]: Using postgres connection "test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247"
[0m21:25:43.409066 [debug] [Thread-3 (]: On test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

with all_values as (

    select
        category as value_field,
        count(*) as n_records

    from "dbt"."public"."transactions"
    group by category

)

select *
from all_values
where value_field not in (
    'Apps & Games','Beauty','Books','Clothing, Shoes & Accessories','Movies & TV','Sports, Fitness & Outdoors'
)



      
    ) dbt_internal_test
[0m21:25:43.406992 [debug] [Thread-2 (]: Using postgres connection "seed.integration_tests.transactions"
[0m21:25:43.409528 [debug] [Thread-2 (]: On seed.integration_tests.transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "seed.integration_tests.transactions"} */
truncate table "dbt"."public"."transactions"
[0m21:25:43.410775 [debug] [Thread-1 (]: SQL status: TRUNCATE TABLE in 0.0 seconds
[0m21:25:43.417820 [debug] [Thread-2 (]: SQL status: TRUNCATE TABLE in 0.0 seconds
[0m21:25:43.457705 [debug] [Thread-1 (]: Using postgres connection "seed.integration_tests.contacts"
[0m21:25:43.463227 [debug] [Thread-1 (]: On seed.integration_tests.contacts: 
          insert into "dbt"."public"."contacts" ("id", "username", "name", "gender", "address", "mail", "birthdate", "_loaded_at_utc") values
          (%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s)
      ...
[0m21:25:43.474891 [debug] [Thread-1 (]: SQL status: INSERT 0 10 in 0.0 seconds
[0m21:25:43.490608 [debug] [Thread-1 (]: Writing runtime SQL for node "seed.integration_tests.contacts"
[0m21:25:43.539792 [debug] [Thread-1 (]: On seed.integration_tests.contacts: COMMIT
[0m21:25:43.545397 [debug] [Thread-1 (]: Using postgres connection "seed.integration_tests.contacts"
[0m21:25:43.550846 [debug] [Thread-1 (]: On seed.integration_tests.contacts: COMMIT
[0m21:25:43.563052 [debug] [Thread-1 (]: SQL status: COMMIT in 0.0 seconds
[0m21:25:43.569028 [debug] [Thread-1 (]: Timing info for seed.integration_tests.contacts (execute): 21:25:43.342330 => 21:25:43.568830
[0m21:25:43.574476 [debug] [Thread-1 (]: On seed.integration_tests.contacts: Close
[0m21:25:43.580269 [debug] [Thread-2 (]: Using postgres connection "seed.integration_tests.transactions"
[0m21:25:43.580753 [debug] [Thread-2 (]: On seed.integration_tests.transactions: 
          insert into "dbt"."public"."transactions" ("contact_id", "id", "transaction_date", "amount", "item_count", "category", "_loaded_at_utc") values
          (%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%...
[0m21:25:43.582396 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'eec61ac7-943f-4cc4-aa21-247b4b00b40c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faaddb70850>]}
[0m21:25:43.583055 [info ] [Thread-1 (]: 1 of 13 OK loaded seed file public.contacts .................................... [[32mINSERT 10[0m in 0.31s]
[0m21:25:43.583792 [debug] [Thread-1 (]: Finished running node seed.integration_tests.contacts
[0m21:25:43.584341 [debug] [Thread-1 (]: Began running node test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d
[0m21:25:43.584711 [debug] [Thread-2 (]: SQL status: INSERT 0 74 in 0.0 seconds
[0m21:25:43.585262 [info ] [Thread-1 (]: 4 of 13 START test source_not_null_salesforce_contacts_id ...................... [RUN]
[0m21:25:43.586111 [debug] [Thread-2 (]: Writing runtime SQL for node "seed.integration_tests.transactions"
[0m21:25:43.586731 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly seed.integration_tests.contacts, now test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d)
[0m21:25:43.587224 [debug] [Thread-1 (]: Began compiling node test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d
[0m21:25:43.594044 [debug] [Thread-2 (]: On seed.integration_tests.transactions: COMMIT
[0m21:25:43.595376 [debug] [Thread-1 (]: Writing injected SQL for node "test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d"
[0m21:25:43.595728 [debug] [Thread-2 (]: Using postgres connection "seed.integration_tests.transactions"
[0m21:25:43.596205 [debug] [Thread-2 (]: On seed.integration_tests.transactions: COMMIT
[0m21:25:43.596852 [debug] [Thread-1 (]: Timing info for test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d (compile): 21:25:43.587485 => 21:25:43.596519
[0m21:25:43.597188 [debug] [Thread-1 (]: Began executing node test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d
[0m21:25:43.599570 [debug] [Thread-1 (]: Writing runtime sql for node "test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d"
[0m21:25:43.600644 [debug] [Thread-1 (]: Using postgres connection "test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d"
[0m21:25:43.601166 [debug] [Thread-1 (]: On test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d: BEGIN
[0m21:25:43.600029 [debug] [Thread-2 (]: SQL status: COMMIT in 0.0 seconds
[0m21:25:43.601638 [debug] [Thread-3 (]: SQL status: SELECT 1 in 0.0 seconds
[0m21:25:43.601993 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:25:43.602881 [debug] [Thread-2 (]: Timing info for seed.integration_tests.transactions (execute): 21:25:43.356324 => 21:25:43.602641
[0m21:25:43.605217 [debug] [Thread-2 (]: On seed.integration_tests.transactions: Close
[0m21:25:43.605947 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'eec61ac7-943f-4cc4-aa21-247b4b00b40c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faaddb08210>]}
[0m21:25:43.606445 [info ] [Thread-2 (]: 2 of 13 OK loaded seed file public.transactions ................................ [[32mINSERT 74[0m in 0.33s]
[0m21:25:43.606939 [debug] [Thread-2 (]: Finished running node seed.integration_tests.transactions
[0m21:25:43.604639 [debug] [Thread-3 (]: Timing info for test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247 (execute): 21:25:43.371549 => 21:25:43.604424
[0m21:25:43.608845 [debug] [Thread-3 (]: On test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247: ROLLBACK
[0m21:25:43.607520 [debug] [Thread-2 (]: Began running node test.customer360.source_not_null_web_transactions_id.88a47bf7e5
[0m21:25:43.609397 [info ] [Thread-2 (]: 5 of 13 START test source_not_null_web_transactions_id ......................... [RUN]
[0m21:25:43.610083 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly seed.integration_tests.transactions, now test.customer360.source_not_null_web_transactions_id.88a47bf7e5)
[0m21:25:43.610460 [debug] [Thread-2 (]: Began compiling node test.customer360.source_not_null_web_transactions_id.88a47bf7e5
[0m21:25:43.614509 [debug] [Thread-2 (]: Writing injected SQL for node "test.customer360.source_not_null_web_transactions_id.88a47bf7e5"
[0m21:25:43.615194 [debug] [Thread-2 (]: Timing info for test.customer360.source_not_null_web_transactions_id.88a47bf7e5 (compile): 21:25:43.610662 => 21:25:43.614898
[0m21:25:43.615744 [debug] [Thread-2 (]: Began executing node test.customer360.source_not_null_web_transactions_id.88a47bf7e5
[0m21:25:43.617977 [debug] [Thread-2 (]: Writing runtime sql for node "test.customer360.source_not_null_web_transactions_id.88a47bf7e5"
[0m21:25:43.619008 [debug] [Thread-2 (]: Using postgres connection "test.customer360.source_not_null_web_transactions_id.88a47bf7e5"
[0m21:25:43.619403 [debug] [Thread-2 (]: On test.customer360.source_not_null_web_transactions_id.88a47bf7e5: BEGIN
[0m21:25:43.618454 [debug] [Thread-3 (]: On test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247: Close
[0m21:25:43.619816 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m21:25:43.620569 [debug] [Thread-1 (]: Using postgres connection "test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d"
[0m21:25:43.622002 [debug] [Thread-1 (]: On test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select id
from "dbt"."public"."contacts"
where id is null



      
    ) dbt_internal_test
[0m21:25:43.621510 [info ] [Thread-3 (]: 3 of 13 PASS source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors  [[32mPASS[0m in 0.35s]
[0m21:25:43.620133 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m21:25:43.622850 [debug] [Thread-3 (]: Finished running node test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247
[0m21:25:43.623643 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.0 seconds
[0m21:25:43.624139 [debug] [Thread-3 (]: Began running node test.customer360.source_unique_salesforce_contacts_id.01cadaaf43
[0m21:25:43.626825 [info ] [Thread-3 (]: 6 of 13 START test source_unique_salesforce_contacts_id ........................ [RUN]
[0m21:25:43.626181 [debug] [Thread-1 (]: Timing info for test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d (execute): 21:25:43.597421 => 21:25:43.625865
[0m21:25:43.627590 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247, now test.customer360.source_unique_salesforce_contacts_id.01cadaaf43)
[0m21:25:43.628052 [debug] [Thread-1 (]: On test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d: ROLLBACK
[0m21:25:43.628534 [debug] [Thread-2 (]: SQL status: BEGIN in 0.0 seconds
[0m21:25:43.628890 [debug] [Thread-3 (]: Began compiling node test.customer360.source_unique_salesforce_contacts_id.01cadaaf43
[0m21:25:43.629286 [debug] [Thread-2 (]: Using postgres connection "test.customer360.source_not_null_web_transactions_id.88a47bf7e5"
[0m21:25:43.629742 [debug] [Thread-1 (]: On test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d: Close
[0m21:25:43.635990 [debug] [Thread-3 (]: Writing injected SQL for node "test.customer360.source_unique_salesforce_contacts_id.01cadaaf43"
[0m21:25:43.637855 [debug] [Thread-3 (]: Timing info for test.customer360.source_unique_salesforce_contacts_id.01cadaaf43 (compile): 21:25:43.629981 => 21:25:43.637560
[0m21:25:43.638282 [debug] [Thread-3 (]: Began executing node test.customer360.source_unique_salesforce_contacts_id.01cadaaf43
[0m21:25:43.640765 [debug] [Thread-3 (]: Writing runtime sql for node "test.customer360.source_unique_salesforce_contacts_id.01cadaaf43"
[0m21:25:43.637126 [info ] [Thread-1 (]: 4 of 13 PASS source_not_null_salesforce_contacts_id ............................ [[32mPASS[0m in 0.05s]
[0m21:25:43.636363 [debug] [Thread-2 (]: On test.customer360.source_not_null_web_transactions_id.88a47bf7e5: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.source_not_null_web_transactions_id.88a47bf7e5"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select id
from "dbt"."public"."transactions"
where id is null



      
    ) dbt_internal_test
[0m21:25:43.641186 [debug] [Thread-3 (]: Using postgres connection "test.customer360.source_unique_salesforce_contacts_id.01cadaaf43"
[0m21:25:43.642003 [debug] [Thread-1 (]: Finished running node test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d
[0m21:25:43.642426 [debug] [Thread-3 (]: On test.customer360.source_unique_salesforce_contacts_id.01cadaaf43: BEGIN
[0m21:25:43.643259 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m21:25:43.642863 [debug] [Thread-1 (]: Began running node test.customer360.source_unique_web_transactions_id.ba28079761
[0m21:25:43.644799 [debug] [Thread-2 (]: SQL status: SELECT 1 in 0.0 seconds
[0m21:25:43.646180 [debug] [Thread-2 (]: Timing info for test.customer360.source_not_null_web_transactions_id.88a47bf7e5 (execute): 21:25:43.616026 => 21:25:43.645978
[0m21:25:43.646726 [debug] [Thread-2 (]: On test.customer360.source_not_null_web_transactions_id.88a47bf7e5: ROLLBACK
[0m21:25:43.644386 [info ] [Thread-1 (]: 7 of 13 START test source_unique_web_transactions_id ........................... [RUN]
[0m21:25:43.647642 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d, now test.customer360.source_unique_web_transactions_id.ba28079761)
[0m21:25:43.648166 [debug] [Thread-1 (]: Began compiling node test.customer360.source_unique_web_transactions_id.ba28079761
[0m21:25:43.652110 [debug] [Thread-1 (]: Writing injected SQL for node "test.customer360.source_unique_web_transactions_id.ba28079761"
[0m21:25:43.653131 [debug] [Thread-1 (]: Timing info for test.customer360.source_unique_web_transactions_id.ba28079761 (compile): 21:25:43.648471 => 21:25:43.652849
[0m21:25:43.652499 [debug] [Thread-2 (]: On test.customer360.source_not_null_web_transactions_id.88a47bf7e5: Close
[0m21:25:43.654216 [info ] [Thread-2 (]: 5 of 13 PASS source_not_null_web_transactions_id ............................... [[32mPASS[0m in 0.04s]
[0m21:25:43.654888 [debug] [Thread-2 (]: Finished running node test.customer360.source_not_null_web_transactions_id.88a47bf7e5
[0m21:25:43.655411 [debug] [Thread-2 (]: Began running node test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344
[0m21:25:43.656592 [info ] [Thread-2 (]: 8 of 13 START test source_relationships_web_transactions_contact_id__id__ref_contacts_  [RUN]
[0m21:25:43.653494 [debug] [Thread-1 (]: Began executing node test.customer360.source_unique_web_transactions_id.ba28079761
[0m21:25:43.657174 [debug] [Thread-3 (]: SQL status: BEGIN in 0.0 seconds
[0m21:25:43.657747 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.customer360.source_not_null_web_transactions_id.88a47bf7e5, now test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344)
[0m21:25:43.659983 [debug] [Thread-1 (]: Writing runtime sql for node "test.customer360.source_unique_web_transactions_id.ba28079761"
[0m21:25:43.660381 [debug] [Thread-3 (]: Using postgres connection "test.customer360.source_unique_salesforce_contacts_id.01cadaaf43"
[0m21:25:43.660753 [debug] [Thread-2 (]: Began compiling node test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344
[0m21:25:43.665686 [debug] [Thread-2 (]: Writing injected SQL for node "test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344"
[0m21:25:43.666647 [debug] [Thread-2 (]: Timing info for test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344 (compile): 21:25:43.661566 => 21:25:43.666385
[0m21:25:43.666075 [debug] [Thread-1 (]: Using postgres connection "test.customer360.source_unique_web_transactions_id.ba28079761"
[0m21:25:43.667008 [debug] [Thread-2 (]: Began executing node test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344
[0m21:25:43.661263 [debug] [Thread-3 (]: On test.customer360.source_unique_salesforce_contacts_id.01cadaaf43: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.source_unique_salesforce_contacts_id.01cadaaf43"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

select
    id as unique_field,
    count(*) as n_records

from "dbt"."public"."contacts"
where id is not null
group by id
having count(*) > 1



      
    ) dbt_internal_test
[0m21:25:43.667398 [debug] [Thread-1 (]: On test.customer360.source_unique_web_transactions_id.ba28079761: BEGIN
[0m21:25:43.669378 [debug] [Thread-2 (]: Writing runtime sql for node "test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344"
[0m21:25:43.670427 [debug] [Thread-2 (]: Using postgres connection "test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344"
[0m21:25:43.670891 [debug] [Thread-2 (]: On test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344: BEGIN
[0m21:25:43.671536 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m21:25:43.669804 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:25:43.671972 [debug] [Thread-3 (]: SQL status: SELECT 1 in 0.0 seconds
[0m21:25:43.673990 [debug] [Thread-3 (]: Timing info for test.customer360.source_unique_salesforce_contacts_id.01cadaaf43 (execute): 21:25:43.638556 => 21:25:43.673728
[0m21:25:43.674454 [debug] [Thread-3 (]: On test.customer360.source_unique_salesforce_contacts_id.01cadaaf43: ROLLBACK
[0m21:25:43.676436 [debug] [Thread-3 (]: On test.customer360.source_unique_salesforce_contacts_id.01cadaaf43: Close
[0m21:25:43.677497 [info ] [Thread-3 (]: 6 of 13 PASS source_unique_salesforce_contacts_id .............................. [[32mPASS[0m in 0.05s]
[0m21:25:43.678181 [debug] [Thread-3 (]: Finished running node test.customer360.source_unique_salesforce_contacts_id.01cadaaf43
[0m21:25:43.679137 [debug] [Thread-3 (]: Began running node model.customer360.stg_sf__contacts
[0m21:25:43.679625 [debug] [Thread-2 (]: SQL status: BEGIN in 0.0 seconds
[0m21:25:43.680019 [info ] [Thread-3 (]: 9 of 13 START sql table model public.stg_sf__contacts .......................... [RUN]
[0m21:25:43.680486 [debug] [Thread-2 (]: Using postgres connection "test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344"
[0m21:25:43.680836 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m21:25:43.681435 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.customer360.source_unique_salesforce_contacts_id.01cadaaf43, now model.customer360.stg_sf__contacts)
[0m21:25:43.681848 [debug] [Thread-2 (]: On test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

with child as (
    select contact_id as from_field
    from "dbt"."public"."transactions"
    where contact_id is not null
),

parent as (
    select id as to_field
    from "dbt"."public"."contacts"
)

select
    from_field

from child
left join parent
    on child.from_field = parent.to_field

where parent.to_field is null



      
    ) dbt_internal_test
[0m21:25:43.682226 [debug] [Thread-1 (]: Using postgres connection "test.customer360.source_unique_web_transactions_id.ba28079761"
[0m21:25:43.683072 [debug] [Thread-1 (]: On test.customer360.source_unique_web_transactions_id.ba28079761: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.source_unique_web_transactions_id.ba28079761"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

select
    id as unique_field,
    count(*) as n_records

from "dbt"."public"."transactions"
where id is not null
group by id
having count(*) > 1



      
    ) dbt_internal_test
[0m21:25:43.682619 [debug] [Thread-3 (]: Began compiling node model.customer360.stg_sf__contacts
[0m21:25:43.688093 [debug] [Thread-3 (]: Writing injected SQL for node "model.customer360.stg_sf__contacts"
[0m21:25:43.688476 [debug] [Thread-2 (]: SQL status: SELECT 1 in 0.0 seconds
[0m21:25:43.690195 [debug] [Thread-2 (]: Timing info for test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344 (execute): 21:25:43.667621 => 21:25:43.689986
[0m21:25:43.690665 [debug] [Thread-2 (]: On test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344: ROLLBACK
[0m21:25:43.688840 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.0 seconds
[0m21:25:43.692049 [debug] [Thread-1 (]: Timing info for test.customer360.source_unique_web_transactions_id.ba28079761 (execute): 21:25:43.657995 => 21:25:43.691829
[0m21:25:43.692526 [debug] [Thread-3 (]: Timing info for model.customer360.stg_sf__contacts (compile): 21:25:43.683375 => 21:25:43.692256
[0m21:25:43.692893 [debug] [Thread-2 (]: On test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344: Close
[0m21:25:43.693220 [debug] [Thread-1 (]: On test.customer360.source_unique_web_transactions_id.ba28079761: ROLLBACK
[0m21:25:43.693595 [debug] [Thread-3 (]: Began executing node model.customer360.stg_sf__contacts
[0m21:25:43.700960 [debug] [Thread-1 (]: On test.customer360.source_unique_web_transactions_id.ba28079761: Close
[0m21:25:43.707551 [info ] [Thread-1 (]: 7 of 13 PASS source_unique_web_transactions_id ................................. [[32mPASS[0m in 0.06s]
[0m21:25:43.706789 [info ] [Thread-2 (]: 8 of 13 PASS source_relationships_web_transactions_contact_id__id__ref_contacts_  [[32mPASS[0m in 0.05s]
[0m21:25:43.728881 [debug] [Thread-2 (]: Finished running node test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344
[0m21:25:43.713207 [debug] [Thread-1 (]: Finished running node test.customer360.source_unique_web_transactions_id.ba28079761
[0m21:25:43.729552 [debug] [Thread-3 (]: Writing runtime sql for node "model.customer360.stg_sf__contacts"
[0m21:25:43.730353 [debug] [Thread-3 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m21:25:43.730691 [debug] [Thread-3 (]: On model.customer360.stg_sf__contacts: BEGIN
[0m21:25:43.731006 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m21:25:43.731570 [debug] [Thread-2 (]: Began running node model.customer360.stg_web__transactions
[0m21:25:43.732110 [info ] [Thread-2 (]: 10 of 13 START sql table model public.stg_web__transactions .................... [RUN]
[0m21:25:43.732817 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344, now model.customer360.stg_web__transactions)
[0m21:25:43.733137 [debug] [Thread-2 (]: Began compiling node model.customer360.stg_web__transactions
[0m21:25:43.736853 [debug] [Thread-2 (]: Writing injected SQL for node "model.customer360.stg_web__transactions"
[0m21:25:43.737609 [debug] [Thread-2 (]: Timing info for model.customer360.stg_web__transactions (compile): 21:25:43.733790 => 21:25:43.737283
[0m21:25:43.738031 [debug] [Thread-3 (]: SQL status: BEGIN in 0.0 seconds
[0m21:25:43.738428 [debug] [Thread-2 (]: Began executing node model.customer360.stg_web__transactions
[0m21:25:43.738807 [debug] [Thread-3 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m21:25:43.742753 [debug] [Thread-2 (]: Writing runtime sql for node "model.customer360.stg_web__transactions"
[0m21:25:43.743143 [debug] [Thread-3 (]: On model.customer360.stg_sf__contacts: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_sf__contacts"} */

  
    

  create  table "dbt"."public"."stg_sf__contacts__dbt_tmp"
  
  
    as
  
  (
    with source as (
    select * from "dbt"."public"."contacts"
),

renamed as (
    select
        id,
        username as user_name,
        name,
        gender,
        address, 
        mail as email_address,
        birthdate as birth_date,
        _loaded_at_utc
    from source     
)

select * from renamed
  );
  
[0m21:25:43.743785 [debug] [Thread-2 (]: Using postgres connection "model.customer360.stg_web__transactions"
[0m21:25:43.744098 [debug] [Thread-2 (]: On model.customer360.stg_web__transactions: BEGIN
[0m21:25:43.744436 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m21:25:43.748186 [debug] [Thread-2 (]: SQL status: BEGIN in 0.0 seconds
[0m21:25:43.749454 [debug] [Thread-2 (]: Using postgres connection "model.customer360.stg_web__transactions"
[0m21:25:43.749827 [debug] [Thread-2 (]: On model.customer360.stg_web__transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_web__transactions"} */

  
    

  create  table "dbt"."public"."stg_web__transactions__dbt_tmp"
  
  
    as
  
  (
    with source as (
    select * from "dbt"."public"."transactions"
),

renamed as (
    select
        id,
        contact_id,
        
    to_timestamp(transaction_date,'YYYY-MM-DD HH24:MI:SS.MS') :: timestamp at TIME zone 'UTC'
 as transaction_date,
        amount,
        item_count,
        category, 
        _loaded_at_utc
    from source     
)

select * from renamed
  );
  
[0m21:25:43.750551 [debug] [Thread-3 (]: SQL status: SELECT 10 in 0.0 seconds
[0m21:25:43.757130 [debug] [Thread-3 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m21:25:43.757518 [debug] [Thread-2 (]: SQL status: SELECT 74 in 0.0 seconds
[0m21:25:43.757869 [debug] [Thread-3 (]: On model.customer360.stg_sf__contacts: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_sf__contacts"} */
alter table "dbt"."public"."stg_sf__contacts" rename to "stg_sf__contacts__dbt_backup"
[0m21:25:43.760515 [debug] [Thread-2 (]: Using postgres connection "model.customer360.stg_web__transactions"
[0m21:25:43.760950 [debug] [Thread-2 (]: On model.customer360.stg_web__transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_web__transactions"} */
alter table "dbt"."public"."stg_web__transactions" rename to "stg_web__transactions__dbt_backup"
[0m21:25:43.761678 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m21:25:43.764118 [debug] [Thread-2 (]: Using postgres connection "model.customer360.stg_web__transactions"
[0m21:25:43.764474 [debug] [Thread-2 (]: On model.customer360.stg_web__transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_web__transactions"} */
alter table "dbt"."public"."stg_web__transactions__dbt_tmp" rename to "stg_web__transactions"
[0m21:25:43.765229 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m21:25:43.765616 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m21:25:43.768127 [debug] [Thread-3 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m21:25:43.774708 [debug] [Thread-2 (]: On model.customer360.stg_web__transactions: COMMIT
[0m21:25:43.775091 [debug] [Thread-3 (]: On model.customer360.stg_sf__contacts: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_sf__contacts"} */
alter table "dbt"."public"."stg_sf__contacts__dbt_tmp" rename to "stg_sf__contacts"
[0m21:25:43.775478 [debug] [Thread-2 (]: Using postgres connection "model.customer360.stg_web__transactions"
[0m21:25:43.775935 [debug] [Thread-2 (]: On model.customer360.stg_web__transactions: COMMIT
[0m21:25:43.776386 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m21:25:43.778158 [debug] [Thread-3 (]: On model.customer360.stg_sf__contacts: COMMIT
[0m21:25:43.778504 [debug] [Thread-3 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m21:25:43.778794 [debug] [Thread-3 (]: On model.customer360.stg_sf__contacts: COMMIT
[0m21:25:43.780666 [debug] [Thread-3 (]: SQL status: COMMIT in 0.0 seconds
[0m21:25:43.786585 [debug] [Thread-2 (]: SQL status: COMMIT in 0.0 seconds
[0m21:25:43.786372 [debug] [Thread-3 (]: Applying DROP to: "dbt"."public"."stg_sf__contacts__dbt_backup"
[0m21:25:43.788910 [debug] [Thread-2 (]: Applying DROP to: "dbt"."public"."stg_web__transactions__dbt_backup"
[0m21:25:43.794655 [debug] [Thread-3 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m21:25:43.795448 [debug] [Thread-2 (]: Using postgres connection "model.customer360.stg_web__transactions"
[0m21:25:43.795841 [debug] [Thread-3 (]: On model.customer360.stg_sf__contacts: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_sf__contacts"} */
drop table if exists "dbt"."public"."stg_sf__contacts__dbt_backup" cascade
[0m21:25:43.796281 [debug] [Thread-2 (]: On model.customer360.stg_web__transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_web__transactions"} */
drop table if exists "dbt"."public"."stg_web__transactions__dbt_backup" cascade
[0m21:25:43.799542 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.0 seconds
[0m21:25:43.801055 [debug] [Thread-3 (]: Timing info for model.customer360.stg_sf__contacts (execute): 21:25:43.693917 => 21:25:43.800780
[0m21:25:43.801450 [debug] [Thread-3 (]: On model.customer360.stg_sf__contacts: Close
[0m21:25:43.802160 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'eec61ac7-943f-4cc4-aa21-247b4b00b40c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faadddd8d10>]}
[0m21:25:43.802721 [info ] [Thread-3 (]: 9 of 13 OK created sql table model public.stg_sf__contacts ..................... [[32mSELECT 10[0m in 0.12s]
[0m21:25:43.803285 [debug] [Thread-3 (]: Finished running node model.customer360.stg_sf__contacts
[0m21:25:43.805109 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.0 seconds
[0m21:25:43.806365 [debug] [Thread-2 (]: Timing info for model.customer360.stg_web__transactions (execute): 21:25:43.739030 => 21:25:43.806143
[0m21:25:43.806677 [debug] [Thread-2 (]: On model.customer360.stg_web__transactions: Close
[0m21:25:43.807444 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'eec61ac7-943f-4cc4-aa21-247b4b00b40c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faadd5cd010>]}
[0m21:25:43.808052 [info ] [Thread-2 (]: 10 of 13 OK created sql table model public.stg_web__transactions ............... [[32mSELECT 74[0m in 0.07s]
[0m21:25:43.808691 [debug] [Thread-2 (]: Finished running node model.customer360.stg_web__transactions
[0m21:25:43.809452 [debug] [Thread-1 (]: Began running node model.customer360.contacts_joined_with_transactions
[0m21:25:43.809872 [info ] [Thread-1 (]: 11 of 13 START sql view model public.contacts_joined_with_transactions ......... [RUN]
[0m21:25:43.810458 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.customer360.source_unique_web_transactions_id.ba28079761, now model.customer360.contacts_joined_with_transactions)
[0m21:25:43.810775 [debug] [Thread-1 (]: Began compiling node model.customer360.contacts_joined_with_transactions
[0m21:25:43.814490 [debug] [Thread-1 (]: Writing injected SQL for node "model.customer360.contacts_joined_with_transactions"
[0m21:25:43.815089 [debug] [Thread-1 (]: Timing info for model.customer360.contacts_joined_with_transactions (compile): 21:25:43.810972 => 21:25:43.814878
[0m21:25:43.815421 [debug] [Thread-1 (]: Began executing node model.customer360.contacts_joined_with_transactions
[0m21:25:43.832261 [debug] [Thread-1 (]: Writing runtime sql for node "model.customer360.contacts_joined_with_transactions"
[0m21:25:43.832834 [debug] [Thread-1 (]: Using postgres connection "model.customer360.contacts_joined_with_transactions"
[0m21:25:43.833159 [debug] [Thread-1 (]: On model.customer360.contacts_joined_with_transactions: BEGIN
[0m21:25:43.833506 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:25:43.836810 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m21:25:43.837133 [debug] [Thread-1 (]: Using postgres connection "model.customer360.contacts_joined_with_transactions"
[0m21:25:43.837497 [debug] [Thread-1 (]: On model.customer360.contacts_joined_with_transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.contacts_joined_with_transactions"} */

  create view "dbt"."public"."contacts_joined_with_transactions__dbt_tmp"
    
    
  as (
    SELECT 
    contacts.*,
    transactions.id as transaction_id,
    transactions.transaction_date,
    transactions.amount,
    transactions.item_count,
    transactions.category
FROM "dbt"."public"."stg_web__transactions" as transactions
LEFT JOIN "dbt"."public"."stg_sf__contacts" as contacts ON contacts.id = transactions.contact_id
  );
[0m21:25:43.839512 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.0 seconds
[0m21:25:43.842407 [debug] [Thread-1 (]: Using postgres connection "model.customer360.contacts_joined_with_transactions"
[0m21:25:43.842736 [debug] [Thread-1 (]: On model.customer360.contacts_joined_with_transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.contacts_joined_with_transactions"} */
alter table "dbt"."public"."contacts_joined_with_transactions__dbt_tmp" rename to "contacts_joined_with_transactions"
[0m21:25:43.843540 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m21:25:43.844953 [debug] [Thread-1 (]: On model.customer360.contacts_joined_with_transactions: COMMIT
[0m21:25:43.845269 [debug] [Thread-1 (]: Using postgres connection "model.customer360.contacts_joined_with_transactions"
[0m21:25:43.845625 [debug] [Thread-1 (]: On model.customer360.contacts_joined_with_transactions: COMMIT
[0m21:25:43.847843 [debug] [Thread-1 (]: SQL status: COMMIT in 0.0 seconds
[0m21:25:43.850005 [debug] [Thread-1 (]: Applying DROP to: "dbt"."public"."contacts_joined_with_transactions__dbt_backup"
[0m21:25:43.852832 [debug] [Thread-1 (]: Using postgres connection "model.customer360.contacts_joined_with_transactions"
[0m21:25:43.853170 [debug] [Thread-1 (]: On model.customer360.contacts_joined_with_transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.contacts_joined_with_transactions"} */
drop view if exists "dbt"."public"."contacts_joined_with_transactions__dbt_backup" cascade
[0m21:25:43.853767 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.0 seconds
[0m21:25:43.855034 [debug] [Thread-1 (]: Timing info for model.customer360.contacts_joined_with_transactions (execute): 21:25:43.815627 => 21:25:43.854796
[0m21:25:43.855374 [debug] [Thread-1 (]: On model.customer360.contacts_joined_with_transactions: Close
[0m21:25:43.856163 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'eec61ac7-943f-4cc4-aa21-247b4b00b40c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faadd42a990>]}
[0m21:25:43.856828 [info ] [Thread-1 (]: 11 of 13 OK created sql view model public.contacts_joined_with_transactions .... [[32mCREATE VIEW[0m in 0.05s]
[0m21:25:43.857518 [debug] [Thread-1 (]: Finished running node model.customer360.contacts_joined_with_transactions
[0m21:25:43.858281 [debug] [Thread-2 (]: Began running node test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311
[0m21:25:43.858724 [info ] [Thread-2 (]: 12 of 13 START test not_null_contacts_joined_with_transactions_id .............. [RUN]
[0m21:25:43.859370 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.customer360.stg_web__transactions, now test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311)
[0m21:25:43.859711 [debug] [Thread-2 (]: Began compiling node test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311
[0m21:25:43.863552 [debug] [Thread-2 (]: Writing injected SQL for node "test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311"
[0m21:25:43.864189 [debug] [Thread-2 (]: Timing info for test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311 (compile): 21:25:43.859902 => 21:25:43.863931
[0m21:25:43.864561 [debug] [Thread-2 (]: Began executing node test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311
[0m21:25:43.866410 [debug] [Thread-2 (]: Writing runtime sql for node "test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311"
[0m21:25:43.866899 [debug] [Thread-2 (]: Using postgres connection "test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311"
[0m21:25:43.867214 [debug] [Thread-2 (]: On test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311: BEGIN
[0m21:25:43.867551 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m21:25:43.870817 [debug] [Thread-2 (]: SQL status: BEGIN in 0.0 seconds
[0m21:25:43.871154 [debug] [Thread-2 (]: Using postgres connection "test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311"
[0m21:25:43.871499 [debug] [Thread-2 (]: On test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select id
from "dbt"."public"."contacts_joined_with_transactions"
where id is null



      
    ) dbt_internal_test
[0m21:25:43.873171 [debug] [Thread-2 (]: SQL status: SELECT 1 in 0.0 seconds
[0m21:25:43.874612 [debug] [Thread-2 (]: Timing info for test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311 (execute): 21:25:43.864760 => 21:25:43.874366
[0m21:25:43.874953 [debug] [Thread-2 (]: On test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311: ROLLBACK
[0m21:25:43.875479 [debug] [Thread-2 (]: On test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311: Close
[0m21:25:43.876219 [info ] [Thread-2 (]: 12 of 13 PASS not_null_contacts_joined_with_transactions_id .................... [[32mPASS[0m in 0.02s]
[0m21:25:43.876733 [debug] [Thread-2 (]: Finished running node test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311
[0m21:25:43.877484 [debug] [Thread-1 (]: Began running node model.customer360.customers
[0m21:25:43.878040 [info ] [Thread-1 (]: 13 of 13 START sql table model public.customers ................................ [RUN]
[0m21:25:43.878729 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.customer360.contacts_joined_with_transactions, now model.customer360.customers)
[0m21:25:43.879071 [debug] [Thread-1 (]: Began compiling node model.customer360.customers
[0m21:25:43.881673 [debug] [Thread-1 (]: Writing injected SQL for node "model.customer360.customers"
[0m21:25:43.882266 [debug] [Thread-1 (]: Timing info for model.customer360.customers (compile): 21:25:43.879262 => 21:25:43.882022
[0m21:25:43.882595 [debug] [Thread-1 (]: Began executing node model.customer360.customers
[0m21:25:43.886352 [debug] [Thread-1 (]: Writing runtime sql for node "model.customer360.customers"
[0m21:25:43.886820 [debug] [Thread-1 (]: Using postgres connection "model.customer360.customers"
[0m21:25:43.887122 [debug] [Thread-1 (]: On model.customer360.customers: BEGIN
[0m21:25:43.887458 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:25:43.890746 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m21:25:43.891090 [debug] [Thread-1 (]: Using postgres connection "model.customer360.customers"
[0m21:25:43.891447 [debug] [Thread-1 (]: On model.customer360.customers: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.customers"} */

  
    

  create  table "dbt"."public"."customers__dbt_tmp"
  
  
    as
  
  (
    SELECT
    id,
    gender,
    
    date_part('year', age(current_date, birth_date))
 AS age,
    sum(amount) as total_expense
FROM "dbt"."public"."contacts_joined_with_transactions"
GROUP BY
    1,2,3
  );
  
[0m21:25:43.901398 [debug] [Thread-1 (]: SQL status: SELECT 9 in 0.0 seconds
[0m21:25:43.904160 [debug] [Thread-1 (]: Using postgres connection "model.customer360.customers"
[0m21:25:43.904511 [debug] [Thread-1 (]: On model.customer360.customers: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.customers"} */
alter table "dbt"."public"."customers" rename to "customers__dbt_backup"
[0m21:25:43.905186 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m21:25:43.907686 [debug] [Thread-1 (]: Using postgres connection "model.customer360.customers"
[0m21:25:43.907996 [debug] [Thread-1 (]: On model.customer360.customers: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.customers"} */
alter table "dbt"."public"."customers__dbt_tmp" rename to "customers"
[0m21:25:43.908573 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m21:25:43.910497 [debug] [Thread-1 (]: On model.customer360.customers: COMMIT
[0m21:25:43.910810 [debug] [Thread-1 (]: Using postgres connection "model.customer360.customers"
[0m21:25:43.911099 [debug] [Thread-1 (]: On model.customer360.customers: COMMIT
[0m21:25:43.912524 [debug] [Thread-1 (]: SQL status: COMMIT in 0.0 seconds
[0m21:25:43.915912 [debug] [Thread-1 (]: Applying DROP to: "dbt"."public"."customers__dbt_backup"
[0m21:25:43.916629 [debug] [Thread-1 (]: Using postgres connection "model.customer360.customers"
[0m21:25:43.916938 [debug] [Thread-1 (]: On model.customer360.customers: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.customers"} */
drop table if exists "dbt"."public"."customers__dbt_backup" cascade
[0m21:25:43.919256 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.0 seconds
[0m21:25:43.920511 [debug] [Thread-1 (]: Timing info for model.customer360.customers (execute): 21:25:43.882788 => 21:25:43.920326
[0m21:25:43.920831 [debug] [Thread-1 (]: On model.customer360.customers: Close
[0m21:25:43.921700 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'eec61ac7-943f-4cc4-aa21-247b4b00b40c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faadd2c87d0>]}
[0m21:25:43.922342 [info ] [Thread-1 (]: 13 of 13 OK created sql table model public.customers ........................... [[32mSELECT 9[0m in 0.04s]
[0m21:25:43.922973 [debug] [Thread-1 (]: Finished running node model.customer360.customers
[0m21:25:43.924452 [debug] [MainThread]: Using postgres connection "master"
[0m21:25:43.924739 [debug] [MainThread]: On master: BEGIN
[0m21:25:43.924997 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m21:25:43.928043 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m21:25:43.928348 [debug] [MainThread]: On master: COMMIT
[0m21:25:43.928607 [debug] [MainThread]: Using postgres connection "master"
[0m21:25:43.928870 [debug] [MainThread]: On master: COMMIT
[0m21:25:43.929285 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m21:25:43.929581 [debug] [MainThread]: On master: Close
[0m21:25:43.930152 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:25:43.930425 [debug] [MainThread]: Connection 'model.customer360.customers' was properly closed.
[0m21:25:43.930659 [debug] [MainThread]: Connection 'test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311' was properly closed.
[0m21:25:43.930896 [debug] [MainThread]: Connection 'model.customer360.stg_sf__contacts' was properly closed.
[0m21:25:43.931204 [info ] [MainThread]: 
[0m21:25:43.931519 [info ] [MainThread]: Finished running 2 seeds, 7 tests, 3 table models, 1 view model in 0 hours 0 minutes and 0.72 seconds (0.72s).
[0m21:25:43.933982 [debug] [MainThread]: Command end result
[0m21:25:43.941670 [info ] [MainThread]: 
[0m21:25:43.942046 [info ] [MainThread]: [32mCompleted successfully[0m
[0m21:25:43.942363 [info ] [MainThread]: 
[0m21:25:43.942659 [info ] [MainThread]: Done. PASS=13 WARN=0 ERROR=0 SKIP=0 TOTAL=13
[0m21:25:43.943359 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 1.36107, "process_user_time": 2.853121, "process_kernel_time": 0.09223, "process_mem_max_rss": "110296", "process_in_blocks": "1488", "process_out_blocks": "2800"}
[0m21:25:43.943809 [debug] [MainThread]: Command `dbt build` succeeded at 21:25:43.943698 after 1.36 seconds
[0m21:25:43.944142 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faae3c9e950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faae3e1c1d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faae3e1cd90>]}
[0m21:25:43.944484 [debug] [MainThread]: Flushing usage events
[0m21:45:22.285349 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f69a8cc7690>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f69a8cc7fd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f69a8cc7310>]}


============================== 21:45:22.287748 | f7074701-d5bd-4d6b-a685-32bca752748e ==============================
[0m21:45:22.287748 [info ] [MainThread]: Running with dbt=1.7.8
[0m21:45:22.288226 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/root/option1-customer360/integration_tests/logs', 'version_check': 'True', 'profiles_dir': '/root/option1-customer360/integration_tests', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'invocation_command': 'dbt deps', 'log_format': 'default', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m21:45:22.361835 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'f7074701-d5bd-4d6b-a685-32bca752748e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f69a8cefd10>]}
[0m21:45:22.363879 [debug] [MainThread]: Set downloads directory='/tmp/dbt-downloads-rmlg99v_'
[0m21:45:22.364251 [info ] [MainThread]: Installing ../
[0m21:45:22.364908 [debug] [MainThread]: Creating symlink to local dependency.
[0m21:45:22.365195 [info ] [MainThread]: Installed from <local @ ../>
[0m21:45:22.365596 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'package', 'label': 'f7074701-d5bd-4d6b-a685-32bca752748e', 'property_': 'install', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f69a9772750>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f69a8d197d0>]}
[0m21:45:22.366359 [debug] [MainThread]: Resource report: {"command_name": "deps", "command_success": true, "command_wall_clock_time": 0.11633587, "process_user_time": 1.634705, "process_kernel_time": 0.070987, "process_mem_max_rss": "90248", "process_out_blocks": "24", "process_in_blocks": "0"}
[0m21:45:22.366812 [debug] [MainThread]: Command `dbt deps` succeeded at 21:45:22.366681 after 0.12 seconds
[0m21:45:22.367119 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f69a8cd1710>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f69a8d29d10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f69ad186ad0>]}
[0m21:45:22.367483 [debug] [MainThread]: Flushing usage events
[0m21:45:31.622168 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5fb3566a90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5fb35b8b10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5fb3578a10>]}


============================== 21:45:31.624569 | cd221442-1b96-4936-9f90-efaa36e12675 ==============================
[0m21:45:31.624569 [info ] [MainThread]: Running with dbt=1.7.8
[0m21:45:31.625044 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/root/option1-customer360/integration_tests', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/root/option1-customer360/integration_tests/logs', 'warn_error': 'None', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt run', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m21:45:31.765247 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'cd221442-1b96-4936-9f90-efaa36e12675', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5fb3e41e90>]}
[0m21:45:31.839813 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'cd221442-1b96-4936-9f90-efaa36e12675', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5fb3567f90>]}
[0m21:45:31.840499 [info ] [MainThread]: Registered adapter: postgres=1.7.8
[0m21:45:31.851489 [debug] [MainThread]: checksum: 67f0013ca5f0bd43af9a0873dd50792fde83ef69de63b71cacd0b4ac656c52e5, vars: {}, profile: , target: , version: 1.7.8
[0m21:45:31.871567 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m21:45:31.872074 [debug] [MainThread]: Partial parsing: updated file: customer360://models/staging/web/stg_web__transactions.sql
[0m21:45:31.992668 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'cd221442-1b96-4936-9f90-efaa36e12675', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5fb1b66650>]}
[0m21:45:32.000275 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'cd221442-1b96-4936-9f90-efaa36e12675', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5fb1ac8f10>]}
[0m21:45:32.000753 [info ] [MainThread]: Found 2 seeds, 4 models, 7 tests, 2 sources, 0 exposures, 0 metrics, 403 macros, 0 groups, 0 semantic models
[0m21:45:32.001079 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'cd221442-1b96-4936-9f90-efaa36e12675', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5fb1aaa610>]}
[0m21:45:32.002874 [info ] [MainThread]: 
[0m21:45:32.003534 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m21:45:32.004559 [debug] [ThreadPool]: Acquiring new postgres connection 'list_dbt'
[0m21:45:32.013577 [debug] [ThreadPool]: Using postgres connection "list_dbt"
[0m21:45:32.013869 [debug] [ThreadPool]: On list_dbt: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "connection_name": "list_dbt"} */

    select distinct nspname from pg_namespace
  
[0m21:45:32.014142 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:45:32.018853 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.0 seconds
[0m21:45:32.020093 [debug] [ThreadPool]: On list_dbt: Close
[0m21:45:32.022989 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dbt, now list_dbt_public)
[0m21:45:32.028334 [debug] [ThreadPool]: Using postgres connection "list_dbt_public"
[0m21:45:32.028622 [debug] [ThreadPool]: On list_dbt_public: BEGIN
[0m21:45:32.028869 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:45:32.031900 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m21:45:32.032182 [debug] [ThreadPool]: Using postgres connection "list_dbt_public"
[0m21:45:32.032506 [debug] [ThreadPool]: On list_dbt_public: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "connection_name": "list_dbt_public"} */
select
      'dbt' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'dbt' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'dbt' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m21:45:32.035332 [debug] [ThreadPool]: SQL status: SELECT 6 in 0.0 seconds
[0m21:45:32.036513 [debug] [ThreadPool]: On list_dbt_public: ROLLBACK
[0m21:45:32.036972 [debug] [ThreadPool]: On list_dbt_public: Close
[0m21:45:32.042732 [debug] [MainThread]: Using postgres connection "master"
[0m21:45:32.043064 [debug] [MainThread]: On master: BEGIN
[0m21:45:32.043359 [debug] [MainThread]: Opening a new connection, currently in state init
[0m21:45:32.046371 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m21:45:32.046668 [debug] [MainThread]: Using postgres connection "master"
[0m21:45:32.047012 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m21:45:32.056682 [debug] [MainThread]: SQL status: SELECT 2 in 0.0 seconds
[0m21:45:32.058187 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'cd221442-1b96-4936-9f90-efaa36e12675', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5fb17cdbd0>]}
[0m21:45:32.058593 [debug] [MainThread]: On master: ROLLBACK
[0m21:45:32.059081 [debug] [MainThread]: Using postgres connection "master"
[0m21:45:32.059374 [debug] [MainThread]: On master: BEGIN
[0m21:45:32.060042 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m21:45:32.060347 [debug] [MainThread]: On master: COMMIT
[0m21:45:32.060608 [debug] [MainThread]: Using postgres connection "master"
[0m21:45:32.060863 [debug] [MainThread]: On master: COMMIT
[0m21:45:32.061326 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m21:45:32.061605 [debug] [MainThread]: On master: Close
[0m21:45:32.062226 [info ] [MainThread]: Concurrency: 3 threads (target='local')
[0m21:45:32.062584 [info ] [MainThread]: 
[0m21:45:32.065610 [debug] [Thread-1 (]: Began running node model.customer360.stg_sf__contacts
[0m21:45:32.066024 [debug] [Thread-2 (]: Began running node model.customer360.stg_web__transactions
[0m21:45:32.066457 [info ] [Thread-1 (]: 1 of 4 START sql table model public.stg_sf__contacts ........................... [RUN]
[0m21:45:32.066950 [info ] [Thread-2 (]: 2 of 4 START sql table model public.stg_web__transactions ...................... [RUN]
[0m21:45:32.067615 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dbt_public, now model.customer360.stg_sf__contacts)
[0m21:45:32.068261 [debug] [Thread-2 (]: Acquiring new postgres connection 'model.customer360.stg_web__transactions'
[0m21:45:32.068651 [debug] [Thread-1 (]: Began compiling node model.customer360.stg_sf__contacts
[0m21:45:32.068996 [debug] [Thread-2 (]: Began compiling node model.customer360.stg_web__transactions
[0m21:45:32.075358 [debug] [Thread-1 (]: Writing injected SQL for node "model.customer360.stg_sf__contacts"
[0m21:45:32.077871 [debug] [Thread-2 (]: Writing injected SQL for node "model.customer360.stg_web__transactions"
[0m21:45:32.078599 [debug] [Thread-1 (]: Timing info for model.customer360.stg_sf__contacts (compile): 21:45:32.069236 => 21:45:32.078370
[0m21:45:32.079076 [debug] [Thread-2 (]: Timing info for model.customer360.stg_web__transactions (compile): 21:45:32.075604 => 21:45:32.078821
[0m21:45:32.079463 [debug] [Thread-1 (]: Began executing node model.customer360.stg_sf__contacts
[0m21:45:32.079834 [debug] [Thread-2 (]: Began executing node model.customer360.stg_web__transactions
[0m21:45:32.133133 [debug] [Thread-1 (]: Writing runtime sql for node "model.customer360.stg_sf__contacts"
[0m21:45:32.134838 [debug] [Thread-2 (]: Writing runtime sql for node "model.customer360.stg_web__transactions"
[0m21:45:32.135639 [debug] [Thread-1 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m21:45:32.136054 [debug] [Thread-2 (]: Using postgres connection "model.customer360.stg_web__transactions"
[0m21:45:32.136481 [debug] [Thread-1 (]: On model.customer360.stg_sf__contacts: BEGIN
[0m21:45:32.136842 [debug] [Thread-2 (]: On model.customer360.stg_web__transactions: BEGIN
[0m21:45:32.137182 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:45:32.137568 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m21:45:32.142173 [debug] [Thread-2 (]: SQL status: BEGIN in 0.0 seconds
[0m21:45:32.142747 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m21:45:32.143087 [debug] [Thread-2 (]: Using postgres connection "model.customer360.stg_web__transactions"
[0m21:45:32.143506 [debug] [Thread-1 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m21:45:32.143948 [debug] [Thread-2 (]: On model.customer360.stg_web__transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_web__transactions"} */

  
    

  create  table "dbt"."public"."stg_web__transactions__dbt_tmp"
  
  
    as
  
  (
    with source as (
    select * from "dbt"."public"."transactions"
),

renamed as (
    select
        id,
        contact_id,
        
    to_timestamp(transaction_date,'YYYY-MM-DD HH24:MI:SS.MS') :: timestamp at TIME zone 'UTC'
 as transaction_date,
        amount,
        item_count,
        category, 
        _loaded_at_utc
    from source    
)

clean_older as {
    select * from renamed 
--    where transaction_date >= (current_date - 1)  过滤超过1天的数据
    where transaction_date >= (to_date('2023-04-12','yyyy-MM-dd') - 1)  --测试用,假设跑数日期为2023-04-12
}

select * from clean_older
  );
  
[0m21:45:32.144390 [debug] [Thread-1 (]: On model.customer360.stg_sf__contacts: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_sf__contacts"} */

  
    

  create  table "dbt"."public"."stg_sf__contacts__dbt_tmp"
  
  
    as
  
  (
    with source as (
    select * from "dbt"."public"."contacts"
),

renamed as (
    select
        id,
        username as user_name,
        name,
        gender,
        address, 
        mail as email_address,
        birthdate as birth_date,
        _loaded_at_utc
    from source     
)

select * from renamed
  );
  
[0m21:45:32.146938 [debug] [Thread-2 (]: Postgres adapter: Postgres error: syntax error at or near "clean_older"
LINE 30: clean_older as {
         ^

[0m21:45:32.147310 [debug] [Thread-2 (]: On model.customer360.stg_web__transactions: ROLLBACK
[0m21:45:32.148022 [debug] [Thread-2 (]: Timing info for model.customer360.stg_web__transactions (execute): 21:45:32.095534 => 21:45:32.147804
[0m21:45:32.149545 [debug] [Thread-2 (]: On model.customer360.stg_web__transactions: Close
[0m21:45:32.152120 [debug] [Thread-1 (]: SQL status: SELECT 10 in 0.0 seconds
[0m21:45:32.158847 [debug] [Thread-1 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m21:45:32.159269 [debug] [Thread-1 (]: On model.customer360.stg_sf__contacts: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_sf__contacts"} */
alter table "dbt"."public"."stg_sf__contacts" rename to "stg_sf__contacts__dbt_backup"
[0m21:45:32.160330 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m21:45:32.161543 [debug] [Thread-2 (]: Database Error in model stg_web__transactions (models/staging/web/stg_web__transactions.sql)
  syntax error at or near "clean_older"
  LINE 30: clean_older as {
           ^
  compiled Code at target/run/customer360/models/staging/web/stg_web__transactions.sql
[0m21:45:32.164376 [debug] [Thread-1 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m21:45:32.164832 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cd221442-1b96-4936-9f90-efaa36e12675', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5fb12edd90>]}
[0m21:45:32.165213 [debug] [Thread-1 (]: On model.customer360.stg_sf__contacts: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_sf__contacts"} */
alter table "dbt"."public"."stg_sf__contacts__dbt_tmp" rename to "stg_sf__contacts"
[0m21:45:32.165832 [error] [Thread-2 (]: 2 of 4 ERROR creating sql table model public.stg_web__transactions ............. [[31mERROR[0m in 0.10s]
[0m21:45:32.166636 [debug] [Thread-2 (]: Finished running node model.customer360.stg_web__transactions
[0m21:45:32.167008 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m21:45:32.185137 [debug] [Thread-1 (]: On model.customer360.stg_sf__contacts: COMMIT
[0m21:45:32.185526 [debug] [Thread-1 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m21:45:32.185830 [debug] [Thread-1 (]: On model.customer360.stg_sf__contacts: COMMIT
[0m21:45:32.187511 [debug] [Thread-1 (]: SQL status: COMMIT in 0.0 seconds
[0m21:45:32.193151 [debug] [Thread-1 (]: Applying DROP to: "dbt"."public"."stg_sf__contacts__dbt_backup"
[0m21:45:32.197477 [debug] [Thread-1 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m21:45:32.197805 [debug] [Thread-1 (]: On model.customer360.stg_sf__contacts: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_sf__contacts"} */
drop table if exists "dbt"."public"."stg_sf__contacts__dbt_backup" cascade
[0m21:45:32.200429 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.0 seconds
[0m21:45:32.201777 [debug] [Thread-1 (]: Timing info for model.customer360.stg_sf__contacts (execute): 21:45:32.080058 => 21:45:32.201578
[0m21:45:32.202137 [debug] [Thread-1 (]: On model.customer360.stg_sf__contacts: Close
[0m21:45:32.202847 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cd221442-1b96-4936-9f90-efaa36e12675', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5fb12bb510>]}
[0m21:45:32.203369 [info ] [Thread-1 (]: 1 of 4 OK created sql table model public.stg_sf__contacts ...................... [[32mSELECT 10[0m in 0.14s]
[0m21:45:32.204065 [debug] [Thread-1 (]: Finished running node model.customer360.stg_sf__contacts
[0m21:45:32.204892 [debug] [Thread-3 (]: Began running node model.customer360.contacts_joined_with_transactions
[0m21:45:32.205470 [info ] [Thread-3 (]: 3 of 4 SKIP relation public.contacts_joined_with_transactions .................. [[33mSKIP[0m]
[0m21:45:32.205853 [debug] [Thread-3 (]: Finished running node model.customer360.contacts_joined_with_transactions
[0m21:45:32.206486 [debug] [Thread-1 (]: Began running node model.customer360.customers
[0m21:45:32.206875 [info ] [Thread-1 (]: 4 of 4 SKIP relation public.customers .......................................... [[33mSKIP[0m]
[0m21:45:32.207236 [debug] [Thread-1 (]: Finished running node model.customer360.customers
[0m21:45:32.208612 [debug] [MainThread]: Using postgres connection "master"
[0m21:45:32.208890 [debug] [MainThread]: On master: BEGIN
[0m21:45:32.209142 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m21:45:32.212374 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m21:45:32.212682 [debug] [MainThread]: On master: COMMIT
[0m21:45:32.212938 [debug] [MainThread]: Using postgres connection "master"
[0m21:45:32.213185 [debug] [MainThread]: On master: COMMIT
[0m21:45:32.213663 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m21:45:32.213944 [debug] [MainThread]: On master: Close
[0m21:45:32.214534 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:45:32.214796 [debug] [MainThread]: Connection 'model.customer360.stg_sf__contacts' was properly closed.
[0m21:45:32.215031 [debug] [MainThread]: Connection 'model.customer360.stg_web__transactions' was properly closed.
[0m21:45:32.215350 [info ] [MainThread]: 
[0m21:45:32.215766 [info ] [MainThread]: Finished running 3 table models, 1 view model in 0 hours 0 minutes and 0.21 seconds (0.21s).
[0m21:45:32.216771 [debug] [MainThread]: Command end result
[0m21:45:32.223539 [info ] [MainThread]: 
[0m21:45:32.223928 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m21:45:32.224207 [info ] [MainThread]: 
[0m21:45:32.224515 [error] [MainThread]:   Database Error in model stg_web__transactions (models/staging/web/stg_web__transactions.sql)
  syntax error at or near "clean_older"
  LINE 30: clean_older as {
           ^
  compiled Code at target/run/customer360/models/staging/web/stg_web__transactions.sql
[0m21:45:32.224805 [info ] [MainThread]: 
[0m21:45:32.225102 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=1 SKIP=2 TOTAL=4
[0m21:45:32.225807 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 0.6391252, "process_user_time": 2.110915, "process_kernel_time": 0.079109, "process_mem_max_rss": "105172", "process_out_blocks": "2544", "command_success": false, "process_in_blocks": "0"}
[0m21:45:32.226252 [debug] [MainThread]: Command `dbt run` failed at 21:45:32.226135 after 0.64 seconds
[0m21:45:32.226604 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5fb358ff50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5fb1910fd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5fb7b51010>]}
[0m21:45:32.226930 [debug] [MainThread]: Flushing usage events
[0m21:47:01.512888 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6e061f8710>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6e06554650>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6e05f8d9d0>]}


============================== 21:47:01.515321 | da2608e7-b225-4c92-9641-940f175943a4 ==============================
[0m21:47:01.515321 [info ] [MainThread]: Running with dbt=1.7.8
[0m21:47:01.515795 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'profiles_dir': '/root/option1-customer360/integration_tests', 'log_path': '/root/option1-customer360/integration_tests/logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'invocation_command': 'dbt run', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m21:47:01.655697 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'da2608e7-b225-4c92-9641-940f175943a4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6e06104050>]}
[0m21:47:01.731214 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'da2608e7-b225-4c92-9641-940f175943a4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6e06ad0f50>]}
[0m21:47:01.731922 [info ] [MainThread]: Registered adapter: postgres=1.7.8
[0m21:47:01.742926 [debug] [MainThread]: checksum: 67f0013ca5f0bd43af9a0873dd50792fde83ef69de63b71cacd0b4ac656c52e5, vars: {}, profile: , target: , version: 1.7.8
[0m21:47:01.763650 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m21:47:01.764181 [debug] [MainThread]: Partial parsing: updated file: customer360://models/staging/web/stg_web__transactions.sql
[0m21:47:01.887227 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'da2608e7-b225-4c92-9641-940f175943a4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6e04259290>]}
[0m21:47:01.954230 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'da2608e7-b225-4c92-9641-940f175943a4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6e044a98d0>]}
[0m21:47:01.954758 [info ] [MainThread]: Found 2 seeds, 4 models, 7 tests, 2 sources, 0 exposures, 0 metrics, 403 macros, 0 groups, 0 semantic models
[0m21:47:01.955103 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'da2608e7-b225-4c92-9641-940f175943a4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6e04465d10>]}
[0m21:47:01.956650 [info ] [MainThread]: 
[0m21:47:01.957366 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m21:47:01.958540 [debug] [ThreadPool]: Acquiring new postgres connection 'list_dbt'
[0m21:47:01.967820 [debug] [ThreadPool]: Using postgres connection "list_dbt"
[0m21:47:01.968123 [debug] [ThreadPool]: On list_dbt: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "connection_name": "list_dbt"} */

    select distinct nspname from pg_namespace
  
[0m21:47:01.968433 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:47:01.973041 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.0 seconds
[0m21:47:01.974416 [debug] [ThreadPool]: On list_dbt: Close
[0m21:47:01.976944 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dbt, now list_dbt_public)
[0m21:47:01.982182 [debug] [ThreadPool]: Using postgres connection "list_dbt_public"
[0m21:47:01.982502 [debug] [ThreadPool]: On list_dbt_public: BEGIN
[0m21:47:01.982752 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:47:01.985851 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m21:47:01.986142 [debug] [ThreadPool]: Using postgres connection "list_dbt_public"
[0m21:47:01.986459 [debug] [ThreadPool]: On list_dbt_public: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "connection_name": "list_dbt_public"} */
select
      'dbt' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'dbt' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'dbt' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m21:47:01.989195 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.0 seconds
[0m21:47:01.990863 [debug] [ThreadPool]: On list_dbt_public: ROLLBACK
[0m21:47:01.991361 [debug] [ThreadPool]: On list_dbt_public: Close
[0m21:47:01.996995 [debug] [MainThread]: Using postgres connection "master"
[0m21:47:01.997373 [debug] [MainThread]: On master: BEGIN
[0m21:47:01.997636 [debug] [MainThread]: Opening a new connection, currently in state init
[0m21:47:02.000974 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m21:47:02.001329 [debug] [MainThread]: Using postgres connection "master"
[0m21:47:02.001690 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m21:47:02.010733 [debug] [MainThread]: SQL status: SELECT 0 in 0.0 seconds
[0m21:47:02.011837 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'da2608e7-b225-4c92-9641-940f175943a4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6e044d6290>]}
[0m21:47:02.012242 [debug] [MainThread]: On master: ROLLBACK
[0m21:47:02.012767 [debug] [MainThread]: Using postgres connection "master"
[0m21:47:02.013135 [debug] [MainThread]: On master: BEGIN
[0m21:47:02.013817 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m21:47:02.014107 [debug] [MainThread]: On master: COMMIT
[0m21:47:02.014392 [debug] [MainThread]: Using postgres connection "master"
[0m21:47:02.014673 [debug] [MainThread]: On master: COMMIT
[0m21:47:02.015091 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m21:47:02.015395 [debug] [MainThread]: On master: Close
[0m21:47:02.016043 [info ] [MainThread]: Concurrency: 3 threads (target='local')
[0m21:47:02.016392 [info ] [MainThread]: 
[0m21:47:02.018930 [debug] [Thread-1 (]: Began running node model.customer360.stg_sf__contacts
[0m21:47:02.019344 [debug] [Thread-2 (]: Began running node model.customer360.stg_web__transactions
[0m21:47:02.019770 [info ] [Thread-1 (]: 1 of 4 START sql table model public.stg_sf__contacts ........................... [RUN]
[0m21:47:02.020234 [info ] [Thread-2 (]: 2 of 4 START sql table model public.stg_web__transactions ...................... [RUN]
[0m21:47:02.021038 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dbt_public, now model.customer360.stg_sf__contacts)
[0m21:47:02.021718 [debug] [Thread-2 (]: Acquiring new postgres connection 'model.customer360.stg_web__transactions'
[0m21:47:02.022082 [debug] [Thread-1 (]: Began compiling node model.customer360.stg_sf__contacts
[0m21:47:02.022450 [debug] [Thread-2 (]: Began compiling node model.customer360.stg_web__transactions
[0m21:47:02.029081 [debug] [Thread-1 (]: Writing injected SQL for node "model.customer360.stg_sf__contacts"
[0m21:47:02.031834 [debug] [Thread-2 (]: Writing injected SQL for node "model.customer360.stg_web__transactions"
[0m21:47:02.032564 [debug] [Thread-2 (]: Timing info for model.customer360.stg_web__transactions (compile): 21:47:02.029319 => 21:47:02.032345
[0m21:47:02.033097 [debug] [Thread-1 (]: Timing info for model.customer360.stg_sf__contacts (compile): 21:47:02.022721 => 21:47:02.032792
[0m21:47:02.033465 [debug] [Thread-2 (]: Began executing node model.customer360.stg_web__transactions
[0m21:47:02.033836 [debug] [Thread-1 (]: Began executing node model.customer360.stg_sf__contacts
[0m21:47:02.087053 [debug] [Thread-2 (]: Writing runtime sql for node "model.customer360.stg_web__transactions"
[0m21:47:02.088804 [debug] [Thread-1 (]: Writing runtime sql for node "model.customer360.stg_sf__contacts"
[0m21:47:02.089571 [debug] [Thread-1 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m21:47:02.089999 [debug] [Thread-2 (]: Using postgres connection "model.customer360.stg_web__transactions"
[0m21:47:02.090392 [debug] [Thread-1 (]: On model.customer360.stg_sf__contacts: BEGIN
[0m21:47:02.090749 [debug] [Thread-2 (]: On model.customer360.stg_web__transactions: BEGIN
[0m21:47:02.091133 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:47:02.091527 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m21:47:02.095940 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m21:47:02.096376 [debug] [Thread-2 (]: SQL status: BEGIN in 0.0 seconds
[0m21:47:02.096688 [debug] [Thread-1 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m21:47:02.097038 [debug] [Thread-2 (]: Using postgres connection "model.customer360.stg_web__transactions"
[0m21:47:02.097440 [debug] [Thread-1 (]: On model.customer360.stg_sf__contacts: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_sf__contacts"} */

  
    

  create  table "dbt"."public"."stg_sf__contacts__dbt_tmp"
  
  
    as
  
  (
    with source as (
    select * from "dbt"."public"."contacts"
),

renamed as (
    select
        id,
        username as user_name,
        name,
        gender,
        address, 
        mail as email_address,
        birthdate as birth_date,
        _loaded_at_utc
    from source     
)

select * from renamed
  );
  
[0m21:47:02.097856 [debug] [Thread-2 (]: On model.customer360.stg_web__transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_web__transactions"} */

  
    

  create  table "dbt"."public"."stg_web__transactions__dbt_tmp"
  
  
    as
  
  (
    with source as (
    select * from "dbt"."public"."transactions"
),

renamed as (
    select
        id,
        contact_id,
        
    to_timestamp(transaction_date,'YYYY-MM-DD HH24:MI:SS.MS') :: timestamp at TIME zone 'UTC'
 as transaction_date,
        amount,
        item_count,
        category, 
        _loaded_at_utc
    from source    
)

clean_older as (
    select * from renamed 
--    where transaction_date >= (current_date - 1)  过滤超过1天的数据
    where transaction_date >= (to_date('2023-04-12','yyyy-MM-dd') - 1)  --测试用,假设跑数日期为2023-04-12
)

select * from clean_older
  );
  
[0m21:47:02.100581 [debug] [Thread-2 (]: Postgres adapter: Postgres error: syntax error at or near "clean_older"
LINE 30: clean_older as (
         ^

[0m21:47:02.100945 [debug] [Thread-2 (]: On model.customer360.stg_web__transactions: ROLLBACK
[0m21:47:02.101824 [debug] [Thread-2 (]: Timing info for model.customer360.stg_web__transactions (execute): 21:47:02.034083 => 21:47:02.101603
[0m21:47:02.103468 [debug] [Thread-2 (]: On model.customer360.stg_web__transactions: Close
[0m21:47:02.106382 [debug] [Thread-1 (]: SQL status: SELECT 10 in 0.0 seconds
[0m21:47:02.112376 [debug] [Thread-1 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m21:47:02.112775 [debug] [Thread-1 (]: On model.customer360.stg_sf__contacts: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_sf__contacts"} */
alter table "dbt"."public"."stg_sf__contacts" rename to "stg_sf__contacts__dbt_backup"
[0m21:47:02.113474 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m21:47:02.116203 [debug] [Thread-1 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m21:47:02.116590 [debug] [Thread-1 (]: On model.customer360.stg_sf__contacts: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_sf__contacts"} */
alter table "dbt"."public"."stg_sf__contacts__dbt_tmp" rename to "stg_sf__contacts"
[0m21:47:02.117318 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m21:47:02.135560 [debug] [Thread-1 (]: On model.customer360.stg_sf__contacts: COMMIT
[0m21:47:02.135944 [debug] [Thread-1 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m21:47:02.136346 [debug] [Thread-1 (]: On model.customer360.stg_sf__contacts: COMMIT
[0m21:47:02.137593 [debug] [Thread-1 (]: SQL status: COMMIT in 0.0 seconds
[0m21:47:02.143238 [debug] [Thread-1 (]: Applying DROP to: "dbt"."public"."stg_sf__contacts__dbt_backup"
[0m21:47:02.147871 [debug] [Thread-1 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m21:47:02.148251 [debug] [Thread-1 (]: On model.customer360.stg_sf__contacts: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_sf__contacts"} */
drop table if exists "dbt"."public"."stg_sf__contacts__dbt_backup" cascade
[0m21:47:02.151348 [debug] [Thread-2 (]: Database Error in model stg_web__transactions (models/staging/web/stg_web__transactions.sql)
  syntax error at or near "clean_older"
  LINE 30: clean_older as (
           ^
  compiled Code at target/run/customer360/models/staging/web/stg_web__transactions.sql
[0m21:47:02.151759 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.0 seconds
[0m21:47:02.152219 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'da2608e7-b225-4c92-9641-940f175943a4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6e04290050>]}
[0m21:47:02.153681 [debug] [Thread-1 (]: Timing info for model.customer360.stg_sf__contacts (execute): 21:47:02.049401 => 21:47:02.153482
[0m21:47:02.154805 [debug] [Thread-1 (]: On model.customer360.stg_sf__contacts: Close
[0m21:47:02.155734 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'da2608e7-b225-4c92-9641-940f175943a4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6e03ca3bd0>]}
[0m21:47:02.154336 [error] [Thread-2 (]: 2 of 4 ERROR creating sql table model public.stg_web__transactions ............. [[31mERROR[0m in 0.13s]
[0m21:47:02.157287 [debug] [Thread-2 (]: Finished running node model.customer360.stg_web__transactions
[0m21:47:02.156555 [info ] [Thread-1 (]: 1 of 4 OK created sql table model public.stg_sf__contacts ...................... [[32mSELECT 10[0m in 0.13s]
[0m21:47:02.158087 [debug] [Thread-1 (]: Finished running node model.customer360.stg_sf__contacts
[0m21:47:02.159186 [debug] [Thread-3 (]: Began running node model.customer360.contacts_joined_with_transactions
[0m21:47:02.159624 [info ] [Thread-3 (]: 3 of 4 SKIP relation public.contacts_joined_with_transactions .................. [[33mSKIP[0m]
[0m21:47:02.160005 [debug] [Thread-3 (]: Finished running node model.customer360.contacts_joined_with_transactions
[0m21:47:02.160644 [debug] [Thread-1 (]: Began running node model.customer360.customers
[0m21:47:02.161014 [info ] [Thread-1 (]: 4 of 4 SKIP relation public.customers .......................................... [[33mSKIP[0m]
[0m21:47:02.161555 [debug] [Thread-1 (]: Finished running node model.customer360.customers
[0m21:47:02.162916 [debug] [MainThread]: Using postgres connection "master"
[0m21:47:02.163198 [debug] [MainThread]: On master: BEGIN
[0m21:47:02.163507 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m21:47:02.166774 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m21:47:02.167079 [debug] [MainThread]: On master: COMMIT
[0m21:47:02.167367 [debug] [MainThread]: Using postgres connection "master"
[0m21:47:02.167660 [debug] [MainThread]: On master: COMMIT
[0m21:47:02.168088 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m21:47:02.168396 [debug] [MainThread]: On master: Close
[0m21:47:02.169010 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:47:02.169269 [debug] [MainThread]: Connection 'model.customer360.stg_sf__contacts' was properly closed.
[0m21:47:02.169649 [debug] [MainThread]: Connection 'model.customer360.stg_web__transactions' was properly closed.
[0m21:47:02.170061 [info ] [MainThread]: 
[0m21:47:02.170485 [info ] [MainThread]: Finished running 3 table models, 1 view model in 0 hours 0 minutes and 0.21 seconds (0.21s).
[0m21:47:02.171384 [debug] [MainThread]: Command end result
[0m21:47:02.178359 [info ] [MainThread]: 
[0m21:47:02.178746 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m21:47:02.179034 [info ] [MainThread]: 
[0m21:47:02.179335 [error] [MainThread]:   Database Error in model stg_web__transactions (models/staging/web/stg_web__transactions.sql)
  syntax error at or near "clean_older"
  LINE 30: clean_older as (
           ^
  compiled Code at target/run/customer360/models/staging/web/stg_web__transactions.sql
[0m21:47:02.179625 [info ] [MainThread]: 
[0m21:47:02.179927 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=1 SKIP=2 TOTAL=4
[0m21:47:02.180633 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 0.7033988, "process_user_time": 2.287047, "process_kernel_time": 0.084853, "process_mem_max_rss": "113200", "process_in_blocks": "384", "process_out_blocks": "2552", "command_success": false}
[0m21:47:02.181084 [debug] [MainThread]: Command `dbt run` failed at 21:47:02.180972 after 0.70 seconds
[0m21:47:02.181465 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6e060fbfd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6e05f72050>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6e0622c990>]}
[0m21:47:02.181810 [debug] [MainThread]: Flushing usage events
[0m21:47:47.951787 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4fd0a12890>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4fd0a07e10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4fd0a01210>]}


============================== 21:47:47.954277 | bdaec165-7d13-4d84-92a4-8f208a85cb2c ==============================
[0m21:47:47.954277 [info ] [MainThread]: Running with dbt=1.7.8
[0m21:47:47.954790 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/root/option1-customer360/integration_tests/logs', 'debug': 'False', 'profiles_dir': '/root/option1-customer360/integration_tests', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt run', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m21:47:48.094926 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'bdaec165-7d13-4d84-92a4-8f208a85cb2c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4fd035d9d0>]}
[0m21:47:48.170119 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'bdaec165-7d13-4d84-92a4-8f208a85cb2c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4fd0412cd0>]}
[0m21:47:48.170810 [info ] [MainThread]: Registered adapter: postgres=1.7.8
[0m21:47:48.181741 [debug] [MainThread]: checksum: 67f0013ca5f0bd43af9a0873dd50792fde83ef69de63b71cacd0b4ac656c52e5, vars: {}, profile: , target: , version: 1.7.8
[0m21:47:48.202345 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m21:47:48.202876 [debug] [MainThread]: Partial parsing: updated file: customer360://models/staging/web/stg_web__transactions.sql
[0m21:47:48.324172 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'bdaec165-7d13-4d84-92a4-8f208a85cb2c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4fd0354810>]}
[0m21:47:48.389231 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'bdaec165-7d13-4d84-92a4-8f208a85cb2c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4fce93c2d0>]}
[0m21:47:48.389723 [info ] [MainThread]: Found 2 seeds, 4 models, 7 tests, 2 sources, 0 exposures, 0 metrics, 403 macros, 0 groups, 0 semantic models
[0m21:47:48.390078 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'bdaec165-7d13-4d84-92a4-8f208a85cb2c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4fd14f58d0>]}
[0m21:47:48.391741 [info ] [MainThread]: 
[0m21:47:48.392419 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m21:47:48.393508 [debug] [ThreadPool]: Acquiring new postgres connection 'list_dbt'
[0m21:47:48.402691 [debug] [ThreadPool]: Using postgres connection "list_dbt"
[0m21:47:48.403008 [debug] [ThreadPool]: On list_dbt: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "connection_name": "list_dbt"} */

    select distinct nspname from pg_namespace
  
[0m21:47:48.403276 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:47:48.408054 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.0 seconds
[0m21:47:48.409197 [debug] [ThreadPool]: On list_dbt: Close
[0m21:47:48.411757 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dbt, now list_dbt_public)
[0m21:47:48.417422 [debug] [ThreadPool]: Using postgres connection "list_dbt_public"
[0m21:47:48.417707 [debug] [ThreadPool]: On list_dbt_public: BEGIN
[0m21:47:48.417956 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:47:48.420989 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m21:47:48.421285 [debug] [ThreadPool]: Using postgres connection "list_dbt_public"
[0m21:47:48.421607 [debug] [ThreadPool]: On list_dbt_public: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "connection_name": "list_dbt_public"} */
select
      'dbt' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'dbt' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'dbt' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m21:47:48.424460 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.0 seconds
[0m21:47:48.425678 [debug] [ThreadPool]: On list_dbt_public: ROLLBACK
[0m21:47:48.426122 [debug] [ThreadPool]: On list_dbt_public: Close
[0m21:47:48.431699 [debug] [MainThread]: Using postgres connection "master"
[0m21:47:48.432004 [debug] [MainThread]: On master: BEGIN
[0m21:47:48.432264 [debug] [MainThread]: Opening a new connection, currently in state init
[0m21:47:48.435366 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m21:47:48.435666 [debug] [MainThread]: Using postgres connection "master"
[0m21:47:48.436014 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m21:47:48.444905 [debug] [MainThread]: SQL status: SELECT 0 in 0.0 seconds
[0m21:47:48.445949 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'bdaec165-7d13-4d84-92a4-8f208a85cb2c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4fce9c0a50>]}
[0m21:47:48.446362 [debug] [MainThread]: On master: ROLLBACK
[0m21:47:48.446943 [debug] [MainThread]: Using postgres connection "master"
[0m21:47:48.447222 [debug] [MainThread]: On master: BEGIN
[0m21:47:48.447874 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m21:47:48.448150 [debug] [MainThread]: On master: COMMIT
[0m21:47:48.448453 [debug] [MainThread]: Using postgres connection "master"
[0m21:47:48.448730 [debug] [MainThread]: On master: COMMIT
[0m21:47:48.449158 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m21:47:48.449454 [debug] [MainThread]: On master: Close
[0m21:47:48.450088 [info ] [MainThread]: Concurrency: 3 threads (target='local')
[0m21:47:48.450455 [info ] [MainThread]: 
[0m21:47:48.452880 [debug] [Thread-1 (]: Began running node model.customer360.stg_sf__contacts
[0m21:47:48.453911 [info ] [Thread-1 (]: 1 of 4 START sql table model public.stg_sf__contacts ........................... [RUN]
[0m21:47:48.453427 [debug] [Thread-2 (]: Began running node model.customer360.stg_web__transactions
[0m21:47:48.454601 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dbt_public, now model.customer360.stg_sf__contacts)
[0m21:47:48.455068 [info ] [Thread-2 (]: 2 of 4 START sql table model public.stg_web__transactions ...................... [RUN]
[0m21:47:48.455491 [debug] [Thread-1 (]: Began compiling node model.customer360.stg_sf__contacts
[0m21:47:48.456164 [debug] [Thread-2 (]: Acquiring new postgres connection 'model.customer360.stg_web__transactions'
[0m21:47:48.462681 [debug] [Thread-1 (]: Writing injected SQL for node "model.customer360.stg_sf__contacts"
[0m21:47:48.463072 [debug] [Thread-2 (]: Began compiling node model.customer360.stg_web__transactions
[0m21:47:48.465737 [debug] [Thread-2 (]: Writing injected SQL for node "model.customer360.stg_web__transactions"
[0m21:47:48.466355 [debug] [Thread-1 (]: Timing info for model.customer360.stg_sf__contacts (compile): 21:47:48.456443 => 21:47:48.466103
[0m21:47:48.466769 [debug] [Thread-1 (]: Began executing node model.customer360.stg_sf__contacts
[0m21:47:48.472351 [debug] [Thread-2 (]: Timing info for model.customer360.stg_web__transactions (compile): 21:47:48.463408 => 21:47:48.472119
[0m21:47:48.482967 [debug] [Thread-2 (]: Began executing node model.customer360.stg_web__transactions
[0m21:47:48.518698 [debug] [Thread-1 (]: Writing runtime sql for node "model.customer360.stg_sf__contacts"
[0m21:47:48.519084 [debug] [Thread-2 (]: Writing runtime sql for node "model.customer360.stg_web__transactions"
[0m21:47:48.519814 [debug] [Thread-2 (]: Using postgres connection "model.customer360.stg_web__transactions"
[0m21:47:48.520221 [debug] [Thread-1 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m21:47:48.520640 [debug] [Thread-2 (]: On model.customer360.stg_web__transactions: BEGIN
[0m21:47:48.520994 [debug] [Thread-1 (]: On model.customer360.stg_sf__contacts: BEGIN
[0m21:47:48.521362 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m21:47:48.521724 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:47:48.526690 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m21:47:48.527037 [debug] [Thread-1 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m21:47:48.527384 [debug] [Thread-1 (]: On model.customer360.stg_sf__contacts: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_sf__contacts"} */

  
    

  create  table "dbt"."public"."stg_sf__contacts__dbt_tmp"
  
  
    as
  
  (
    with source as (
    select * from "dbt"."public"."contacts"
),

renamed as (
    select
        id,
        username as user_name,
        name,
        gender,
        address, 
        mail as email_address,
        birthdate as birth_date,
        _loaded_at_utc
    from source     
)

select * from renamed
  );
  
[0m21:47:48.527793 [debug] [Thread-2 (]: SQL status: BEGIN in 0.0 seconds
[0m21:47:48.528102 [debug] [Thread-2 (]: Using postgres connection "model.customer360.stg_web__transactions"
[0m21:47:48.528462 [debug] [Thread-2 (]: On model.customer360.stg_web__transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_web__transactions"} */

  
    

  create  table "dbt"."public"."stg_web__transactions__dbt_tmp"
  
  
    as
  
  (
    with source as (
    select * from "dbt"."public"."transactions"
),

renamed as (
    select
        id,
        contact_id,
        
    to_timestamp(transaction_date,'YYYY-MM-DD HH24:MI:SS.MS') :: timestamp at TIME zone 'UTC'
 as transaction_date,
        amount,
        item_count,
        category, 
        _loaded_at_utc
    from source    
),

clean_older as (
    select * from renamed 
--    where transaction_date >= (current_date - 1)  过滤超过1天的数据
    where transaction_date >= (to_date('2023-04-12','yyyy-MM-dd') - 1)  --测试用,假设跑数日期为2023-04-12
)

select * from clean_older
  );
  
[0m21:47:48.534855 [debug] [Thread-1 (]: SQL status: SELECT 10 in 0.0 seconds
[0m21:47:48.540935 [debug] [Thread-2 (]: SQL status: SELECT 72 in 0.0 seconds
[0m21:47:48.541549 [debug] [Thread-1 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m21:47:48.544199 [debug] [Thread-2 (]: Using postgres connection "model.customer360.stg_web__transactions"
[0m21:47:48.544609 [debug] [Thread-1 (]: On model.customer360.stg_sf__contacts: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_sf__contacts"} */
alter table "dbt"."public"."stg_sf__contacts" rename to "stg_sf__contacts__dbt_backup"
[0m21:47:48.544995 [debug] [Thread-2 (]: On model.customer360.stg_web__transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_web__transactions"} */
alter table "dbt"."public"."stg_web__transactions" rename to "stg_web__transactions__dbt_backup"
[0m21:47:48.545800 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m21:47:48.548387 [debug] [Thread-1 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m21:47:48.548748 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m21:47:48.549209 [debug] [Thread-1 (]: On model.customer360.stg_sf__contacts: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_sf__contacts"} */
alter table "dbt"."public"."stg_sf__contacts__dbt_tmp" rename to "stg_sf__contacts"
[0m21:47:48.551662 [debug] [Thread-2 (]: Using postgres connection "model.customer360.stg_web__transactions"
[0m21:47:48.552149 [debug] [Thread-2 (]: On model.customer360.stg_web__transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_web__transactions"} */
alter table "dbt"."public"."stg_web__transactions__dbt_tmp" rename to "stg_web__transactions"
[0m21:47:48.552600 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m21:47:48.558800 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m21:47:48.579842 [debug] [Thread-1 (]: On model.customer360.stg_sf__contacts: COMMIT
[0m21:47:48.580535 [debug] [Thread-2 (]: On model.customer360.stg_web__transactions: COMMIT
[0m21:47:48.580877 [debug] [Thread-1 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m21:47:48.581235 [debug] [Thread-2 (]: Using postgres connection "model.customer360.stg_web__transactions"
[0m21:47:48.581632 [debug] [Thread-1 (]: On model.customer360.stg_sf__contacts: COMMIT
[0m21:47:48.581983 [debug] [Thread-2 (]: On model.customer360.stg_web__transactions: COMMIT
[0m21:47:48.583529 [debug] [Thread-2 (]: SQL status: COMMIT in 0.0 seconds
[0m21:47:48.589026 [debug] [Thread-2 (]: Applying DROP to: "dbt"."public"."stg_web__transactions__dbt_backup"
[0m21:47:48.589400 [debug] [Thread-1 (]: SQL status: COMMIT in 0.0 seconds
[0m21:47:48.593718 [debug] [Thread-2 (]: Using postgres connection "model.customer360.stg_web__transactions"
[0m21:47:48.596214 [debug] [Thread-1 (]: Applying DROP to: "dbt"."public"."stg_sf__contacts__dbt_backup"
[0m21:47:48.596627 [debug] [Thread-2 (]: On model.customer360.stg_web__transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_web__transactions"} */
drop table if exists "dbt"."public"."stg_web__transactions__dbt_backup" cascade
[0m21:47:48.597421 [debug] [Thread-1 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m21:47:48.597839 [debug] [Thread-1 (]: On model.customer360.stg_sf__contacts: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_sf__contacts"} */
drop table if exists "dbt"."public"."stg_sf__contacts__dbt_backup" cascade
[0m21:47:48.600240 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.0 seconds
[0m21:47:48.600733 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.0 seconds
[0m21:47:48.602109 [debug] [Thread-2 (]: Timing info for model.customer360.stg_web__transactions (execute): 21:47:48.488307 => 21:47:48.601893
[0m21:47:48.603366 [debug] [Thread-1 (]: Timing info for model.customer360.stg_sf__contacts (execute): 21:47:48.467043 => 21:47:48.603158
[0m21:47:48.603754 [debug] [Thread-2 (]: On model.customer360.stg_web__transactions: Close
[0m21:47:48.604167 [debug] [Thread-1 (]: On model.customer360.stg_sf__contacts: Close
[0m21:47:48.605076 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bdaec165-7d13-4d84-92a4-8f208a85cb2c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4fce181010>]}
[0m21:47:48.605770 [info ] [Thread-2 (]: 2 of 4 OK created sql table model public.stg_web__transactions ................. [[32mSELECT 72[0m in 0.15s]
[0m21:47:48.606539 [debug] [Thread-2 (]: Finished running node model.customer360.stg_web__transactions
[0m21:47:48.607347 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bdaec165-7d13-4d84-92a4-8f208a85cb2c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4fce9f1110>]}
[0m21:47:48.608129 [info ] [Thread-1 (]: 1 of 4 OK created sql table model public.stg_sf__contacts ...................... [[32mSELECT 10[0m in 0.15s]
[0m21:47:48.608707 [debug] [Thread-1 (]: Finished running node model.customer360.stg_sf__contacts
[0m21:47:48.609615 [debug] [Thread-3 (]: Began running node model.customer360.contacts_joined_with_transactions
[0m21:47:48.610118 [info ] [Thread-3 (]: 3 of 4 START sql view model public.contacts_joined_with_transactions ........... [RUN]
[0m21:47:48.610868 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.customer360.contacts_joined_with_transactions'
[0m21:47:48.611198 [debug] [Thread-3 (]: Began compiling node model.customer360.contacts_joined_with_transactions
[0m21:47:48.614185 [debug] [Thread-3 (]: Writing injected SQL for node "model.customer360.contacts_joined_with_transactions"
[0m21:47:48.614825 [debug] [Thread-3 (]: Timing info for model.customer360.contacts_joined_with_transactions (compile): 21:47:48.611563 => 21:47:48.614575
[0m21:47:48.615177 [debug] [Thread-3 (]: Began executing node model.customer360.contacts_joined_with_transactions
[0m21:47:48.631772 [debug] [Thread-3 (]: Writing runtime sql for node "model.customer360.contacts_joined_with_transactions"
[0m21:47:48.632383 [debug] [Thread-3 (]: Using postgres connection "model.customer360.contacts_joined_with_transactions"
[0m21:47:48.632722 [debug] [Thread-3 (]: On model.customer360.contacts_joined_with_transactions: BEGIN
[0m21:47:48.633038 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m21:47:48.636384 [debug] [Thread-3 (]: SQL status: BEGIN in 0.0 seconds
[0m21:47:48.636783 [debug] [Thread-3 (]: Using postgres connection "model.customer360.contacts_joined_with_transactions"
[0m21:47:48.637161 [debug] [Thread-3 (]: On model.customer360.contacts_joined_with_transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.contacts_joined_with_transactions"} */

  create view "dbt"."public"."contacts_joined_with_transactions__dbt_tmp"
    
    
  as (
    SELECT 
    contacts.*,
    transactions.id as transaction_id,
    transactions.transaction_date,
    transactions.amount,
    transactions.item_count,
    transactions.category
FROM "dbt"."public"."stg_web__transactions" as transactions
LEFT JOIN "dbt"."public"."stg_sf__contacts" as contacts ON contacts.id = transactions.contact_id
  );
[0m21:47:48.639212 [debug] [Thread-3 (]: SQL status: CREATE VIEW in 0.0 seconds
[0m21:47:48.642333 [debug] [Thread-3 (]: Using postgres connection "model.customer360.contacts_joined_with_transactions"
[0m21:47:48.642680 [debug] [Thread-3 (]: On model.customer360.contacts_joined_with_transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.contacts_joined_with_transactions"} */
alter table "dbt"."public"."contacts_joined_with_transactions__dbt_tmp" rename to "contacts_joined_with_transactions"
[0m21:47:48.643391 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m21:47:48.646466 [debug] [Thread-3 (]: On model.customer360.contacts_joined_with_transactions: COMMIT
[0m21:47:48.646809 [debug] [Thread-3 (]: Using postgres connection "model.customer360.contacts_joined_with_transactions"
[0m21:47:48.647119 [debug] [Thread-3 (]: On model.customer360.contacts_joined_with_transactions: COMMIT
[0m21:47:48.648467 [debug] [Thread-3 (]: SQL status: COMMIT in 0.0 seconds
[0m21:47:48.650505 [debug] [Thread-3 (]: Applying DROP to: "dbt"."public"."contacts_joined_with_transactions__dbt_backup"
[0m21:47:48.653286 [debug] [Thread-3 (]: Using postgres connection "model.customer360.contacts_joined_with_transactions"
[0m21:47:48.653633 [debug] [Thread-3 (]: On model.customer360.contacts_joined_with_transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.contacts_joined_with_transactions"} */
drop view if exists "dbt"."public"."contacts_joined_with_transactions__dbt_backup" cascade
[0m21:47:48.654226 [debug] [Thread-3 (]: SQL status: DROP VIEW in 0.0 seconds
[0m21:47:48.655550 [debug] [Thread-3 (]: Timing info for model.customer360.contacts_joined_with_transactions (execute): 21:47:48.615414 => 21:47:48.655348
[0m21:47:48.655948 [debug] [Thread-3 (]: On model.customer360.contacts_joined_with_transactions: Close
[0m21:47:48.656993 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bdaec165-7d13-4d84-92a4-8f208a85cb2c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4fd161a090>]}
[0m21:47:48.657674 [info ] [Thread-3 (]: 3 of 4 OK created sql view model public.contacts_joined_with_transactions ...... [[32mCREATE VIEW[0m in 0.05s]
[0m21:47:48.658373 [debug] [Thread-3 (]: Finished running node model.customer360.contacts_joined_with_transactions
[0m21:47:48.659499 [debug] [Thread-1 (]: Began running node model.customer360.customers
[0m21:47:48.660034 [info ] [Thread-1 (]: 4 of 4 START sql table model public.customers .................................. [RUN]
[0m21:47:48.660763 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.customer360.stg_sf__contacts, now model.customer360.customers)
[0m21:47:48.661099 [debug] [Thread-1 (]: Began compiling node model.customer360.customers
[0m21:47:48.664395 [debug] [Thread-1 (]: Writing injected SQL for node "model.customer360.customers"
[0m21:47:48.665004 [debug] [Thread-1 (]: Timing info for model.customer360.customers (compile): 21:47:48.661291 => 21:47:48.664760
[0m21:47:48.665356 [debug] [Thread-1 (]: Began executing node model.customer360.customers
[0m21:47:48.669230 [debug] [Thread-1 (]: Writing runtime sql for node "model.customer360.customers"
[0m21:47:48.669738 [debug] [Thread-1 (]: Using postgres connection "model.customer360.customers"
[0m21:47:48.670055 [debug] [Thread-1 (]: On model.customer360.customers: BEGIN
[0m21:47:48.670428 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:47:48.673831 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m21:47:48.674164 [debug] [Thread-1 (]: Using postgres connection "model.customer360.customers"
[0m21:47:48.674527 [debug] [Thread-1 (]: On model.customer360.customers: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.customers"} */

  
    

  create  table "dbt"."public"."customers__dbt_tmp"
  
  
    as
  
  (
    SELECT
    id,
    gender,
    
    date_part('year', age(current_date, birth_date))
 AS age,
    sum(amount) as total_expense
FROM "dbt"."public"."contacts_joined_with_transactions"
GROUP BY
    1,2,3
  );
  
[0m21:47:48.680828 [debug] [Thread-1 (]: SQL status: SELECT 9 in 0.0 seconds
[0m21:47:48.683686 [debug] [Thread-1 (]: Using postgres connection "model.customer360.customers"
[0m21:47:48.684008 [debug] [Thread-1 (]: On model.customer360.customers: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.customers"} */
alter table "dbt"."public"."customers" rename to "customers__dbt_backup"
[0m21:47:48.684646 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m21:47:48.687014 [debug] [Thread-1 (]: Using postgres connection "model.customer360.customers"
[0m21:47:48.687354 [debug] [Thread-1 (]: On model.customer360.customers: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.customers"} */
alter table "dbt"."public"."customers__dbt_tmp" rename to "customers"
[0m21:47:48.688085 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m21:47:48.690046 [debug] [Thread-1 (]: On model.customer360.customers: COMMIT
[0m21:47:48.690394 [debug] [Thread-1 (]: Using postgres connection "model.customer360.customers"
[0m21:47:48.690709 [debug] [Thread-1 (]: On model.customer360.customers: COMMIT
[0m21:47:48.692148 [debug] [Thread-1 (]: SQL status: COMMIT in 0.0 seconds
[0m21:47:48.694342 [debug] [Thread-1 (]: Applying DROP to: "dbt"."public"."customers__dbt_backup"
[0m21:47:48.695103 [debug] [Thread-1 (]: Using postgres connection "model.customer360.customers"
[0m21:47:48.695467 [debug] [Thread-1 (]: On model.customer360.customers: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.customers"} */
drop table if exists "dbt"."public"."customers__dbt_backup" cascade
[0m21:47:48.697482 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.0 seconds
[0m21:47:48.698726 [debug] [Thread-1 (]: Timing info for model.customer360.customers (execute): 21:47:48.665571 => 21:47:48.698521
[0m21:47:48.699042 [debug] [Thread-1 (]: On model.customer360.customers: Close
[0m21:47:48.699851 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bdaec165-7d13-4d84-92a4-8f208a85cb2c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4fce1c2790>]}
[0m21:47:48.700497 [info ] [Thread-1 (]: 4 of 4 OK created sql table model public.customers ............................. [[32mSELECT 9[0m in 0.04s]
[0m21:47:48.701162 [debug] [Thread-1 (]: Finished running node model.customer360.customers
[0m21:47:48.702660 [debug] [MainThread]: Using postgres connection "master"
[0m21:47:48.702946 [debug] [MainThread]: On master: BEGIN
[0m21:47:48.703224 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m21:47:48.706393 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m21:47:48.706686 [debug] [MainThread]: On master: COMMIT
[0m21:47:48.706958 [debug] [MainThread]: Using postgres connection "master"
[0m21:47:48.707209 [debug] [MainThread]: On master: COMMIT
[0m21:47:48.707703 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m21:47:48.707997 [debug] [MainThread]: On master: Close
[0m21:47:48.708592 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:47:48.708862 [debug] [MainThread]: Connection 'model.customer360.customers' was properly closed.
[0m21:47:48.709105 [debug] [MainThread]: Connection 'model.customer360.stg_web__transactions' was properly closed.
[0m21:47:48.709395 [debug] [MainThread]: Connection 'model.customer360.contacts_joined_with_transactions' was properly closed.
[0m21:47:48.709826 [info ] [MainThread]: 
[0m21:47:48.710231 [info ] [MainThread]: Finished running 3 table models, 1 view model in 0 hours 0 minutes and 0.32 seconds (0.32s).
[0m21:47:48.711321 [debug] [MainThread]: Command end result
[0m21:47:48.717804 [info ] [MainThread]: 
[0m21:47:48.718178 [info ] [MainThread]: [32mCompleted successfully[0m
[0m21:47:48.718476 [info ] [MainThread]: 
[0m21:47:48.718780 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 TOTAL=4
[0m21:47:48.719782 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 0.8034125, "process_user_time": 2.313581, "process_kernel_time": 0.088136, "process_mem_max_rss": "113672", "process_out_blocks": "2608", "process_in_blocks": "0"}
[0m21:47:48.720260 [debug] [MainThread]: Command `dbt run` succeeded at 21:47:48.720119 after 0.80 seconds
[0m21:47:48.720651 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4fd06a31d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4fd05a3510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4fce186b10>]}
[0m21:47:48.720977 [debug] [MainThread]: Flushing usage events
[0m21:52:28.167428 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9b91ab3a50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9b919086d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9b91697c90>]}


============================== 21:52:28.169970 | 29a62907-e4ef-4131-8b84-4ea1d0f98d83 ==============================
[0m21:52:28.169970 [info ] [MainThread]: Running with dbt=1.7.8
[0m21:52:28.170466 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/root/option1-customer360/integration_tests', 'fail_fast': 'False', 'warn_error': 'None', 'log_path': '/root/option1-customer360/integration_tests/logs', 'debug': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt run', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m21:52:28.308938 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '29a62907-e4ef-4131-8b84-4ea1d0f98d83', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9b8fc145d0>]}
[0m21:52:28.383170 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '29a62907-e4ef-4131-8b84-4ea1d0f98d83', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9b91595ad0>]}
[0m21:52:28.383853 [info ] [MainThread]: Registered adapter: postgres=1.7.8
[0m21:52:28.394806 [debug] [MainThread]: checksum: 67f0013ca5f0bd43af9a0873dd50792fde83ef69de63b71cacd0b4ac656c52e5, vars: {}, profile: , target: , version: 1.7.8
[0m21:52:28.415316 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m21:52:28.415855 [debug] [MainThread]: Partial parsing: updated file: customer360://models/staging/web/stg_web__transactions.sql
[0m21:52:28.536497 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '29a62907-e4ef-4131-8b84-4ea1d0f98d83', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9b8f37b890>]}
[0m21:52:28.600785 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '29a62907-e4ef-4131-8b84-4ea1d0f98d83', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9b8fa1c4d0>]}
[0m21:52:28.601261 [info ] [MainThread]: Found 2 seeds, 4 models, 7 tests, 2 sources, 0 exposures, 0 metrics, 403 macros, 0 groups, 0 semantic models
[0m21:52:28.601626 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '29a62907-e4ef-4131-8b84-4ea1d0f98d83', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9b8fb6ea90>]}
[0m21:52:28.603174 [info ] [MainThread]: 
[0m21:52:28.603853 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m21:52:28.604957 [debug] [ThreadPool]: Acquiring new postgres connection 'list_dbt'
[0m21:52:28.614272 [debug] [ThreadPool]: Using postgres connection "list_dbt"
[0m21:52:28.614597 [debug] [ThreadPool]: On list_dbt: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "connection_name": "list_dbt"} */

    select distinct nspname from pg_namespace
  
[0m21:52:28.614862 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:52:28.619466 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.0 seconds
[0m21:52:28.620616 [debug] [ThreadPool]: On list_dbt: Close
[0m21:52:28.623247 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dbt, now list_dbt_public)
[0m21:52:28.628471 [debug] [ThreadPool]: Using postgres connection "list_dbt_public"
[0m21:52:28.628770 [debug] [ThreadPool]: On list_dbt_public: BEGIN
[0m21:52:28.629023 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:52:28.632086 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m21:52:28.632410 [debug] [ThreadPool]: Using postgres connection "list_dbt_public"
[0m21:52:28.632706 [debug] [ThreadPool]: On list_dbt_public: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "connection_name": "list_dbt_public"} */
select
      'dbt' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'dbt' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'dbt' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m21:52:28.635437 [debug] [ThreadPool]: SQL status: SELECT 6 in 0.0 seconds
[0m21:52:28.636727 [debug] [ThreadPool]: On list_dbt_public: ROLLBACK
[0m21:52:28.637642 [debug] [ThreadPool]: On list_dbt_public: Close
[0m21:52:28.643212 [debug] [MainThread]: Using postgres connection "master"
[0m21:52:28.643543 [debug] [MainThread]: On master: BEGIN
[0m21:52:28.643801 [debug] [MainThread]: Opening a new connection, currently in state init
[0m21:52:28.646857 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m21:52:28.647190 [debug] [MainThread]: Using postgres connection "master"
[0m21:52:28.647581 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m21:52:28.657356 [debug] [MainThread]: SQL status: SELECT 2 in 0.0 seconds
[0m21:52:28.658872 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '29a62907-e4ef-4131-8b84-4ea1d0f98d83', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9b8fac9550>]}
[0m21:52:28.659267 [debug] [MainThread]: On master: ROLLBACK
[0m21:52:28.659760 [debug] [MainThread]: Using postgres connection "master"
[0m21:52:28.660042 [debug] [MainThread]: On master: BEGIN
[0m21:52:28.660693 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m21:52:28.660983 [debug] [MainThread]: On master: COMMIT
[0m21:52:28.661282 [debug] [MainThread]: Using postgres connection "master"
[0m21:52:28.661571 [debug] [MainThread]: On master: COMMIT
[0m21:52:28.661999 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m21:52:28.662309 [debug] [MainThread]: On master: Close
[0m21:52:28.662945 [info ] [MainThread]: Concurrency: 3 threads (target='local')
[0m21:52:28.663259 [info ] [MainThread]: 
[0m21:52:28.665869 [debug] [Thread-1 (]: Began running node model.customer360.stg_sf__contacts
[0m21:52:28.666269 [debug] [Thread-2 (]: Began running node model.customer360.stg_web__transactions
[0m21:52:28.666735 [info ] [Thread-1 (]: 1 of 4 START sql table model public.stg_sf__contacts ........................... [RUN]
[0m21:52:28.667235 [info ] [Thread-2 (]: 2 of 4 START sql table model public.stg_web__transactions ...................... [RUN]
[0m21:52:28.667897 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dbt_public, now model.customer360.stg_sf__contacts)
[0m21:52:28.668700 [debug] [Thread-2 (]: Acquiring new postgres connection 'model.customer360.stg_web__transactions'
[0m21:52:28.669079 [debug] [Thread-1 (]: Began compiling node model.customer360.stg_sf__contacts
[0m21:52:28.669465 [debug] [Thread-2 (]: Began compiling node model.customer360.stg_web__transactions
[0m21:52:28.675931 [debug] [Thread-1 (]: Writing injected SQL for node "model.customer360.stg_sf__contacts"
[0m21:52:28.678585 [debug] [Thread-2 (]: Writing injected SQL for node "model.customer360.stg_web__transactions"
[0m21:52:28.679248 [debug] [Thread-2 (]: Timing info for model.customer360.stg_web__transactions (compile): 21:52:28.676186 => 21:52:28.679029
[0m21:52:28.679759 [debug] [Thread-1 (]: Timing info for model.customer360.stg_sf__contacts (compile): 21:52:28.669697 => 21:52:28.679502
[0m21:52:28.680118 [debug] [Thread-2 (]: Began executing node model.customer360.stg_web__transactions
[0m21:52:28.680495 [debug] [Thread-1 (]: Began executing node model.customer360.stg_sf__contacts
[0m21:52:28.734435 [debug] [Thread-2 (]: Writing runtime sql for node "model.customer360.stg_web__transactions"
[0m21:52:28.734815 [debug] [Thread-1 (]: Writing runtime sql for node "model.customer360.stg_sf__contacts"
[0m21:52:28.735631 [debug] [Thread-1 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m21:52:28.736051 [debug] [Thread-2 (]: Using postgres connection "model.customer360.stg_web__transactions"
[0m21:52:28.736424 [debug] [Thread-1 (]: On model.customer360.stg_sf__contacts: BEGIN
[0m21:52:28.736792 [debug] [Thread-2 (]: On model.customer360.stg_web__transactions: BEGIN
[0m21:52:28.737175 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:52:28.737550 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m21:52:28.742852 [debug] [Thread-2 (]: SQL status: BEGIN in 0.0 seconds
[0m21:52:28.743238 [debug] [Thread-2 (]: Using postgres connection "model.customer360.stg_web__transactions"
[0m21:52:28.743634 [debug] [Thread-2 (]: On model.customer360.stg_web__transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_web__transactions"} */

  
    

  create  table "dbt"."public"."stg_web__transactions__dbt_tmp"
  
  
    as
  
  (
    with source as (
    select * from "dbt"."public"."transactions"
),

renamed as (
    select
        id,
        contact_id,
        
    to_timestamp(transaction_date,'YYYY-MM-DD HH24:MI:SS.MS') :: timestamp at TIME zone 'UTC'
 as transaction_date,
        amount,
        item_count,
        category, 
        _loaded_at_utc
    from source    
),

clean_older as (
    select * from renamed 
--    where transaction_date >= (current_date - 1)  过滤超过1天的数据
    where transaction_date >= (to_date('2023-04-12','yyyy-MM-dd') - 1)  --测试用,假设跑数日期为2023-04-12
    and transaction_date < to_date('2023-04-12','yyyy-MM-dd')
)

select * from clean_older
  );
  
[0m21:52:28.744040 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m21:52:28.744401 [debug] [Thread-1 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m21:52:28.744891 [debug] [Thread-1 (]: On model.customer360.stg_sf__contacts: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_sf__contacts"} */

  
    

  create  table "dbt"."public"."stg_sf__contacts__dbt_tmp"
  
  
    as
  
  (
    with source as (
    select * from "dbt"."public"."contacts"
),

renamed as (
    select
        id,
        username as user_name,
        name,
        gender,
        address, 
        mail as email_address,
        birthdate as birth_date,
        _loaded_at_utc
    from source     
)

select * from renamed
  );
  
[0m21:52:28.751086 [debug] [Thread-1 (]: SQL status: SELECT 10 in 0.0 seconds
[0m21:52:28.757515 [debug] [Thread-1 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m21:52:28.757926 [debug] [Thread-2 (]: SQL status: SELECT 4 in 0.0 seconds
[0m21:52:28.758315 [debug] [Thread-1 (]: On model.customer360.stg_sf__contacts: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_sf__contacts"} */
alter table "dbt"."public"."stg_sf__contacts" rename to "stg_sf__contacts__dbt_backup"
[0m21:52:28.761013 [debug] [Thread-2 (]: Using postgres connection "model.customer360.stg_web__transactions"
[0m21:52:28.761499 [debug] [Thread-2 (]: On model.customer360.stg_web__transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_web__transactions"} */
alter table "dbt"."public"."stg_web__transactions" rename to "stg_web__transactions__dbt_backup"
[0m21:52:28.762541 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m21:52:28.765110 [debug] [Thread-2 (]: Using postgres connection "model.customer360.stg_web__transactions"
[0m21:52:28.765470 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m21:52:28.765827 [debug] [Thread-2 (]: On model.customer360.stg_web__transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_web__transactions"} */
alter table "dbt"."public"."stg_web__transactions__dbt_tmp" rename to "stg_web__transactions"
[0m21:52:28.768377 [debug] [Thread-1 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m21:52:28.768874 [debug] [Thread-1 (]: On model.customer360.stg_sf__contacts: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_sf__contacts"} */
alter table "dbt"."public"."stg_sf__contacts__dbt_tmp" rename to "stg_sf__contacts"
[0m21:52:28.769273 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m21:52:28.784240 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m21:52:28.788031 [debug] [Thread-2 (]: On model.customer360.stg_web__transactions: COMMIT
[0m21:52:28.790061 [debug] [Thread-1 (]: On model.customer360.stg_sf__contacts: COMMIT
[0m21:52:28.790468 [debug] [Thread-2 (]: Using postgres connection "model.customer360.stg_web__transactions"
[0m21:52:28.790837 [debug] [Thread-1 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m21:52:28.791195 [debug] [Thread-2 (]: On model.customer360.stg_web__transactions: COMMIT
[0m21:52:28.791609 [debug] [Thread-1 (]: On model.customer360.stg_sf__contacts: COMMIT
[0m21:52:28.793553 [debug] [Thread-2 (]: SQL status: COMMIT in 0.0 seconds
[0m21:52:28.793913 [debug] [Thread-1 (]: SQL status: COMMIT in 0.0 seconds
[0m21:52:28.799628 [debug] [Thread-2 (]: Applying DROP to: "dbt"."public"."stg_web__transactions__dbt_backup"
[0m21:52:28.801783 [debug] [Thread-1 (]: Applying DROP to: "dbt"."public"."stg_sf__contacts__dbt_backup"
[0m21:52:28.806160 [debug] [Thread-2 (]: Using postgres connection "model.customer360.stg_web__transactions"
[0m21:52:28.807012 [debug] [Thread-1 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m21:52:28.807419 [debug] [Thread-2 (]: On model.customer360.stg_web__transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_web__transactions"} */
drop table if exists "dbt"."public"."stg_web__transactions__dbt_backup" cascade
[0m21:52:28.807797 [debug] [Thread-1 (]: On model.customer360.stg_sf__contacts: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_sf__contacts"} */
drop table if exists "dbt"."public"."stg_sf__contacts__dbt_backup" cascade
[0m21:52:28.811030 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.0 seconds
[0m21:52:28.812610 [debug] [Thread-1 (]: Timing info for model.customer360.stg_sf__contacts (execute): 21:52:28.696046 => 21:52:28.812327
[0m21:52:28.812980 [debug] [Thread-1 (]: On model.customer360.stg_sf__contacts: Close
[0m21:52:28.813433 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.0 seconds
[0m21:52:28.815168 [debug] [Thread-2 (]: Timing info for model.customer360.stg_web__transactions (execute): 21:52:28.680728 => 21:52:28.814816
[0m21:52:28.815872 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '29a62907-e4ef-4131-8b84-4ea1d0f98d83', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9b8f90fad0>]}
[0m21:52:28.816256 [debug] [Thread-2 (]: On model.customer360.stg_web__transactions: Close
[0m21:52:28.817547 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '29a62907-e4ef-4131-8b84-4ea1d0f98d83', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9b8fb22f50>]}
[0m21:52:28.816841 [info ] [Thread-1 (]: 1 of 4 OK created sql table model public.stg_sf__contacts ...................... [[32mSELECT 10[0m in 0.15s]
[0m21:52:28.818808 [debug] [Thread-1 (]: Finished running node model.customer360.stg_sf__contacts
[0m21:52:28.818016 [info ] [Thread-2 (]: 2 of 4 OK created sql table model public.stg_web__transactions ................. [[32mSELECT 4[0m in 0.15s]
[0m21:52:28.819619 [debug] [Thread-2 (]: Finished running node model.customer360.stg_web__transactions
[0m21:52:28.820333 [debug] [Thread-3 (]: Began running node model.customer360.contacts_joined_with_transactions
[0m21:52:28.820758 [info ] [Thread-3 (]: 3 of 4 START sql view model public.contacts_joined_with_transactions ........... [RUN]
[0m21:52:28.821429 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.customer360.contacts_joined_with_transactions'
[0m21:52:28.821750 [debug] [Thread-3 (]: Began compiling node model.customer360.contacts_joined_with_transactions
[0m21:52:28.824686 [debug] [Thread-3 (]: Writing injected SQL for node "model.customer360.contacts_joined_with_transactions"
[0m21:52:28.825476 [debug] [Thread-3 (]: Timing info for model.customer360.contacts_joined_with_transactions (compile): 21:52:28.821945 => 21:52:28.825201
[0m21:52:28.825800 [debug] [Thread-3 (]: Began executing node model.customer360.contacts_joined_with_transactions
[0m21:52:28.842447 [debug] [Thread-3 (]: Writing runtime sql for node "model.customer360.contacts_joined_with_transactions"
[0m21:52:28.843006 [debug] [Thread-3 (]: Using postgres connection "model.customer360.contacts_joined_with_transactions"
[0m21:52:28.843380 [debug] [Thread-3 (]: On model.customer360.contacts_joined_with_transactions: BEGIN
[0m21:52:28.843721 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m21:52:28.847060 [debug] [Thread-3 (]: SQL status: BEGIN in 0.0 seconds
[0m21:52:28.847427 [debug] [Thread-3 (]: Using postgres connection "model.customer360.contacts_joined_with_transactions"
[0m21:52:28.847769 [debug] [Thread-3 (]: On model.customer360.contacts_joined_with_transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.contacts_joined_with_transactions"} */

  create view "dbt"."public"."contacts_joined_with_transactions__dbt_tmp"
    
    
  as (
    SELECT 
    contacts.*,
    transactions.id as transaction_id,
    transactions.transaction_date,
    transactions.amount,
    transactions.item_count,
    transactions.category
FROM "dbt"."public"."stg_web__transactions" as transactions
LEFT JOIN "dbt"."public"."stg_sf__contacts" as contacts ON contacts.id = transactions.contact_id
  );
[0m21:52:28.849787 [debug] [Thread-3 (]: SQL status: CREATE VIEW in 0.0 seconds
[0m21:52:28.852445 [debug] [Thread-3 (]: Using postgres connection "model.customer360.contacts_joined_with_transactions"
[0m21:52:28.852789 [debug] [Thread-3 (]: On model.customer360.contacts_joined_with_transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.contacts_joined_with_transactions"} */
alter table "dbt"."public"."contacts_joined_with_transactions__dbt_tmp" rename to "contacts_joined_with_transactions"
[0m21:52:28.853490 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m21:52:28.856650 [debug] [Thread-3 (]: On model.customer360.contacts_joined_with_transactions: COMMIT
[0m21:52:28.856982 [debug] [Thread-3 (]: Using postgres connection "model.customer360.contacts_joined_with_transactions"
[0m21:52:28.857346 [debug] [Thread-3 (]: On model.customer360.contacts_joined_with_transactions: COMMIT
[0m21:52:28.859041 [debug] [Thread-3 (]: SQL status: COMMIT in 0.0 seconds
[0m21:52:28.861041 [debug] [Thread-3 (]: Applying DROP to: "dbt"."public"."contacts_joined_with_transactions__dbt_backup"
[0m21:52:28.863872 [debug] [Thread-3 (]: Using postgres connection "model.customer360.contacts_joined_with_transactions"
[0m21:52:28.864211 [debug] [Thread-3 (]: On model.customer360.contacts_joined_with_transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.contacts_joined_with_transactions"} */
drop view if exists "dbt"."public"."contacts_joined_with_transactions__dbt_backup" cascade
[0m21:52:28.864911 [debug] [Thread-3 (]: SQL status: DROP VIEW in 0.0 seconds
[0m21:52:28.866164 [debug] [Thread-3 (]: Timing info for model.customer360.contacts_joined_with_transactions (execute): 21:52:28.825993 => 21:52:28.865969
[0m21:52:28.866510 [debug] [Thread-3 (]: On model.customer360.contacts_joined_with_transactions: Close
[0m21:52:28.867290 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '29a62907-e4ef-4131-8b84-4ea1d0f98d83', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9b8f43d990>]}
[0m21:52:28.867953 [info ] [Thread-3 (]: 3 of 4 OK created sql view model public.contacts_joined_with_transactions ...... [[32mCREATE VIEW[0m in 0.05s]
[0m21:52:28.868667 [debug] [Thread-3 (]: Finished running node model.customer360.contacts_joined_with_transactions
[0m21:52:28.869465 [debug] [Thread-2 (]: Began running node model.customer360.customers
[0m21:52:28.869877 [info ] [Thread-2 (]: 4 of 4 START sql table model public.customers .................................. [RUN]
[0m21:52:28.870476 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.customer360.stg_web__transactions, now model.customer360.customers)
[0m21:52:28.870794 [debug] [Thread-2 (]: Began compiling node model.customer360.customers
[0m21:52:28.874021 [debug] [Thread-2 (]: Writing injected SQL for node "model.customer360.customers"
[0m21:52:28.874632 [debug] [Thread-2 (]: Timing info for model.customer360.customers (compile): 21:52:28.871001 => 21:52:28.874391
[0m21:52:28.874947 [debug] [Thread-2 (]: Began executing node model.customer360.customers
[0m21:52:28.878798 [debug] [Thread-2 (]: Writing runtime sql for node "model.customer360.customers"
[0m21:52:28.879288 [debug] [Thread-2 (]: Using postgres connection "model.customer360.customers"
[0m21:52:28.879635 [debug] [Thread-2 (]: On model.customer360.customers: BEGIN
[0m21:52:28.879934 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m21:52:28.883155 [debug] [Thread-2 (]: SQL status: BEGIN in 0.0 seconds
[0m21:52:28.883518 [debug] [Thread-2 (]: Using postgres connection "model.customer360.customers"
[0m21:52:28.883833 [debug] [Thread-2 (]: On model.customer360.customers: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.customers"} */

  
    

  create  table "dbt"."public"."customers__dbt_tmp"
  
  
    as
  
  (
    SELECT
    id,
    gender,
    
    date_part('year', age(current_date, birth_date))
 AS age,
    sum(amount) as total_expense
FROM "dbt"."public"."contacts_joined_with_transactions"
GROUP BY
    1,2,3
  );
  
[0m21:52:28.889716 [debug] [Thread-2 (]: SQL status: SELECT 2 in 0.0 seconds
[0m21:52:28.892631 [debug] [Thread-2 (]: Using postgres connection "model.customer360.customers"
[0m21:52:28.892957 [debug] [Thread-2 (]: On model.customer360.customers: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.customers"} */
alter table "dbt"."public"."customers" rename to "customers__dbt_backup"
[0m21:52:28.893607 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m21:52:28.895982 [debug] [Thread-2 (]: Using postgres connection "model.customer360.customers"
[0m21:52:28.896325 [debug] [Thread-2 (]: On model.customer360.customers: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.customers"} */
alter table "dbt"."public"."customers__dbt_tmp" rename to "customers"
[0m21:52:28.896920 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m21:52:28.898913 [debug] [Thread-2 (]: On model.customer360.customers: COMMIT
[0m21:52:28.899231 [debug] [Thread-2 (]: Using postgres connection "model.customer360.customers"
[0m21:52:28.899563 [debug] [Thread-2 (]: On model.customer360.customers: COMMIT
[0m21:52:28.903275 [debug] [Thread-2 (]: SQL status: COMMIT in 0.0 seconds
[0m21:52:28.905453 [debug] [Thread-2 (]: Applying DROP to: "dbt"."public"."customers__dbt_backup"
[0m21:52:28.906168 [debug] [Thread-2 (]: Using postgres connection "model.customer360.customers"
[0m21:52:28.906524 [debug] [Thread-2 (]: On model.customer360.customers: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.customers"} */
drop table if exists "dbt"."public"."customers__dbt_backup" cascade
[0m21:52:28.908645 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.0 seconds
[0m21:52:28.909848 [debug] [Thread-2 (]: Timing info for model.customer360.customers (execute): 21:52:28.875161 => 21:52:28.909658
[0m21:52:28.910167 [debug] [Thread-2 (]: On model.customer360.customers: Close
[0m21:52:28.910973 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '29a62907-e4ef-4131-8b84-4ea1d0f98d83', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9b8f4356d0>]}
[0m21:52:28.911619 [info ] [Thread-2 (]: 4 of 4 OK created sql table model public.customers ............................. [[32mSELECT 2[0m in 0.04s]
[0m21:52:28.912268 [debug] [Thread-2 (]: Finished running node model.customer360.customers
[0m21:52:28.913754 [debug] [MainThread]: Using postgres connection "master"
[0m21:52:28.914035 [debug] [MainThread]: On master: BEGIN
[0m21:52:28.914310 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m21:52:28.917312 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m21:52:28.917609 [debug] [MainThread]: On master: COMMIT
[0m21:52:28.917910 [debug] [MainThread]: Using postgres connection "master"
[0m21:52:28.918342 [debug] [MainThread]: On master: COMMIT
[0m21:52:28.918819 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m21:52:28.919103 [debug] [MainThread]: On master: Close
[0m21:52:28.919688 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:52:28.919962 [debug] [MainThread]: Connection 'model.customer360.stg_sf__contacts' was properly closed.
[0m21:52:28.920202 [debug] [MainThread]: Connection 'model.customer360.customers' was properly closed.
[0m21:52:28.920553 [debug] [MainThread]: Connection 'model.customer360.contacts_joined_with_transactions' was properly closed.
[0m21:52:28.920973 [info ] [MainThread]: 
[0m21:52:28.921401 [info ] [MainThread]: Finished running 3 table models, 1 view model in 0 hours 0 minutes and 0.32 seconds (0.32s).
[0m21:52:28.922443 [debug] [MainThread]: Command end result
[0m21:52:28.929007 [info ] [MainThread]: 
[0m21:52:28.929414 [info ] [MainThread]: [32mCompleted successfully[0m
[0m21:52:28.929694 [info ] [MainThread]: 
[0m21:52:28.929991 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 TOTAL=4
[0m21:52:28.930675 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 0.7996699, "process_user_time": 2.295374, "process_kernel_time": 0.093136, "process_mem_max_rss": "113432", "process_out_blocks": "2600", "process_in_blocks": "0"}
[0m21:52:28.931132 [debug] [MainThread]: Command `dbt run` succeeded at 21:52:28.931017 after 0.80 seconds
[0m21:52:28.931484 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9b91689290>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9b960abd90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9b960abd50>]}
[0m21:52:28.931809 [debug] [MainThread]: Flushing usage events
[0m23:48:06.306237 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f00b18c8390>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f00b1be3950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f00b18c8750>]}


============================== 23:48:06.308884 | 2567bc4a-b943-46fc-b071-86d48a4d88b5 ==============================
[0m23:48:06.308884 [info ] [MainThread]: Running with dbt=1.7.8
[0m23:48:06.309413 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'profiles_dir': '/root/option1-customer360/integration_tests', 'log_path': '/root/option1-customer360/integration_tests/logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt test', 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m23:48:06.448167 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '2567bc4a-b943-46fc-b071-86d48a4d88b5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f00afb50190>]}
[0m23:48:06.522650 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '2567bc4a-b943-46fc-b071-86d48a4d88b5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f00b1a99810>]}
[0m23:48:06.523390 [info ] [MainThread]: Registered adapter: postgres=1.7.8
[0m23:48:06.534274 [debug] [MainThread]: checksum: 67f0013ca5f0bd43af9a0873dd50792fde83ef69de63b71cacd0b4ac656c52e5, vars: {}, profile: , target: , version: 1.7.8
[0m23:48:06.555047 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 2 files added, 0 files changed.
[0m23:48:06.555574 [debug] [MainThread]: Partial parsing: added file: customer360://tests/macro_test1.sql
[0m23:48:06.555884 [debug] [MainThread]: Partial parsing: added file: customer360://tests/macro_test2.sql
[0m23:48:06.650772 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '2567bc4a-b943-46fc-b071-86d48a4d88b5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f00b162d3d0>]}
[0m23:48:06.716456 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '2567bc4a-b943-46fc-b071-86d48a4d88b5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f00af8bf750>]}
[0m23:48:06.716918 [info ] [MainThread]: Found 2 seeds, 4 models, 9 tests, 2 sources, 0 exposures, 0 metrics, 403 macros, 0 groups, 0 semantic models
[0m23:48:06.717259 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2567bc4a-b943-46fc-b071-86d48a4d88b5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f00af87add0>]}
[0m23:48:06.719108 [info ] [MainThread]: 
[0m23:48:06.719782 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m23:48:06.721171 [debug] [ThreadPool]: Acquiring new postgres connection 'list_dbt_public'
[0m23:48:06.730634 [debug] [ThreadPool]: Using postgres connection "list_dbt_public"
[0m23:48:06.730961 [debug] [ThreadPool]: On list_dbt_public: BEGIN
[0m23:48:06.731305 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:48:06.735323 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m23:48:06.735641 [debug] [ThreadPool]: Using postgres connection "list_dbt_public"
[0m23:48:06.735928 [debug] [ThreadPool]: On list_dbt_public: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "connection_name": "list_dbt_public"} */
select
      'dbt' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'dbt' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'dbt' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m23:48:06.739412 [debug] [ThreadPool]: SQL status: SELECT 6 in 0.0 seconds
[0m23:48:06.740690 [debug] [ThreadPool]: On list_dbt_public: ROLLBACK
[0m23:48:06.741169 [debug] [ThreadPool]: On list_dbt_public: Close
[0m23:48:06.747136 [debug] [MainThread]: Using postgres connection "master"
[0m23:48:06.747478 [debug] [MainThread]: On master: BEGIN
[0m23:48:06.747736 [debug] [MainThread]: Opening a new connection, currently in state init
[0m23:48:06.750808 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m23:48:06.751122 [debug] [MainThread]: Using postgres connection "master"
[0m23:48:06.751534 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m23:48:06.761286 [debug] [MainThread]: SQL status: SELECT 2 in 0.0 seconds
[0m23:48:06.762891 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2567bc4a-b943-46fc-b071-86d48a4d88b5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f00afc1bf50>]}
[0m23:48:06.763287 [debug] [MainThread]: On master: ROLLBACK
[0m23:48:06.763772 [debug] [MainThread]: Using postgres connection "master"
[0m23:48:06.764047 [debug] [MainThread]: On master: BEGIN
[0m23:48:06.764695 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m23:48:06.764981 [debug] [MainThread]: On master: COMMIT
[0m23:48:06.765247 [debug] [MainThread]: Using postgres connection "master"
[0m23:48:06.765536 [debug] [MainThread]: On master: COMMIT
[0m23:48:06.765960 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m23:48:06.766248 [debug] [MainThread]: On master: Close
[0m23:48:06.766895 [info ] [MainThread]: Concurrency: 3 threads (target='local')
[0m23:48:06.767199 [info ] [MainThread]: 
[0m23:48:06.769977 [debug] [Thread-1 (]: Began running node test.customer360.macro_test1
[0m23:48:06.770394 [debug] [Thread-2 (]: Began running node test.customer360.macro_test2
[0m23:48:06.770766 [debug] [Thread-3 (]: Began running node test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311
[0m23:48:06.771111 [info ] [Thread-1 (]: 1 of 9 START test macro_test1 .................................................. [RUN]
[0m23:48:06.771739 [info ] [Thread-2 (]: 2 of 9 START test macro_test2 .................................................. [RUN]
[0m23:48:06.772151 [info ] [Thread-3 (]: 3 of 9 START test not_null_contacts_joined_with_transactions_id ................ [RUN]
[0m23:48:06.772887 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dbt_public, now test.customer360.macro_test1)
[0m23:48:06.773550 [debug] [Thread-2 (]: Acquiring new postgres connection 'test.customer360.macro_test2'
[0m23:48:06.774199 [debug] [Thread-3 (]: Acquiring new postgres connection 'test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311'
[0m23:48:06.774597 [debug] [Thread-1 (]: Began compiling node test.customer360.macro_test1
[0m23:48:06.774938 [debug] [Thread-2 (]: Began compiling node test.customer360.macro_test2
[0m23:48:06.775275 [debug] [Thread-3 (]: Began compiling node test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311
[0m23:48:06.783942 [debug] [Thread-2 (]: Writing injected SQL for node "test.customer360.macro_test2"
[0m23:48:06.794649 [debug] [Thread-3 (]: Writing injected SQL for node "test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311"
[0m23:48:06.795402 [debug] [Thread-1 (]: Timing info for test.customer360.macro_test1 (compile): 23:48:06.775552 => 23:48:06.795151
[0m23:48:06.795989 [debug] [Thread-2 (]: Timing info for test.customer360.macro_test2 (compile): 23:48:06.781947 => 23:48:06.795693
[0m23:48:06.796430 [debug] [Thread-3 (]: Timing info for test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311 (compile): 23:48:06.784213 => 23:48:06.796206
[0m23:48:06.797386 [debug] [Thread-2 (]: Began executing node test.customer360.macro_test2
[0m23:48:06.797937 [debug] [Thread-3 (]: Began executing node test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311
[0m23:48:06.813000 [debug] [Thread-3 (]: Writing runtime sql for node "test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311"
[0m23:48:06.814490 [debug] [Thread-2 (]: Writing runtime sql for node "test.customer360.macro_test2"
[0m23:48:06.815172 [debug] [Thread-3 (]: Using postgres connection "test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311"
[0m23:48:06.815610 [debug] [Thread-3 (]: On test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311: BEGIN
[0m23:48:06.816005 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m23:48:06.817057 [debug] [Thread-2 (]: Using postgres connection "test.customer360.macro_test2"
[0m23:48:06.817453 [debug] [Thread-2 (]: On test.customer360.macro_test2: BEGIN
[0m23:48:06.817858 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m23:48:06.821031 [debug] [Thread-1 (]: Compilation Error in test macro_test1 (tests/macro_test1.sql)
  'to_date' is undefined. This can happen when calling a macro that does not exist. Check for typos and/or install package dependencies with "dbt deps".
[0m23:48:06.821794 [error] [Thread-1 (]: 1 of 9 ERROR macro_test1 ....................................................... [[31mERROR[0m in 0.05s]
[0m23:48:06.823016 [debug] [Thread-1 (]: Finished running node test.customer360.macro_test1
[0m23:48:06.823501 [debug] [Thread-1 (]: Began running node test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247
[0m23:48:06.823863 [info ] [Thread-1 (]: 4 of 9 START test source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors  [RUN]
[0m23:48:06.822422 [debug] [Thread-3 (]: SQL status: BEGIN in 0.0 seconds
[0m23:48:06.825166 [debug] [Thread-3 (]: Using postgres connection "test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311"
[0m23:48:06.825545 [debug] [Thread-3 (]: On test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select id
from "dbt"."public"."contacts_joined_with_transactions"
where id is null



      
    ) dbt_internal_test
[0m23:48:06.824817 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.customer360.macro_test1, now test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247)
[0m23:48:06.825929 [debug] [Thread-1 (]: Began compiling node test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247
[0m23:48:06.838527 [debug] [Thread-1 (]: Writing injected SQL for node "test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247"
[0m23:48:06.839551 [debug] [Thread-2 (]: SQL status: BEGIN in 0.0 seconds
[0m23:48:06.840051 [debug] [Thread-3 (]: SQL status: SELECT 1 in 0.0 seconds
[0m23:48:06.840414 [debug] [Thread-2 (]: Using postgres connection "test.customer360.macro_test2"
[0m23:48:06.842347 [debug] [Thread-3 (]: Timing info for test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311 (execute): 23:48:06.808539 => 23:48:06.842105
[0m23:48:06.842771 [debug] [Thread-1 (]: Timing info for test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247 (compile): 23:48:06.826131 => 23:48:06.842550
[0m23:48:06.843153 [debug] [Thread-2 (]: On test.customer360.macro_test2: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.macro_test2"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      with marco_result as (
    select 
    to_timestamp(2023-02-27 21:00:00,'YYYY-MM-DD HH24:MI:SS.MS') :: timestamp at TIME zone 'UTC'
 as expect_result
),
select
    1
from marco_result
where pg_typeof(expect_result) not like '%timestamp%'
      
    ) dbt_internal_test
[0m23:48:06.843587 [debug] [Thread-3 (]: On test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311: ROLLBACK
[0m23:48:06.843976 [debug] [Thread-1 (]: Began executing node test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247
[0m23:48:06.846583 [debug] [Thread-1 (]: Writing runtime sql for node "test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247"
[0m23:48:06.846990 [debug] [Thread-3 (]: On test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311: Close
[0m23:48:06.848363 [info ] [Thread-3 (]: 3 of 9 PASS not_null_contacts_joined_with_transactions_id ...................... [[32mPASS[0m in 0.07s]
[0m23:48:06.849036 [debug] [Thread-3 (]: Finished running node test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311
[0m23:48:06.849572 [debug] [Thread-3 (]: Began running node test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d
[0m23:48:06.849962 [info ] [Thread-3 (]: 5 of 9 START test source_not_null_salesforce_contacts_id ....................... [RUN]
[0m23:48:06.850541 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311, now test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d)
[0m23:48:06.851457 [debug] [Thread-3 (]: Began compiling node test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d
[0m23:48:06.850999 [debug] [Thread-1 (]: Using postgres connection "test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247"
[0m23:48:06.855404 [debug] [Thread-3 (]: Writing injected SQL for node "test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d"
[0m23:48:06.847365 [debug] [Thread-2 (]: Postgres adapter: Postgres error: syntax error at or near "21"
LINE 9:     to_timestamp(2023-02-27 21:00:00,'YYYY-MM-DD HH24:MI:SS....
                                    ^

[0m23:48:06.856245 [debug] [Thread-2 (]: On test.customer360.macro_test2: ROLLBACK
[0m23:48:06.855793 [debug] [Thread-1 (]: On test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247: BEGIN
[0m23:48:06.856881 [debug] [Thread-3 (]: Timing info for test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d (compile): 23:48:06.851704 => 23:48:06.856556
[0m23:48:06.857403 [debug] [Thread-2 (]: Timing info for test.customer360.macro_test2 (execute): 23:48:06.798189 => 23:48:06.857177
[0m23:48:06.857759 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:48:06.858138 [debug] [Thread-3 (]: Began executing node test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d
[0m23:48:06.861410 [debug] [Thread-3 (]: Writing runtime sql for node "test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d"
[0m23:48:06.858531 [debug] [Thread-2 (]: On test.customer360.macro_test2: Close
[0m23:48:06.862070 [debug] [Thread-3 (]: Using postgres connection "test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d"
[0m23:48:06.864073 [debug] [Thread-3 (]: On test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d: BEGIN
[0m23:48:06.864775 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m23:48:06.865433 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m23:48:06.867280 [debug] [Thread-2 (]: Database Error in test macro_test2 (tests/macro_test2.sql)
  syntax error at or near "21"
  LINE 9:     to_timestamp(2023-02-27 21:00:00,'YYYY-MM-DD HH24:MI:SS....
                                      ^
  compiled Code at target/run/customer360/tests/macro_test2.sql
[0m23:48:06.868234 [error] [Thread-2 (]: 2 of 9 ERROR macro_test2 ....................................................... [[31mERROR[0m in 0.09s]
[0m23:48:06.868985 [debug] [Thread-2 (]: Finished running node test.customer360.macro_test2
[0m23:48:06.869756 [debug] [Thread-2 (]: Began running node test.customer360.source_not_null_web_transactions_id.88a47bf7e5
[0m23:48:06.867654 [debug] [Thread-1 (]: Using postgres connection "test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247"
[0m23:48:06.870449 [info ] [Thread-2 (]: 6 of 9 START test source_not_null_web_transactions_id .......................... [RUN]
[0m23:48:06.871059 [debug] [Thread-1 (]: On test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

with all_values as (

    select
        category as value_field,
        count(*) as n_records

    from "dbt"."public"."transactions"
    group by category

)

select *
from all_values
where value_field not in (
    'Apps & Games','Beauty','Books','Clothing, Shoes & Accessories','Movies & TV','Sports, Fitness & Outdoors'
)



      
    ) dbt_internal_test
[0m23:48:06.871665 [debug] [Thread-3 (]: SQL status: BEGIN in 0.0 seconds
[0m23:48:06.872342 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.customer360.macro_test2, now test.customer360.source_not_null_web_transactions_id.88a47bf7e5)
[0m23:48:06.872791 [debug] [Thread-3 (]: Using postgres connection "test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d"
[0m23:48:06.873734 [debug] [Thread-3 (]: On test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select id
from "dbt"."public"."contacts"
where id is null



      
    ) dbt_internal_test
[0m23:48:06.873199 [debug] [Thread-2 (]: Began compiling node test.customer360.source_not_null_web_transactions_id.88a47bf7e5
[0m23:48:06.878607 [debug] [Thread-2 (]: Writing injected SQL for node "test.customer360.source_not_null_web_transactions_id.88a47bf7e5"
[0m23:48:06.879039 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.0 seconds
[0m23:48:06.879546 [debug] [Thread-3 (]: SQL status: SELECT 1 in 0.0 seconds
[0m23:48:06.881001 [debug] [Thread-1 (]: Timing info for test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247 (execute): 23:48:06.844348 => 23:48:06.880775
[0m23:48:06.882366 [debug] [Thread-3 (]: Timing info for test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d (execute): 23:48:06.858883 => 23:48:06.882130
[0m23:48:06.882766 [debug] [Thread-2 (]: Timing info for test.customer360.source_not_null_web_transactions_id.88a47bf7e5 (compile): 23:48:06.874117 => 23:48:06.882573
[0m23:48:06.883149 [debug] [Thread-1 (]: On test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247: ROLLBACK
[0m23:48:06.883565 [debug] [Thread-3 (]: On test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d: ROLLBACK
[0m23:48:06.883934 [debug] [Thread-2 (]: Began executing node test.customer360.source_not_null_web_transactions_id.88a47bf7e5
[0m23:48:06.886187 [debug] [Thread-2 (]: Writing runtime sql for node "test.customer360.source_not_null_web_transactions_id.88a47bf7e5"
[0m23:48:06.886651 [debug] [Thread-1 (]: On test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247: Close
[0m23:48:06.888012 [debug] [Thread-2 (]: Using postgres connection "test.customer360.source_not_null_web_transactions_id.88a47bf7e5"
[0m23:48:06.888539 [debug] [Thread-2 (]: On test.customer360.source_not_null_web_transactions_id.88a47bf7e5: BEGIN
[0m23:48:06.888952 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m23:48:06.889920 [debug] [Thread-3 (]: On test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d: Close
[0m23:48:06.887592 [info ] [Thread-1 (]: 4 of 9 PASS source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors  [[32mPASS[0m in 0.06s]
[0m23:48:06.891456 [debug] [Thread-1 (]: Finished running node test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247
[0m23:48:06.891878 [debug] [Thread-1 (]: Began running node test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344
[0m23:48:06.892444 [info ] [Thread-1 (]: 7 of 9 START test source_relationships_web_transactions_contact_id__id__ref_contacts_  [RUN]
[0m23:48:06.893276 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247, now test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344)
[0m23:48:06.893811 [debug] [Thread-1 (]: Began compiling node test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344
[0m23:48:06.890651 [info ] [Thread-3 (]: 5 of 9 PASS source_not_null_salesforce_contacts_id ............................. [[32mPASS[0m in 0.04s]
[0m23:48:06.902394 [debug] [Thread-1 (]: Writing injected SQL for node "test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344"
[0m23:48:06.902960 [debug] [Thread-3 (]: Finished running node test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d
[0m23:48:06.903598 [debug] [Thread-3 (]: Began running node test.customer360.source_unique_salesforce_contacts_id.01cadaaf43
[0m23:48:06.904002 [info ] [Thread-3 (]: 8 of 9 START test source_unique_salesforce_contacts_id ......................... [RUN]
[0m23:48:06.904698 [debug] [Thread-1 (]: Timing info for test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344 (compile): 23:48:06.894067 => 23:48:06.904420
[0m23:48:06.905721 [debug] [Thread-1 (]: Began executing node test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344
[0m23:48:06.907913 [debug] [Thread-1 (]: Writing runtime sql for node "test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344"
[0m23:48:06.908436 [debug] [Thread-1 (]: Using postgres connection "test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344"
[0m23:48:06.908764 [debug] [Thread-1 (]: On test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344: BEGIN
[0m23:48:06.909091 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:48:06.905262 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d, now test.customer360.source_unique_salesforce_contacts_id.01cadaaf43)
[0m23:48:06.910205 [debug] [Thread-3 (]: Began compiling node test.customer360.source_unique_salesforce_contacts_id.01cadaaf43
[0m23:48:06.909609 [debug] [Thread-2 (]: SQL status: BEGIN in 0.0 seconds
[0m23:48:06.917315 [debug] [Thread-2 (]: Using postgres connection "test.customer360.source_not_null_web_transactions_id.88a47bf7e5"
[0m23:48:06.917759 [debug] [Thread-2 (]: On test.customer360.source_not_null_web_transactions_id.88a47bf7e5: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.source_not_null_web_transactions_id.88a47bf7e5"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select id
from "dbt"."public"."transactions"
where id is null



      
    ) dbt_internal_test
[0m23:48:06.916642 [debug] [Thread-3 (]: Writing injected SQL for node "test.customer360.source_unique_salesforce_contacts_id.01cadaaf43"
[0m23:48:06.918884 [debug] [Thread-3 (]: Timing info for test.customer360.source_unique_salesforce_contacts_id.01cadaaf43 (compile): 23:48:06.910486 => 23:48:06.918587
[0m23:48:06.919394 [debug] [Thread-3 (]: Began executing node test.customer360.source_unique_salesforce_contacts_id.01cadaaf43
[0m23:48:06.918158 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m23:48:06.919811 [debug] [Thread-2 (]: SQL status: SELECT 1 in 0.0 seconds
[0m23:48:06.921963 [debug] [Thread-3 (]: Writing runtime sql for node "test.customer360.source_unique_salesforce_contacts_id.01cadaaf43"
[0m23:48:06.922376 [debug] [Thread-1 (]: Using postgres connection "test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344"
[0m23:48:06.924255 [debug] [Thread-1 (]: On test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

with child as (
    select contact_id as from_field
    from "dbt"."public"."transactions"
    where contact_id is not null
),

parent as (
    select id as to_field
    from "dbt"."public"."contacts"
)

select
    from_field

from child
left join parent
    on child.from_field = parent.to_field

where parent.to_field is null



      
    ) dbt_internal_test
[0m23:48:06.923766 [debug] [Thread-2 (]: Timing info for test.customer360.source_not_null_web_transactions_id.88a47bf7e5 (execute): 23:48:06.884242 => 23:48:06.923559
[0m23:48:06.925371 [debug] [Thread-2 (]: On test.customer360.source_not_null_web_transactions_id.88a47bf7e5: ROLLBACK
[0m23:48:06.924808 [debug] [Thread-3 (]: Using postgres connection "test.customer360.source_unique_salesforce_contacts_id.01cadaaf43"
[0m23:48:06.925890 [debug] [Thread-3 (]: On test.customer360.source_unique_salesforce_contacts_id.01cadaaf43: BEGIN
[0m23:48:06.926404 [debug] [Thread-2 (]: On test.customer360.source_not_null_web_transactions_id.88a47bf7e5: Close
[0m23:48:06.926778 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.0 seconds
[0m23:48:06.927085 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m23:48:06.928004 [info ] [Thread-2 (]: 6 of 9 PASS source_not_null_web_transactions_id ................................ [[32mPASS[0m in 0.06s]
[0m23:48:06.930402 [debug] [Thread-2 (]: Finished running node test.customer360.source_not_null_web_transactions_id.88a47bf7e5
[0m23:48:06.930941 [debug] [Thread-2 (]: Began running node test.customer360.source_unique_web_transactions_id.ba28079761
[0m23:48:06.931364 [info ] [Thread-2 (]: 9 of 9 START test source_unique_web_transactions_id ............................ [RUN]
[0m23:48:06.932172 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.customer360.source_not_null_web_transactions_id.88a47bf7e5, now test.customer360.source_unique_web_transactions_id.ba28079761)
[0m23:48:06.932839 [debug] [Thread-2 (]: Began compiling node test.customer360.source_unique_web_transactions_id.ba28079761
[0m23:48:06.929623 [debug] [Thread-1 (]: Timing info for test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344 (execute): 23:48:06.905949 => 23:48:06.929412
[0m23:48:06.937483 [debug] [Thread-1 (]: On test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344: ROLLBACK
[0m23:48:06.936942 [debug] [Thread-2 (]: Writing injected SQL for node "test.customer360.source_unique_web_transactions_id.ba28079761"
[0m23:48:06.938670 [debug] [Thread-2 (]: Timing info for test.customer360.source_unique_web_transactions_id.ba28079761 (compile): 23:48:06.933147 => 23:48:06.938425
[0m23:48:06.939035 [debug] [Thread-2 (]: Began executing node test.customer360.source_unique_web_transactions_id.ba28079761
[0m23:48:06.937925 [debug] [Thread-3 (]: SQL status: BEGIN in 0.0 seconds
[0m23:48:06.939416 [debug] [Thread-1 (]: On test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344: Close
[0m23:48:06.941572 [debug] [Thread-2 (]: Writing runtime sql for node "test.customer360.source_unique_web_transactions_id.ba28079761"
[0m23:48:06.942616 [debug] [Thread-2 (]: Using postgres connection "test.customer360.source_unique_web_transactions_id.ba28079761"
[0m23:48:06.943062 [debug] [Thread-2 (]: On test.customer360.source_unique_web_transactions_id.ba28079761: BEGIN
[0m23:48:06.943489 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m23:48:06.944913 [info ] [Thread-1 (]: 7 of 9 PASS source_relationships_web_transactions_contact_id__id__ref_contacts_  [[32mPASS[0m in 0.05s]
[0m23:48:06.945513 [debug] [Thread-1 (]: Finished running node test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344
[0m23:48:06.941957 [debug] [Thread-3 (]: Using postgres connection "test.customer360.source_unique_salesforce_contacts_id.01cadaaf43"
[0m23:48:06.946171 [debug] [Thread-3 (]: On test.customer360.source_unique_salesforce_contacts_id.01cadaaf43: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.source_unique_salesforce_contacts_id.01cadaaf43"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

select
    id as unique_field,
    count(*) as n_records

from "dbt"."public"."contacts"
where id is not null
group by id
having count(*) > 1



      
    ) dbt_internal_test
[0m23:48:06.948012 [debug] [Thread-3 (]: SQL status: SELECT 1 in 0.0 seconds
[0m23:48:06.949807 [debug] [Thread-3 (]: Timing info for test.customer360.source_unique_salesforce_contacts_id.01cadaaf43 (execute): 23:48:06.919999 => 23:48:06.949580
[0m23:48:06.950133 [debug] [Thread-3 (]: On test.customer360.source_unique_salesforce_contacts_id.01cadaaf43: ROLLBACK
[0m23:48:06.950719 [debug] [Thread-3 (]: On test.customer360.source_unique_salesforce_contacts_id.01cadaaf43: Close
[0m23:48:06.951602 [info ] [Thread-3 (]: 8 of 9 PASS source_unique_salesforce_contacts_id ............................... [[32mPASS[0m in 0.05s]
[0m23:48:06.952311 [debug] [Thread-3 (]: Finished running node test.customer360.source_unique_salesforce_contacts_id.01cadaaf43
[0m23:48:06.953121 [debug] [Thread-2 (]: SQL status: BEGIN in 0.0 seconds
[0m23:48:06.953471 [debug] [Thread-2 (]: Using postgres connection "test.customer360.source_unique_web_transactions_id.ba28079761"
[0m23:48:06.953811 [debug] [Thread-2 (]: On test.customer360.source_unique_web_transactions_id.ba28079761: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.source_unique_web_transactions_id.ba28079761"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

select
    id as unique_field,
    count(*) as n_records

from "dbt"."public"."transactions"
where id is not null
group by id
having count(*) > 1



      
    ) dbt_internal_test
[0m23:48:06.955239 [debug] [Thread-2 (]: SQL status: SELECT 1 in 0.0 seconds
[0m23:48:06.956499 [debug] [Thread-2 (]: Timing info for test.customer360.source_unique_web_transactions_id.ba28079761 (execute): 23:48:06.939694 => 23:48:06.956273
[0m23:48:06.956834 [debug] [Thread-2 (]: On test.customer360.source_unique_web_transactions_id.ba28079761: ROLLBACK
[0m23:48:06.957332 [debug] [Thread-2 (]: On test.customer360.source_unique_web_transactions_id.ba28079761: Close
[0m23:48:06.958046 [info ] [Thread-2 (]: 9 of 9 PASS source_unique_web_transactions_id .................................. [[32mPASS[0m in 0.03s]
[0m23:48:06.958561 [debug] [Thread-2 (]: Finished running node test.customer360.source_unique_web_transactions_id.ba28079761
[0m23:48:06.960207 [debug] [MainThread]: Using postgres connection "master"
[0m23:48:06.960587 [debug] [MainThread]: On master: BEGIN
[0m23:48:06.960994 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m23:48:06.964406 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m23:48:06.964706 [debug] [MainThread]: On master: COMMIT
[0m23:48:06.964983 [debug] [MainThread]: Using postgres connection "master"
[0m23:48:06.965241 [debug] [MainThread]: On master: COMMIT
[0m23:48:06.965690 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m23:48:06.965977 [debug] [MainThread]: On master: Close
[0m23:48:06.966583 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:48:06.966844 [debug] [MainThread]: Connection 'test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344' was properly closed.
[0m23:48:06.967109 [debug] [MainThread]: Connection 'test.customer360.source_unique_web_transactions_id.ba28079761' was properly closed.
[0m23:48:06.967372 [debug] [MainThread]: Connection 'test.customer360.source_unique_salesforce_contacts_id.01cadaaf43' was properly closed.
[0m23:48:06.967677 [info ] [MainThread]: 
[0m23:48:06.967982 [info ] [MainThread]: Finished running 9 tests in 0 hours 0 minutes and 0.25 seconds (0.25s).
[0m23:48:06.969600 [debug] [MainThread]: Command end result
[0m23:48:06.978322 [info ] [MainThread]: 
[0m23:48:06.978729 [info ] [MainThread]: [31mCompleted with 2 errors and 0 warnings:[0m
[0m23:48:06.979011 [info ] [MainThread]: 
[0m23:48:06.979354 [error] [MainThread]:   Compilation Error in test macro_test1 (tests/macro_test1.sql)
  'to_date' is undefined. This can happen when calling a macro that does not exist. Check for typos and/or install package dependencies with "dbt deps".
[0m23:48:06.979779 [info ] [MainThread]: 
[0m23:48:06.980051 [error] [MainThread]:   Database Error in test macro_test2 (tests/macro_test2.sql)
  syntax error at or near "21"
  LINE 9:     to_timestamp(2023-02-27 21:00:00,'YYYY-MM-DD HH24:MI:SS....
                                      ^
  compiled Code at target/run/customer360/tests/macro_test2.sql
[0m23:48:06.980399 [info ] [MainThread]: 
[0m23:48:06.980695 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=2 SKIP=0 TOTAL=9
[0m23:48:06.981392 [debug] [MainThread]: Resource report: {"command_name": "test", "command_wall_clock_time": 0.71076405, "process_user_time": 2.22818, "process_kernel_time": 0.112958, "process_mem_max_rss": "112292", "process_in_blocks": "216", "process_out_blocks": "2720", "command_success": false}
[0m23:48:06.981849 [debug] [MainThread]: Command `dbt test` failed at 23:48:06.981739 after 0.71 seconds
[0m23:48:06.982183 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f00b1928fd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f00b160d210>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f00b1bab610>]}
[0m23:48:06.982564 [debug] [MainThread]: Flushing usage events
[0m23:48:54.203593 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffaf14df010>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffaf3eac050>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffaf14ceb10>]}


============================== 23:48:54.206043 | d917d498-4996-4ff7-a896-455b0e73d705 ==============================
[0m23:48:54.206043 [info ] [MainThread]: Running with dbt=1.7.8
[0m23:48:54.206543 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/root/option1-customer360/integration_tests', 'debug': 'False', 'warn_error': 'None', 'log_path': '/root/option1-customer360/integration_tests/logs', 'version_check': 'True', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'invocation_command': 'dbt deps', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m23:48:54.278553 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd917d498-4996-4ff7-a896-455b0e73d705', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffaf1bc3310>]}
[0m23:48:54.280613 [debug] [MainThread]: Set downloads directory='/tmp/dbt-downloads-040vh0zi'
[0m23:48:54.280995 [info ] [MainThread]: Installing ../
[0m23:48:54.281693 [debug] [MainThread]: Creating symlink to local dependency.
[0m23:48:54.281997 [info ] [MainThread]: Installed from <local @ ../>
[0m23:48:54.282370 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'package', 'label': 'd917d498-4996-4ff7-a896-455b0e73d705', 'property_': 'install', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffaf195fc50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffaf13bfd90>]}
[0m23:48:54.283122 [debug] [MainThread]: Resource report: {"command_name": "deps", "command_success": true, "command_wall_clock_time": 0.11501454, "process_user_time": 1.676154, "process_kernel_time": 0.079007, "process_mem_max_rss": "98116", "process_out_blocks": "24", "process_in_blocks": "0"}
[0m23:48:54.283599 [debug] [MainThread]: Command `dbt deps` succeeded at 23:48:54.283480 after 0.12 seconds
[0m23:48:54.283902 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffaf14df010>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffaf14a9fd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffaf1a97190>]}
[0m23:48:54.284246 [debug] [MainThread]: Flushing usage events
[0m23:50:09.545744 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3f9980d410>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3f997ecf90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3f999e1810>]}


============================== 23:50:09.548170 | a8147872-3196-49b7-8a9f-ae01b0d8b6c2 ==============================
[0m23:50:09.548170 [info ] [MainThread]: Running with dbt=1.7.8
[0m23:50:09.548805 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/root/option1-customer360/integration_tests', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/root/option1-customer360/integration_tests/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt test', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m23:50:09.690136 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a8147872-3196-49b7-8a9f-ae01b0d8b6c2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3f999e3950>]}
[0m23:50:09.764550 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'a8147872-3196-49b7-8a9f-ae01b0d8b6c2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3f996ebd50>]}
[0m23:50:09.765244 [info ] [MainThread]: Registered adapter: postgres=1.7.8
[0m23:50:09.776191 [debug] [MainThread]: checksum: 67f0013ca5f0bd43af9a0873dd50792fde83ef69de63b71cacd0b4ac656c52e5, vars: {}, profile: , target: , version: 1.7.8
[0m23:50:09.796907 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m23:50:09.797475 [debug] [MainThread]: Partial parsing: updated file: customer360://tests/macro_test2.sql
[0m23:50:09.888174 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'a8147872-3196-49b7-8a9f-ae01b0d8b6c2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3f979e0750>]}
[0m23:50:09.896634 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'a8147872-3196-49b7-8a9f-ae01b0d8b6c2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3f978e8a90>]}
[0m23:50:09.897089 [info ] [MainThread]: Found 2 seeds, 4 models, 9 tests, 2 sources, 0 exposures, 0 metrics, 403 macros, 0 groups, 0 semantic models
[0m23:50:09.897495 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a8147872-3196-49b7-8a9f-ae01b0d8b6c2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3f99407910>]}
[0m23:50:09.899460 [info ] [MainThread]: 
[0m23:50:09.900095 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m23:50:09.901282 [debug] [ThreadPool]: Acquiring new postgres connection 'list_dbt_public'
[0m23:50:09.967236 [debug] [ThreadPool]: Using postgres connection "list_dbt_public"
[0m23:50:09.967706 [debug] [ThreadPool]: On list_dbt_public: BEGIN
[0m23:50:09.967995 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:50:09.971988 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m23:50:09.972334 [debug] [ThreadPool]: Using postgres connection "list_dbt_public"
[0m23:50:09.972646 [debug] [ThreadPool]: On list_dbt_public: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "connection_name": "list_dbt_public"} */
select
      'dbt' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'dbt' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'dbt' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m23:50:09.975430 [debug] [ThreadPool]: SQL status: SELECT 6 in 0.0 seconds
[0m23:50:09.976783 [debug] [ThreadPool]: On list_dbt_public: ROLLBACK
[0m23:50:09.977258 [debug] [ThreadPool]: On list_dbt_public: Close
[0m23:50:09.983066 [debug] [MainThread]: Using postgres connection "master"
[0m23:50:09.983406 [debug] [MainThread]: On master: BEGIN
[0m23:50:09.983667 [debug] [MainThread]: Opening a new connection, currently in state init
[0m23:50:09.986645 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m23:50:09.986956 [debug] [MainThread]: Using postgres connection "master"
[0m23:50:09.987328 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m23:50:09.997018 [debug] [MainThread]: SQL status: SELECT 2 in 0.0 seconds
[0m23:50:09.998626 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a8147872-3196-49b7-8a9f-ae01b0d8b6c2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3f97aa57d0>]}
[0m23:50:09.999038 [debug] [MainThread]: On master: ROLLBACK
[0m23:50:09.999530 [debug] [MainThread]: Using postgres connection "master"
[0m23:50:09.999844 [debug] [MainThread]: On master: BEGIN
[0m23:50:10.000492 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m23:50:10.000784 [debug] [MainThread]: On master: COMMIT
[0m23:50:10.001039 [debug] [MainThread]: Using postgres connection "master"
[0m23:50:10.001335 [debug] [MainThread]: On master: COMMIT
[0m23:50:10.001773 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m23:50:10.002053 [debug] [MainThread]: On master: Close
[0m23:50:10.002704 [info ] [MainThread]: Concurrency: 3 threads (target='local')
[0m23:50:10.003004 [info ] [MainThread]: 
[0m23:50:10.005540 [debug] [Thread-1 (]: Began running node test.customer360.macro_test1
[0m23:50:10.005944 [debug] [Thread-2 (]: Began running node test.customer360.macro_test2
[0m23:50:10.006335 [debug] [Thread-3 (]: Began running node test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311
[0m23:50:10.006697 [info ] [Thread-1 (]: 1 of 9 START test macro_test1 .................................................. [RUN]
[0m23:50:10.008320 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dbt_public, now test.customer360.macro_test1)
[0m23:50:10.007131 [info ] [Thread-2 (]: 2 of 9 START test macro_test2 .................................................. [RUN]
[0m23:50:10.007639 [info ] [Thread-3 (]: 3 of 9 START test not_null_contacts_joined_with_transactions_id ................ [RUN]
[0m23:50:10.008787 [debug] [Thread-1 (]: Began compiling node test.customer360.macro_test1
[0m23:50:10.009447 [debug] [Thread-2 (]: Acquiring new postgres connection 'test.customer360.macro_test2'
[0m23:50:10.010088 [debug] [Thread-3 (]: Acquiring new postgres connection 'test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311'
[0m23:50:10.016666 [debug] [Thread-2 (]: Began compiling node test.customer360.macro_test2
[0m23:50:10.017377 [debug] [Thread-1 (]: Timing info for test.customer360.macro_test1 (compile): 23:50:10.010345 => 23:50:10.017135
[0m23:50:10.017747 [debug] [Thread-3 (]: Began compiling node test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311
[0m23:50:10.020038 [debug] [Thread-2 (]: Writing injected SQL for node "test.customer360.macro_test2"
[0m23:50:10.031425 [debug] [Thread-3 (]: Writing injected SQL for node "test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311"
[0m23:50:10.032574 [debug] [Thread-2 (]: Timing info for test.customer360.macro_test2 (compile): 23:50:10.017980 => 23:50:10.032308
[0m23:50:10.033479 [debug] [Thread-2 (]: Began executing node test.customer360.macro_test2
[0m23:50:10.046842 [debug] [Thread-2 (]: Writing runtime sql for node "test.customer360.macro_test2"
[0m23:50:10.047447 [debug] [Thread-2 (]: Using postgres connection "test.customer360.macro_test2"
[0m23:50:10.047783 [debug] [Thread-2 (]: On test.customer360.macro_test2: BEGIN
[0m23:50:10.048127 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m23:50:10.048538 [debug] [Thread-3 (]: Timing info for test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311 (compile): 23:50:10.020995 => 23:50:10.048323
[0m23:50:10.050201 [debug] [Thread-3 (]: Began executing node test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311
[0m23:50:10.052607 [debug] [Thread-3 (]: Writing runtime sql for node "test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311"
[0m23:50:10.049644 [debug] [Thread-1 (]: Compilation Error in test macro_test1 (tests/macro_test1.sql)
  'to_date' is undefined. This can happen when calling a macro that does not exist. Check for typos and/or install package dependencies with "dbt deps".
[0m23:50:10.053661 [error] [Thread-1 (]: 1 of 9 ERROR macro_test1 ....................................................... [[31mERROR[0m in 0.05s]
[0m23:50:10.054805 [debug] [Thread-1 (]: Finished running node test.customer360.macro_test1
[0m23:50:10.055404 [debug] [Thread-1 (]: Began running node test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247
[0m23:50:10.055932 [info ] [Thread-1 (]: 4 of 9 START test source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors  [RUN]
[0m23:50:10.053116 [debug] [Thread-3 (]: Using postgres connection "test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311"
[0m23:50:10.056747 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.customer360.macro_test1, now test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247)
[0m23:50:10.057762 [debug] [Thread-1 (]: Began compiling node test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247
[0m23:50:10.057283 [debug] [Thread-3 (]: On test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311: BEGIN
[0m23:50:10.067576 [debug] [Thread-1 (]: Writing injected SQL for node "test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247"
[0m23:50:10.068023 [debug] [Thread-2 (]: SQL status: BEGIN in 0.0 seconds
[0m23:50:10.068857 [debug] [Thread-2 (]: Using postgres connection "test.customer360.macro_test2"
[0m23:50:10.068384 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m23:50:10.069219 [debug] [Thread-2 (]: On test.customer360.macro_test2: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.macro_test2"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      with marco_result as (
    select 
    to_timestamp('2023-02-27 21:00:00','YYYY-MM-DD HH24:MI:SS.MS') :: timestamp at TIME zone 'UTC'
 as expect_result
),
select
    1
from marco_result
where pg_typeof(expect_result) not like '%timestamp%'
      
    ) dbt_internal_test
[0m23:50:10.070141 [debug] [Thread-1 (]: Timing info for test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247 (compile): 23:50:10.057977 => 23:50:10.069830
[0m23:50:10.070733 [debug] [Thread-1 (]: Began executing node test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247
[0m23:50:10.073076 [debug] [Thread-1 (]: Writing runtime sql for node "test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247"
[0m23:50:10.073664 [debug] [Thread-1 (]: Using postgres connection "test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247"
[0m23:50:10.074580 [debug] [Thread-1 (]: On test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247: BEGIN
[0m23:50:10.075053 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:50:10.074130 [debug] [Thread-2 (]: Postgres adapter: Postgres error: syntax error at or near "select"
LINE 12: select
         ^

[0m23:50:10.075870 [debug] [Thread-2 (]: On test.customer360.macro_test2: ROLLBACK
[0m23:50:10.076669 [debug] [Thread-2 (]: Timing info for test.customer360.macro_test2 (execute): 23:50:10.033721 => 23:50:10.076386
[0m23:50:10.077155 [debug] [Thread-2 (]: On test.customer360.macro_test2: Close
[0m23:50:10.080966 [debug] [Thread-2 (]: Database Error in test macro_test2 (tests/macro_test2.sql)
  syntax error at or near "select"
  LINE 12: select
           ^
  compiled Code at target/run/customer360/tests/macro_test2.sql
[0m23:50:10.081770 [error] [Thread-2 (]: 2 of 9 ERROR macro_test2 ....................................................... [[31mERROR[0m in 0.07s]
[0m23:50:10.082322 [debug] [Thread-3 (]: SQL status: BEGIN in 0.0 seconds
[0m23:50:10.083220 [debug] [Thread-3 (]: Using postgres connection "test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311"
[0m23:50:10.083617 [debug] [Thread-3 (]: On test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select id
from "dbt"."public"."contacts_joined_with_transactions"
where id is null



      
    ) dbt_internal_test
[0m23:50:10.084070 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m23:50:10.084566 [debug] [Thread-1 (]: Using postgres connection "test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247"
[0m23:50:10.085172 [debug] [Thread-1 (]: On test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

with all_values as (

    select
        category as value_field,
        count(*) as n_records

    from "dbt"."public"."transactions"
    group by category

)

select *
from all_values
where value_field not in (
    'Apps & Games','Beauty','Books','Clothing, Shoes & Accessories','Movies & TV','Sports, Fitness & Outdoors'
)



      
    ) dbt_internal_test
[0m23:50:10.082787 [debug] [Thread-2 (]: Finished running node test.customer360.macro_test2
[0m23:50:10.085878 [debug] [Thread-2 (]: Began running node test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d
[0m23:50:10.086406 [info ] [Thread-2 (]: 5 of 9 START test source_not_null_salesforce_contacts_id ....................... [RUN]
[0m23:50:10.087141 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.customer360.macro_test2, now test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d)
[0m23:50:10.087541 [debug] [Thread-2 (]: Began compiling node test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d
[0m23:50:10.088028 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.0 seconds
[0m23:50:10.088412 [debug] [Thread-3 (]: SQL status: SELECT 1 in 0.0 seconds
[0m23:50:10.092327 [debug] [Thread-2 (]: Writing injected SQL for node "test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d"
[0m23:50:10.094159 [debug] [Thread-1 (]: Timing info for test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247 (execute): 23:50:10.071044 => 23:50:10.093933
[0m23:50:10.095930 [debug] [Thread-1 (]: On test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247: ROLLBACK
[0m23:50:10.095451 [debug] [Thread-3 (]: Timing info for test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311 (execute): 23:50:10.050525 => 23:50:10.095200
[0m23:50:10.096572 [debug] [Thread-2 (]: Timing info for test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d (compile): 23:50:10.088620 => 23:50:10.096250
[0m23:50:10.097389 [debug] [Thread-2 (]: Began executing node test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d
[0m23:50:10.096938 [debug] [Thread-3 (]: On test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311: ROLLBACK
[0m23:50:10.101080 [debug] [Thread-2 (]: Writing runtime sql for node "test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d"
[0m23:50:10.101476 [debug] [Thread-1 (]: On test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247: Close
[0m23:50:10.102595 [info ] [Thread-1 (]: 4 of 9 PASS source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors  [[32mPASS[0m in 0.05s]
[0m23:50:10.103281 [debug] [Thread-1 (]: Finished running node test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247
[0m23:50:10.103876 [debug] [Thread-1 (]: Began running node test.customer360.source_not_null_web_transactions_id.88a47bf7e5
[0m23:50:10.104334 [info ] [Thread-1 (]: 6 of 9 START test source_not_null_web_transactions_id .......................... [RUN]
[0m23:50:10.104748 [debug] [Thread-3 (]: On test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311: Close
[0m23:50:10.106660 [info ] [Thread-3 (]: 3 of 9 PASS not_null_contacts_joined_with_transactions_id ...................... [[32mPASS[0m in 0.10s]
[0m23:50:10.107328 [debug] [Thread-3 (]: Finished running node test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311
[0m23:50:10.107842 [debug] [Thread-3 (]: Began running node test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344
[0m23:50:10.105169 [debug] [Thread-2 (]: Using postgres connection "test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d"
[0m23:50:10.105744 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247, now test.customer360.source_not_null_web_transactions_id.88a47bf7e5)
[0m23:50:10.108250 [info ] [Thread-3 (]: 7 of 9 START test source_relationships_web_transactions_contact_id__id__ref_contacts_  [RUN]
[0m23:50:10.108713 [debug] [Thread-2 (]: On test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d: BEGIN
[0m23:50:10.109076 [debug] [Thread-1 (]: Began compiling node test.customer360.source_not_null_web_transactions_id.88a47bf7e5
[0m23:50:10.109676 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311, now test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344)
[0m23:50:10.110041 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m23:50:10.113915 [debug] [Thread-1 (]: Writing injected SQL for node "test.customer360.source_not_null_web_transactions_id.88a47bf7e5"
[0m23:50:10.115149 [debug] [Thread-1 (]: Timing info for test.customer360.source_not_null_web_transactions_id.88a47bf7e5 (compile): 23:50:10.110306 => 23:50:10.114849
[0m23:50:10.115551 [debug] [Thread-1 (]: Began executing node test.customer360.source_not_null_web_transactions_id.88a47bf7e5
[0m23:50:10.114317 [debug] [Thread-3 (]: Began compiling node test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344
[0m23:50:10.118219 [debug] [Thread-1 (]: Writing runtime sql for node "test.customer360.source_not_null_web_transactions_id.88a47bf7e5"
[0m23:50:10.126953 [debug] [Thread-1 (]: Using postgres connection "test.customer360.source_not_null_web_transactions_id.88a47bf7e5"
[0m23:50:10.126251 [debug] [Thread-3 (]: Writing injected SQL for node "test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344"
[0m23:50:10.127288 [debug] [Thread-1 (]: On test.customer360.source_not_null_web_transactions_id.88a47bf7e5: BEGIN
[0m23:50:10.127815 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:50:10.128957 [debug] [Thread-3 (]: Timing info for test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344 (compile): 23:50:10.118818 => 23:50:10.128681
[0m23:50:10.129382 [debug] [Thread-3 (]: Began executing node test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344
[0m23:50:10.132113 [debug] [Thread-3 (]: Writing runtime sql for node "test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344"
[0m23:50:10.132810 [debug] [Thread-3 (]: Using postgres connection "test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344"
[0m23:50:10.133282 [debug] [Thread-3 (]: On test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344: BEGIN
[0m23:50:10.134246 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m23:50:10.133768 [debug] [Thread-2 (]: SQL status: BEGIN in 0.0 seconds
[0m23:50:10.135138 [debug] [Thread-2 (]: Using postgres connection "test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d"
[0m23:50:10.135674 [debug] [Thread-2 (]: On test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select id
from "dbt"."public"."contacts"
where id is null



      
    ) dbt_internal_test
[0m23:50:10.134635 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m23:50:10.136215 [debug] [Thread-1 (]: Using postgres connection "test.customer360.source_not_null_web_transactions_id.88a47bf7e5"
[0m23:50:10.136719 [debug] [Thread-1 (]: On test.customer360.source_not_null_web_transactions_id.88a47bf7e5: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.source_not_null_web_transactions_id.88a47bf7e5"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select id
from "dbt"."public"."transactions"
where id is null



      
    ) dbt_internal_test
[0m23:50:10.137262 [debug] [Thread-2 (]: SQL status: SELECT 1 in 0.0 seconds
[0m23:50:10.138892 [debug] [Thread-2 (]: Timing info for test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d (execute): 23:50:10.097606 => 23:50:10.138681
[0m23:50:10.139798 [debug] [Thread-2 (]: On test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d: ROLLBACK
[0m23:50:10.139354 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.0 seconds
[0m23:50:10.141440 [debug] [Thread-1 (]: Timing info for test.customer360.source_not_null_web_transactions_id.88a47bf7e5 (execute): 23:50:10.115771 => 23:50:10.141128
[0m23:50:10.141906 [debug] [Thread-1 (]: On test.customer360.source_not_null_web_transactions_id.88a47bf7e5: ROLLBACK
[0m23:50:10.142472 [debug] [Thread-2 (]: On test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d: Close
[0m23:50:10.143505 [info ] [Thread-2 (]: 5 of 9 PASS source_not_null_salesforce_contacts_id ............................. [[32mPASS[0m in 0.06s]
[0m23:50:10.144187 [debug] [Thread-2 (]: Finished running node test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d
[0m23:50:10.144703 [debug] [Thread-2 (]: Began running node test.customer360.source_unique_salesforce_contacts_id.01cadaaf43
[0m23:50:10.145172 [info ] [Thread-2 (]: 8 of 9 START test source_unique_salesforce_contacts_id ......................... [RUN]
[0m23:50:10.145586 [debug] [Thread-1 (]: On test.customer360.source_not_null_web_transactions_id.88a47bf7e5: Close
[0m23:50:10.145909 [debug] [Thread-3 (]: SQL status: BEGIN in 0.0 seconds
[0m23:50:10.147723 [debug] [Thread-3 (]: Using postgres connection "test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344"
[0m23:50:10.148231 [debug] [Thread-3 (]: On test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

with child as (
    select contact_id as from_field
    from "dbt"."public"."transactions"
    where contact_id is not null
),

parent as (
    select id as to_field
    from "dbt"."public"."contacts"
)

select
    from_field

from child
left join parent
    on child.from_field = parent.to_field

where parent.to_field is null



      
    ) dbt_internal_test
[0m23:50:10.147187 [info ] [Thread-1 (]: 6 of 9 PASS source_not_null_web_transactions_id ................................ [[32mPASS[0m in 0.04s]
[0m23:50:10.149090 [debug] [Thread-1 (]: Finished running node test.customer360.source_not_null_web_transactions_id.88a47bf7e5
[0m23:50:10.149592 [debug] [Thread-1 (]: Began running node test.customer360.source_unique_web_transactions_id.ba28079761
[0m23:50:10.150079 [info ] [Thread-1 (]: 9 of 9 START test source_unique_web_transactions_id ............................ [RUN]
[0m23:50:10.146499 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d, now test.customer360.source_unique_salesforce_contacts_id.01cadaaf43)
[0m23:50:10.150892 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.customer360.source_not_null_web_transactions_id.88a47bf7e5, now test.customer360.source_unique_web_transactions_id.ba28079761)
[0m23:50:10.151401 [debug] [Thread-3 (]: SQL status: SELECT 1 in 0.0 seconds
[0m23:50:10.151740 [debug] [Thread-2 (]: Began compiling node test.customer360.source_unique_salesforce_contacts_id.01cadaaf43
[0m23:50:10.152104 [debug] [Thread-1 (]: Began compiling node test.customer360.source_unique_web_transactions_id.ba28079761
[0m23:50:10.153628 [debug] [Thread-3 (]: Timing info for test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344 (execute): 23:50:10.129654 => 23:50:10.153412
[0m23:50:10.161757 [debug] [Thread-2 (]: Writing injected SQL for node "test.customer360.source_unique_salesforce_contacts_id.01cadaaf43"
[0m23:50:10.165894 [debug] [Thread-1 (]: Writing injected SQL for node "test.customer360.source_unique_web_transactions_id.ba28079761"
[0m23:50:10.166358 [debug] [Thread-3 (]: On test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344: ROLLBACK
[0m23:50:10.167131 [debug] [Thread-2 (]: Timing info for test.customer360.source_unique_salesforce_contacts_id.01cadaaf43 (compile): 23:50:10.153873 => 23:50:10.166859
[0m23:50:10.168094 [debug] [Thread-2 (]: Began executing node test.customer360.source_unique_salesforce_contacts_id.01cadaaf43
[0m23:50:10.167599 [debug] [Thread-1 (]: Timing info for test.customer360.source_unique_web_transactions_id.ba28079761 (compile): 23:50:10.162051 => 23:50:10.167374
[0m23:50:10.168522 [debug] [Thread-3 (]: On test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344: Close
[0m23:50:10.170641 [debug] [Thread-2 (]: Writing runtime sql for node "test.customer360.source_unique_salesforce_contacts_id.01cadaaf43"
[0m23:50:10.171028 [debug] [Thread-1 (]: Began executing node test.customer360.source_unique_web_transactions_id.ba28079761
[0m23:50:10.174496 [debug] [Thread-1 (]: Writing runtime sql for node "test.customer360.source_unique_web_transactions_id.ba28079761"
[0m23:50:10.175015 [debug] [Thread-1 (]: Using postgres connection "test.customer360.source_unique_web_transactions_id.ba28079761"
[0m23:50:10.175428 [debug] [Thread-1 (]: On test.customer360.source_unique_web_transactions_id.ba28079761: BEGIN
[0m23:50:10.175731 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:50:10.176718 [debug] [Thread-2 (]: Using postgres connection "test.customer360.source_unique_salesforce_contacts_id.01cadaaf43"
[0m23:50:10.177182 [debug] [Thread-2 (]: On test.customer360.source_unique_salesforce_contacts_id.01cadaaf43: BEGIN
[0m23:50:10.177567 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m23:50:10.172020 [info ] [Thread-3 (]: 7 of 9 PASS source_relationships_web_transactions_contact_id__id__ref_contacts_  [[32mPASS[0m in 0.06s]
[0m23:50:10.178752 [debug] [Thread-3 (]: Finished running node test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344
[0m23:50:10.182016 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m23:50:10.182416 [debug] [Thread-1 (]: Using postgres connection "test.customer360.source_unique_web_transactions_id.ba28079761"
[0m23:50:10.182788 [debug] [Thread-2 (]: SQL status: BEGIN in 0.0 seconds
[0m23:50:10.183144 [debug] [Thread-1 (]: On test.customer360.source_unique_web_transactions_id.ba28079761: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.source_unique_web_transactions_id.ba28079761"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

select
    id as unique_field,
    count(*) as n_records

from "dbt"."public"."transactions"
where id is not null
group by id
having count(*) > 1



      
    ) dbt_internal_test
[0m23:50:10.183550 [debug] [Thread-2 (]: Using postgres connection "test.customer360.source_unique_salesforce_contacts_id.01cadaaf43"
[0m23:50:10.184064 [debug] [Thread-2 (]: On test.customer360.source_unique_salesforce_contacts_id.01cadaaf43: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.source_unique_salesforce_contacts_id.01cadaaf43"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

select
    id as unique_field,
    count(*) as n_records

from "dbt"."public"."contacts"
where id is not null
group by id
having count(*) > 1



      
    ) dbt_internal_test
[0m23:50:10.185988 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.0 seconds
[0m23:50:10.187645 [debug] [Thread-1 (]: Timing info for test.customer360.source_unique_web_transactions_id.ba28079761 (execute): 23:50:10.172367 => 23:50:10.187436
[0m23:50:10.187973 [debug] [Thread-1 (]: On test.customer360.source_unique_web_transactions_id.ba28079761: ROLLBACK
[0m23:50:10.188414 [debug] [Thread-2 (]: SQL status: SELECT 1 in 0.0 seconds
[0m23:50:10.189624 [debug] [Thread-2 (]: Timing info for test.customer360.source_unique_salesforce_contacts_id.01cadaaf43 (execute): 23:50:10.168755 => 23:50:10.189418
[0m23:50:10.189941 [debug] [Thread-2 (]: On test.customer360.source_unique_salesforce_contacts_id.01cadaaf43: ROLLBACK
[0m23:50:10.190476 [debug] [Thread-1 (]: On test.customer360.source_unique_web_transactions_id.ba28079761: Close
[0m23:50:10.191238 [info ] [Thread-1 (]: 9 of 9 PASS source_unique_web_transactions_id .................................. [[32mPASS[0m in 0.04s]
[0m23:50:10.191940 [debug] [Thread-1 (]: Finished running node test.customer360.source_unique_web_transactions_id.ba28079761
[0m23:50:10.192506 [debug] [Thread-2 (]: On test.customer360.source_unique_salesforce_contacts_id.01cadaaf43: Close
[0m23:50:10.193269 [info ] [Thread-2 (]: 8 of 9 PASS source_unique_salesforce_contacts_id ............................... [[32mPASS[0m in 0.05s]
[0m23:50:10.193809 [debug] [Thread-2 (]: Finished running node test.customer360.source_unique_salesforce_contacts_id.01cadaaf43
[0m23:50:10.195610 [debug] [MainThread]: Using postgres connection "master"
[0m23:50:10.195951 [debug] [MainThread]: On master: BEGIN
[0m23:50:10.196208 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m23:50:10.199358 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m23:50:10.199651 [debug] [MainThread]: On master: COMMIT
[0m23:50:10.199907 [debug] [MainThread]: Using postgres connection "master"
[0m23:50:10.200159 [debug] [MainThread]: On master: COMMIT
[0m23:50:10.200639 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m23:50:10.200918 [debug] [MainThread]: On master: Close
[0m23:50:10.201548 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:50:10.201819 [debug] [MainThread]: Connection 'test.customer360.source_unique_web_transactions_id.ba28079761' was properly closed.
[0m23:50:10.202063 [debug] [MainThread]: Connection 'test.customer360.source_unique_salesforce_contacts_id.01cadaaf43' was properly closed.
[0m23:50:10.202341 [debug] [MainThread]: Connection 'test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344' was properly closed.
[0m23:50:10.202785 [info ] [MainThread]: 
[0m23:50:10.203193 [info ] [MainThread]: Finished running 9 tests in 0 hours 0 minutes and 0.30 seconds (0.30s).
[0m23:50:10.204812 [debug] [MainThread]: Command end result
[0m23:50:10.212886 [info ] [MainThread]: 
[0m23:50:10.213269 [info ] [MainThread]: [31mCompleted with 2 errors and 0 warnings:[0m
[0m23:50:10.213574 [info ] [MainThread]: 
[0m23:50:10.213850 [error] [MainThread]:   Compilation Error in test macro_test1 (tests/macro_test1.sql)
  'to_date' is undefined. This can happen when calling a macro that does not exist. Check for typos and/or install package dependencies with "dbt deps".
[0m23:50:10.214116 [info ] [MainThread]: 
[0m23:50:10.214482 [error] [MainThread]:   Database Error in test macro_test2 (tests/macro_test2.sql)
  syntax error at or near "select"
  LINE 12: select
           ^
  compiled Code at target/run/customer360/tests/macro_test2.sql
[0m23:50:10.214799 [info ] [MainThread]: 
[0m23:50:10.215088 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=2 SKIP=0 TOTAL=9
[0m23:50:10.215782 [debug] [MainThread]: Resource report: {"command_name": "test", "command_wall_clock_time": 0.7056704, "process_user_time": 2.230683, "process_kernel_time": 0.111034, "process_mem_max_rss": "112188", "process_out_blocks": "2720", "command_success": false, "process_in_blocks": "0"}
[0m23:50:10.216220 [debug] [MainThread]: Command `dbt test` failed at 23:50:10.216105 after 0.71 seconds
[0m23:50:10.216598 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3f9957ff50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3f99b64090>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3f97a91a10>]}
[0m23:50:10.216942 [debug] [MainThread]: Flushing usage events
[0m23:51:36.654308 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb0607ed7d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb060d7a490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb060d79f50>]}


============================== 23:51:36.656861 | e4971929-0d1c-4521-af4a-51cb54cc76d0 ==============================
[0m23:51:36.656861 [info ] [MainThread]: Running with dbt=1.7.8
[0m23:51:36.657503 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'profiles_dir': '/root/option1-customer360/integration_tests', 'log_path': '/root/option1-customer360/integration_tests/logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'log_format': 'default', 'target_path': 'None', 'invocation_command': 'dbt test', 'send_anonymous_usage_stats': 'True'}
[0m23:51:36.809114 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'e4971929-0d1c-4521-af4a-51cb54cc76d0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb060dcb3d0>]}
[0m23:51:36.888925 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'e4971929-0d1c-4521-af4a-51cb54cc76d0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb060db2350>]}
[0m23:51:36.889633 [info ] [MainThread]: Registered adapter: postgres=1.7.8
[0m23:51:36.901366 [debug] [MainThread]: checksum: 67f0013ca5f0bd43af9a0873dd50792fde83ef69de63b71cacd0b4ac656c52e5, vars: {}, profile: , target: , version: 1.7.8
[0m23:51:36.925234 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 2 files changed.
[0m23:51:36.926012 [debug] [MainThread]: Partial parsing: updated file: customer360://tests/macro_test1.sql
[0m23:51:36.926563 [debug] [MainThread]: Partial parsing: updated file: customer360://tests/macro_test2.sql
[0m23:51:37.030776 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e4971929-0d1c-4521-af4a-51cb54cc76d0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb05ea84ed0>]}
[0m23:51:37.099009 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e4971929-0d1c-4521-af4a-51cb54cc76d0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb06071a090>]}
[0m23:51:37.099490 [info ] [MainThread]: Found 2 seeds, 4 models, 9 tests, 2 sources, 0 exposures, 0 metrics, 403 macros, 0 groups, 0 semantic models
[0m23:51:37.099916 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e4971929-0d1c-4521-af4a-51cb54cc76d0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb061b3bd90>]}
[0m23:51:37.101994 [info ] [MainThread]: 
[0m23:51:37.102739 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m23:51:37.104084 [debug] [ThreadPool]: Acquiring new postgres connection 'list_dbt_public'
[0m23:51:37.114031 [debug] [ThreadPool]: Using postgres connection "list_dbt_public"
[0m23:51:37.114362 [debug] [ThreadPool]: On list_dbt_public: BEGIN
[0m23:51:37.114656 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:51:37.118971 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m23:51:37.119388 [debug] [ThreadPool]: Using postgres connection "list_dbt_public"
[0m23:51:37.119689 [debug] [ThreadPool]: On list_dbt_public: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "connection_name": "list_dbt_public"} */
select
      'dbt' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'dbt' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'dbt' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m23:51:37.122694 [debug] [ThreadPool]: SQL status: SELECT 6 in 0.0 seconds
[0m23:51:37.124023 [debug] [ThreadPool]: On list_dbt_public: ROLLBACK
[0m23:51:37.124567 [debug] [ThreadPool]: On list_dbt_public: Close
[0m23:51:37.130668 [debug] [MainThread]: Using postgres connection "master"
[0m23:51:37.131025 [debug] [MainThread]: On master: BEGIN
[0m23:51:37.131342 [debug] [MainThread]: Opening a new connection, currently in state init
[0m23:51:37.134565 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m23:51:37.134925 [debug] [MainThread]: Using postgres connection "master"
[0m23:51:37.135410 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m23:51:37.145868 [debug] [MainThread]: SQL status: SELECT 2 in 0.0 seconds
[0m23:51:37.147632 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e4971929-0d1c-4521-af4a-51cb54cc76d0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb05eb45910>]}
[0m23:51:37.148032 [debug] [MainThread]: On master: ROLLBACK
[0m23:51:37.148589 [debug] [MainThread]: Using postgres connection "master"
[0m23:51:37.148879 [debug] [MainThread]: On master: BEGIN
[0m23:51:37.149561 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m23:51:37.149866 [debug] [MainThread]: On master: COMMIT
[0m23:51:37.150121 [debug] [MainThread]: Using postgres connection "master"
[0m23:51:37.150413 [debug] [MainThread]: On master: COMMIT
[0m23:51:37.150939 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m23:51:37.151219 [debug] [MainThread]: On master: Close
[0m23:51:37.151940 [info ] [MainThread]: Concurrency: 3 threads (target='local')
[0m23:51:37.152237 [info ] [MainThread]: 
[0m23:51:37.155282 [debug] [Thread-1 (]: Began running node test.customer360.macro_test1
[0m23:51:37.155810 [debug] [Thread-2 (]: Began running node test.customer360.macro_test2
[0m23:51:37.156173 [debug] [Thread-3 (]: Began running node test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311
[0m23:51:37.156713 [info ] [Thread-1 (]: 1 of 9 START test macro_test1 .................................................. [RUN]
[0m23:51:37.157369 [info ] [Thread-2 (]: 2 of 9 START test macro_test2 .................................................. [RUN]
[0m23:51:37.157851 [info ] [Thread-3 (]: 3 of 9 START test not_null_contacts_joined_with_transactions_id ................ [RUN]
[0m23:51:37.158599 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dbt_public, now test.customer360.macro_test1)
[0m23:51:37.159336 [debug] [Thread-2 (]: Acquiring new postgres connection 'test.customer360.macro_test2'
[0m23:51:37.160031 [debug] [Thread-3 (]: Acquiring new postgres connection 'test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311'
[0m23:51:37.160481 [debug] [Thread-1 (]: Began compiling node test.customer360.macro_test1
[0m23:51:37.160864 [debug] [Thread-2 (]: Began compiling node test.customer360.macro_test2
[0m23:51:37.161333 [debug] [Thread-3 (]: Began compiling node test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311
[0m23:51:37.168950 [debug] [Thread-2 (]: Writing injected SQL for node "test.customer360.macro_test2"
[0m23:51:37.170726 [debug] [Thread-1 (]: Writing injected SQL for node "test.customer360.macro_test1"
[0m23:51:37.177011 [debug] [Thread-2 (]: Timing info for test.customer360.macro_test2 (compile): 23:51:37.166762 => 23:51:37.176662
[0m23:51:37.183532 [debug] [Thread-2 (]: Began executing node test.customer360.macro_test2
[0m23:51:37.182987 [debug] [Thread-3 (]: Writing injected SQL for node "test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311"
[0m23:51:37.197700 [debug] [Thread-2 (]: Writing runtime sql for node "test.customer360.macro_test2"
[0m23:51:37.198170 [debug] [Thread-1 (]: Timing info for test.customer360.macro_test1 (compile): 23:51:37.161615 => 23:51:37.197966
[0m23:51:37.198895 [debug] [Thread-3 (]: Timing info for test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311 (compile): 23:51:37.171087 => 23:51:37.198689
[0m23:51:37.199398 [debug] [Thread-2 (]: Using postgres connection "test.customer360.macro_test2"
[0m23:51:37.199810 [debug] [Thread-1 (]: Began executing node test.customer360.macro_test1
[0m23:51:37.200166 [debug] [Thread-3 (]: Began executing node test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311
[0m23:51:37.200637 [debug] [Thread-2 (]: On test.customer360.macro_test2: BEGIN
[0m23:51:37.202868 [debug] [Thread-1 (]: Writing runtime sql for node "test.customer360.macro_test1"
[0m23:51:37.204975 [debug] [Thread-3 (]: Writing runtime sql for node "test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311"
[0m23:51:37.205428 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m23:51:37.206271 [debug] [Thread-3 (]: Using postgres connection "test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311"
[0m23:51:37.206757 [debug] [Thread-3 (]: On test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311: BEGIN
[0m23:51:37.207330 [debug] [Thread-1 (]: Using postgres connection "test.customer360.macro_test1"
[0m23:51:37.208213 [debug] [Thread-1 (]: On test.customer360.macro_test1: BEGIN
[0m23:51:37.208668 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:51:37.207747 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m23:51:37.211791 [debug] [Thread-2 (]: SQL status: BEGIN in 0.0 seconds
[0m23:51:37.212277 [debug] [Thread-2 (]: Using postgres connection "test.customer360.macro_test2"
[0m23:51:37.212643 [debug] [Thread-2 (]: On test.customer360.macro_test2: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.macro_test2"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      with marco_result as (
    select 
    to_timestamp('2023-02-27 21:00:00','YYYY-MM-DD HH24:MI:SS.MS') :: timestamp at TIME zone 'UTC'
 as expect_result
)
select
    1
from marco_result
where pg_typeof(expect_result) not like '%timestamp%'
      
    ) dbt_internal_test
[0m23:51:37.214696 [debug] [Thread-2 (]: Postgres adapter: Postgres error: operator does not exist: regtype !~~ unknown
LINE 15: where pg_typeof(expect_result) not like '%timestamp%'
                                        ^
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.

[0m23:51:37.215279 [debug] [Thread-2 (]: On test.customer360.macro_test2: ROLLBACK
[0m23:51:37.215820 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m23:51:37.216228 [debug] [Thread-1 (]: Using postgres connection "test.customer360.macro_test1"
[0m23:51:37.216736 [debug] [Thread-1 (]: On test.customer360.macro_test1: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.macro_test1"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      with marco_result as (
    select 
    date_part('year', age(current_date, 2023-02-12))
 as expect_result
),
select
    1
from marco_result
where expect_result <> '1'
      
    ) dbt_internal_test
[0m23:51:37.217579 [debug] [Thread-2 (]: Timing info for test.customer360.macro_test2 (execute): 23:51:37.183850 => 23:51:37.217283
[0m23:51:37.217989 [debug] [Thread-2 (]: On test.customer360.macro_test2: Close
[0m23:51:37.221071 [debug] [Thread-3 (]: SQL status: BEGIN in 0.0 seconds
[0m23:51:37.221429 [debug] [Thread-3 (]: Using postgres connection "test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311"
[0m23:51:37.221864 [debug] [Thread-3 (]: On test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select id
from "dbt"."public"."contacts_joined_with_transactions"
where id is null



      
    ) dbt_internal_test
[0m23:51:37.224202 [debug] [Thread-2 (]: Database Error in test macro_test2 (tests/macro_test2.sql)
  operator does not exist: regtype !~~ unknown
  LINE 15: where pg_typeof(expect_result) not like '%timestamp%'
                                          ^
  HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
  compiled Code at target/run/customer360/tests/macro_test2.sql
[0m23:51:37.225276 [debug] [Thread-1 (]: Postgres adapter: Postgres error: syntax error at or near "select"
LINE 12: select
         ^

[0m23:51:37.224928 [error] [Thread-2 (]: 2 of 9 ERROR macro_test2 ....................................................... [[31mERROR[0m in 0.07s]
[0m23:51:37.225859 [debug] [Thread-1 (]: On test.customer360.macro_test1: ROLLBACK
[0m23:51:37.226204 [debug] [Thread-3 (]: SQL status: SELECT 1 in 0.0 seconds
[0m23:51:37.226825 [debug] [Thread-2 (]: Finished running node test.customer360.macro_test2
[0m23:51:37.228973 [debug] [Thread-3 (]: Timing info for test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311 (execute): 23:51:37.203111 => 23:51:37.228751
[0m23:51:37.230437 [debug] [Thread-3 (]: On test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311: ROLLBACK
[0m23:51:37.230025 [debug] [Thread-2 (]: Began running node test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247
[0m23:51:37.229476 [debug] [Thread-1 (]: Timing info for test.customer360.macro_test1 (execute): 23:51:37.200866 => 23:51:37.229253
[0m23:51:37.231071 [info ] [Thread-2 (]: 4 of 9 START test source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors  [RUN]
[0m23:51:37.231656 [debug] [Thread-3 (]: On test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311: Close
[0m23:51:37.232031 [debug] [Thread-1 (]: On test.customer360.macro_test1: Close
[0m23:51:37.232719 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.customer360.macro_test2, now test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247)
[0m23:51:37.235882 [debug] [Thread-2 (]: Began compiling node test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247
[0m23:51:37.233697 [info ] [Thread-3 (]: 3 of 9 PASS not_null_contacts_joined_with_transactions_id ...................... [[32mPASS[0m in 0.07s]
[0m23:51:37.248609 [debug] [Thread-2 (]: Writing injected SQL for node "test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247"
[0m23:51:37.249333 [debug] [Thread-3 (]: Finished running node test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311
[0m23:51:37.250830 [debug] [Thread-1 (]: Database Error in test macro_test1 (tests/macro_test1.sql)
  syntax error at or near "select"
  LINE 12: select
           ^
  compiled Code at target/run/customer360/tests/macro_test1.sql
[0m23:51:37.251385 [debug] [Thread-3 (]: Began running node test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d
[0m23:51:37.253068 [info ] [Thread-3 (]: 5 of 9 START test source_not_null_salesforce_contacts_id ....................... [RUN]
[0m23:51:37.252572 [error] [Thread-1 (]: 1 of 9 ERROR macro_test1 ....................................................... [[31mERROR[0m in 0.09s]
[0m23:51:37.251945 [debug] [Thread-2 (]: Timing info for test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247 (compile): 23:51:37.236137 => 23:51:37.251685
[0m23:51:37.253724 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311, now test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d)
[0m23:51:37.254358 [debug] [Thread-1 (]: Finished running node test.customer360.macro_test1
[0m23:51:37.254750 [debug] [Thread-2 (]: Began executing node test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247
[0m23:51:37.255175 [debug] [Thread-3 (]: Began compiling node test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d
[0m23:51:37.255623 [debug] [Thread-1 (]: Began running node test.customer360.source_not_null_web_transactions_id.88a47bf7e5
[0m23:51:37.258173 [debug] [Thread-2 (]: Writing runtime sql for node "test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247"
[0m23:51:37.262201 [debug] [Thread-3 (]: Writing injected SQL for node "test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d"
[0m23:51:37.262660 [info ] [Thread-1 (]: 6 of 9 START test source_not_null_web_transactions_id .......................... [RUN]
[0m23:51:37.263491 [debug] [Thread-2 (]: Using postgres connection "test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247"
[0m23:51:37.264071 [debug] [Thread-3 (]: Timing info for test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d (compile): 23:51:37.258492 => 23:51:37.263852
[0m23:51:37.264837 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.customer360.macro_test1, now test.customer360.source_not_null_web_transactions_id.88a47bf7e5)
[0m23:51:37.265232 [debug] [Thread-2 (]: On test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247: BEGIN
[0m23:51:37.265640 [debug] [Thread-3 (]: Began executing node test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d
[0m23:51:37.266074 [debug] [Thread-1 (]: Began compiling node test.customer360.source_not_null_web_transactions_id.88a47bf7e5
[0m23:51:37.266461 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m23:51:37.268527 [debug] [Thread-3 (]: Writing runtime sql for node "test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d"
[0m23:51:37.273249 [debug] [Thread-3 (]: Using postgres connection "test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d"
[0m23:51:37.273797 [debug] [Thread-3 (]: On test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d: BEGIN
[0m23:51:37.274223 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m23:51:37.272437 [debug] [Thread-1 (]: Writing injected SQL for node "test.customer360.source_not_null_web_transactions_id.88a47bf7e5"
[0m23:51:37.275441 [debug] [Thread-1 (]: Timing info for test.customer360.source_not_null_web_transactions_id.88a47bf7e5 (compile): 23:51:37.268859 => 23:51:37.275140
[0m23:51:37.276021 [debug] [Thread-1 (]: Began executing node test.customer360.source_not_null_web_transactions_id.88a47bf7e5
[0m23:51:37.278820 [debug] [Thread-1 (]: Writing runtime sql for node "test.customer360.source_not_null_web_transactions_id.88a47bf7e5"
[0m23:51:37.279554 [debug] [Thread-1 (]: Using postgres connection "test.customer360.source_not_null_web_transactions_id.88a47bf7e5"
[0m23:51:37.279909 [debug] [Thread-1 (]: On test.customer360.source_not_null_web_transactions_id.88a47bf7e5: BEGIN
[0m23:51:37.280210 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:51:37.283180 [debug] [Thread-2 (]: SQL status: BEGIN in 0.0 seconds
[0m23:51:37.283673 [debug] [Thread-2 (]: Using postgres connection "test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247"
[0m23:51:37.284044 [debug] [Thread-2 (]: On test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

with all_values as (

    select
        category as value_field,
        count(*) as n_records

    from "dbt"."public"."transactions"
    group by category

)

select *
from all_values
where value_field not in (
    'Apps & Games','Beauty','Books','Clothing, Shoes & Accessories','Movies & TV','Sports, Fitness & Outdoors'
)



      
    ) dbt_internal_test
[0m23:51:37.284751 [debug] [Thread-3 (]: SQL status: BEGIN in 0.0 seconds
[0m23:51:37.285220 [debug] [Thread-3 (]: Using postgres connection "test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d"
[0m23:51:37.285769 [debug] [Thread-3 (]: On test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select id
from "dbt"."public"."contacts"
where id is null



      
    ) dbt_internal_test
[0m23:51:37.287029 [debug] [Thread-2 (]: SQL status: SELECT 1 in 0.0 seconds
[0m23:51:37.288822 [debug] [Thread-2 (]: Timing info for test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247 (execute): 23:51:37.255993 => 23:51:37.288487
[0m23:51:37.289334 [debug] [Thread-2 (]: On test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247: ROLLBACK
[0m23:51:37.289697 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m23:51:37.290019 [debug] [Thread-3 (]: SQL status: SELECT 1 in 0.0 seconds
[0m23:51:37.291879 [debug] [Thread-3 (]: Timing info for test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d (execute): 23:51:37.266756 => 23:51:37.291679
[0m23:51:37.292267 [debug] [Thread-3 (]: On test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d: ROLLBACK
[0m23:51:37.290526 [debug] [Thread-1 (]: Using postgres connection "test.customer360.source_not_null_web_transactions_id.88a47bf7e5"
[0m23:51:37.292722 [debug] [Thread-1 (]: On test.customer360.source_not_null_web_transactions_id.88a47bf7e5: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.source_not_null_web_transactions_id.88a47bf7e5"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select id
from "dbt"."public"."transactions"
where id is null



      
    ) dbt_internal_test
[0m23:51:37.293222 [debug] [Thread-2 (]: On test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247: Close
[0m23:51:37.294373 [info ] [Thread-2 (]: 4 of 9 PASS source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors  [[32mPASS[0m in 0.06s]
[0m23:51:37.295145 [debug] [Thread-2 (]: Finished running node test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247
[0m23:51:37.295878 [debug] [Thread-2 (]: Began running node test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344
[0m23:51:37.296389 [info ] [Thread-2 (]: 7 of 9 START test source_relationships_web_transactions_contact_id__id__ref_contacts_  [RUN]
[0m23:51:37.296799 [debug] [Thread-3 (]: On test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d: Close
[0m23:51:37.297488 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247, now test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344)
[0m23:51:37.299306 [debug] [Thread-2 (]: Began compiling node test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344
[0m23:51:37.298784 [info ] [Thread-3 (]: 5 of 9 PASS source_not_null_salesforce_contacts_id ............................. [[32mPASS[0m in 0.05s]
[0m23:51:37.298022 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.0 seconds
[0m23:51:37.308005 [debug] [Thread-2 (]: Writing injected SQL for node "test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344"
[0m23:51:37.308597 [debug] [Thread-3 (]: Finished running node test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d
[0m23:51:37.310730 [debug] [Thread-3 (]: Began running node test.customer360.source_unique_salesforce_contacts_id.01cadaaf43
[0m23:51:37.310104 [debug] [Thread-1 (]: Timing info for test.customer360.source_not_null_web_transactions_id.88a47bf7e5 (execute): 23:51:37.276316 => 23:51:37.309899
[0m23:51:37.311236 [info ] [Thread-3 (]: 8 of 9 START test source_unique_salesforce_contacts_id ......................... [RUN]
[0m23:51:37.312443 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d, now test.customer360.source_unique_salesforce_contacts_id.01cadaaf43)
[0m23:51:37.311766 [debug] [Thread-1 (]: On test.customer360.source_not_null_web_transactions_id.88a47bf7e5: ROLLBACK
[0m23:51:37.313003 [debug] [Thread-2 (]: Timing info for test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344 (compile): 23:51:37.299550 => 23:51:37.312778
[0m23:51:37.313349 [debug] [Thread-3 (]: Began compiling node test.customer360.source_unique_salesforce_contacts_id.01cadaaf43
[0m23:51:37.313875 [debug] [Thread-2 (]: Began executing node test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344
[0m23:51:37.320135 [debug] [Thread-3 (]: Writing injected SQL for node "test.customer360.source_unique_salesforce_contacts_id.01cadaaf43"
[0m23:51:37.320567 [debug] [Thread-1 (]: On test.customer360.source_not_null_web_transactions_id.88a47bf7e5: Close
[0m23:51:37.323933 [info ] [Thread-1 (]: 6 of 9 PASS source_not_null_web_transactions_id ................................ [[32mPASS[0m in 0.06s]
[0m23:51:37.324732 [debug] [Thread-1 (]: Finished running node test.customer360.source_not_null_web_transactions_id.88a47bf7e5
[0m23:51:37.322833 [debug] [Thread-2 (]: Writing runtime sql for node "test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344"
[0m23:51:37.325235 [debug] [Thread-1 (]: Began running node test.customer360.source_unique_web_transactions_id.ba28079761
[0m23:51:37.326028 [debug] [Thread-3 (]: Timing info for test.customer360.source_unique_salesforce_contacts_id.01cadaaf43 (compile): 23:51:37.314112 => 23:51:37.325818
[0m23:51:37.326628 [debug] [Thread-2 (]: Using postgres connection "test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344"
[0m23:51:37.326992 [info ] [Thread-1 (]: 9 of 9 START test source_unique_web_transactions_id ............................ [RUN]
[0m23:51:37.327497 [debug] [Thread-3 (]: Began executing node test.customer360.source_unique_salesforce_contacts_id.01cadaaf43
[0m23:51:37.327871 [debug] [Thread-2 (]: On test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344: BEGIN
[0m23:51:37.328567 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.customer360.source_not_null_web_transactions_id.88a47bf7e5, now test.customer360.source_unique_web_transactions_id.ba28079761)
[0m23:51:37.330863 [debug] [Thread-3 (]: Writing runtime sql for node "test.customer360.source_unique_salesforce_contacts_id.01cadaaf43"
[0m23:51:37.331341 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m23:51:37.331712 [debug] [Thread-1 (]: Began compiling node test.customer360.source_unique_web_transactions_id.ba28079761
[0m23:51:37.337663 [debug] [Thread-1 (]: Writing injected SQL for node "test.customer360.source_unique_web_transactions_id.ba28079761"
[0m23:51:37.332476 [debug] [Thread-3 (]: Using postgres connection "test.customer360.source_unique_salesforce_contacts_id.01cadaaf43"
[0m23:51:37.338375 [debug] [Thread-3 (]: On test.customer360.source_unique_salesforce_contacts_id.01cadaaf43: BEGIN
[0m23:51:37.339283 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m23:51:37.338870 [debug] [Thread-2 (]: SQL status: BEGIN in 0.0 seconds
[0m23:51:37.340919 [debug] [Thread-2 (]: Using postgres connection "test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344"
[0m23:51:37.341430 [debug] [Thread-2 (]: On test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

with child as (
    select contact_id as from_field
    from "dbt"."public"."transactions"
    where contact_id is not null
),

parent as (
    select id as to_field
    from "dbt"."public"."contacts"
)

select
    from_field

from child
left join parent
    on child.from_field = parent.to_field

where parent.to_field is null



      
    ) dbt_internal_test
[0m23:51:37.340206 [debug] [Thread-1 (]: Timing info for test.customer360.source_unique_web_transactions_id.ba28079761 (compile): 23:51:37.333271 => 23:51:37.339706
[0m23:51:37.341832 [debug] [Thread-1 (]: Began executing node test.customer360.source_unique_web_transactions_id.ba28079761
[0m23:51:37.343993 [debug] [Thread-1 (]: Writing runtime sql for node "test.customer360.source_unique_web_transactions_id.ba28079761"
[0m23:51:37.345562 [debug] [Thread-1 (]: Using postgres connection "test.customer360.source_unique_web_transactions_id.ba28079761"
[0m23:51:37.345985 [debug] [Thread-1 (]: On test.customer360.source_unique_web_transactions_id.ba28079761: BEGIN
[0m23:51:37.346329 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:51:37.346856 [debug] [Thread-2 (]: SQL status: SELECT 1 in 0.0 seconds
[0m23:51:37.351226 [debug] [Thread-2 (]: Timing info for test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344 (execute): 23:51:37.320836 => 23:51:37.350993
[0m23:51:37.351702 [debug] [Thread-2 (]: On test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344: ROLLBACK
[0m23:51:37.352138 [debug] [Thread-3 (]: SQL status: BEGIN in 0.0 seconds
[0m23:51:37.352814 [debug] [Thread-3 (]: Using postgres connection "test.customer360.source_unique_salesforce_contacts_id.01cadaaf43"
[0m23:51:37.353387 [debug] [Thread-3 (]: On test.customer360.source_unique_salesforce_contacts_id.01cadaaf43: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.source_unique_salesforce_contacts_id.01cadaaf43"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

select
    id as unique_field,
    count(*) as n_records

from "dbt"."public"."contacts"
where id is not null
group by id
having count(*) > 1



      
    ) dbt_internal_test
[0m23:51:37.354044 [debug] [Thread-2 (]: On test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344: Close
[0m23:51:37.355185 [info ] [Thread-2 (]: 7 of 9 PASS source_relationships_web_transactions_contact_id__id__ref_contacts_  [[32mPASS[0m in 0.06s]
[0m23:51:37.356099 [debug] [Thread-2 (]: Finished running node test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344
[0m23:51:37.357062 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m23:51:37.357596 [debug] [Thread-1 (]: Using postgres connection "test.customer360.source_unique_web_transactions_id.ba28079761"
[0m23:51:37.358108 [debug] [Thread-1 (]: On test.customer360.source_unique_web_transactions_id.ba28079761: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.source_unique_web_transactions_id.ba28079761"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

select
    id as unique_field,
    count(*) as n_records

from "dbt"."public"."transactions"
where id is not null
group by id
having count(*) > 1



      
    ) dbt_internal_test
[0m23:51:37.358621 [debug] [Thread-3 (]: SQL status: SELECT 1 in 0.0 seconds
[0m23:51:37.360104 [debug] [Thread-3 (]: Timing info for test.customer360.source_unique_salesforce_contacts_id.01cadaaf43 (execute): 23:51:37.328812 => 23:51:37.359905
[0m23:51:37.360575 [debug] [Thread-3 (]: On test.customer360.source_unique_salesforce_contacts_id.01cadaaf43: ROLLBACK
[0m23:51:37.361764 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.0 seconds
[0m23:51:37.363086 [debug] [Thread-1 (]: Timing info for test.customer360.source_unique_web_transactions_id.ba28079761 (execute): 23:51:37.342083 => 23:51:37.362891
[0m23:51:37.363573 [debug] [Thread-1 (]: On test.customer360.source_unique_web_transactions_id.ba28079761: ROLLBACK
[0m23:51:37.363934 [debug] [Thread-3 (]: On test.customer360.source_unique_salesforce_contacts_id.01cadaaf43: Close
[0m23:51:37.364808 [info ] [Thread-3 (]: 8 of 9 PASS source_unique_salesforce_contacts_id ............................... [[32mPASS[0m in 0.05s]
[0m23:51:37.366015 [debug] [Thread-3 (]: Finished running node test.customer360.source_unique_salesforce_contacts_id.01cadaaf43
[0m23:51:37.365252 [debug] [Thread-1 (]: On test.customer360.source_unique_web_transactions_id.ba28079761: Close
[0m23:51:37.367006 [info ] [Thread-1 (]: 9 of 9 PASS source_unique_web_transactions_id .................................. [[32mPASS[0m in 0.04s]
[0m23:51:37.367624 [debug] [Thread-1 (]: Finished running node test.customer360.source_unique_web_transactions_id.ba28079761
[0m23:51:37.369904 [debug] [MainThread]: Using postgres connection "master"
[0m23:51:37.370307 [debug] [MainThread]: On master: BEGIN
[0m23:51:37.370591 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m23:51:37.373784 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m23:51:37.374138 [debug] [MainThread]: On master: COMMIT
[0m23:51:37.374478 [debug] [MainThread]: Using postgres connection "master"
[0m23:51:37.374729 [debug] [MainThread]: On master: COMMIT
[0m23:51:37.375217 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m23:51:37.375519 [debug] [MainThread]: On master: Close
[0m23:51:37.376162 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:51:37.376510 [debug] [MainThread]: Connection 'test.customer360.source_unique_web_transactions_id.ba28079761' was properly closed.
[0m23:51:37.376872 [debug] [MainThread]: Connection 'test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344' was properly closed.
[0m23:51:37.377322 [debug] [MainThread]: Connection 'test.customer360.source_unique_salesforce_contacts_id.01cadaaf43' was properly closed.
[0m23:51:37.377750 [info ] [MainThread]: 
[0m23:51:37.378217 [info ] [MainThread]: Finished running 9 tests in 0 hours 0 minutes and 0.28 seconds (0.28s).
[0m23:51:37.380269 [debug] [MainThread]: Command end result
[0m23:51:37.387909 [info ] [MainThread]: 
[0m23:51:37.388321 [info ] [MainThread]: [31mCompleted with 2 errors and 0 warnings:[0m
[0m23:51:37.388617 [info ] [MainThread]: 
[0m23:51:37.388986 [error] [MainThread]:   Database Error in test macro_test2 (tests/macro_test2.sql)
  operator does not exist: regtype !~~ unknown
  LINE 15: where pg_typeof(expect_result) not like '%timestamp%'
                                          ^
  HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
  compiled Code at target/run/customer360/tests/macro_test2.sql
[0m23:51:37.389281 [info ] [MainThread]: 
[0m23:51:37.389593 [error] [MainThread]:   Database Error in test macro_test1 (tests/macro_test1.sql)
  syntax error at or near "select"
  LINE 12: select
           ^
  compiled Code at target/run/customer360/tests/macro_test1.sql
[0m23:51:37.389963 [info ] [MainThread]: 
[0m23:51:37.390266 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=2 SKIP=0 TOTAL=9
[0m23:51:37.391082 [debug] [MainThread]: Resource report: {"command_name": "test", "command_wall_clock_time": 0.77466273, "process_user_time": 2.292444, "process_kernel_time": 0.129533, "process_mem_max_rss": "112200", "process_out_blocks": "2744", "command_success": false, "process_in_blocks": "0"}
[0m23:51:37.391573 [debug] [MainThread]: Command `dbt test` failed at 23:51:37.391455 after 0.78 seconds
[0m23:51:37.392003 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb060a7e4d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb06082b810>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb06122a290>]}
[0m23:51:37.392388 [debug] [MainThread]: Flushing usage events
[0m23:52:48.184399 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f142e571e50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f142e94b010>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f142e597610>]}


============================== 23:52:48.187004 | a0e4fa95-e321-4afa-a2a8-7f5415f36529 ==============================
[0m23:52:48.187004 [info ] [MainThread]: Running with dbt=1.7.8
[0m23:52:48.187500 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/root/option1-customer360/integration_tests', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/root/option1-customer360/integration_tests/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt test', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m23:52:48.327886 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a0e4fa95-e321-4afa-a2a8-7f5415f36529', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f142e596b90>]}
[0m23:52:48.404534 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'a0e4fa95-e321-4afa-a2a8-7f5415f36529', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f142cba9a90>]}
[0m23:52:48.405215 [info ] [MainThread]: Registered adapter: postgres=1.7.8
[0m23:52:48.416065 [debug] [MainThread]: checksum: 67f0013ca5f0bd43af9a0873dd50792fde83ef69de63b71cacd0b4ac656c52e5, vars: {}, profile: , target: , version: 1.7.8
[0m23:52:48.437228 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 2 files changed.
[0m23:52:48.437788 [debug] [MainThread]: Partial parsing: updated file: customer360://tests/macro_test2.sql
[0m23:52:48.438152 [debug] [MainThread]: Partial parsing: updated file: customer360://tests/macro_test1.sql
[0m23:52:48.532837 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'a0e4fa95-e321-4afa-a2a8-7f5415f36529', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f142c8094d0>]}
[0m23:52:48.597256 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'a0e4fa95-e321-4afa-a2a8-7f5415f36529', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f142cadc3d0>]}
[0m23:52:48.597763 [info ] [MainThread]: Found 2 seeds, 4 models, 9 tests, 2 sources, 0 exposures, 0 metrics, 403 macros, 0 groups, 0 semantic models
[0m23:52:48.598094 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a0e4fa95-e321-4afa-a2a8-7f5415f36529', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f142cc9b490>]}
[0m23:52:48.599970 [info ] [MainThread]: 
[0m23:52:48.600653 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m23:52:48.601985 [debug] [ThreadPool]: Acquiring new postgres connection 'list_dbt_public'
[0m23:52:48.611659 [debug] [ThreadPool]: Using postgres connection "list_dbt_public"
[0m23:52:48.611984 [debug] [ThreadPool]: On list_dbt_public: BEGIN
[0m23:52:48.612243 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:52:48.616209 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m23:52:48.616543 [debug] [ThreadPool]: Using postgres connection "list_dbt_public"
[0m23:52:48.616827 [debug] [ThreadPool]: On list_dbt_public: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "connection_name": "list_dbt_public"} */
select
      'dbt' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'dbt' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'dbt' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m23:52:48.619609 [debug] [ThreadPool]: SQL status: SELECT 6 in 0.0 seconds
[0m23:52:48.620839 [debug] [ThreadPool]: On list_dbt_public: ROLLBACK
[0m23:52:48.621325 [debug] [ThreadPool]: On list_dbt_public: Close
[0m23:52:48.627157 [debug] [MainThread]: Using postgres connection "master"
[0m23:52:48.627490 [debug] [MainThread]: On master: BEGIN
[0m23:52:48.627759 [debug] [MainThread]: Opening a new connection, currently in state init
[0m23:52:48.630785 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m23:52:48.631073 [debug] [MainThread]: Using postgres connection "master"
[0m23:52:48.631451 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m23:52:48.641140 [debug] [MainThread]: SQL status: SELECT 2 in 0.0 seconds
[0m23:52:48.642724 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a0e4fa95-e321-4afa-a2a8-7f5415f36529', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f142cb6f3d0>]}
[0m23:52:48.643121 [debug] [MainThread]: On master: ROLLBACK
[0m23:52:48.643606 [debug] [MainThread]: Using postgres connection "master"
[0m23:52:48.643885 [debug] [MainThread]: On master: BEGIN
[0m23:52:48.644519 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m23:52:48.644835 [debug] [MainThread]: On master: COMMIT
[0m23:52:48.645145 [debug] [MainThread]: Using postgres connection "master"
[0m23:52:48.645461 [debug] [MainThread]: On master: COMMIT
[0m23:52:48.645890 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m23:52:48.646182 [debug] [MainThread]: On master: Close
[0m23:52:48.646819 [info ] [MainThread]: Concurrency: 3 threads (target='local')
[0m23:52:48.647126 [info ] [MainThread]: 
[0m23:52:48.649271 [debug] [Thread-1 (]: Began running node test.customer360.macro_test1
[0m23:52:48.649671 [info ] [Thread-1 (]: 1 of 9 START test macro_test1 .................................................. [RUN]
[0m23:52:48.650254 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dbt_public, now test.customer360.macro_test1)
[0m23:52:48.650598 [debug] [Thread-1 (]: Began compiling node test.customer360.macro_test1
[0m23:52:48.657613 [debug] [Thread-2 (]: Began running node test.customer360.macro_test2
[0m23:52:48.657993 [debug] [Thread-1 (]: Writing injected SQL for node "test.customer360.macro_test1"
[0m23:52:48.659456 [debug] [Thread-1 (]: Timing info for test.customer360.macro_test1 (compile): 23:52:48.650792 => 23:52:48.659178
[0m23:52:48.658766 [info ] [Thread-2 (]: 2 of 9 START test macro_test2 .................................................. [RUN]
[0m23:52:48.659800 [debug] [Thread-1 (]: Began executing node test.customer360.macro_test1
[0m23:52:48.658409 [debug] [Thread-3 (]: Began running node test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311
[0m23:52:48.660476 [debug] [Thread-2 (]: Acquiring new postgres connection 'test.customer360.macro_test2'
[0m23:52:48.676057 [debug] [Thread-2 (]: Began compiling node test.customer360.macro_test2
[0m23:52:48.675602 [info ] [Thread-3 (]: 3 of 9 START test not_null_contacts_joined_with_transactions_id ................ [RUN]
[0m23:52:48.675181 [debug] [Thread-1 (]: Writing runtime sql for node "test.customer360.macro_test1"
[0m23:52:48.678365 [debug] [Thread-2 (]: Writing injected SQL for node "test.customer360.macro_test2"
[0m23:52:48.679065 [debug] [Thread-3 (]: Acquiring new postgres connection 'test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311'
[0m23:52:48.679790 [debug] [Thread-1 (]: Using postgres connection "test.customer360.macro_test1"
[0m23:52:48.680149 [debug] [Thread-3 (]: Began compiling node test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311
[0m23:52:48.680588 [debug] [Thread-1 (]: On test.customer360.macro_test1: BEGIN
[0m23:52:48.690018 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:52:48.689548 [debug] [Thread-3 (]: Writing injected SQL for node "test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311"
[0m23:52:48.691222 [debug] [Thread-3 (]: Timing info for test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311 (compile): 23:52:48.680884 => 23:52:48.690934
[0m23:52:48.691626 [debug] [Thread-3 (]: Began executing node test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311
[0m23:52:48.690486 [debug] [Thread-2 (]: Timing info for test.customer360.macro_test2 (compile): 23:52:48.676270 => 23:52:48.690237
[0m23:52:48.694377 [debug] [Thread-3 (]: Writing runtime sql for node "test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311"
[0m23:52:48.695395 [debug] [Thread-3 (]: Using postgres connection "test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311"
[0m23:52:48.695875 [debug] [Thread-3 (]: On test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311: BEGIN
[0m23:52:48.694792 [debug] [Thread-2 (]: Began executing node test.customer360.macro_test2
[0m23:52:48.696221 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m23:52:48.698330 [debug] [Thread-2 (]: Writing runtime sql for node "test.customer360.macro_test2"
[0m23:52:48.699467 [debug] [Thread-2 (]: Using postgres connection "test.customer360.macro_test2"
[0m23:52:48.699827 [debug] [Thread-2 (]: On test.customer360.macro_test2: BEGIN
[0m23:52:48.700152 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m23:52:48.702290 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m23:52:48.702826 [debug] [Thread-1 (]: Using postgres connection "test.customer360.macro_test1"
[0m23:52:48.703369 [debug] [Thread-1 (]: On test.customer360.macro_test1: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.macro_test1"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      with marco_result as (
    select 
    date_part('year', age(current_date, 2023-02-12))
 as expect_result
)
select
    1
from marco_result
where expect_result <> '1'
      
    ) dbt_internal_test
[0m23:52:48.704597 [debug] [Thread-1 (]: Postgres adapter: Postgres error: function age(date, integer) does not exist
LINE 9:     date_part('year', age(current_date, 2023-02-12))
                              ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.

[0m23:52:48.705115 [debug] [Thread-1 (]: On test.customer360.macro_test1: ROLLBACK
[0m23:52:48.705741 [debug] [Thread-2 (]: SQL status: BEGIN in 0.0 seconds
[0m23:52:48.706094 [debug] [Thread-2 (]: Using postgres connection "test.customer360.macro_test2"
[0m23:52:48.707030 [debug] [Thread-2 (]: On test.customer360.macro_test2: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.macro_test2"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      with marco_result as (
    select 
    to_timestamp('2023-02-27 21:00:00','YYYY-MM-DD HH24:MI:SS.MS') :: timestamp at TIME zone 'UTC'
 as expect_result
)
select
    1
from marco_result
where cast(pg_typeof(expect_result) as text) not like '%timestamp%'
      
    ) dbt_internal_test
[0m23:52:48.706678 [debug] [Thread-1 (]: Timing info for test.customer360.macro_test1 (execute): 23:52:48.660714 => 23:52:48.706450
[0m23:52:48.707540 [debug] [Thread-1 (]: On test.customer360.macro_test1: Close
[0m23:52:48.708014 [debug] [Thread-3 (]: SQL status: BEGIN in 0.0 seconds
[0m23:52:48.712018 [debug] [Thread-1 (]: Database Error in test macro_test1 (tests/macro_test1.sql)
  function age(date, integer) does not exist
  LINE 9:     date_part('year', age(current_date, 2023-02-12))
                                ^
  HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
  compiled Code at target/run/customer360/tests/macro_test1.sql
[0m23:52:48.712432 [debug] [Thread-2 (]: SQL status: SELECT 1 in 0.0 seconds
[0m23:52:48.712799 [debug] [Thread-3 (]: Using postgres connection "test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311"
[0m23:52:48.715167 [debug] [Thread-2 (]: Timing info for test.customer360.macro_test2 (execute): 23:52:48.696476 => 23:52:48.714960
[0m23:52:48.715587 [debug] [Thread-3 (]: On test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select id
from "dbt"."public"."contacts_joined_with_transactions"
where id is null



      
    ) dbt_internal_test
[0m23:52:48.713271 [error] [Thread-1 (]: 1 of 9 ERROR macro_test1 ....................................................... [[31mERROR[0m in 0.06s]
[0m23:52:48.716056 [debug] [Thread-2 (]: On test.customer360.macro_test2: ROLLBACK
[0m23:52:48.716657 [debug] [Thread-1 (]: Finished running node test.customer360.macro_test1
[0m23:52:48.718376 [debug] [Thread-3 (]: SQL status: SELECT 1 in 0.0 seconds
[0m23:52:48.718749 [debug] [Thread-2 (]: On test.customer360.macro_test2: Close
[0m23:52:48.719159 [debug] [Thread-1 (]: Began running node test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247
[0m23:52:48.721125 [info ] [Thread-1 (]: 4 of 9 START test source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors  [RUN]
[0m23:52:48.721963 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.customer360.macro_test1, now test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247)
[0m23:52:48.722462 [debug] [Thread-1 (]: Began compiling node test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247
[0m23:52:48.720609 [debug] [Thread-3 (]: Timing info for test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311 (execute): 23:52:48.691820 => 23:52:48.720382
[0m23:52:48.728916 [info ] [Thread-2 (]: 2 of 9 PASS macro_test2 ........................................................ [[32mPASS[0m in 0.07s]
[0m23:52:48.735173 [debug] [Thread-1 (]: Writing injected SQL for node "test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247"
[0m23:52:48.735606 [debug] [Thread-3 (]: On test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311: ROLLBACK
[0m23:52:48.736131 [debug] [Thread-2 (]: Finished running node test.customer360.macro_test2
[0m23:52:48.736813 [debug] [Thread-2 (]: Began running node test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d
[0m23:52:48.737285 [debug] [Thread-1 (]: Timing info for test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247 (compile): 23:52:48.722745 => 23:52:48.737034
[0m23:52:48.738488 [debug] [Thread-1 (]: Began executing node test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247
[0m23:52:48.740506 [debug] [Thread-1 (]: Writing runtime sql for node "test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247"
[0m23:52:48.741037 [debug] [Thread-1 (]: Using postgres connection "test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247"
[0m23:52:48.741407 [debug] [Thread-1 (]: On test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247: BEGIN
[0m23:52:48.741735 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:52:48.737777 [debug] [Thread-3 (]: On test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311: Close
[0m23:52:48.738145 [info ] [Thread-2 (]: 5 of 9 START test source_not_null_salesforce_contacts_id ....................... [RUN]
[0m23:52:48.744156 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.customer360.macro_test2, now test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d)
[0m23:52:48.744674 [debug] [Thread-2 (]: Began compiling node test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d
[0m23:52:48.749163 [debug] [Thread-2 (]: Writing injected SQL for node "test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d"
[0m23:52:48.749950 [debug] [Thread-2 (]: Timing info for test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d (compile): 23:52:48.744961 => 23:52:48.749711
[0m23:52:48.750622 [debug] [Thread-2 (]: Began executing node test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d
[0m23:52:48.752590 [debug] [Thread-2 (]: Writing runtime sql for node "test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d"
[0m23:52:48.753077 [debug] [Thread-2 (]: Using postgres connection "test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d"
[0m23:52:48.753441 [debug] [Thread-2 (]: On test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d: BEGIN
[0m23:52:48.743146 [info ] [Thread-3 (]: 3 of 9 PASS not_null_contacts_joined_with_transactions_id ...................... [[32mPASS[0m in 0.06s]
[0m23:52:48.753827 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m23:52:48.754143 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m23:52:48.754680 [debug] [Thread-3 (]: Finished running node test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311
[0m23:52:48.755684 [debug] [Thread-3 (]: Began running node test.customer360.source_not_null_web_transactions_id.88a47bf7e5
[0m23:52:48.756104 [info ] [Thread-3 (]: 6 of 9 START test source_not_null_web_transactions_id .......................... [RUN]
[0m23:52:48.756801 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311, now test.customer360.source_not_null_web_transactions_id.88a47bf7e5)
[0m23:52:48.757122 [debug] [Thread-3 (]: Began compiling node test.customer360.source_not_null_web_transactions_id.88a47bf7e5
[0m23:52:48.755048 [debug] [Thread-1 (]: Using postgres connection "test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247"
[0m23:52:48.762752 [debug] [Thread-1 (]: On test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

with all_values as (

    select
        category as value_field,
        count(*) as n_records

    from "dbt"."public"."transactions"
    group by category

)

select *
from all_values
where value_field not in (
    'Apps & Games','Beauty','Books','Clothing, Shoes & Accessories','Movies & TV','Sports, Fitness & Outdoors'
)



      
    ) dbt_internal_test
[0m23:52:48.761986 [debug] [Thread-3 (]: Writing injected SQL for node "test.customer360.source_not_null_web_transactions_id.88a47bf7e5"
[0m23:52:48.763233 [debug] [Thread-2 (]: SQL status: BEGIN in 0.0 seconds
[0m23:52:48.764037 [debug] [Thread-2 (]: Using postgres connection "test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d"
[0m23:52:48.764568 [debug] [Thread-2 (]: On test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select id
from "dbt"."public"."contacts"
where id is null



      
    ) dbt_internal_test
[0m23:52:48.765358 [debug] [Thread-3 (]: Timing info for test.customer360.source_not_null_web_transactions_id.88a47bf7e5 (compile): 23:52:48.757356 => 23:52:48.765018
[0m23:52:48.765758 [debug] [Thread-3 (]: Began executing node test.customer360.source_not_null_web_transactions_id.88a47bf7e5
[0m23:52:48.768428 [debug] [Thread-3 (]: Writing runtime sql for node "test.customer360.source_not_null_web_transactions_id.88a47bf7e5"
[0m23:52:48.768857 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.0 seconds
[0m23:52:48.770921 [debug] [Thread-1 (]: Timing info for test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247 (execute): 23:52:48.738709 => 23:52:48.770674
[0m23:52:48.769164 [debug] [Thread-2 (]: SQL status: SELECT 1 in 0.0 seconds
[0m23:52:48.771469 [debug] [Thread-3 (]: Using postgres connection "test.customer360.source_not_null_web_transactions_id.88a47bf7e5"
[0m23:52:48.771824 [debug] [Thread-1 (]: On test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247: ROLLBACK
[0m23:52:48.773105 [debug] [Thread-2 (]: Timing info for test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d (execute): 23:52:48.750841 => 23:52:48.772904
[0m23:52:48.773974 [debug] [Thread-2 (]: On test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d: ROLLBACK
[0m23:52:48.773511 [debug] [Thread-3 (]: On test.customer360.source_not_null_web_transactions_id.88a47bf7e5: BEGIN
[0m23:52:48.774405 [debug] [Thread-1 (]: On test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247: Close
[0m23:52:48.774802 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m23:52:48.775938 [debug] [Thread-2 (]: On test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d: Close
[0m23:52:48.777570 [info ] [Thread-2 (]: 5 of 9 PASS source_not_null_salesforce_contacts_id ............................. [[32mPASS[0m in 0.03s]
[0m23:52:48.778074 [debug] [Thread-2 (]: Finished running node test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d
[0m23:52:48.778535 [debug] [Thread-2 (]: Began running node test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344
[0m23:52:48.775593 [info ] [Thread-1 (]: 4 of 9 PASS source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors  [[32mPASS[0m in 0.05s]
[0m23:52:48.779025 [info ] [Thread-2 (]: 7 of 9 START test source_relationships_web_transactions_contact_id__id__ref_contacts_  [RUN]
[0m23:52:48.782239 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d, now test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344)
[0m23:52:48.782689 [debug] [Thread-2 (]: Began compiling node test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344
[0m23:52:48.781333 [debug] [Thread-1 (]: Finished running node test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247
[0m23:52:48.788830 [debug] [Thread-1 (]: Began running node test.customer360.source_unique_salesforce_contacts_id.01cadaaf43
[0m23:52:48.792063 [info ] [Thread-1 (]: 8 of 9 START test source_unique_salesforce_contacts_id ......................... [RUN]
[0m23:52:48.791652 [debug] [Thread-2 (]: Writing injected SQL for node "test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344"
[0m23:52:48.792676 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247, now test.customer360.source_unique_salesforce_contacts_id.01cadaaf43)
[0m23:52:48.793203 [debug] [Thread-1 (]: Began compiling node test.customer360.source_unique_salesforce_contacts_id.01cadaaf43
[0m23:52:48.789379 [debug] [Thread-3 (]: SQL status: BEGIN in 0.0 seconds
[0m23:52:48.798852 [debug] [Thread-1 (]: Writing injected SQL for node "test.customer360.source_unique_salesforce_contacts_id.01cadaaf43"
[0m23:52:48.799276 [debug] [Thread-3 (]: Using postgres connection "test.customer360.source_not_null_web_transactions_id.88a47bf7e5"
[0m23:52:48.800823 [debug] [Thread-3 (]: On test.customer360.source_not_null_web_transactions_id.88a47bf7e5: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.source_not_null_web_transactions_id.88a47bf7e5"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select id
from "dbt"."public"."transactions"
where id is null



      
    ) dbt_internal_test
[0m23:52:48.800432 [debug] [Thread-1 (]: Timing info for test.customer360.source_unique_salesforce_contacts_id.01cadaaf43 (compile): 23:52:48.793463 => 23:52:48.800180
[0m23:52:48.799907 [debug] [Thread-2 (]: Timing info for test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344 (compile): 23:52:48.782891 => 23:52:48.799634
[0m23:52:48.801713 [debug] [Thread-2 (]: Began executing node test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344
[0m23:52:48.804123 [debug] [Thread-2 (]: Writing runtime sql for node "test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344"
[0m23:52:48.801261 [debug] [Thread-1 (]: Began executing node test.customer360.source_unique_salesforce_contacts_id.01cadaaf43
[0m23:52:48.804542 [debug] [Thread-3 (]: SQL status: SELECT 1 in 0.0 seconds
[0m23:52:48.808230 [debug] [Thread-3 (]: Timing info for test.customer360.source_not_null_web_transactions_id.88a47bf7e5 (execute): 23:52:48.765954 => 23:52:48.808009
[0m23:52:48.806703 [debug] [Thread-1 (]: Writing runtime sql for node "test.customer360.source_unique_salesforce_contacts_id.01cadaaf43"
[0m23:52:48.808659 [debug] [Thread-2 (]: Using postgres connection "test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344"
[0m23:52:48.809484 [debug] [Thread-2 (]: On test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344: BEGIN
[0m23:52:48.809857 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m23:52:48.810472 [debug] [Thread-1 (]: Using postgres connection "test.customer360.source_unique_salesforce_contacts_id.01cadaaf43"
[0m23:52:48.812239 [debug] [Thread-1 (]: On test.customer360.source_unique_salesforce_contacts_id.01cadaaf43: BEGIN
[0m23:52:48.809005 [debug] [Thread-3 (]: On test.customer360.source_not_null_web_transactions_id.88a47bf7e5: ROLLBACK
[0m23:52:48.812664 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:52:48.814016 [debug] [Thread-3 (]: On test.customer360.source_not_null_web_transactions_id.88a47bf7e5: Close
[0m23:52:48.814873 [info ] [Thread-3 (]: 6 of 9 PASS source_not_null_web_transactions_id ................................ [[32mPASS[0m in 0.06s]
[0m23:52:48.815454 [debug] [Thread-3 (]: Finished running node test.customer360.source_not_null_web_transactions_id.88a47bf7e5
[0m23:52:48.816002 [debug] [Thread-3 (]: Began running node test.customer360.source_unique_web_transactions_id.ba28079761
[0m23:52:48.818024 [info ] [Thread-3 (]: 9 of 9 START test source_unique_web_transactions_id ............................ [RUN]
[0m23:52:48.818746 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.customer360.source_not_null_web_transactions_id.88a47bf7e5, now test.customer360.source_unique_web_transactions_id.ba28079761)
[0m23:52:48.819376 [debug] [Thread-3 (]: Began compiling node test.customer360.source_unique_web_transactions_id.ba28079761
[0m23:52:48.823612 [debug] [Thread-3 (]: Writing injected SQL for node "test.customer360.source_unique_web_transactions_id.ba28079761"
[0m23:52:48.823982 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m23:52:48.824309 [debug] [Thread-2 (]: SQL status: BEGIN in 0.0 seconds
[0m23:52:48.824759 [debug] [Thread-1 (]: Using postgres connection "test.customer360.source_unique_salesforce_contacts_id.01cadaaf43"
[0m23:52:48.825568 [debug] [Thread-1 (]: On test.customer360.source_unique_salesforce_contacts_id.01cadaaf43: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.source_unique_salesforce_contacts_id.01cadaaf43"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

select
    id as unique_field,
    count(*) as n_records

from "dbt"."public"."contacts"
where id is not null
group by id
having count(*) > 1



      
    ) dbt_internal_test
[0m23:52:48.825121 [debug] [Thread-2 (]: Using postgres connection "test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344"
[0m23:52:48.826110 [debug] [Thread-2 (]: On test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

with child as (
    select contact_id as from_field
    from "dbt"."public"."transactions"
    where contact_id is not null
),

parent as (
    select id as to_field
    from "dbt"."public"."contacts"
)

select
    from_field

from child
left join parent
    on child.from_field = parent.to_field

where parent.to_field is null



      
    ) dbt_internal_test
[0m23:52:48.826887 [debug] [Thread-3 (]: Timing info for test.customer360.source_unique_web_transactions_id.ba28079761 (compile): 23:52:48.819611 => 23:52:48.826590
[0m23:52:48.827361 [debug] [Thread-3 (]: Began executing node test.customer360.source_unique_web_transactions_id.ba28079761
[0m23:52:48.831608 [debug] [Thread-3 (]: Writing runtime sql for node "test.customer360.source_unique_web_transactions_id.ba28079761"
[0m23:52:48.832019 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.0 seconds
[0m23:52:48.832418 [debug] [Thread-2 (]: SQL status: SELECT 1 in 0.0 seconds
[0m23:52:48.835142 [debug] [Thread-2 (]: Timing info for test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344 (execute): 23:52:48.801998 => 23:52:48.834936
[0m23:52:48.833850 [debug] [Thread-1 (]: Timing info for test.customer360.source_unique_salesforce_contacts_id.01cadaaf43 (execute): 23:52:48.804884 => 23:52:48.833647
[0m23:52:48.835524 [debug] [Thread-3 (]: Using postgres connection "test.customer360.source_unique_web_transactions_id.ba28079761"
[0m23:52:48.835916 [debug] [Thread-2 (]: On test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344: ROLLBACK
[0m23:52:48.836276 [debug] [Thread-1 (]: On test.customer360.source_unique_salesforce_contacts_id.01cadaaf43: ROLLBACK
[0m23:52:48.836678 [debug] [Thread-3 (]: On test.customer360.source_unique_web_transactions_id.ba28079761: BEGIN
[0m23:52:48.837160 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m23:52:48.837583 [debug] [Thread-1 (]: On test.customer360.source_unique_salesforce_contacts_id.01cadaaf43: Close
[0m23:52:48.838880 [info ] [Thread-1 (]: 8 of 9 PASS source_unique_salesforce_contacts_id ............................... [[32mPASS[0m in 0.05s]
[0m23:52:48.838060 [debug] [Thread-2 (]: On test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344: Close
[0m23:52:48.840377 [info ] [Thread-2 (]: 7 of 9 PASS source_relationships_web_transactions_contact_id__id__ref_contacts_  [[32mPASS[0m in 0.06s]
[0m23:52:48.839434 [debug] [Thread-1 (]: Finished running node test.customer360.source_unique_salesforce_contacts_id.01cadaaf43
[0m23:52:48.841077 [debug] [Thread-2 (]: Finished running node test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344
[0m23:52:48.844132 [debug] [Thread-3 (]: SQL status: BEGIN in 0.0 seconds
[0m23:52:48.844525 [debug] [Thread-3 (]: Using postgres connection "test.customer360.source_unique_web_transactions_id.ba28079761"
[0m23:52:48.844931 [debug] [Thread-3 (]: On test.customer360.source_unique_web_transactions_id.ba28079761: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.source_unique_web_transactions_id.ba28079761"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

select
    id as unique_field,
    count(*) as n_records

from "dbt"."public"."transactions"
where id is not null
group by id
having count(*) > 1



      
    ) dbt_internal_test
[0m23:52:48.846409 [debug] [Thread-3 (]: SQL status: SELECT 1 in 0.0 seconds
[0m23:52:48.847732 [debug] [Thread-3 (]: Timing info for test.customer360.source_unique_web_transactions_id.ba28079761 (execute): 23:52:48.827597 => 23:52:48.847529
[0m23:52:48.848066 [debug] [Thread-3 (]: On test.customer360.source_unique_web_transactions_id.ba28079761: ROLLBACK
[0m23:52:48.848556 [debug] [Thread-3 (]: On test.customer360.source_unique_web_transactions_id.ba28079761: Close
[0m23:52:48.849489 [info ] [Thread-3 (]: 9 of 9 PASS source_unique_web_transactions_id .................................. [[32mPASS[0m in 0.03s]
[0m23:52:48.850242 [debug] [Thread-3 (]: Finished running node test.customer360.source_unique_web_transactions_id.ba28079761
[0m23:52:48.851672 [debug] [MainThread]: Using postgres connection "master"
[0m23:52:48.851964 [debug] [MainThread]: On master: BEGIN
[0m23:52:48.852217 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m23:52:48.855314 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m23:52:48.855604 [debug] [MainThread]: On master: COMMIT
[0m23:52:48.855859 [debug] [MainThread]: Using postgres connection "master"
[0m23:52:48.856125 [debug] [MainThread]: On master: COMMIT
[0m23:52:48.856555 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m23:52:48.856826 [debug] [MainThread]: On master: Close
[0m23:52:48.857411 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:52:48.857807 [debug] [MainThread]: Connection 'test.customer360.source_unique_salesforce_contacts_id.01cadaaf43' was properly closed.
[0m23:52:48.858063 [debug] [MainThread]: Connection 'test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344' was properly closed.
[0m23:52:48.858337 [debug] [MainThread]: Connection 'test.customer360.source_unique_web_transactions_id.ba28079761' was properly closed.
[0m23:52:48.858687 [info ] [MainThread]: 
[0m23:52:48.858977 [info ] [MainThread]: Finished running 9 tests in 0 hours 0 minutes and 0.26 seconds (0.26s).
[0m23:52:48.860965 [debug] [MainThread]: Command end result
[0m23:52:48.867652 [info ] [MainThread]: 
[0m23:52:48.868003 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m23:52:48.868314 [info ] [MainThread]: 
[0m23:52:48.868605 [error] [MainThread]:   Database Error in test macro_test1 (tests/macro_test1.sql)
  function age(date, integer) does not exist
  LINE 9:     date_part('year', age(current_date, 2023-02-12))
                                ^
  HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
  compiled Code at target/run/customer360/tests/macro_test1.sql
[0m23:52:48.868938 [info ] [MainThread]: 
[0m23:52:48.869250 [info ] [MainThread]: Done. PASS=8 WARN=0 ERROR=1 SKIP=0 TOTAL=9
[0m23:52:48.869972 [debug] [MainThread]: Resource report: {"command_name": "test", "command_wall_clock_time": 0.72098726, "process_user_time": 2.26478, "process_kernel_time": 0.093073, "process_mem_max_rss": "112196", "process_out_blocks": "2744", "command_success": false, "process_in_blocks": "0"}
[0m23:52:48.870444 [debug] [MainThread]: Command `dbt test` failed at 23:52:48.870326 after 0.72 seconds
[0m23:52:48.870780 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f142eb5fc50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f142e54a850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1432ff8a50>]}
[0m23:52:48.871128 [debug] [MainThread]: Flushing usage events
[0m23:52:56.892273 [debug] [MainThread]: Error sending anonymous usage statistics. Disabling tracking for this execution. If you wish to permanently disable tracking, see: https://docs.getdbt.com/reference/global-configs#send-anonymous-usage-stats.
[0m23:55:12.158445 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f51478bb9d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5147706f90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f51478b8d50>]}


============================== 23:55:12.160873 | 81ca52a9-e065-44e2-a457-ddce171270d7 ==============================
[0m23:55:12.160873 [info ] [MainThread]: Running with dbt=1.7.8
[0m23:55:12.161434 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/root/option1-customer360/integration_tests', 'version_check': 'True', 'warn_error': 'None', 'log_path': '/root/option1-customer360/integration_tests/logs', 'debug': 'False', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt test', 'static_parser': 'True', 'log_format': 'default', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m23:55:12.301096 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '81ca52a9-e065-44e2-a457-ddce171270d7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f51459972d0>]}
[0m23:55:12.375980 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '81ca52a9-e065-44e2-a457-ddce171270d7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f514597ba90>]}
[0m23:55:12.376682 [info ] [MainThread]: Registered adapter: postgres=1.7.8
[0m23:55:12.387600 [debug] [MainThread]: checksum: 67f0013ca5f0bd43af9a0873dd50792fde83ef69de63b71cacd0b4ac656c52e5, vars: {}, profile: , target: , version: 1.7.8
[0m23:55:12.408355 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m23:55:12.408871 [debug] [MainThread]: Partial parsing: updated file: customer360://tests/macro_test1.sql
[0m23:55:12.499336 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '81ca52a9-e065-44e2-a457-ddce171270d7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f51472ee7d0>]}
[0m23:55:12.507631 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '81ca52a9-e065-44e2-a457-ddce171270d7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f51458189d0>]}
[0m23:55:12.508055 [info ] [MainThread]: Found 2 seeds, 4 models, 9 tests, 2 sources, 0 exposures, 0 metrics, 403 macros, 0 groups, 0 semantic models
[0m23:55:12.508404 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '81ca52a9-e065-44e2-a457-ddce171270d7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f514587f550>]}
[0m23:55:12.510213 [info ] [MainThread]: 
[0m23:55:12.510927 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m23:55:12.512140 [debug] [ThreadPool]: Acquiring new postgres connection 'list_dbt_public'
[0m23:55:12.577676 [debug] [ThreadPool]: Using postgres connection "list_dbt_public"
[0m23:55:12.578078 [debug] [ThreadPool]: On list_dbt_public: BEGIN
[0m23:55:12.578365 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:55:12.582446 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m23:55:12.582741 [debug] [ThreadPool]: Using postgres connection "list_dbt_public"
[0m23:55:12.583021 [debug] [ThreadPool]: On list_dbt_public: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "connection_name": "list_dbt_public"} */
select
      'dbt' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'dbt' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'dbt' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m23:55:12.585801 [debug] [ThreadPool]: SQL status: SELECT 6 in 0.0 seconds
[0m23:55:12.587052 [debug] [ThreadPool]: On list_dbt_public: ROLLBACK
[0m23:55:12.587526 [debug] [ThreadPool]: On list_dbt_public: Close
[0m23:55:12.593372 [debug] [MainThread]: Using postgres connection "master"
[0m23:55:12.593672 [debug] [MainThread]: On master: BEGIN
[0m23:55:12.593922 [debug] [MainThread]: Opening a new connection, currently in state init
[0m23:55:12.597056 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m23:55:12.597377 [debug] [MainThread]: Using postgres connection "master"
[0m23:55:12.597731 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m23:55:12.607545 [debug] [MainThread]: SQL status: SELECT 2 in 0.0 seconds
[0m23:55:12.609114 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '81ca52a9-e065-44e2-a457-ddce171270d7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f51482d1c10>]}
[0m23:55:12.609544 [debug] [MainThread]: On master: ROLLBACK
[0m23:55:12.610024 [debug] [MainThread]: Using postgres connection "master"
[0m23:55:12.610318 [debug] [MainThread]: On master: BEGIN
[0m23:55:12.610953 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m23:55:12.611229 [debug] [MainThread]: On master: COMMIT
[0m23:55:12.611519 [debug] [MainThread]: Using postgres connection "master"
[0m23:55:12.611786 [debug] [MainThread]: On master: COMMIT
[0m23:55:12.612226 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m23:55:12.612531 [debug] [MainThread]: On master: Close
[0m23:55:12.613164 [info ] [MainThread]: Concurrency: 3 threads (target='local')
[0m23:55:12.613566 [info ] [MainThread]: 
[0m23:55:12.616174 [debug] [Thread-1 (]: Began running node test.customer360.macro_test1
[0m23:55:12.616584 [debug] [Thread-2 (]: Began running node test.customer360.macro_test2
[0m23:55:12.616989 [debug] [Thread-3 (]: Began running node test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311
[0m23:55:12.617358 [info ] [Thread-1 (]: 1 of 9 START test macro_test1 .................................................. [RUN]
[0m23:55:12.617788 [info ] [Thread-2 (]: 2 of 9 START test macro_test2 .................................................. [RUN]
[0m23:55:12.618234 [info ] [Thread-3 (]: 3 of 9 START test not_null_contacts_joined_with_transactions_id ................ [RUN]
[0m23:55:12.618922 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dbt_public, now test.customer360.macro_test1)
[0m23:55:12.619589 [debug] [Thread-2 (]: Acquiring new postgres connection 'test.customer360.macro_test2'
[0m23:55:12.620266 [debug] [Thread-3 (]: Acquiring new postgres connection 'test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311'
[0m23:55:12.620651 [debug] [Thread-1 (]: Began compiling node test.customer360.macro_test1
[0m23:55:12.621011 [debug] [Thread-2 (]: Began compiling node test.customer360.macro_test2
[0m23:55:12.621378 [debug] [Thread-3 (]: Began compiling node test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311
[0m23:55:12.627899 [debug] [Thread-1 (]: Writing injected SQL for node "test.customer360.macro_test1"
[0m23:55:12.630754 [debug] [Thread-2 (]: Writing injected SQL for node "test.customer360.macro_test2"
[0m23:55:12.641460 [debug] [Thread-3 (]: Writing injected SQL for node "test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311"
[0m23:55:12.642167 [debug] [Thread-2 (]: Timing info for test.customer360.macro_test2 (compile): 23:55:12.628136 => 23:55:12.641887
[0m23:55:12.642692 [debug] [Thread-1 (]: Timing info for test.customer360.macro_test1 (compile): 23:55:12.621614 => 23:55:12.642480
[0m23:55:12.643635 [debug] [Thread-1 (]: Began executing node test.customer360.macro_test1
[0m23:55:12.643137 [debug] [Thread-2 (]: Began executing node test.customer360.macro_test2
[0m23:55:12.644065 [debug] [Thread-3 (]: Timing info for test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311 (compile): 23:55:12.631014 => 23:55:12.643865
[0m23:55:12.657039 [debug] [Thread-1 (]: Writing runtime sql for node "test.customer360.macro_test1"
[0m23:55:12.659050 [debug] [Thread-2 (]: Writing runtime sql for node "test.customer360.macro_test2"
[0m23:55:12.659441 [debug] [Thread-3 (]: Began executing node test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311
[0m23:55:12.661668 [debug] [Thread-3 (]: Writing runtime sql for node "test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311"
[0m23:55:12.662164 [debug] [Thread-3 (]: Using postgres connection "test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311"
[0m23:55:12.662990 [debug] [Thread-3 (]: On test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311: BEGIN
[0m23:55:12.662587 [debug] [Thread-1 (]: Using postgres connection "test.customer360.macro_test1"
[0m23:55:12.663384 [debug] [Thread-2 (]: Using postgres connection "test.customer360.macro_test2"
[0m23:55:12.663726 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m23:55:12.664069 [debug] [Thread-1 (]: On test.customer360.macro_test1: BEGIN
[0m23:55:12.664943 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:55:12.664423 [debug] [Thread-2 (]: On test.customer360.macro_test2: BEGIN
[0m23:55:12.665892 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m23:55:12.670823 [debug] [Thread-3 (]: SQL status: BEGIN in 0.0 seconds
[0m23:55:12.671189 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m23:55:12.671593 [debug] [Thread-2 (]: SQL status: BEGIN in 0.0 seconds
[0m23:55:12.671932 [debug] [Thread-3 (]: Using postgres connection "test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311"
[0m23:55:12.672280 [debug] [Thread-1 (]: Using postgres connection "test.customer360.macro_test1"
[0m23:55:12.672657 [debug] [Thread-2 (]: Using postgres connection "test.customer360.macro_test2"
[0m23:55:12.673029 [debug] [Thread-3 (]: On test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select id
from "dbt"."public"."contacts_joined_with_transactions"
where id is null



      
    ) dbt_internal_test
[0m23:55:12.673425 [debug] [Thread-1 (]: On test.customer360.macro_test1: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.macro_test1"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      with marco_result as (
    select 
    date_part('year', age(current_date, '2023-02-12'))
 as expect_result
)
select
    1
from marco_result
where expect_result <> '1'
      
    ) dbt_internal_test
[0m23:55:12.673816 [debug] [Thread-2 (]: On test.customer360.macro_test2: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.macro_test2"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      with marco_result as (
    select 
    to_timestamp('2023-02-27 21:00:00','YYYY-MM-DD HH24:MI:SS.MS') :: timestamp at TIME zone 'UTC'
 as expect_result
)
select
    1
from marco_result
where cast(pg_typeof(expect_result) as text) not like '%timestamp%'
      
    ) dbt_internal_test
[0m23:55:12.675232 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.0 seconds
[0m23:55:12.677529 [debug] [Thread-1 (]: Timing info for test.customer360.macro_test1 (execute): 23:55:12.644279 => 23:55:12.677267
[0m23:55:12.677918 [debug] [Thread-2 (]: SQL status: SELECT 1 in 0.0 seconds
[0m23:55:12.678277 [debug] [Thread-1 (]: On test.customer360.macro_test1: ROLLBACK
[0m23:55:12.679583 [debug] [Thread-2 (]: Timing info for test.customer360.macro_test2 (execute): 23:55:12.657271 => 23:55:12.679384
[0m23:55:12.680418 [debug] [Thread-2 (]: On test.customer360.macro_test2: ROLLBACK
[0m23:55:12.679923 [debug] [Thread-3 (]: SQL status: SELECT 1 in 0.0 seconds
[0m23:55:12.680830 [debug] [Thread-1 (]: On test.customer360.macro_test1: Close
[0m23:55:12.682167 [debug] [Thread-3 (]: Timing info for test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311 (execute): 23:55:12.659887 => 23:55:12.681952
[0m23:55:12.684577 [debug] [Thread-3 (]: On test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311: ROLLBACK
[0m23:55:12.682565 [debug] [Thread-2 (]: On test.customer360.macro_test2: Close
[0m23:55:12.685785 [info ] [Thread-2 (]: 2 of 9 PASS macro_test2 ........................................................ [[32mPASS[0m in 0.07s]
[0m23:55:12.686634 [debug] [Thread-2 (]: Finished running node test.customer360.macro_test2
[0m23:55:12.683354 [info ] [Thread-1 (]: 1 of 9 PASS macro_test1 ........................................................ [[32mPASS[0m in 0.06s]
[0m23:55:12.687100 [debug] [Thread-3 (]: On test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311: Close
[0m23:55:12.687647 [debug] [Thread-2 (]: Began running node test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247
[0m23:55:12.688366 [debug] [Thread-1 (]: Finished running node test.customer360.macro_test1
[0m23:55:12.689321 [info ] [Thread-3 (]: 3 of 9 PASS not_null_contacts_joined_with_transactions_id ...................... [[32mPASS[0m in 0.07s]
[0m23:55:12.690557 [debug] [Thread-1 (]: Began running node test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d
[0m23:55:12.690131 [info ] [Thread-2 (]: 4 of 9 START test source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors  [RUN]
[0m23:55:12.691153 [debug] [Thread-3 (]: Finished running node test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311
[0m23:55:12.691615 [info ] [Thread-1 (]: 5 of 9 START test source_not_null_salesforce_contacts_id ....................... [RUN]
[0m23:55:12.693359 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.customer360.macro_test1, now test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d)
[0m23:55:12.692746 [debug] [Thread-3 (]: Began running node test.customer360.source_not_null_web_transactions_id.88a47bf7e5
[0m23:55:12.692323 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.customer360.macro_test2, now test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247)
[0m23:55:12.693765 [debug] [Thread-1 (]: Began compiling node test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d
[0m23:55:12.694137 [info ] [Thread-3 (]: 6 of 9 START test source_not_null_web_transactions_id .......................... [RUN]
[0m23:55:12.694618 [debug] [Thread-2 (]: Began compiling node test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247
[0m23:55:12.698860 [debug] [Thread-1 (]: Writing injected SQL for node "test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d"
[0m23:55:12.699523 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311, now test.customer360.source_not_null_web_transactions_id.88a47bf7e5)
[0m23:55:12.709548 [debug] [Thread-3 (]: Began compiling node test.customer360.source_not_null_web_transactions_id.88a47bf7e5
[0m23:55:12.709068 [debug] [Thread-2 (]: Writing injected SQL for node "test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247"
[0m23:55:12.714953 [debug] [Thread-2 (]: Timing info for test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247 (compile): 23:55:12.699768 => 23:55:12.714666
[0m23:55:12.714236 [debug] [Thread-3 (]: Writing injected SQL for node "test.customer360.source_not_null_web_transactions_id.88a47bf7e5"
[0m23:55:12.715365 [debug] [Thread-2 (]: Began executing node test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247
[0m23:55:12.718069 [debug] [Thread-2 (]: Writing runtime sql for node "test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247"
[0m23:55:12.718605 [debug] [Thread-2 (]: Using postgres connection "test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247"
[0m23:55:12.715776 [debug] [Thread-1 (]: Timing info for test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d (compile): 23:55:12.694858 => 23:55:12.715564
[0m23:55:12.719118 [debug] [Thread-3 (]: Timing info for test.customer360.source_not_null_web_transactions_id.88a47bf7e5 (compile): 23:55:12.709781 => 23:55:12.718849
[0m23:55:12.719471 [debug] [Thread-2 (]: On test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247: BEGIN
[0m23:55:12.719876 [debug] [Thread-1 (]: Began executing node test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d
[0m23:55:12.720251 [debug] [Thread-3 (]: Began executing node test.customer360.source_not_null_web_transactions_id.88a47bf7e5
[0m23:55:12.720643 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m23:55:12.722594 [debug] [Thread-1 (]: Writing runtime sql for node "test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d"
[0m23:55:12.725257 [debug] [Thread-1 (]: Using postgres connection "test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d"
[0m23:55:12.725764 [debug] [Thread-1 (]: On test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d: BEGIN
[0m23:55:12.726169 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:55:12.724534 [debug] [Thread-3 (]: Writing runtime sql for node "test.customer360.source_not_null_web_transactions_id.88a47bf7e5"
[0m23:55:12.727112 [debug] [Thread-3 (]: Using postgres connection "test.customer360.source_not_null_web_transactions_id.88a47bf7e5"
[0m23:55:12.727454 [debug] [Thread-3 (]: On test.customer360.source_not_null_web_transactions_id.88a47bf7e5: BEGIN
[0m23:55:12.727748 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m23:55:12.732767 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m23:55:12.733158 [debug] [Thread-2 (]: SQL status: BEGIN in 0.0 seconds
[0m23:55:12.733473 [debug] [Thread-3 (]: SQL status: BEGIN in 0.0 seconds
[0m23:55:12.733801 [debug] [Thread-1 (]: Using postgres connection "test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d"
[0m23:55:12.734180 [debug] [Thread-2 (]: Using postgres connection "test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247"
[0m23:55:12.734570 [debug] [Thread-3 (]: Using postgres connection "test.customer360.source_not_null_web_transactions_id.88a47bf7e5"
[0m23:55:12.734932 [debug] [Thread-1 (]: On test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select id
from "dbt"."public"."contacts"
where id is null



      
    ) dbt_internal_test
[0m23:55:12.735390 [debug] [Thread-2 (]: On test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

with all_values as (

    select
        category as value_field,
        count(*) as n_records

    from "dbt"."public"."transactions"
    group by category

)

select *
from all_values
where value_field not in (
    'Apps & Games','Beauty','Books','Clothing, Shoes & Accessories','Movies & TV','Sports, Fitness & Outdoors'
)



      
    ) dbt_internal_test
[0m23:55:12.735795 [debug] [Thread-3 (]: On test.customer360.source_not_null_web_transactions_id.88a47bf7e5: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.source_not_null_web_transactions_id.88a47bf7e5"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select id
from "dbt"."public"."transactions"
where id is null



      
    ) dbt_internal_test
[0m23:55:12.737834 [debug] [Thread-2 (]: SQL status: SELECT 1 in 0.0 seconds
[0m23:55:12.738199 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.0 seconds
[0m23:55:12.738562 [debug] [Thread-3 (]: SQL status: SELECT 1 in 0.0 seconds
[0m23:55:12.740074 [debug] [Thread-2 (]: Timing info for test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247 (execute): 23:55:12.716237 => 23:55:12.739846
[0m23:55:12.741315 [debug] [Thread-1 (]: Timing info for test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d (execute): 23:55:12.720882 => 23:55:12.741096
[0m23:55:12.742524 [debug] [Thread-3 (]: Timing info for test.customer360.source_not_null_web_transactions_id.88a47bf7e5 (execute): 23:55:12.722841 => 23:55:12.742323
[0m23:55:12.742912 [debug] [Thread-2 (]: On test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247: ROLLBACK
[0m23:55:12.743289 [debug] [Thread-1 (]: On test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d: ROLLBACK
[0m23:55:12.743680 [debug] [Thread-3 (]: On test.customer360.source_not_null_web_transactions_id.88a47bf7e5: ROLLBACK
[0m23:55:12.744267 [debug] [Thread-2 (]: On test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247: Close
[0m23:55:12.745027 [info ] [Thread-2 (]: 4 of 9 PASS source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors  [[32mPASS[0m in 0.05s]
[0m23:55:12.745582 [debug] [Thread-2 (]: Finished running node test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247
[0m23:55:12.745972 [debug] [Thread-2 (]: Began running node test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344
[0m23:55:12.746450 [debug] [Thread-3 (]: On test.customer360.source_not_null_web_transactions_id.88a47bf7e5: Close
[0m23:55:12.747572 [debug] [Thread-1 (]: On test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d: Close
[0m23:55:12.749670 [info ] [Thread-1 (]: 5 of 9 PASS source_not_null_salesforce_contacts_id ............................. [[32mPASS[0m in 0.06s]
[0m23:55:12.750354 [debug] [Thread-1 (]: Finished running node test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d
[0m23:55:12.750876 [debug] [Thread-1 (]: Began running node test.customer360.source_unique_salesforce_contacts_id.01cadaaf43
[0m23:55:12.751352 [info ] [Thread-1 (]: 8 of 9 START test source_unique_salesforce_contacts_id ......................... [RUN]
[0m23:55:12.748823 [info ] [Thread-3 (]: 6 of 9 PASS source_not_null_web_transactions_id ................................ [[32mPASS[0m in 0.05s]
[0m23:55:12.748060 [info ] [Thread-2 (]: 7 of 9 START test source_relationships_web_transactions_contact_id__id__ref_contacts_  [RUN]
[0m23:55:12.752115 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d, now test.customer360.source_unique_salesforce_contacts_id.01cadaaf43)
[0m23:55:12.752791 [debug] [Thread-3 (]: Finished running node test.customer360.source_not_null_web_transactions_id.88a47bf7e5
[0m23:55:12.753389 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247, now test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344)
[0m23:55:12.753766 [debug] [Thread-1 (]: Began compiling node test.customer360.source_unique_salesforce_contacts_id.01cadaaf43
[0m23:55:12.754176 [debug] [Thread-3 (]: Began running node test.customer360.source_unique_web_transactions_id.ba28079761
[0m23:55:12.754629 [debug] [Thread-2 (]: Began compiling node test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344
[0m23:55:12.760670 [debug] [Thread-1 (]: Writing injected SQL for node "test.customer360.source_unique_salesforce_contacts_id.01cadaaf43"
[0m23:55:12.761077 [info ] [Thread-3 (]: 9 of 9 START test source_unique_web_transactions_id ............................ [RUN]
[0m23:55:12.768288 [debug] [Thread-2 (]: Writing injected SQL for node "test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344"
[0m23:55:12.769027 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.customer360.source_not_null_web_transactions_id.88a47bf7e5, now test.customer360.source_unique_web_transactions_id.ba28079761)
[0m23:55:12.769548 [debug] [Thread-3 (]: Began compiling node test.customer360.source_unique_web_transactions_id.ba28079761
[0m23:55:12.770059 [debug] [Thread-2 (]: Timing info for test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344 (compile): 23:55:12.761398 => 23:55:12.769845
[0m23:55:12.770534 [debug] [Thread-1 (]: Timing info for test.customer360.source_unique_salesforce_contacts_id.01cadaaf43 (compile): 23:55:12.754886 => 23:55:12.770262
[0m23:55:12.774019 [debug] [Thread-3 (]: Writing injected SQL for node "test.customer360.source_unique_web_transactions_id.ba28079761"
[0m23:55:12.774422 [debug] [Thread-2 (]: Began executing node test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344
[0m23:55:12.776922 [debug] [Thread-2 (]: Writing runtime sql for node "test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344"
[0m23:55:12.774797 [debug] [Thread-1 (]: Began executing node test.customer360.source_unique_salesforce_contacts_id.01cadaaf43
[0m23:55:12.780497 [debug] [Thread-1 (]: Writing runtime sql for node "test.customer360.source_unique_salesforce_contacts_id.01cadaaf43"
[0m23:55:12.781127 [debug] [Thread-3 (]: Timing info for test.customer360.source_unique_web_transactions_id.ba28079761 (compile): 23:55:12.770791 => 23:55:12.780860
[0m23:55:12.782012 [debug] [Thread-3 (]: Began executing node test.customer360.source_unique_web_transactions_id.ba28079761
[0m23:55:12.781594 [debug] [Thread-2 (]: Using postgres connection "test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344"
[0m23:55:12.784009 [debug] [Thread-3 (]: Writing runtime sql for node "test.customer360.source_unique_web_transactions_id.ba28079761"
[0m23:55:12.784376 [debug] [Thread-1 (]: Using postgres connection "test.customer360.source_unique_salesforce_contacts_id.01cadaaf43"
[0m23:55:12.785189 [debug] [Thread-1 (]: On test.customer360.source_unique_salesforce_contacts_id.01cadaaf43: BEGIN
[0m23:55:12.785551 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:55:12.784747 [debug] [Thread-2 (]: On test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344: BEGIN
[0m23:55:12.786624 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m23:55:12.786144 [debug] [Thread-3 (]: Using postgres connection "test.customer360.source_unique_web_transactions_id.ba28079761"
[0m23:55:12.787402 [debug] [Thread-3 (]: On test.customer360.source_unique_web_transactions_id.ba28079761: BEGIN
[0m23:55:12.787706 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m23:55:12.792831 [debug] [Thread-2 (]: SQL status: BEGIN in 0.0 seconds
[0m23:55:12.793199 [debug] [Thread-2 (]: Using postgres connection "test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344"
[0m23:55:12.793583 [debug] [Thread-2 (]: On test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

with child as (
    select contact_id as from_field
    from "dbt"."public"."transactions"
    where contact_id is not null
),

parent as (
    select id as to_field
    from "dbt"."public"."contacts"
)

select
    from_field

from child
left join parent
    on child.from_field = parent.to_field

where parent.to_field is null



      
    ) dbt_internal_test
[0m23:55:12.793988 [debug] [Thread-3 (]: SQL status: BEGIN in 0.0 seconds
[0m23:55:12.794466 [debug] [Thread-3 (]: Using postgres connection "test.customer360.source_unique_web_transactions_id.ba28079761"
[0m23:55:12.794803 [debug] [Thread-3 (]: On test.customer360.source_unique_web_transactions_id.ba28079761: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.source_unique_web_transactions_id.ba28079761"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

select
    id as unique_field,
    count(*) as n_records

from "dbt"."public"."transactions"
where id is not null
group by id
having count(*) > 1



      
    ) dbt_internal_test
[0m23:55:12.795231 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m23:55:12.795710 [debug] [Thread-1 (]: Using postgres connection "test.customer360.source_unique_salesforce_contacts_id.01cadaaf43"
[0m23:55:12.796193 [debug] [Thread-1 (]: On test.customer360.source_unique_salesforce_contacts_id.01cadaaf43: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.source_unique_salesforce_contacts_id.01cadaaf43"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

select
    id as unique_field,
    count(*) as n_records

from "dbt"."public"."contacts"
where id is not null
group by id
having count(*) > 1



      
    ) dbt_internal_test
[0m23:55:12.796810 [debug] [Thread-3 (]: SQL status: SELECT 1 in 0.0 seconds
[0m23:55:12.798766 [debug] [Thread-3 (]: Timing info for test.customer360.source_unique_web_transactions_id.ba28079761 (execute): 23:55:12.782250 => 23:55:12.798490
[0m23:55:12.799100 [debug] [Thread-3 (]: On test.customer360.source_unique_web_transactions_id.ba28079761: ROLLBACK
[0m23:55:12.799528 [debug] [Thread-2 (]: SQL status: SELECT 1 in 0.0 seconds
[0m23:55:12.800798 [debug] [Thread-2 (]: Timing info for test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344 (execute): 23:55:12.775111 => 23:55:12.800587
[0m23:55:12.801150 [debug] [Thread-3 (]: On test.customer360.source_unique_web_transactions_id.ba28079761: Close
[0m23:55:12.801538 [debug] [Thread-2 (]: On test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344: ROLLBACK
[0m23:55:12.801874 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.0 seconds
[0m23:55:12.804569 [debug] [Thread-1 (]: Timing info for test.customer360.source_unique_salesforce_contacts_id.01cadaaf43 (execute): 23:55:12.777273 => 23:55:12.804216
[0m23:55:12.805269 [debug] [Thread-1 (]: On test.customer360.source_unique_salesforce_contacts_id.01cadaaf43: ROLLBACK
[0m23:55:12.804916 [debug] [Thread-2 (]: On test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344: Close
[0m23:55:12.802880 [info ] [Thread-3 (]: 9 of 9 PASS source_unique_web_transactions_id .................................. [[32mPASS[0m in 0.03s]
[0m23:55:12.805995 [debug] [Thread-3 (]: Finished running node test.customer360.source_unique_web_transactions_id.ba28079761
[0m23:55:12.807001 [info ] [Thread-2 (]: 7 of 9 PASS source_relationships_web_transactions_contact_id__id__ref_contacts_  [[32mPASS[0m in 0.05s]
[0m23:55:12.807647 [debug] [Thread-2 (]: Finished running node test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344
[0m23:55:12.808002 [debug] [Thread-1 (]: On test.customer360.source_unique_salesforce_contacts_id.01cadaaf43: Close
[0m23:55:12.808808 [info ] [Thread-1 (]: 8 of 9 PASS source_unique_salesforce_contacts_id ............................... [[32mPASS[0m in 0.06s]
[0m23:55:12.809283 [debug] [Thread-1 (]: Finished running node test.customer360.source_unique_salesforce_contacts_id.01cadaaf43
[0m23:55:12.811873 [debug] [MainThread]: Using postgres connection "master"
[0m23:55:12.812226 [debug] [MainThread]: On master: BEGIN
[0m23:55:12.812566 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m23:55:12.815667 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m23:55:12.815961 [debug] [MainThread]: On master: COMMIT
[0m23:55:12.816219 [debug] [MainThread]: Using postgres connection "master"
[0m23:55:12.816506 [debug] [MainThread]: On master: COMMIT
[0m23:55:12.816937 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m23:55:12.817239 [debug] [MainThread]: On master: Close
[0m23:55:12.817901 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:55:12.818166 [debug] [MainThread]: Connection 'test.customer360.source_unique_salesforce_contacts_id.01cadaaf43' was properly closed.
[0m23:55:12.818464 [debug] [MainThread]: Connection 'test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344' was properly closed.
[0m23:55:12.818722 [debug] [MainThread]: Connection 'test.customer360.source_unique_web_transactions_id.ba28079761' was properly closed.
[0m23:55:12.819056 [info ] [MainThread]: 
[0m23:55:12.819379 [info ] [MainThread]: Finished running 9 tests in 0 hours 0 minutes and 0.31 seconds (0.31s).
[0m23:55:12.821219 [debug] [MainThread]: Command end result
[0m23:55:12.829400 [info ] [MainThread]: 
[0m23:55:12.829775 [info ] [MainThread]: [32mCompleted successfully[0m
[0m23:55:12.830080 [info ] [MainThread]: 
[0m23:55:12.830422 [info ] [MainThread]: Done. PASS=9 WARN=0 ERROR=0 SKIP=0 TOTAL=9
[0m23:55:12.831104 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": true, "command_wall_clock_time": 0.70857894, "process_user_time": 2.307462, "process_kernel_time": 0.111602, "process_mem_max_rss": "111488", "process_out_blocks": "2744", "process_in_blocks": "0"}
[0m23:55:12.831593 [debug] [MainThread]: Command `dbt test` succeeded at 23:55:12.831479 after 0.71 seconds
[0m23:55:12.831931 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f514bc10150>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f514791fd50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f514bd64c90>]}
[0m23:55:12.832280 [debug] [MainThread]: Flushing usage events
[0m23:55:18.525420 [debug] [MainThread]: Error sending anonymous usage statistics. Disabling tracking for this execution. If you wish to permanently disable tracking, see: https://docs.getdbt.com/reference/global-configs#send-anonymous-usage-stats.
[0m23:55:37.397601 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4ed2a4aad0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4ed2683290>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4ed23f82d0>]}


============================== 23:55:37.400670 | 2db94549-515a-43a7-bc76-c330780bd3ea ==============================
[0m23:55:37.400670 [info ] [MainThread]: Running with dbt=1.7.8
[0m23:55:37.401146 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/root/option1-customer360/integration_tests', 'version_check': 'True', 'debug': 'False', 'log_path': '/root/option1-customer360/integration_tests/logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': 'dbt test', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m23:55:37.554182 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '2db94549-515a-43a7-bc76-c330780bd3ea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4ed29df2d0>]}
[0m23:55:37.628993 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '2db94549-515a-43a7-bc76-c330780bd3ea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4ed23d7090>]}
[0m23:55:37.629695 [info ] [MainThread]: Registered adapter: postgres=1.7.8
[0m23:55:37.640966 [debug] [MainThread]: checksum: 67f0013ca5f0bd43af9a0873dd50792fde83ef69de63b71cacd0b4ac656c52e5, vars: {}, profile: , target: , version: 1.7.8
[0m23:55:37.661664 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m23:55:37.662192 [debug] [MainThread]: Partial parsing: updated file: customer360://tests/macro_test1.sql
[0m23:55:37.751564 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '2db94549-515a-43a7-bc76-c330780bd3ea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4ed0684cd0>]}
[0m23:55:37.760743 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '2db94549-515a-43a7-bc76-c330780bd3ea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4ed072c8d0>]}
[0m23:55:37.761354 [info ] [MainThread]: Found 2 seeds, 4 models, 9 tests, 2 sources, 0 exposures, 0 metrics, 403 macros, 0 groups, 0 semantic models
[0m23:55:37.761714 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2db94549-515a-43a7-bc76-c330780bd3ea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4ed225fad0>]}
[0m23:55:37.763721 [info ] [MainThread]: 
[0m23:55:37.764411 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m23:55:37.765606 [debug] [ThreadPool]: Acquiring new postgres connection 'list_dbt_public'
[0m23:55:37.831963 [debug] [ThreadPool]: Using postgres connection "list_dbt_public"
[0m23:55:37.832373 [debug] [ThreadPool]: On list_dbt_public: BEGIN
[0m23:55:37.832645 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:55:37.836727 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m23:55:37.837018 [debug] [ThreadPool]: Using postgres connection "list_dbt_public"
[0m23:55:37.837357 [debug] [ThreadPool]: On list_dbt_public: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "connection_name": "list_dbt_public"} */
select
      'dbt' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'dbt' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'dbt' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m23:55:37.840097 [debug] [ThreadPool]: SQL status: SELECT 6 in 0.0 seconds
[0m23:55:37.841518 [debug] [ThreadPool]: On list_dbt_public: ROLLBACK
[0m23:55:37.842005 [debug] [ThreadPool]: On list_dbt_public: Close
[0m23:55:37.847673 [debug] [MainThread]: Using postgres connection "master"
[0m23:55:37.847971 [debug] [MainThread]: On master: BEGIN
[0m23:55:37.848227 [debug] [MainThread]: Opening a new connection, currently in state init
[0m23:55:37.851248 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m23:55:37.851554 [debug] [MainThread]: Using postgres connection "master"
[0m23:55:37.851912 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m23:55:37.862032 [debug] [MainThread]: SQL status: SELECT 2 in 0.0 seconds
[0m23:55:37.863618 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2db94549-515a-43a7-bc76-c330780bd3ea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4ed29cb910>]}
[0m23:55:37.864016 [debug] [MainThread]: On master: ROLLBACK
[0m23:55:37.864527 [debug] [MainThread]: Using postgres connection "master"
[0m23:55:37.864807 [debug] [MainThread]: On master: BEGIN
[0m23:55:37.865472 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m23:55:37.865747 [debug] [MainThread]: On master: COMMIT
[0m23:55:37.866019 [debug] [MainThread]: Using postgres connection "master"
[0m23:55:37.866271 [debug] [MainThread]: On master: COMMIT
[0m23:55:37.866731 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m23:55:37.867024 [debug] [MainThread]: On master: Close
[0m23:55:37.867796 [info ] [MainThread]: Concurrency: 3 threads (target='local')
[0m23:55:37.868190 [info ] [MainThread]: 
[0m23:55:37.870542 [debug] [Thread-1 (]: Began running node test.customer360.macro_test1
[0m23:55:37.870922 [debug] [Thread-2 (]: Began running node test.customer360.macro_test2
[0m23:55:37.871348 [debug] [Thread-3 (]: Began running node test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311
[0m23:55:37.871702 [info ] [Thread-1 (]: 1 of 9 START test macro_test1 .................................................. [RUN]
[0m23:55:37.872457 [info ] [Thread-2 (]: 2 of 9 START test macro_test2 .................................................. [RUN]
[0m23:55:37.872909 [info ] [Thread-3 (]: 3 of 9 START test not_null_contacts_joined_with_transactions_id ................ [RUN]
[0m23:55:37.873631 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dbt_public, now test.customer360.macro_test1)
[0m23:55:37.874343 [debug] [Thread-2 (]: Acquiring new postgres connection 'test.customer360.macro_test2'
[0m23:55:37.874994 [debug] [Thread-3 (]: Acquiring new postgres connection 'test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311'
[0m23:55:37.875392 [debug] [Thread-1 (]: Began compiling node test.customer360.macro_test1
[0m23:55:37.875743 [debug] [Thread-2 (]: Began compiling node test.customer360.macro_test2
[0m23:55:37.876111 [debug] [Thread-3 (]: Began compiling node test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311
[0m23:55:37.882633 [debug] [Thread-1 (]: Writing injected SQL for node "test.customer360.macro_test1"
[0m23:55:37.885431 [debug] [Thread-2 (]: Writing injected SQL for node "test.customer360.macro_test2"
[0m23:55:37.896496 [debug] [Thread-2 (]: Timing info for test.customer360.macro_test2 (compile): 23:55:37.882855 => 23:55:37.896192
[0m23:55:37.896965 [debug] [Thread-1 (]: Timing info for test.customer360.macro_test1 (compile): 23:55:37.876360 => 23:55:37.896755
[0m23:55:37.897174 [debug] [Thread-3 (]: Writing injected SQL for node "test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311"
[0m23:55:37.897559 [debug] [Thread-2 (]: Began executing node test.customer360.macro_test2
[0m23:55:37.897917 [debug] [Thread-1 (]: Began executing node test.customer360.macro_test1
[0m23:55:37.921249 [debug] [Thread-1 (]: Writing runtime sql for node "test.customer360.macro_test1"
[0m23:55:37.922509 [debug] [Thread-2 (]: Writing runtime sql for node "test.customer360.macro_test2"
[0m23:55:37.922953 [debug] [Thread-3 (]: Timing info for test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311 (compile): 23:55:37.885681 => 23:55:37.922721
[0m23:55:37.923580 [debug] [Thread-1 (]: Using postgres connection "test.customer360.macro_test1"
[0m23:55:37.923994 [debug] [Thread-2 (]: Using postgres connection "test.customer360.macro_test2"
[0m23:55:37.924422 [debug] [Thread-3 (]: Began executing node test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311
[0m23:55:37.924771 [debug] [Thread-1 (]: On test.customer360.macro_test1: BEGIN
[0m23:55:37.925130 [debug] [Thread-2 (]: On test.customer360.macro_test2: BEGIN
[0m23:55:37.927289 [debug] [Thread-3 (]: Writing runtime sql for node "test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311"
[0m23:55:37.927689 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:55:37.928048 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m23:55:37.928748 [debug] [Thread-3 (]: Using postgres connection "test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311"
[0m23:55:37.929431 [debug] [Thread-3 (]: On test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311: BEGIN
[0m23:55:37.929887 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m23:55:37.934910 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m23:55:37.935314 [debug] [Thread-1 (]: Using postgres connection "test.customer360.macro_test1"
[0m23:55:37.935663 [debug] [Thread-1 (]: On test.customer360.macro_test1: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.macro_test1"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      with marco_result as (
    select 
    date_part('year', age(current_date, '2023-02-12'))
 as expect_result
)
select
    1
from marco_result
where expect_result = '1'
      
    ) dbt_internal_test
[0m23:55:37.936062 [debug] [Thread-3 (]: SQL status: BEGIN in 0.0 seconds
[0m23:55:37.936415 [debug] [Thread-3 (]: Using postgres connection "test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311"
[0m23:55:37.936738 [debug] [Thread-3 (]: On test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select id
from "dbt"."public"."contacts_joined_with_transactions"
where id is null



      
    ) dbt_internal_test
[0m23:55:37.937156 [debug] [Thread-2 (]: SQL status: BEGIN in 0.0 seconds
[0m23:55:37.937615 [debug] [Thread-2 (]: Using postgres connection "test.customer360.macro_test2"
[0m23:55:37.938093 [debug] [Thread-2 (]: On test.customer360.macro_test2: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.macro_test2"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      with marco_result as (
    select 
    to_timestamp('2023-02-27 21:00:00','YYYY-MM-DD HH24:MI:SS.MS') :: timestamp at TIME zone 'UTC'
 as expect_result
)
select
    1
from marco_result
where cast(pg_typeof(expect_result) as text) not like '%timestamp%'
      
    ) dbt_internal_test
[0m23:55:37.939385 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.0 seconds
[0m23:55:37.939742 [debug] [Thread-3 (]: SQL status: SELECT 1 in 0.0 seconds
[0m23:55:37.940079 [debug] [Thread-2 (]: SQL status: SELECT 1 in 0.0 seconds
[0m23:55:37.941926 [debug] [Thread-1 (]: Timing info for test.customer360.macro_test1 (execute): 23:55:37.903384 => 23:55:37.941710
[0m23:55:37.943161 [debug] [Thread-3 (]: Timing info for test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311 (execute): 23:55:37.925369 => 23:55:37.942958
[0m23:55:37.944432 [debug] [Thread-2 (]: Timing info for test.customer360.macro_test2 (execute): 23:55:37.898233 => 23:55:37.944187
[0m23:55:37.944804 [debug] [Thread-1 (]: On test.customer360.macro_test1: ROLLBACK
[0m23:55:37.945168 [debug] [Thread-3 (]: On test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311: ROLLBACK
[0m23:55:37.945565 [debug] [Thread-2 (]: On test.customer360.macro_test2: ROLLBACK
[0m23:55:37.946125 [debug] [Thread-1 (]: On test.customer360.macro_test1: Close
[0m23:55:37.946530 [debug] [Thread-3 (]: On test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311: Close
[0m23:55:37.947857 [info ] [Thread-3 (]: 3 of 9 PASS not_null_contacts_joined_with_transactions_id ...................... [[32mPASS[0m in 0.07s]
[0m23:55:37.948629 [debug] [Thread-3 (]: Finished running node test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311
[0m23:55:37.949066 [debug] [Thread-3 (]: Began running node test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247
[0m23:55:37.949591 [info ] [Thread-3 (]: 4 of 9 START test source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors  [RUN]
[0m23:55:37.950559 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311, now test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247)
[0m23:55:37.951023 [debug] [Thread-3 (]: Began compiling node test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247
[0m23:55:37.946832 [debug] [Thread-2 (]: On test.customer360.macro_test2: Close
[0m23:55:37.958900 [error] [Thread-1 (]: 1 of 9 FAIL 1 macro_test1 ...................................................... [[31mFAIL 1[0m in 0.09s]
[0m23:55:37.962542 [debug] [Thread-1 (]: Finished running node test.customer360.macro_test1
[0m23:55:37.963055 [debug] [Thread-1 (]: Began running node test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d
[0m23:55:37.963526 [info ] [Thread-1 (]: 5 of 9 START test source_not_null_salesforce_contacts_id ....................... [RUN]
[0m23:55:37.964189 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.customer360.macro_test1, now test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d)
[0m23:55:37.965417 [debug] [Thread-1 (]: Began compiling node test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d
[0m23:55:37.964914 [info ] [Thread-2 (]: 2 of 9 PASS macro_test2 ........................................................ [[32mPASS[0m in 0.09s]
[0m23:55:37.961857 [debug] [Thread-3 (]: Writing injected SQL for node "test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247"
[0m23:55:37.969236 [debug] [Thread-1 (]: Writing injected SQL for node "test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d"
[0m23:55:37.969800 [debug] [Thread-2 (]: Finished running node test.customer360.macro_test2
[0m23:55:37.970390 [debug] [Thread-2 (]: Began running node test.customer360.source_not_null_web_transactions_id.88a47bf7e5
[0m23:55:37.971404 [info ] [Thread-2 (]: 6 of 9 START test source_not_null_web_transactions_id .......................... [RUN]
[0m23:55:37.972066 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.customer360.macro_test2, now test.customer360.source_not_null_web_transactions_id.88a47bf7e5)
[0m23:55:37.971036 [debug] [Thread-3 (]: Timing info for test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247 (compile): 23:55:37.951240 => 23:55:37.970714
[0m23:55:37.972511 [debug] [Thread-1 (]: Timing info for test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d (compile): 23:55:37.965636 => 23:55:37.972312
[0m23:55:37.972832 [debug] [Thread-2 (]: Began compiling node test.customer360.source_not_null_web_transactions_id.88a47bf7e5
[0m23:55:37.973215 [debug] [Thread-3 (]: Began executing node test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247
[0m23:55:37.973611 [debug] [Thread-1 (]: Began executing node test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d
[0m23:55:37.978483 [debug] [Thread-2 (]: Writing injected SQL for node "test.customer360.source_not_null_web_transactions_id.88a47bf7e5"
[0m23:55:37.980568 [debug] [Thread-3 (]: Writing runtime sql for node "test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247"
[0m23:55:37.982741 [debug] [Thread-1 (]: Writing runtime sql for node "test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d"
[0m23:55:37.983457 [debug] [Thread-3 (]: Using postgres connection "test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247"
[0m23:55:37.984402 [debug] [Thread-3 (]: On test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247: BEGIN
[0m23:55:37.984759 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m23:55:37.985363 [debug] [Thread-1 (]: Using postgres connection "test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d"
[0m23:55:37.983935 [debug] [Thread-2 (]: Timing info for test.customer360.source_not_null_web_transactions_id.88a47bf7e5 (compile): 23:55:37.973840 => 23:55:37.983736
[0m23:55:37.986242 [debug] [Thread-2 (]: Began executing node test.customer360.source_not_null_web_transactions_id.88a47bf7e5
[0m23:55:37.988520 [debug] [Thread-2 (]: Writing runtime sql for node "test.customer360.source_not_null_web_transactions_id.88a47bf7e5"
[0m23:55:37.988994 [debug] [Thread-2 (]: Using postgres connection "test.customer360.source_not_null_web_transactions_id.88a47bf7e5"
[0m23:55:37.989359 [debug] [Thread-2 (]: On test.customer360.source_not_null_web_transactions_id.88a47bf7e5: BEGIN
[0m23:55:37.989815 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m23:55:37.985835 [debug] [Thread-1 (]: On test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d: BEGIN
[0m23:55:37.990763 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:55:37.993533 [debug] [Thread-3 (]: SQL status: BEGIN in 0.0 seconds
[0m23:55:37.994038 [debug] [Thread-3 (]: Using postgres connection "test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247"
[0m23:55:37.994644 [debug] [Thread-3 (]: On test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

with all_values as (

    select
        category as value_field,
        count(*) as n_records

    from "dbt"."public"."transactions"
    group by category

)

select *
from all_values
where value_field not in (
    'Apps & Games','Beauty','Books','Clothing, Shoes & Accessories','Movies & TV','Sports, Fitness & Outdoors'
)



      
    ) dbt_internal_test
[0m23:55:37.996496 [debug] [Thread-3 (]: SQL status: SELECT 1 in 0.0 seconds
[0m23:55:37.998105 [debug] [Thread-3 (]: Timing info for test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247 (execute): 23:55:37.978738 => 23:55:37.997880
[0m23:55:37.998496 [debug] [Thread-3 (]: On test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247: ROLLBACK
[0m23:55:37.998917 [debug] [Thread-2 (]: SQL status: BEGIN in 0.0 seconds
[0m23:55:37.999319 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m23:55:38.000105 [debug] [Thread-1 (]: Using postgres connection "test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d"
[0m23:55:38.000479 [debug] [Thread-1 (]: On test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select id
from "dbt"."public"."contacts"
where id is null



      
    ) dbt_internal_test
[0m23:55:37.999732 [debug] [Thread-2 (]: Using postgres connection "test.customer360.source_not_null_web_transactions_id.88a47bf7e5"
[0m23:55:38.000892 [debug] [Thread-2 (]: On test.customer360.source_not_null_web_transactions_id.88a47bf7e5: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.source_not_null_web_transactions_id.88a47bf7e5"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select id
from "dbt"."public"."transactions"
where id is null



      
    ) dbt_internal_test
[0m23:55:38.002197 [debug] [Thread-2 (]: SQL status: SELECT 1 in 0.0 seconds
[0m23:55:38.002636 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.0 seconds
[0m23:55:38.002971 [debug] [Thread-3 (]: On test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247: Close
[0m23:55:38.004200 [debug] [Thread-2 (]: Timing info for test.customer360.source_not_null_web_transactions_id.88a47bf7e5 (execute): 23:55:37.986541 => 23:55:38.004001
[0m23:55:38.006035 [debug] [Thread-2 (]: On test.customer360.source_not_null_web_transactions_id.88a47bf7e5: ROLLBACK
[0m23:55:38.005636 [debug] [Thread-1 (]: Timing info for test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d (execute): 23:55:37.980819 => 23:55:38.005347
[0m23:55:38.006985 [info ] [Thread-3 (]: 4 of 9 PASS source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors  [[32mPASS[0m in 0.06s]
[0m23:55:38.008186 [debug] [Thread-2 (]: On test.customer360.source_not_null_web_transactions_id.88a47bf7e5: Close
[0m23:55:38.008571 [debug] [Thread-1 (]: On test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d: ROLLBACK
[0m23:55:38.009084 [debug] [Thread-3 (]: Finished running node test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247
[0m23:55:38.010439 [debug] [Thread-3 (]: Began running node test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344
[0m23:55:38.010955 [info ] [Thread-3 (]: 7 of 9 START test source_relationships_web_transactions_contact_id__id__ref_contacts_  [RUN]
[0m23:55:38.011698 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247, now test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344)
[0m23:55:38.012196 [debug] [Thread-3 (]: Began compiling node test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344
[0m23:55:38.009823 [info ] [Thread-2 (]: 6 of 9 PASS source_not_null_web_transactions_id ................................ [[32mPASS[0m in 0.04s]
[0m23:55:38.012622 [debug] [Thread-1 (]: On test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d: Close
[0m23:55:38.020354 [debug] [Thread-3 (]: Writing injected SQL for node "test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344"
[0m23:55:38.020922 [debug] [Thread-2 (]: Finished running node test.customer360.source_not_null_web_transactions_id.88a47bf7e5
[0m23:55:38.021918 [info ] [Thread-1 (]: 5 of 9 PASS source_not_null_salesforce_contacts_id ............................. [[32mPASS[0m in 0.06s]
[0m23:55:38.022601 [debug] [Thread-3 (]: Timing info for test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344 (compile): 23:55:38.012991 => 23:55:38.022342
[0m23:55:38.023396 [debug] [Thread-2 (]: Began running node test.customer360.source_unique_salesforce_contacts_id.01cadaaf43
[0m23:55:38.023979 [debug] [Thread-1 (]: Finished running node test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d
[0m23:55:38.024364 [debug] [Thread-3 (]: Began executing node test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344
[0m23:55:38.024742 [info ] [Thread-2 (]: 8 of 9 START test source_unique_salesforce_contacts_id ......................... [RUN]
[0m23:55:38.025206 [debug] [Thread-1 (]: Began running node test.customer360.source_unique_web_transactions_id.ba28079761
[0m23:55:38.028633 [info ] [Thread-1 (]: 9 of 9 START test source_unique_web_transactions_id ............................ [RUN]
[0m23:55:38.029225 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d, now test.customer360.source_unique_web_transactions_id.ba28079761)
[0m23:55:38.027528 [debug] [Thread-3 (]: Writing runtime sql for node "test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344"
[0m23:55:38.028128 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.customer360.source_not_null_web_transactions_id.88a47bf7e5, now test.customer360.source_unique_salesforce_contacts_id.01cadaaf43)
[0m23:55:38.030231 [debug] [Thread-2 (]: Began compiling node test.customer360.source_unique_salesforce_contacts_id.01cadaaf43
[0m23:55:38.029594 [debug] [Thread-1 (]: Began compiling node test.customer360.source_unique_web_transactions_id.ba28079761
[0m23:55:38.035849 [debug] [Thread-2 (]: Writing injected SQL for node "test.customer360.source_unique_salesforce_contacts_id.01cadaaf43"
[0m23:55:38.039379 [debug] [Thread-1 (]: Writing injected SQL for node "test.customer360.source_unique_web_transactions_id.ba28079761"
[0m23:55:38.039857 [debug] [Thread-3 (]: Using postgres connection "test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344"
[0m23:55:38.040574 [debug] [Thread-1 (]: Timing info for test.customer360.source_unique_web_transactions_id.ba28079761 (compile): 23:55:38.036160 => 23:55:38.040313
[0m23:55:38.040973 [debug] [Thread-2 (]: Timing info for test.customer360.source_unique_salesforce_contacts_id.01cadaaf43 (compile): 23:55:38.030490 => 23:55:38.040768
[0m23:55:38.041356 [debug] [Thread-3 (]: On test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344: BEGIN
[0m23:55:38.041721 [debug] [Thread-1 (]: Began executing node test.customer360.source_unique_web_transactions_id.ba28079761
[0m23:55:38.042106 [debug] [Thread-2 (]: Began executing node test.customer360.source_unique_salesforce_contacts_id.01cadaaf43
[0m23:55:38.042479 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m23:55:38.044717 [debug] [Thread-1 (]: Writing runtime sql for node "test.customer360.source_unique_web_transactions_id.ba28079761"
[0m23:55:38.047411 [debug] [Thread-1 (]: Using postgres connection "test.customer360.source_unique_web_transactions_id.ba28079761"
[0m23:55:38.047872 [debug] [Thread-1 (]: On test.customer360.source_unique_web_transactions_id.ba28079761: BEGIN
[0m23:55:38.048198 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:55:38.046713 [debug] [Thread-2 (]: Writing runtime sql for node "test.customer360.source_unique_salesforce_contacts_id.01cadaaf43"
[0m23:55:38.049223 [debug] [Thread-2 (]: Using postgres connection "test.customer360.source_unique_salesforce_contacts_id.01cadaaf43"
[0m23:55:38.049715 [debug] [Thread-2 (]: On test.customer360.source_unique_salesforce_contacts_id.01cadaaf43: BEGIN
[0m23:55:38.050145 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m23:55:38.053039 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m23:55:38.053532 [debug] [Thread-1 (]: Using postgres connection "test.customer360.source_unique_web_transactions_id.ba28079761"
[0m23:55:38.053985 [debug] [Thread-1 (]: On test.customer360.source_unique_web_transactions_id.ba28079761: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.source_unique_web_transactions_id.ba28079761"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

select
    id as unique_field,
    count(*) as n_records

from "dbt"."public"."transactions"
where id is not null
group by id
having count(*) > 1



      
    ) dbt_internal_test
[0m23:55:38.055829 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.0 seconds
[0m23:55:38.057256 [debug] [Thread-1 (]: Timing info for test.customer360.source_unique_web_transactions_id.ba28079761 (execute): 23:55:38.042728 => 23:55:38.057046
[0m23:55:38.057624 [debug] [Thread-1 (]: On test.customer360.source_unique_web_transactions_id.ba28079761: ROLLBACK
[0m23:55:38.058263 [debug] [Thread-2 (]: SQL status: BEGIN in 0.0 seconds
[0m23:55:38.058624 [debug] [Thread-2 (]: Using postgres connection "test.customer360.source_unique_salesforce_contacts_id.01cadaaf43"
[0m23:55:38.058946 [debug] [Thread-2 (]: On test.customer360.source_unique_salesforce_contacts_id.01cadaaf43: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.source_unique_salesforce_contacts_id.01cadaaf43"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

select
    id as unique_field,
    count(*) as n_records

from "dbt"."public"."contacts"
where id is not null
group by id
having count(*) > 1



      
    ) dbt_internal_test
[0m23:55:38.059381 [debug] [Thread-1 (]: On test.customer360.source_unique_web_transactions_id.ba28079761: Close
[0m23:55:38.060552 [info ] [Thread-1 (]: 9 of 9 PASS source_unique_web_transactions_id .................................. [[32mPASS[0m in 0.03s]
[0m23:55:38.061252 [debug] [Thread-1 (]: Finished running node test.customer360.source_unique_web_transactions_id.ba28079761
[0m23:55:38.062222 [debug] [Thread-2 (]: SQL status: SELECT 1 in 0.0 seconds
[0m23:55:38.063610 [debug] [Thread-2 (]: Timing info for test.customer360.source_unique_salesforce_contacts_id.01cadaaf43 (execute): 23:55:38.044961 => 23:55:38.063395
[0m23:55:38.063982 [debug] [Thread-3 (]: SQL status: BEGIN in 0.0 seconds
[0m23:55:38.064320 [debug] [Thread-2 (]: On test.customer360.source_unique_salesforce_contacts_id.01cadaaf43: ROLLBACK
[0m23:55:38.064710 [debug] [Thread-3 (]: Using postgres connection "test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344"
[0m23:55:38.065139 [debug] [Thread-3 (]: On test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

with child as (
    select contact_id as from_field
    from "dbt"."public"."transactions"
    where contact_id is not null
),

parent as (
    select id as to_field
    from "dbt"."public"."contacts"
)

select
    from_field

from child
left join parent
    on child.from_field = parent.to_field

where parent.to_field is null



      
    ) dbt_internal_test
[0m23:55:38.065626 [debug] [Thread-2 (]: On test.customer360.source_unique_salesforce_contacts_id.01cadaaf43: Close
[0m23:55:38.066288 [info ] [Thread-2 (]: 8 of 9 PASS source_unique_salesforce_contacts_id ............................... [[32mPASS[0m in 0.04s]
[0m23:55:38.066815 [debug] [Thread-2 (]: Finished running node test.customer360.source_unique_salesforce_contacts_id.01cadaaf43
[0m23:55:38.068261 [debug] [Thread-3 (]: SQL status: SELECT 1 in 0.0 seconds
[0m23:55:38.069863 [debug] [Thread-3 (]: Timing info for test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344 (execute): 23:55:38.025540 => 23:55:38.069635
[0m23:55:38.070193 [debug] [Thread-3 (]: On test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344: ROLLBACK
[0m23:55:38.070757 [debug] [Thread-3 (]: On test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344: Close
[0m23:55:38.071490 [info ] [Thread-3 (]: 7 of 9 PASS source_relationships_web_transactions_contact_id__id__ref_contacts_  [[32mPASS[0m in 0.06s]
[0m23:55:38.072001 [debug] [Thread-3 (]: Finished running node test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344
[0m23:55:38.073596 [debug] [MainThread]: Using postgres connection "master"
[0m23:55:38.073902 [debug] [MainThread]: On master: BEGIN
[0m23:55:38.074156 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m23:55:38.077672 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m23:55:38.078001 [debug] [MainThread]: On master: COMMIT
[0m23:55:38.078261 [debug] [MainThread]: Using postgres connection "master"
[0m23:55:38.078563 [debug] [MainThread]: On master: COMMIT
[0m23:55:38.079015 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m23:55:38.079318 [debug] [MainThread]: On master: Close
[0m23:55:38.079922 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:55:38.080181 [debug] [MainThread]: Connection 'test.customer360.source_unique_web_transactions_id.ba28079761' was properly closed.
[0m23:55:38.080481 [debug] [MainThread]: Connection 'test.customer360.source_unique_salesforce_contacts_id.01cadaaf43' was properly closed.
[0m23:55:38.080722 [debug] [MainThread]: Connection 'test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344' was properly closed.
[0m23:55:38.081028 [info ] [MainThread]: 
[0m23:55:38.081350 [info ] [MainThread]: Finished running 9 tests in 0 hours 0 minutes and 0.32 seconds (0.32s).
[0m23:55:38.083155 [debug] [MainThread]: Command end result
[0m23:55:38.091443 [info ] [MainThread]: 
[0m23:55:38.091835 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m23:55:38.092126 [info ] [MainThread]: 
[0m23:55:38.092475 [error] [MainThread]: [31mFailure in test macro_test1 (tests/macro_test1.sql)[0m
[0m23:55:38.092746 [error] [MainThread]:   Got 1 result, configured to fail if != 0
[0m23:55:38.092998 [info ] [MainThread]: 
[0m23:55:38.093269 [info ] [MainThread]:   compiled Code at target/compiled/customer360/tests/macro_test1.sql
[0m23:55:38.093580 [info ] [MainThread]: 
[0m23:55:38.093862 [info ] [MainThread]: Done. PASS=8 WARN=0 ERROR=1 SKIP=0 TOTAL=9
[0m23:55:38.094568 [debug] [MainThread]: Resource report: {"command_name": "test", "command_wall_clock_time": 0.7476534, "process_user_time": 2.249512, "process_kernel_time": 0.11992, "process_mem_max_rss": "111852", "process_out_blocks": "2736", "command_success": false, "process_in_blocks": "0"}
[0m23:55:38.095002 [debug] [MainThread]: Command `dbt test` failed at 23:55:38.094892 after 0.75 seconds
[0m23:55:38.095375 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4ed2667210>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4ed2ad7790>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4ed2a38c50>]}
[0m23:55:38.095720 [debug] [MainThread]: Flushing usage events
[0m23:56:01.989528 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f26edc979d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f26edc56910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f26edf7b2d0>]}


============================== 23:56:01.992036 | 423f7208-2693-4edd-b98a-dca7196f7307 ==============================
[0m23:56:01.992036 [info ] [MainThread]: Running with dbt=1.7.8
[0m23:56:01.992529 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'profiles_dir': '/root/option1-customer360/integration_tests', 'log_path': '/root/option1-customer360/integration_tests/logs', 'version_check': 'True', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'invocation_command': 'dbt test', 'static_parser': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m23:56:02.132161 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '423f7208-2693-4edd-b98a-dca7196f7307', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f26ee1fba90>]}
[0m23:56:02.207964 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '423f7208-2693-4edd-b98a-dca7196f7307', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f26edba2050>]}
[0m23:56:02.208638 [info ] [MainThread]: Registered adapter: postgres=1.7.8
[0m23:56:02.219620 [debug] [MainThread]: checksum: 67f0013ca5f0bd43af9a0873dd50792fde83ef69de63b71cacd0b4ac656c52e5, vars: {}, profile: , target: , version: 1.7.8
[0m23:56:02.240470 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m23:56:02.241018 [debug] [MainThread]: Partial parsing: updated file: customer360://tests/macro_test1.sql
[0m23:56:02.331558 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '423f7208-2693-4edd-b98a-dca7196f7307', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f26ebf12650>]}
[0m23:56:02.339937 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '423f7208-2693-4edd-b98a-dca7196f7307', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f26ebf24a90>]}
[0m23:56:02.340418 [info ] [MainThread]: Found 2 seeds, 4 models, 9 tests, 2 sources, 0 exposures, 0 metrics, 403 macros, 0 groups, 0 semantic models
[0m23:56:02.340753 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '423f7208-2693-4edd-b98a-dca7196f7307', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f26ec090b90>]}
[0m23:56:02.342720 [info ] [MainThread]: 
[0m23:56:02.343387 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m23:56:02.344605 [debug] [ThreadPool]: Acquiring new postgres connection 'list_dbt_public'
[0m23:56:02.409904 [debug] [ThreadPool]: Using postgres connection "list_dbt_public"
[0m23:56:02.410307 [debug] [ThreadPool]: On list_dbt_public: BEGIN
[0m23:56:02.410593 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:56:02.414703 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m23:56:02.414999 [debug] [ThreadPool]: Using postgres connection "list_dbt_public"
[0m23:56:02.415280 [debug] [ThreadPool]: On list_dbt_public: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "connection_name": "list_dbt_public"} */
select
      'dbt' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'dbt' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'dbt' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m23:56:02.418130 [debug] [ThreadPool]: SQL status: SELECT 6 in 0.0 seconds
[0m23:56:02.419423 [debug] [ThreadPool]: On list_dbt_public: ROLLBACK
[0m23:56:02.419879 [debug] [ThreadPool]: On list_dbt_public: Close
[0m23:56:02.425713 [debug] [MainThread]: Using postgres connection "master"
[0m23:56:02.426021 [debug] [MainThread]: On master: BEGIN
[0m23:56:02.426273 [debug] [MainThread]: Opening a new connection, currently in state init
[0m23:56:02.429387 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m23:56:02.429684 [debug] [MainThread]: Using postgres connection "master"
[0m23:56:02.430051 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m23:56:02.439716 [debug] [MainThread]: SQL status: SELECT 2 in 0.0 seconds
[0m23:56:02.441278 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '423f7208-2693-4edd-b98a-dca7196f7307', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f26edb9b8d0>]}
[0m23:56:02.441683 [debug] [MainThread]: On master: ROLLBACK
[0m23:56:02.442188 [debug] [MainThread]: Using postgres connection "master"
[0m23:56:02.442484 [debug] [MainThread]: On master: BEGIN
[0m23:56:02.443114 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m23:56:02.443431 [debug] [MainThread]: On master: COMMIT
[0m23:56:02.443690 [debug] [MainThread]: Using postgres connection "master"
[0m23:56:02.443943 [debug] [MainThread]: On master: COMMIT
[0m23:56:02.444394 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m23:56:02.444676 [debug] [MainThread]: On master: Close
[0m23:56:02.445326 [info ] [MainThread]: Concurrency: 3 threads (target='local')
[0m23:56:02.445747 [info ] [MainThread]: 
[0m23:56:02.448262 [debug] [Thread-1 (]: Began running node test.customer360.macro_test1
[0m23:56:02.448699 [debug] [Thread-2 (]: Began running node test.customer360.macro_test2
[0m23:56:02.449060 [info ] [Thread-1 (]: 1 of 9 START test macro_test1 .................................................. [RUN]
[0m23:56:02.449508 [info ] [Thread-2 (]: 2 of 9 START test macro_test2 .................................................. [RUN]
[0m23:56:02.449900 [debug] [Thread-3 (]: Began running node test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311
[0m23:56:02.450545 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dbt_public, now test.customer360.macro_test1)
[0m23:56:02.451208 [debug] [Thread-2 (]: Acquiring new postgres connection 'test.customer360.macro_test2'
[0m23:56:02.451706 [info ] [Thread-3 (]: 3 of 9 START test not_null_contacts_joined_with_transactions_id ................ [RUN]
[0m23:56:02.452111 [debug] [Thread-1 (]: Began compiling node test.customer360.macro_test1
[0m23:56:02.452503 [debug] [Thread-2 (]: Began compiling node test.customer360.macro_test2
[0m23:56:02.453160 [debug] [Thread-3 (]: Acquiring new postgres connection 'test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311'
[0m23:56:02.459561 [debug] [Thread-1 (]: Writing injected SQL for node "test.customer360.macro_test1"
[0m23:56:02.462399 [debug] [Thread-2 (]: Writing injected SQL for node "test.customer360.macro_test2"
[0m23:56:02.462782 [debug] [Thread-3 (]: Began compiling node test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311
[0m23:56:02.463490 [debug] [Thread-1 (]: Timing info for test.customer360.macro_test1 (compile): 23:56:02.453442 => 23:56:02.463202
[0m23:56:02.474069 [debug] [Thread-3 (]: Writing injected SQL for node "test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311"
[0m23:56:02.474609 [debug] [Thread-2 (]: Timing info for test.customer360.macro_test2 (compile): 23:56:02.459809 => 23:56:02.474379
[0m23:56:02.475465 [debug] [Thread-2 (]: Began executing node test.customer360.macro_test2
[0m23:56:02.474983 [debug] [Thread-1 (]: Began executing node test.customer360.macro_test1
[0m23:56:02.488737 [debug] [Thread-2 (]: Writing runtime sql for node "test.customer360.macro_test2"
[0m23:56:02.490776 [debug] [Thread-1 (]: Writing runtime sql for node "test.customer360.macro_test1"
[0m23:56:02.491207 [debug] [Thread-3 (]: Timing info for test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311 (compile): 23:56:02.463784 => 23:56:02.490996
[0m23:56:02.491869 [debug] [Thread-1 (]: Using postgres connection "test.customer360.macro_test1"
[0m23:56:02.492265 [debug] [Thread-2 (]: Using postgres connection "test.customer360.macro_test2"
[0m23:56:02.492677 [debug] [Thread-3 (]: Began executing node test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311
[0m23:56:02.493037 [debug] [Thread-1 (]: On test.customer360.macro_test1: BEGIN
[0m23:56:02.493397 [debug] [Thread-2 (]: On test.customer360.macro_test2: BEGIN
[0m23:56:02.495388 [debug] [Thread-3 (]: Writing runtime sql for node "test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311"
[0m23:56:02.495754 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:56:02.496107 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m23:56:02.496796 [debug] [Thread-3 (]: Using postgres connection "test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311"
[0m23:56:02.497918 [debug] [Thread-3 (]: On test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311: BEGIN
[0m23:56:02.498449 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m23:56:02.502691 [debug] [Thread-2 (]: SQL status: BEGIN in 0.0 seconds
[0m23:56:02.503177 [debug] [Thread-2 (]: Using postgres connection "test.customer360.macro_test2"
[0m23:56:02.503617 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m23:56:02.503944 [debug] [Thread-2 (]: On test.customer360.macro_test2: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.macro_test2"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      with marco_result as (
    select 
    to_timestamp('2023-02-27 21:00:00','YYYY-MM-DD HH24:MI:SS.MS') :: timestamp at TIME zone 'UTC'
 as expect_result
)
select
    1
from marco_result
where cast(pg_typeof(expect_result) as text) not like '%timestamp%'
      
    ) dbt_internal_test
[0m23:56:02.504390 [debug] [Thread-1 (]: Using postgres connection "test.customer360.macro_test1"
[0m23:56:02.504857 [debug] [Thread-1 (]: On test.customer360.macro_test1: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.macro_test1"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      with marco_result as (
    select 
    date_part('year', age(current_date, '2023-02-12'))
 as expect_result
)
select
    1
from marco_result
where expect_result <> 1
      
    ) dbt_internal_test
[0m23:56:02.506384 [debug] [Thread-2 (]: SQL status: SELECT 1 in 0.0 seconds
[0m23:56:02.506757 [debug] [Thread-3 (]: SQL status: BEGIN in 0.0 seconds
[0m23:56:02.508754 [debug] [Thread-2 (]: Timing info for test.customer360.macro_test2 (execute): 23:56:02.475723 => 23:56:02.508516
[0m23:56:02.509109 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.0 seconds
[0m23:56:02.509541 [debug] [Thread-3 (]: Using postgres connection "test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311"
[0m23:56:02.509924 [debug] [Thread-2 (]: On test.customer360.macro_test2: ROLLBACK
[0m23:56:02.511155 [debug] [Thread-1 (]: Timing info for test.customer360.macro_test1 (execute): 23:56:02.488990 => 23:56:02.510958
[0m23:56:02.512000 [debug] [Thread-1 (]: On test.customer360.macro_test1: ROLLBACK
[0m23:56:02.511581 [debug] [Thread-3 (]: On test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select id
from "dbt"."public"."contacts_joined_with_transactions"
where id is null



      
    ) dbt_internal_test
[0m23:56:02.513481 [debug] [Thread-1 (]: On test.customer360.macro_test1: Close
[0m23:56:02.513968 [debug] [Thread-3 (]: SQL status: SELECT 1 in 0.0 seconds
[0m23:56:02.516809 [debug] [Thread-3 (]: Timing info for test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311 (execute): 23:56:02.493625 => 23:56:02.516600
[0m23:56:02.515133 [debug] [Thread-2 (]: On test.customer360.macro_test2: Close
[0m23:56:02.518230 [info ] [Thread-2 (]: 2 of 9 PASS macro_test2 ........................................................ [[32mPASS[0m in 0.07s]
[0m23:56:02.514796 [info ] [Thread-1 (]: 1 of 9 PASS macro_test1 ........................................................ [[32mPASS[0m in 0.06s]
[0m23:56:02.518942 [debug] [Thread-2 (]: Finished running node test.customer360.macro_test2
[0m23:56:02.517190 [debug] [Thread-3 (]: On test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311: ROLLBACK
[0m23:56:02.519591 [debug] [Thread-1 (]: Finished running node test.customer360.macro_test1
[0m23:56:02.520615 [debug] [Thread-1 (]: Began running node test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d
[0m23:56:02.521048 [info ] [Thread-1 (]: 5 of 9 START test source_not_null_salesforce_contacts_id ....................... [RUN]
[0m23:56:02.521679 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.customer360.macro_test1, now test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d)
[0m23:56:02.522008 [debug] [Thread-1 (]: Began compiling node test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d
[0m23:56:02.520032 [debug] [Thread-2 (]: Began running node test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247
[0m23:56:02.525973 [debug] [Thread-1 (]: Writing injected SQL for node "test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d"
[0m23:56:02.526333 [debug] [Thread-3 (]: On test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311: Close
[0m23:56:02.526741 [info ] [Thread-2 (]: 4 of 9 START test source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors  [RUN]
[0m23:56:02.528581 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.customer360.macro_test2, now test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247)
[0m23:56:02.529028 [debug] [Thread-2 (]: Began compiling node test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247
[0m23:56:02.527811 [info ] [Thread-3 (]: 3 of 9 PASS not_null_contacts_joined_with_transactions_id ...................... [[32mPASS[0m in 0.07s]
[0m23:56:02.538689 [debug] [Thread-2 (]: Writing injected SQL for node "test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247"
[0m23:56:02.539136 [debug] [Thread-1 (]: Timing info for test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d (compile): 23:56:02.522204 => 23:56:02.538927
[0m23:56:02.540179 [debug] [Thread-1 (]: Began executing node test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d
[0m23:56:02.539695 [debug] [Thread-3 (]: Finished running node test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311
[0m23:56:02.543988 [debug] [Thread-3 (]: Began running node test.customer360.source_not_null_web_transactions_id.88a47bf7e5
[0m23:56:02.544476 [info ] [Thread-3 (]: 6 of 9 START test source_not_null_web_transactions_id .......................... [RUN]
[0m23:56:02.545698 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311, now test.customer360.source_not_null_web_transactions_id.88a47bf7e5)
[0m23:56:02.544961 [debug] [Thread-2 (]: Timing info for test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247 (compile): 23:56:02.529232 => 23:56:02.544729
[0m23:56:02.546050 [debug] [Thread-3 (]: Began compiling node test.customer360.source_not_null_web_transactions_id.88a47bf7e5
[0m23:56:02.550019 [debug] [Thread-3 (]: Writing injected SQL for node "test.customer360.source_not_null_web_transactions_id.88a47bf7e5"
[0m23:56:02.546427 [debug] [Thread-2 (]: Began executing node test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247
[0m23:56:02.543507 [debug] [Thread-1 (]: Writing runtime sql for node "test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d"
[0m23:56:02.552163 [debug] [Thread-2 (]: Writing runtime sql for node "test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247"
[0m23:56:02.552758 [debug] [Thread-3 (]: Timing info for test.customer360.source_not_null_web_transactions_id.88a47bf7e5 (compile): 23:56:02.546663 => 23:56:02.552495
[0m23:56:02.553379 [debug] [Thread-2 (]: Using postgres connection "test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247"
[0m23:56:02.553769 [debug] [Thread-1 (]: Using postgres connection "test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d"
[0m23:56:02.554123 [debug] [Thread-3 (]: Began executing node test.customer360.source_not_null_web_transactions_id.88a47bf7e5
[0m23:56:02.554507 [debug] [Thread-2 (]: On test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247: BEGIN
[0m23:56:02.554876 [debug] [Thread-1 (]: On test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d: BEGIN
[0m23:56:02.556846 [debug] [Thread-3 (]: Writing runtime sql for node "test.customer360.source_not_null_web_transactions_id.88a47bf7e5"
[0m23:56:02.557286 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m23:56:02.557661 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:56:02.558392 [debug] [Thread-3 (]: Using postgres connection "test.customer360.source_not_null_web_transactions_id.88a47bf7e5"
[0m23:56:02.559410 [debug] [Thread-3 (]: On test.customer360.source_not_null_web_transactions_id.88a47bf7e5: BEGIN
[0m23:56:02.559834 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m23:56:02.564413 [debug] [Thread-3 (]: SQL status: BEGIN in 0.0 seconds
[0m23:56:02.564804 [debug] [Thread-2 (]: SQL status: BEGIN in 0.0 seconds
[0m23:56:02.565616 [debug] [Thread-2 (]: Using postgres connection "test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247"
[0m23:56:02.565990 [debug] [Thread-2 (]: On test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

with all_values as (

    select
        category as value_field,
        count(*) as n_records

    from "dbt"."public"."transactions"
    group by category

)

select *
from all_values
where value_field not in (
    'Apps & Games','Beauty','Books','Clothing, Shoes & Accessories','Movies & TV','Sports, Fitness & Outdoors'
)



      
    ) dbt_internal_test
[0m23:56:02.565130 [debug] [Thread-3 (]: Using postgres connection "test.customer360.source_not_null_web_transactions_id.88a47bf7e5"
[0m23:56:02.566484 [debug] [Thread-3 (]: On test.customer360.source_not_null_web_transactions_id.88a47bf7e5: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.source_not_null_web_transactions_id.88a47bf7e5"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select id
from "dbt"."public"."transactions"
where id is null



      
    ) dbt_internal_test
[0m23:56:02.567849 [debug] [Thread-2 (]: SQL status: SELECT 1 in 0.0 seconds
[0m23:56:02.569497 [debug] [Thread-2 (]: Timing info for test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247 (execute): 23:56:02.550359 => 23:56:02.569197
[0m23:56:02.569849 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m23:56:02.570164 [debug] [Thread-3 (]: SQL status: SELECT 1 in 0.0 seconds
[0m23:56:02.570578 [debug] [Thread-2 (]: On test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247: ROLLBACK
[0m23:56:02.570949 [debug] [Thread-1 (]: Using postgres connection "test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d"
[0m23:56:02.572638 [debug] [Thread-1 (]: On test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select id
from "dbt"."public"."contacts"
where id is null



      
    ) dbt_internal_test
[0m23:56:02.572152 [debug] [Thread-3 (]: Timing info for test.customer360.source_not_null_web_transactions_id.88a47bf7e5 (execute): 23:56:02.555108 => 23:56:02.571955
[0m23:56:02.573068 [debug] [Thread-3 (]: On test.customer360.source_not_null_web_transactions_id.88a47bf7e5: ROLLBACK
[0m23:56:02.573675 [debug] [Thread-3 (]: On test.customer360.source_not_null_web_transactions_id.88a47bf7e5: Close
[0m23:56:02.574977 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.0 seconds
[0m23:56:02.576631 [debug] [Thread-1 (]: Timing info for test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d (execute): 23:56:02.540439 => 23:56:02.576239
[0m23:56:02.576953 [debug] [Thread-1 (]: On test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d: ROLLBACK
[0m23:56:02.577392 [debug] [Thread-2 (]: On test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247: Close
[0m23:56:02.574614 [info ] [Thread-3 (]: 6 of 9 PASS source_not_null_web_transactions_id ................................ [[32mPASS[0m in 0.03s]
[0m23:56:02.578922 [debug] [Thread-3 (]: Finished running node test.customer360.source_not_null_web_transactions_id.88a47bf7e5
[0m23:56:02.579461 [debug] [Thread-3 (]: Began running node test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344
[0m23:56:02.579987 [info ] [Thread-3 (]: 7 of 9 START test source_relationships_web_transactions_contact_id__id__ref_contacts_  [RUN]
[0m23:56:02.580713 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.customer360.source_not_null_web_transactions_id.88a47bf7e5, now test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344)
[0m23:56:02.578083 [info ] [Thread-2 (]: 4 of 9 PASS source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors  [[32mPASS[0m in 0.05s]
[0m23:56:02.581079 [debug] [Thread-1 (]: On test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d: Close
[0m23:56:02.581440 [debug] [Thread-3 (]: Began compiling node test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344
[0m23:56:02.581961 [debug] [Thread-2 (]: Finished running node test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247
[0m23:56:02.582836 [info ] [Thread-1 (]: 5 of 9 PASS source_not_null_salesforce_contacts_id ............................. [[32mPASS[0m in 0.06s]
[0m23:56:02.591023 [debug] [Thread-2 (]: Began running node test.customer360.source_unique_salesforce_contacts_id.01cadaaf43
[0m23:56:02.591519 [debug] [Thread-3 (]: Writing injected SQL for node "test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344"
[0m23:56:02.593391 [debug] [Thread-3 (]: Timing info for test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344 (compile): 23:56:02.583333 => 23:56:02.593113
[0m23:56:02.592685 [info ] [Thread-2 (]: 8 of 9 START test source_unique_salesforce_contacts_id ......................... [RUN]
[0m23:56:02.593738 [debug] [Thread-3 (]: Began executing node test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344
[0m23:56:02.592254 [debug] [Thread-1 (]: Finished running node test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d
[0m23:56:02.594374 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247, now test.customer360.source_unique_salesforce_contacts_id.01cadaaf43)
[0m23:56:02.596531 [debug] [Thread-3 (]: Writing runtime sql for node "test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344"
[0m23:56:02.596969 [debug] [Thread-1 (]: Began running node test.customer360.source_unique_web_transactions_id.ba28079761
[0m23:56:02.597886 [info ] [Thread-1 (]: 9 of 9 START test source_unique_web_transactions_id ............................ [RUN]
[0m23:56:02.597419 [debug] [Thread-2 (]: Began compiling node test.customer360.source_unique_salesforce_contacts_id.01cadaaf43
[0m23:56:02.598430 [debug] [Thread-3 (]: Using postgres connection "test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344"
[0m23:56:02.598996 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d, now test.customer360.source_unique_web_transactions_id.ba28079761)
[0m23:56:02.604541 [debug] [Thread-2 (]: Writing injected SQL for node "test.customer360.source_unique_salesforce_contacts_id.01cadaaf43"
[0m23:56:02.604904 [debug] [Thread-3 (]: On test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344: BEGIN
[0m23:56:02.605750 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m23:56:02.605290 [debug] [Thread-1 (]: Began compiling node test.customer360.source_unique_web_transactions_id.ba28079761
[0m23:56:02.610703 [debug] [Thread-1 (]: Writing injected SQL for node "test.customer360.source_unique_web_transactions_id.ba28079761"
[0m23:56:02.611272 [debug] [Thread-1 (]: Timing info for test.customer360.source_unique_web_transactions_id.ba28079761 (compile): 23:56:02.607066 => 23:56:02.611026
[0m23:56:02.611770 [debug] [Thread-1 (]: Began executing node test.customer360.source_unique_web_transactions_id.ba28079761
[0m23:56:02.606466 [debug] [Thread-2 (]: Timing info for test.customer360.source_unique_salesforce_contacts_id.01cadaaf43 (compile): 23:56:02.599237 => 23:56:02.606149
[0m23:56:02.614768 [debug] [Thread-2 (]: Began executing node test.customer360.source_unique_salesforce_contacts_id.01cadaaf43
[0m23:56:02.614220 [debug] [Thread-1 (]: Writing runtime sql for node "test.customer360.source_unique_web_transactions_id.ba28079761"
[0m23:56:02.615270 [debug] [Thread-3 (]: SQL status: BEGIN in 0.0 seconds
[0m23:56:02.617742 [debug] [Thread-3 (]: Using postgres connection "test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344"
[0m23:56:02.618130 [debug] [Thread-3 (]: On test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

with child as (
    select contact_id as from_field
    from "dbt"."public"."transactions"
    where contact_id is not null
),

parent as (
    select id as to_field
    from "dbt"."public"."contacts"
)

select
    from_field

from child
left join parent
    on child.from_field = parent.to_field

where parent.to_field is null



      
    ) dbt_internal_test
[0m23:56:02.617212 [debug] [Thread-2 (]: Writing runtime sql for node "test.customer360.source_unique_salesforce_contacts_id.01cadaaf43"
[0m23:56:02.619395 [debug] [Thread-2 (]: Using postgres connection "test.customer360.source_unique_salesforce_contacts_id.01cadaaf43"
[0m23:56:02.619865 [debug] [Thread-2 (]: On test.customer360.source_unique_salesforce_contacts_id.01cadaaf43: BEGIN
[0m23:56:02.618721 [debug] [Thread-1 (]: Using postgres connection "test.customer360.source_unique_web_transactions_id.ba28079761"
[0m23:56:02.620355 [debug] [Thread-3 (]: SQL status: SELECT 1 in 0.0 seconds
[0m23:56:02.620675 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m23:56:02.621025 [debug] [Thread-1 (]: On test.customer360.source_unique_web_transactions_id.ba28079761: BEGIN
[0m23:56:02.622937 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:56:02.622412 [debug] [Thread-3 (]: Timing info for test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344 (execute): 23:56:02.594624 => 23:56:02.622165
[0m23:56:02.624014 [debug] [Thread-3 (]: On test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344: ROLLBACK
[0m23:56:02.624973 [debug] [Thread-3 (]: On test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344: Close
[0m23:56:02.625880 [info ] [Thread-3 (]: 7 of 9 PASS source_relationships_web_transactions_contact_id__id__ref_contacts_  [[32mPASS[0m in 0.05s]
[0m23:56:02.626584 [debug] [Thread-3 (]: Finished running node test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344
[0m23:56:02.629252 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m23:56:02.629674 [debug] [Thread-2 (]: SQL status: BEGIN in 0.0 seconds
[0m23:56:02.630029 [debug] [Thread-1 (]: Using postgres connection "test.customer360.source_unique_web_transactions_id.ba28079761"
[0m23:56:02.630406 [debug] [Thread-2 (]: Using postgres connection "test.customer360.source_unique_salesforce_contacts_id.01cadaaf43"
[0m23:56:02.630806 [debug] [Thread-1 (]: On test.customer360.source_unique_web_transactions_id.ba28079761: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.source_unique_web_transactions_id.ba28079761"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

select
    id as unique_field,
    count(*) as n_records

from "dbt"."public"."transactions"
where id is not null
group by id
having count(*) > 1



      
    ) dbt_internal_test
[0m23:56:02.631198 [debug] [Thread-2 (]: On test.customer360.source_unique_salesforce_contacts_id.01cadaaf43: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.source_unique_salesforce_contacts_id.01cadaaf43"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

select
    id as unique_field,
    count(*) as n_records

from "dbt"."public"."contacts"
where id is not null
group by id
having count(*) > 1



      
    ) dbt_internal_test
[0m23:56:02.632998 [debug] [Thread-2 (]: SQL status: SELECT 1 in 0.0 seconds
[0m23:56:02.633395 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.0 seconds
[0m23:56:02.634737 [debug] [Thread-2 (]: Timing info for test.customer360.source_unique_salesforce_contacts_id.01cadaaf43 (execute): 23:56:02.615507 => 23:56:02.634529
[0m23:56:02.635950 [debug] [Thread-1 (]: Timing info for test.customer360.source_unique_web_transactions_id.ba28079761 (execute): 23:56:02.612057 => 23:56:02.635750
[0m23:56:02.636360 [debug] [Thread-2 (]: On test.customer360.source_unique_salesforce_contacts_id.01cadaaf43: ROLLBACK
[0m23:56:02.636748 [debug] [Thread-1 (]: On test.customer360.source_unique_web_transactions_id.ba28079761: ROLLBACK
[0m23:56:02.637323 [debug] [Thread-2 (]: On test.customer360.source_unique_salesforce_contacts_id.01cadaaf43: Close
[0m23:56:02.638218 [info ] [Thread-2 (]: 8 of 9 PASS source_unique_salesforce_contacts_id ............................... [[32mPASS[0m in 0.04s]
[0m23:56:02.639241 [debug] [Thread-2 (]: Finished running node test.customer360.source_unique_salesforce_contacts_id.01cadaaf43
[0m23:56:02.639865 [debug] [Thread-1 (]: On test.customer360.source_unique_web_transactions_id.ba28079761: Close
[0m23:56:02.640666 [info ] [Thread-1 (]: 9 of 9 PASS source_unique_web_transactions_id .................................. [[32mPASS[0m in 0.04s]
[0m23:56:02.641358 [debug] [Thread-1 (]: Finished running node test.customer360.source_unique_web_transactions_id.ba28079761
[0m23:56:02.642836 [debug] [MainThread]: Using postgres connection "master"
[0m23:56:02.643124 [debug] [MainThread]: On master: BEGIN
[0m23:56:02.643426 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m23:56:02.646687 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m23:56:02.647001 [debug] [MainThread]: On master: COMMIT
[0m23:56:02.647259 [debug] [MainThread]: Using postgres connection "master"
[0m23:56:02.647566 [debug] [MainThread]: On master: COMMIT
[0m23:56:02.648001 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m23:56:02.648277 [debug] [MainThread]: On master: Close
[0m23:56:02.648898 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:56:02.649157 [debug] [MainThread]: Connection 'test.customer360.source_unique_web_transactions_id.ba28079761' was properly closed.
[0m23:56:02.649501 [debug] [MainThread]: Connection 'test.customer360.source_unique_salesforce_contacts_id.01cadaaf43' was properly closed.
[0m23:56:02.649851 [debug] [MainThread]: Connection 'test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344' was properly closed.
[0m23:56:02.650276 [info ] [MainThread]: 
[0m23:56:02.650719 [info ] [MainThread]: Finished running 9 tests in 0 hours 0 minutes and 0.31 seconds (0.31s).
[0m23:56:02.652278 [debug] [MainThread]: Command end result
[0m23:56:02.660182 [info ] [MainThread]: 
[0m23:56:02.660564 [info ] [MainThread]: [32mCompleted successfully[0m
[0m23:56:02.660894 [info ] [MainThread]: 
[0m23:56:02.661205 [info ] [MainThread]: Done. PASS=9 WARN=0 ERROR=0 SKIP=0 TOTAL=9
[0m23:56:02.661922 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": true, "command_wall_clock_time": 0.70876217, "process_user_time": 2.264658, "process_kernel_time": 0.090105, "process_mem_max_rss": "111524", "process_out_blocks": "2744", "process_in_blocks": "0"}
[0m23:56:02.662397 [debug] [MainThread]: Command `dbt test` succeeded at 23:56:02.662259 after 0.71 seconds
[0m23:56:02.662721 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f26ee232ad0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f26edf7b550>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f26f26b4710>]}
[0m23:56:02.663081 [debug] [MainThread]: Flushing usage events
[0m12:41:32.145049 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f44de7ce3d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f44de7ce2d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f44de7ce390>]}


============================== 12:41:32.147560 | 82fd73ff-c83f-4c4e-8835-c6fe23c893bd ==============================
[0m12:41:32.147560 [info ] [MainThread]: Running with dbt=1.7.8
[0m12:41:32.148041 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'profiles_dir': '/root/option1-customer360/integration_tests', 'log_path': '/root/option1-customer360/integration_tests/logs', 'fail_fast': 'False', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'target_path': 'None', 'invocation_command': 'dbt run --profile=env_databricks', 'send_anonymous_usage_stats': 'True'}
[0m12:41:32.150362 [error] [MainThread]: Encountered an error:
Runtime Error
  Could not find profile named 'env_databricks'
[0m12:41:32.151026 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 0.041100208, "process_user_time": 1.69159, "process_kernel_time": 0.085079, "process_mem_max_rss": "89228", "process_in_blocks": "2536", "process_out_blocks": "16", "command_success": false}
[0m12:41:32.151653 [debug] [MainThread]: Command `dbt run` failed at 12:41:32.151505 after 0.04 seconds
[0m12:41:32.151993 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f44de798690>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f44de7da5d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f44de7cf290>]}
[0m12:41:32.152353 [debug] [MainThread]: Flushing usage events
[0m12:44:02.001148 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6a15aa1d10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6a15af4b10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6a15af7210>]}


============================== 12:44:02.004663 | a90e8ead-408b-4712-b227-35c530ea6edf ==============================
[0m12:44:02.004663 [info ] [MainThread]: Running with dbt=1.7.8
[0m12:44:02.005356 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/root/option1-customer360/integration_tests', 'version_check': 'True', 'debug': 'False', 'log_path': '/root/option1-customer360/integration_tests/logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'invocation_command': 'dbt deps', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m12:44:02.114175 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a90e8ead-408b-4712-b227-35c530ea6edf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6a159772d0>]}
[0m12:44:02.116910 [debug] [MainThread]: Set downloads directory='/tmp/dbt-downloads-bu14twes'
[0m12:44:02.117442 [info ] [MainThread]: Installing ../
[0m12:44:02.118383 [debug] [MainThread]: Creating symlink to local dependency.
[0m12:44:02.118777 [info ] [MainThread]: Installed from <local @ ../>
[0m12:44:02.119246 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'package', 'label': 'a90e8ead-408b-4712-b227-35c530ea6edf', 'property_': 'install', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6a15af6710>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6a159c69d0>]}
[0m12:44:02.120253 [debug] [MainThread]: Resource report: {"command_name": "deps", "command_success": true, "command_wall_clock_time": 0.17120764, "process_user_time": 1.933188, "process_kernel_time": 0.082836, "process_mem_max_rss": "90272", "process_out_blocks": "16", "process_in_blocks": "0"}
[0m12:44:02.120899 [debug] [MainThread]: Command `dbt deps` succeeded at 12:44:02.120732 after 0.17 seconds
[0m12:44:02.121361 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6a1637e010>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6a15aa98d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6a19f12b10>]}
[0m12:44:02.121838 [debug] [MainThread]: Flushing usage events
[0m12:44:21.612553 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa8a15d5a90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa8a13d8290>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa8a12b9f90>]}


============================== 12:44:21.616244 | bd9e8a2e-0f90-469a-b1f5-3f350e2f5cce ==============================
[0m12:44:21.616244 [info ] [MainThread]: Running with dbt=1.7.8
[0m12:44:21.617058 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/root/option1-customer360/integration_tests/logs', 'profiles_dir': '/root/option1-customer360/integration_tests', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'invocation_command': 'dbt deps', 'send_anonymous_usage_stats': 'True'}
[0m12:44:21.732144 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'bd9e8a2e-0f90-469a-b1f5-3f350e2f5cce', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa8a1143510>]}
[0m12:44:21.734555 [debug] [MainThread]: Set downloads directory='/tmp/dbt-downloads-n8oyd5e9'
[0m12:44:21.734928 [info ] [MainThread]: Installing ../
[0m12:44:21.735712 [debug] [MainThread]: Creating symlink to local dependency.
[0m12:44:21.736011 [info ] [MainThread]: Installed from <local @ ../>
[0m12:44:21.736467 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'package', 'label': 'bd9e8a2e-0f90-469a-b1f5-3f350e2f5cce', 'property_': 'install', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa8a171ead0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa8a1060d10>]}
[0m12:44:21.737205 [debug] [MainThread]: Resource report: {"command_name": "deps", "command_success": true, "command_wall_clock_time": 0.1826924, "process_user_time": 2.114346, "process_kernel_time": 0.092359, "process_mem_max_rss": "98108", "process_in_blocks": "14488", "process_out_blocks": "8"}
[0m12:44:21.737795 [debug] [MainThread]: Command `dbt deps` succeeded at 12:44:21.737678 after 0.18 seconds
[0m12:44:21.738103 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa8a1149d50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa8a11922d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa8a5ad9f50>]}
[0m12:44:21.738551 [debug] [MainThread]: Flushing usage events
[0m12:45:12.203147 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2806c9f250>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2806c9dc90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2806fb0210>]}


============================== 12:45:12.206656 | 6bebcbf7-02e1-467f-9ab0-45d7c39f51fc ==============================
[0m12:45:12.206656 [info ] [MainThread]: Running with dbt=1.7.8
[0m12:45:12.207388 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/root/option1-customer360/integration_tests', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/root/option1-customer360/integration_tests/logs', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'target_path': 'None', 'invocation_command': 'dbt run --profile=env_databricks', 'send_anonymous_usage_stats': 'True'}
[0m12:45:12.210824 [error] [MainThread]: Encountered an error:
Runtime Error
  Could not find profile named 'env_databricks'
[0m12:45:12.211966 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 0.11418422, "process_user_time": 1.986492, "process_kernel_time": 0.086426, "process_mem_max_rss": "97092", "process_out_blocks": "16", "command_success": false, "process_in_blocks": "0"}
[0m12:45:12.212708 [debug] [MainThread]: Command `dbt run` failed at 12:45:12.212511 after 0.12 seconds
[0m12:45:12.213311 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2807293390>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2806ec8b90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2807437010>]}
[0m12:45:12.213870 [debug] [MainThread]: Flushing usage events
[0m12:52:38.709006 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe917c7f0d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe9182fa650>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe917c773d0>]}


============================== 12:52:38.711427 | c33a375c-1128-4ed5-b4c6-97123d90dbad ==============================
[0m12:52:38.711427 [info ] [MainThread]: Running with dbt=1.7.8
[0m12:52:38.711919 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/root/option1-customer360/integration_tests', 'fail_fast': 'False', 'warn_error': 'None', 'log_path': '/root/option1-customer360/integration_tests/logs', 'debug': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'target_path': 'None', 'invocation_command': 'dbt run --profile=env_databricks', 'send_anonymous_usage_stats': 'True'}
[0m12:52:38.714396 [error] [MainThread]: Encountered an error:
Runtime Error
  Could not find profile named 'env_databricks'
[0m12:52:38.715099 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 0.041724443, "process_user_time": 1.842088, "process_kernel_time": 0.074922, "process_mem_max_rss": "97088", "process_out_blocks": "8", "command_success": false, "process_in_blocks": "0"}
[0m12:52:38.715662 [debug] [MainThread]: Command `dbt run` failed at 12:52:38.715530 after 0.04 seconds
[0m12:52:38.715996 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe917ccb190>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe9180f89d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe917c773d0>]}
[0m12:52:38.716350 [debug] [MainThread]: Flushing usage events
[0m12:53:24.386478 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8031b88e10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f802f2ffbd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f802f402d50>]}


============================== 12:53:24.388896 | 45ffd17e-b44c-472a-babb-bdf526cb1abb ==============================
[0m12:53:24.388896 [info ] [MainThread]: Running with dbt=1.7.8
[0m12:53:24.389397 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/root/option1-customer360/integration_tests', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/root/option1-customer360/integration_tests/logs', 'warn_error': 'None', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'static_parser': 'True', 'invocation_command': 'dbt run --profile=env_databricks', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m12:53:24.391768 [error] [MainThread]: Encountered an error:
Runtime Error
  Could not find profile named 'env_databricks'
[0m12:53:24.392522 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 0.04205052, "process_user_time": 1.774432, "process_kernel_time": 0.079749, "process_mem_max_rss": "97080", "process_out_blocks": "16", "command_success": false, "process_in_blocks": "0"}
[0m12:53:24.393002 [debug] [MainThread]: Command `dbt run` failed at 12:53:24.392872 after 0.04 seconds
[0m12:53:24.393348 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f802ef7fc10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f802ef6de50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f802f571450>]}
[0m12:53:24.393688 [debug] [MainThread]: Flushing usage events
[0m12:54:24.530979 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1ec65c7850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1ec633ed50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1ec645e1d0>]}


============================== 12:54:24.533637 | 4bc0b81a-6ca8-49ef-8f77-ecce3419d54c ==============================
[0m12:54:24.533637 [info ] [MainThread]: Running with dbt=1.7.8
[0m12:54:24.534184 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': '/root/option1-customer360/integration_tests/logs', 'profiles_dir': '/root/option1-customer360/integration_tests', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'target_path': 'None', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True'}
[0m12:54:24.536749 [error] [MainThread]: Encountered an error:
Runtime Error
  Could not find profile named 'env_databricks'
[0m12:54:24.537568 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 0.044568628, "process_user_time": 1.989926, "process_kernel_time": 0.085738, "process_mem_max_rss": "97096", "process_out_blocks": "8", "command_success": false, "process_in_blocks": "0"}
[0m12:54:24.538100 [debug] [MainThread]: Command `dbt run` failed at 12:54:24.537912 after 0.05 seconds
[0m12:54:24.538495 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1ec659f850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1ec6b34f50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1ec633c5d0>]}
[0m12:54:24.538849 [debug] [MainThread]: Flushing usage events
[0m12:56:27.788045 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe935a74f90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe9356259d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe935c64a50>]}


============================== 12:56:27.790466 | 1883bef3-178d-4d91-8bc8-754a4af54bc1 ==============================
[0m12:56:27.790466 [info ] [MainThread]: Running with dbt=1.7.8
[0m12:56:27.790979 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/root/option1-customer360/integration_tests', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/root/option1-customer360/integration_tests/logs', 'warn_error': 'None', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run', 'static_parser': 'True', 'log_format': 'default', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m12:56:27.793708 [error] [MainThread]: Encountered an error:
Runtime Error
  The profile 'env_databricks' does not have a target named 'local'. The valid target names for this profile are:
   - dev
[0m12:56:27.794474 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 0.04185748, "process_user_time": 1.714444, "process_kernel_time": 0.07693, "process_mem_max_rss": "97096", "process_out_blocks": "8", "command_success": false, "process_in_blocks": "0"}
[0m12:56:27.795127 [debug] [MainThread]: Command `dbt run` failed at 12:56:27.794989 after 0.04 seconds
[0m12:56:27.795503 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe935a97a10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe9358a4350>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe9358aa790>]}
[0m12:56:27.795861 [debug] [MainThread]: Flushing usage events
[0m12:57:36.515925 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5015bdc750>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5013897b90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f50135ae710>]}


============================== 12:57:36.518599 | 455e7b4e-c4c0-42b7-920b-38a9c842cde0 ==============================
[0m12:57:36.518599 [info ] [MainThread]: Running with dbt=1.7.8
[0m12:57:36.519099 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'profiles_dir': '/root/option1-customer360/integration_tests', 'log_path': '/root/option1-customer360/integration_tests/logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt run', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m12:57:36.523330 [info ] [MainThread]: Error importing adapter: No module named 'dbt.adapters.databricks'
[0m12:57:36.523765 [error] [MainThread]: Encountered an error:
Runtime Error
  Credentials in profile "env_databricks", target "dev" invalid: Runtime Error
    Could not find adapter type databricks!
[0m12:57:36.524475 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 0.044083536, "process_user_time": 2.02937, "process_kernel_time": 0.087199, "process_mem_max_rss": "97120", "process_out_blocks": "16", "command_success": false, "process_in_blocks": "0"}
[0m12:57:36.524933 [debug] [MainThread]: Command `dbt run` failed at 12:57:36.524813 after 0.04 seconds
[0m12:57:36.525276 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f50134c7f50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f501323ee90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f50134db550>]}
[0m12:57:36.525653 [debug] [MainThread]: Flushing usage events
[0m12:57:57.117266 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f83723a2fd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f83723a0310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f83723a1190>]}


============================== 12:57:57.119736 | 757f2c53-ef46-4513-91fb-f9927c6f1744 ==============================
[0m12:57:57.119736 [info ] [MainThread]: Running with dbt=1.7.8
[0m12:57:57.120208 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/root/option1-customer360/integration_tests/logs', 'debug': 'False', 'profiles_dir': '/root/option1-customer360/integration_tests', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': 'dbt run', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m12:57:57.121339 [error] [MainThread]: Encountered an error:
Runtime Error
  dbt cannot run because no profile was specified for this dbt project.
  To specify a profile for this project, add a line like the this to
  your dbt_project.yml file:
  
  profile: [profile name]
  
  Here, [profile name] should be replaced with a profile name
  defined in your profiles.yml file. You can find profiles.yml here:
  
  /root/option1-customer360/integration_tests/profiles.yml
  
[0m12:57:57.122038 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 0.04069031, "process_user_time": 1.911411, "process_kernel_time": 0.074431, "process_mem_max_rss": "97072", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m12:57:57.122533 [debug] [MainThread]: Command `dbt run` failed at 12:57:57.122404 after 0.04 seconds
[0m12:57:57.122877 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8372827d50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f837297b5d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f837294c050>]}
[0m12:57:57.123216 [debug] [MainThread]: Flushing usage events
[0m13:09:16.365869 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1cc413d350>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1cc42dda10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1cc44d38d0>]}


============================== 13:09:16.369643 | 710b7ffb-6cc6-49af-a6d8-6e18b61409b9 ==============================
[0m13:09:16.369643 [info ] [MainThread]: Running with dbt=1.7.8
[0m13:09:16.371215 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/root/option1-customer360/integration_tests', 'version_check': 'True', 'warn_error': 'None', 'log_path': '/root/option1-customer360/integration_tests/logs', 'fail_fast': 'False', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'invocation_command': 'dbt debug', 'log_format': 'default', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m13:09:16.371847 [info ] [MainThread]: dbt version: 1.7.8
[0m13:09:16.372386 [info ] [MainThread]: python version: 3.11.5
[0m13:09:16.372847 [info ] [MainThread]: python path: /root/option1-customer360/integration_tests/venv/bin/python
[0m13:09:16.373486 [info ] [MainThread]: os info: Linux-3.10.0-1160.99.1.el7.x86_64-x86_64-with-glibc2.17
[0m13:09:16.599161 [info ] [MainThread]: Using profiles dir at /root/option1-customer360/integration_tests
[0m13:09:16.599781 [info ] [MainThread]: Using profiles.yml file at /root/option1-customer360/integration_tests/profiles.yml
[0m13:09:16.600212 [info ] [MainThread]: Using dbt_project.yml file at /root/option1-customer360/integration_tests/dbt_project.yml
[0m13:09:16.600838 [info ] [MainThread]: adapter type: postgres
[0m13:09:16.601262 [info ] [MainThread]: adapter version: 1.7.8
[0m13:09:16.702947 [info ] [MainThread]: Configuration:
[0m13:09:16.703530 [info ] [MainThread]:   profiles.yml file [[32mOK found and valid[0m]
[0m13:09:16.703949 [info ] [MainThread]:   dbt_project.yml file [[32mOK found and valid[0m]
[0m13:09:16.704656 [info ] [MainThread]: Required dependencies:
[0m13:09:16.705064 [debug] [MainThread]: Executing "git --help"
[0m13:09:16.714469 [debug] [MainThread]: STDOUT: "b"\xe7\x94\xa8\xe6\xb3\x95\xef\xbc\x9agit [--version] [--help] [-c name=value]\n           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]\n           [-p|--paginate|--no-pager] [--no-replace-objects] [--bare]\n           [--git-dir=<path>] [--work-tree=<path>] [--namespace=<name>]\n           <command> [<args>]\n\n\xe6\x9c\x80\xe5\xb8\xb8\xe7\x94\xa8\xe7\x9a\x84 git \xe5\x91\xbd\xe4\xbb\xa4\xe6\x9c\x89\xef\xbc\x9a\n   add        \xe6\xb7\xbb\xe5\x8a\xa0\xe6\x96\x87\xe4\xbb\xb6\xe5\x86\x85\xe5\xae\xb9\xe8\x87\xb3\xe7\xb4\xa2\xe5\xbc\x95\n   bisect     \xe9\x80\x9a\xe8\xbf\x87\xe4\xba\x8c\xe5\x88\x86\xe6\x9f\xa5\xe6\x89\xbe\xe5\xae\x9a\xe4\xbd\x8d\xe5\xbc\x95\xe5\x85\xa5 bug \xe7\x9a\x84\xe5\x8f\x98\xe6\x9b\xb4\n   branch     \xe5\x88\x97\xe5\x87\xba\xe3\x80\x81\xe5\x88\x9b\xe5\xbb\xba\xe6\x88\x96\xe5\x88\xa0\xe9\x99\xa4\xe5\x88\x86\xe6\x94\xaf\n   checkout   \xe6\xa3\x80\xe5\x87\xba\xe4\xb8\x80\xe4\xb8\xaa\xe5\x88\x86\xe6\x94\xaf\xe6\x88\x96\xe8\xb7\xaf\xe5\xbe\x84\xe5\x88\xb0\xe5\xb7\xa5\xe4\xbd\x9c\xe5\x8c\xba\n   clone      \xe5\x85\x8b\xe9\x9a\x86\xe4\xb8\x80\xe4\xb8\xaa\xe7\x89\x88\xe6\x9c\xac\xe5\xba\x93\xe5\x88\xb0\xe4\xb8\x80\xe4\xb8\xaa\xe6\x96\xb0\xe7\x9b\xae\xe5\xbd\x95\n   commit     \xe8\xae\xb0\xe5\xbd\x95\xe5\x8f\x98\xe6\x9b\xb4\xe5\x88\xb0\xe7\x89\x88\xe6\x9c\xac\xe5\xba\x93\n   diff       \xe6\x98\xbe\xe7\xa4\xba\xe6\x8f\x90\xe4\xba\xa4\xe4\xb9\x8b\xe9\x97\xb4\xe3\x80\x81\xe6\x8f\x90\xe4\xba\xa4\xe5\x92\x8c\xe5\xb7\xa5\xe4\xbd\x9c\xe5\x8c\xba\xe4\xb9\x8b\xe9\x97\xb4\xe7\xad\x89\xe7\x9a\x84\xe5\xb7\xae\xe5\xbc\x82\n   fetch      \xe4\xbb\x8e\xe5\x8f\xa6\xe5\xa4\x96\xe4\xb8\x80\xe4\xb8\xaa\xe7\x89\x88\xe6\x9c\xac\xe5\xba\x93\xe4\xb8\x8b\xe8\xbd\xbd\xe5\xaf\xb9\xe8\xb1\xa1\xe5\x92\x8c\xe5\xbc\x95\xe7\x94\xa8\n   grep       \xe8\xbe\x93\xe5\x87\xba\xe5\x92\x8c\xe6\xa8\xa1\xe5\xbc\x8f\xe5\x8c\xb9\xe9\x85\x8d\xe7\x9a\x84\xe8\xa1\x8c\n   init       \xe5\x88\x9b\xe5\xbb\xba\xe4\xb8\x80\xe4\xb8\xaa\xe7\xa9\xba\xe7\x9a\x84 Git \xe7\x89\x88\xe6\x9c\xac\xe5\xba\x93\xe6\x88\x96\xe9\x87\x8d\xe6\x96\xb0\xe5\x88\x9d\xe5\xa7\x8b\xe5\x8c\x96\xe4\xb8\x80\xe4\xb8\xaa\xe5\xb7\xb2\xe5\xad\x98\xe5\x9c\xa8\xe7\x9a\x84\xe7\x89\x88\xe6\x9c\xac\xe5\xba\x93\n   log        \xe6\x98\xbe\xe7\xa4\xba\xe6\x8f\x90\xe4\xba\xa4\xe6\x97\xa5\xe5\xbf\x97\n   merge      \xe5\x90\x88\xe5\xb9\xb6\xe4\xb8\xa4\xe4\xb8\xaa\xe6\x88\x96\xe6\x9b\xb4\xe5\xa4\x9a\xe5\xbc\x80\xe5\x8f\x91\xe5\x8e\x86\xe5\x8f\xb2\n   mv         \xe7\xa7\xbb\xe5\x8a\xa8\xe6\x88\x96\xe9\x87\x8d\xe5\x91\xbd\xe5\x90\x8d\xe4\xb8\x80\xe4\xb8\xaa\xe6\x96\x87\xe4\xbb\xb6\xe3\x80\x81\xe7\x9b\xae\xe5\xbd\x95\xe6\x88\x96\xe7\xac\xa6\xe5\x8f\xb7\xe9\x93\xbe\xe6\x8e\xa5\n   pull       \xe8\x8e\xb7\xe5\x8f\x96\xe5\xb9\xb6\xe5\x90\x88\xe5\xb9\xb6\xe5\x8f\xa6\xe5\xa4\x96\xe7\x9a\x84\xe7\x89\x88\xe6\x9c\xac\xe5\xba\x93\xe6\x88\x96\xe4\xb8\x80\xe4\xb8\xaa\xe6\x9c\xac\xe5\x9c\xb0\xe5\x88\x86\xe6\x94\xaf\n   push       \xe6\x9b\xb4\xe6\x96\xb0\xe8\xbf\x9c\xe7\xa8\x8b\xe5\xbc\x95\xe7\x94\xa8\xe5\x92\x8c\xe7\x9b\xb8\xe5\x85\xb3\xe7\x9a\x84\xe5\xaf\xb9\xe8\xb1\xa1\n   rebase     \xe6\x9c\xac\xe5\x9c\xb0\xe6\x8f\x90\xe4\xba\xa4\xe8\xbd\xac\xe7\xa7\xbb\xe8\x87\xb3\xe6\x9b\xb4\xe6\x96\xb0\xe5\x90\x8e\xe7\x9a\x84\xe4\xb8\x8a\xe6\xb8\xb8\xe5\x88\x86\xe6\x94\xaf\xe4\xb8\xad\n   reset      \xe9\x87\x8d\xe7\xbd\xae\xe5\xbd\x93\xe5\x89\x8dHEAD\xe5\x88\xb0\xe6\x8c\x87\xe5\xae\x9a\xe7\x8a\xb6\xe6\x80\x81\n   rm         \xe4\xbb\x8e\xe5\xb7\xa5\xe4\xbd\x9c\xe5\x8c\xba\xe5\x92\x8c\xe7\xb4\xa2\xe5\xbc\x95\xe4\xb8\xad\xe5\x88\xa0\xe9\x99\xa4\xe6\x96\x87\xe4\xbb\xb6\n   show       \xe6\x98\xbe\xe7\xa4\xba\xe5\x90\x84\xe7\xa7\x8d\xe7\xb1\xbb\xe5\x9e\x8b\xe7\x9a\x84\xe5\xaf\xb9\xe8\xb1\xa1\n   status     \xe6\x98\xbe\xe7\xa4\xba\xe5\xb7\xa5\xe4\xbd\x9c\xe5\x8c\xba\xe7\x8a\xb6\xe6\x80\x81\n   tag        \xe5\x88\x9b\xe5\xbb\xba\xe3\x80\x81\xe5\x88\x97\xe5\x87\xba\xe3\x80\x81\xe5\x88\xa0\xe9\x99\xa4\xe6\x88\x96\xe6\xa0\xa1\xe9\xaa\x8c\xe4\xb8\x80\xe4\xb8\xaaGPG\xe7\xad\xbe\xe5\x90\x8d\xe7\x9a\x84 tag \xe5\xaf\xb9\xe8\xb1\xa1\n\n\xe5\x91\xbd\xe4\xbb\xa4 'git help -a' \xe5\x92\x8c 'git help -g' \xe6\x98\xbe\xe7\xa4\xba\xe5\x8f\xaf\xe7\x94\xa8\xe7\x9a\x84\xe5\xad\x90\xe5\x91\xbd\xe4\xbb\xa4\xe5\x92\x8c\xe4\xb8\x80\xe4\xba\x9b\xe6\x8c\x87\xe5\x8d\x97\xe3\x80\x82\xe5\x8f\x82\xe8\xa7\x81\n'git help <\xe5\x91\xbd\xe4\xbb\xa4>' \xe6\x88\x96 'git help <\xe6\x8c\x87\xe5\x8d\x97>' \xe6\x9d\xa5\xe6\x9f\xa5\xe7\x9c\x8b\xe7\xbb\x99\xe5\xae\x9a\xe7\x9a\x84\xe5\xad\x90\xe5\x91\xbd\xe4\xbb\xa4\xe5\xb8\xae\xe5\x8a\xa9\xe6\x88\x96\xe6\x8c\x87\xe5\x8d\x97\xe3\x80\x82\n""
[0m13:09:16.715333 [debug] [MainThread]: STDERR: "b''"
[0m13:09:16.715752 [info ] [MainThread]:  - git [[32mOK found[0m]

[0m13:09:16.716229 [info ] [MainThread]: Connection:
[0m13:09:16.716685 [info ] [MainThread]:   host: localhost
[0m13:09:16.717126 [info ] [MainThread]:   port: 5432
[0m13:09:16.717550 [info ] [MainThread]:   user: dbt
[0m13:09:16.717943 [info ] [MainThread]:   database: dbt
[0m13:09:16.718392 [info ] [MainThread]:   schema: public
[0m13:09:16.718786 [info ] [MainThread]:   connect_timeout: 10
[0m13:09:16.719223 [info ] [MainThread]:   role: None
[0m13:09:16.719744 [info ] [MainThread]:   search_path: None
[0m13:09:16.720202 [info ] [MainThread]:   keepalives_idle: 0
[0m13:09:16.720630 [info ] [MainThread]:   sslmode: None
[0m13:09:16.721030 [info ] [MainThread]:   sslcert: None
[0m13:09:16.724742 [info ] [MainThread]:   sslkey: None
[0m13:09:16.725188 [info ] [MainThread]:   sslrootcert: None
[0m13:09:16.725658 [info ] [MainThread]:   application_name: dbt
[0m13:09:16.726055 [info ] [MainThread]:   retries: 1
[0m13:09:16.727005 [info ] [MainThread]: Registered adapter: postgres=1.7.8
[0m13:09:16.727892 [debug] [MainThread]: Acquiring new postgres connection 'debug'
[0m13:09:16.728365 [debug] [MainThread]: Using postgres connection "debug"
[0m13:09:16.728767 [debug] [MainThread]: On debug: select 1 as id
[0m13:09:16.729150 [debug] [MainThread]: Opening a new connection, currently in state init
[0m13:09:16.741136 [debug] [MainThread]: SQL status: SELECT 1 in 0.0 seconds
[0m13:09:16.742506 [debug] [MainThread]: On debug: Close
[0m13:09:16.743006 [info ] [MainThread]:   Connection test: [[32mOK connection ok[0m]

[0m13:09:16.743459 [info ] [MainThread]: [32mAll checks passed![0m
[0m13:09:16.744441 [debug] [MainThread]: Resource report: {"command_name": "debug", "command_success": true, "command_wall_clock_time": 0.5193842, "process_user_time": 2.260856, "process_kernel_time": 0.092763, "process_mem_max_rss": "102524", "process_in_blocks": "9296", "process_out_blocks": "32"}
[0m13:09:16.745087 [debug] [MainThread]: Command `dbt debug` succeeded at 13:09:16.744929 after 0.52 seconds
[0m13:09:16.747152 [debug] [MainThread]: Connection 'debug' was properly closed.
[0m13:09:16.747664 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1cc44dce50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1cc43919d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1cc3ef7d50>]}
[0m13:09:16.748225 [debug] [MainThread]: Flushing usage events
[0m13:09:40.817139 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd4dceba710>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd4dcecc110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd4dcd8a190>]}


============================== 13:09:40.819662 | aeaf32a1-2e71-4a2e-a7ff-005349db65e8 ==============================
[0m13:09:40.819662 [info ] [MainThread]: Running with dbt=1.7.8
[0m13:09:40.820133 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'profiles_dir': '/root/option1-customer360/integration_tests', 'log_path': '/root/option1-customer360/integration_tests/logs', 'debug': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt build', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m13:09:40.962986 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'aeaf32a1-2e71-4a2e-a7ff-005349db65e8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd4db119c50>]}
[0m13:09:41.038739 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'aeaf32a1-2e71-4a2e-a7ff-005349db65e8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd4db0ed050>]}
[0m13:09:41.039446 [info ] [MainThread]: Registered adapter: postgres=1.7.8
[0m13:09:41.050843 [debug] [MainThread]: checksum: 67f0013ca5f0bd43af9a0873dd50792fde83ef69de63b71cacd0b4ac656c52e5, vars: {}, profile: , target: , version: 1.7.8
[0m13:09:41.059192 [info ] [MainThread]: Unable to do partial parsing because profile has changed
[0m13:09:41.059596 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m13:09:41.059892 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'aeaf32a1-2e71-4a2e-a7ff-005349db65e8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd4db13bdd0>]}
[0m13:09:42.877075 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'aeaf32a1-2e71-4a2e-a7ff-005349db65e8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd4daf12910>]}
[0m13:09:42.886249 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'aeaf32a1-2e71-4a2e-a7ff-005349db65e8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd4da493a50>]}
[0m13:09:42.886790 [info ] [MainThread]: Found 2 seeds, 4 models, 9 tests, 2 sources, 0 exposures, 0 metrics, 403 macros, 0 groups, 0 semantic models
[0m13:09:42.888775 [info ] [MainThread]: 
[0m13:09:42.889443 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m13:09:42.890753 [debug] [ThreadPool]: Acquiring new postgres connection 'list_dbt'
[0m13:09:42.899720 [debug] [ThreadPool]: Using postgres connection "list_dbt"
[0m13:09:42.900039 [debug] [ThreadPool]: On list_dbt: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "connection_name": "list_dbt"} */

    select distinct nspname from pg_namespace
  
[0m13:09:42.900320 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:09:42.904853 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.0 seconds
[0m13:09:42.906066 [debug] [ThreadPool]: On list_dbt: Close
[0m13:09:42.908048 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dbt, now list_dbt_public)
[0m13:09:42.913280 [debug] [ThreadPool]: Using postgres connection "list_dbt_public"
[0m13:09:42.913600 [debug] [ThreadPool]: On list_dbt_public: BEGIN
[0m13:09:42.913857 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:09:42.916900 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m13:09:42.917196 [debug] [ThreadPool]: Using postgres connection "list_dbt_public"
[0m13:09:42.917521 [debug] [ThreadPool]: On list_dbt_public: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "connection_name": "list_dbt_public"} */
select
      'dbt' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'dbt' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'dbt' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m13:09:42.920286 [debug] [ThreadPool]: SQL status: SELECT 6 in 0.0 seconds
[0m13:09:42.921486 [debug] [ThreadPool]: On list_dbt_public: ROLLBACK
[0m13:09:42.922013 [debug] [ThreadPool]: On list_dbt_public: Close
[0m13:09:42.927677 [debug] [MainThread]: Using postgres connection "master"
[0m13:09:42.927971 [debug] [MainThread]: On master: BEGIN
[0m13:09:42.928267 [debug] [MainThread]: Opening a new connection, currently in state init
[0m13:09:42.931285 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m13:09:42.931662 [debug] [MainThread]: Using postgres connection "master"
[0m13:09:42.932063 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m13:09:42.941828 [debug] [MainThread]: SQL status: SELECT 2 in 0.0 seconds
[0m13:09:42.943425 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'aeaf32a1-2e71-4a2e-a7ff-005349db65e8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd4da6c2450>]}
[0m13:09:42.943826 [debug] [MainThread]: On master: ROLLBACK
[0m13:09:42.944324 [debug] [MainThread]: Using postgres connection "master"
[0m13:09:42.944623 [debug] [MainThread]: On master: BEGIN
[0m13:09:42.945244 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m13:09:42.945556 [debug] [MainThread]: On master: COMMIT
[0m13:09:42.945825 [debug] [MainThread]: Using postgres connection "master"
[0m13:09:42.946076 [debug] [MainThread]: On master: COMMIT
[0m13:09:42.946508 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m13:09:42.946802 [debug] [MainThread]: On master: Close
[0m13:09:42.947448 [info ] [MainThread]: Concurrency: 3 threads (target='local')
[0m13:09:42.947771 [info ] [MainThread]: 
[0m13:09:42.951398 [debug] [Thread-1 (]: Began running node seed.integration_tests.contacts
[0m13:09:42.951812 [debug] [Thread-2 (]: Began running node seed.integration_tests.transactions
[0m13:09:42.952227 [info ] [Thread-1 (]: 1 of 15 START seed file public.contacts ........................................ [RUN]
[0m13:09:42.953973 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dbt_public, now seed.integration_tests.contacts)
[0m13:09:42.953269 [info ] [Thread-2 (]: 2 of 15 START seed file public.transactions .................................... [RUN]
[0m13:09:42.954341 [debug] [Thread-1 (]: Began compiling node seed.integration_tests.contacts
[0m13:09:42.952722 [debug] [Thread-3 (]: Began running node test.customer360.macro_test1
[0m13:09:42.954996 [debug] [Thread-2 (]: Acquiring new postgres connection 'seed.integration_tests.transactions'
[0m13:09:42.956249 [debug] [Thread-2 (]: Began compiling node seed.integration_tests.transactions
[0m13:09:42.955855 [info ] [Thread-3 (]: 3 of 15 START test macro_test1 ................................................. [RUN]
[0m13:09:42.956683 [debug] [Thread-2 (]: Timing info for seed.integration_tests.transactions (compile): 13:09:42.956496 => 13:09:42.956498
[0m13:09:42.955469 [debug] [Thread-1 (]: Timing info for seed.integration_tests.contacts (compile): 13:09:42.955240 => 13:09:42.955243
[0m13:09:42.957332 [debug] [Thread-3 (]: Acquiring new postgres connection 'test.customer360.macro_test1'
[0m13:09:42.957690 [debug] [Thread-2 (]: Began executing node seed.integration_tests.transactions
[0m13:09:42.958051 [debug] [Thread-1 (]: Began executing node seed.integration_tests.contacts
[0m13:09:42.958417 [debug] [Thread-3 (]: Began compiling node test.customer360.macro_test1
[0m13:09:43.005679 [debug] [Thread-3 (]: Writing injected SQL for node "test.customer360.macro_test1"
[0m13:09:43.007037 [debug] [Thread-2 (]: Using postgres connection "seed.integration_tests.transactions"
[0m13:09:43.013491 [debug] [Thread-2 (]: On seed.integration_tests.transactions: BEGIN
[0m13:09:43.013854 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m13:09:43.013010 [debug] [Thread-1 (]: Using postgres connection "seed.integration_tests.contacts"
[0m13:09:43.015891 [debug] [Thread-1 (]: On seed.integration_tests.contacts: BEGIN
[0m13:09:43.016211 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:09:43.014577 [debug] [Thread-3 (]: Timing info for test.customer360.macro_test1 (compile): 13:09:42.984133 => 13:09:43.014272
[0m13:09:43.016951 [debug] [Thread-3 (]: Began executing node test.customer360.macro_test1
[0m13:09:43.034206 [debug] [Thread-3 (]: Writing runtime sql for node "test.customer360.macro_test1"
[0m13:09:43.034680 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m13:09:43.035483 [debug] [Thread-1 (]: Using postgres connection "seed.integration_tests.contacts"
[0m13:09:43.035867 [debug] [Thread-1 (]: On seed.integration_tests.contacts: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "seed.integration_tests.contacts"} */
truncate table "dbt"."public"."contacts"
[0m13:09:43.034996 [debug] [Thread-2 (]: SQL status: BEGIN in 0.0 seconds
[0m13:09:43.036837 [debug] [Thread-2 (]: Using postgres connection "seed.integration_tests.transactions"
[0m13:09:43.036368 [debug] [Thread-3 (]: Using postgres connection "test.customer360.macro_test1"
[0m13:09:43.037741 [debug] [Thread-3 (]: On test.customer360.macro_test1: BEGIN
[0m13:09:43.038106 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m13:09:43.037340 [debug] [Thread-2 (]: On seed.integration_tests.transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "seed.integration_tests.transactions"} */
truncate table "dbt"."public"."transactions"
[0m13:09:43.040074 [debug] [Thread-1 (]: SQL status: TRUNCATE TABLE in 0.0 seconds
[0m13:09:43.051191 [debug] [Thread-2 (]: SQL status: TRUNCATE TABLE in 0.0 seconds
[0m13:09:43.107625 [debug] [Thread-3 (]: SQL status: BEGIN in 0.0 seconds
[0m13:09:43.108256 [debug] [Thread-3 (]: Using postgres connection "test.customer360.macro_test1"
[0m13:09:43.108764 [debug] [Thread-3 (]: On test.customer360.macro_test1: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.macro_test1"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      with marco_result as (
    select 
    date_part('year', age(current_date, '2023-02-12'))
 as expect_result
)
select
    1
from marco_result
where expect_result <> 1
      
    ) dbt_internal_test
[0m13:09:43.131638 [debug] [Thread-3 (]: SQL status: SELECT 1 in 0.0 seconds
[0m13:09:43.134478 [debug] [Thread-3 (]: Timing info for test.customer360.macro_test1 (execute): 13:09:43.017153 => 13:09:43.134087
[0m13:09:43.134998 [debug] [Thread-3 (]: On test.customer360.macro_test1: ROLLBACK
[0m13:09:43.145838 [debug] [Thread-1 (]: Using postgres connection "seed.integration_tests.contacts"
[0m13:09:43.146443 [debug] [Thread-1 (]: On seed.integration_tests.contacts: 
          insert into "dbt"."public"."contacts" ("id", "username", "name", "gender", "address", "mail", "birthdate", "_loaded_at_utc") values
          (%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s)
      ...
[0m13:09:43.171031 [debug] [Thread-1 (]: SQL status: INSERT 0 10 in 0.0 seconds
[0m13:09:43.192976 [debug] [Thread-1 (]: Writing runtime SQL for node "seed.integration_tests.contacts"
[0m13:09:43.237984 [debug] [Thread-1 (]: On seed.integration_tests.contacts: COMMIT
[0m13:09:43.238610 [debug] [Thread-1 (]: Using postgres connection "seed.integration_tests.contacts"
[0m13:09:43.239164 [debug] [Thread-1 (]: On seed.integration_tests.contacts: COMMIT
[0m13:09:43.245661 [debug] [Thread-3 (]: On test.customer360.macro_test1: Close
[0m13:09:43.246694 [info ] [Thread-3 (]: 3 of 15 PASS macro_test1 ....................................................... [[32mPASS[0m in 0.29s]
[0m13:09:43.247428 [debug] [Thread-3 (]: Finished running node test.customer360.macro_test1
[0m13:09:43.247935 [debug] [Thread-3 (]: Began running node test.customer360.macro_test2
[0m13:09:43.248469 [info ] [Thread-3 (]: 4 of 15 START test macro_test2 ................................................. [RUN]
[0m13:09:43.249467 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.customer360.macro_test1, now test.customer360.macro_test2)
[0m13:09:43.250145 [debug] [Thread-3 (]: Began compiling node test.customer360.macro_test2
[0m13:09:43.253957 [debug] [Thread-3 (]: Writing injected SQL for node "test.customer360.macro_test2"
[0m13:09:43.254782 [debug] [Thread-3 (]: Timing info for test.customer360.macro_test2 (compile): 13:09:43.250486 => 13:09:43.254479
[0m13:09:43.255278 [debug] [Thread-3 (]: Began executing node test.customer360.macro_test2
[0m13:09:43.258544 [debug] [Thread-3 (]: Writing runtime sql for node "test.customer360.macro_test2"
[0m13:09:43.259214 [debug] [Thread-3 (]: Using postgres connection "test.customer360.macro_test2"
[0m13:09:43.259701 [debug] [Thread-3 (]: On test.customer360.macro_test2: BEGIN
[0m13:09:43.260168 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m13:09:43.264618 [debug] [Thread-3 (]: SQL status: BEGIN in 0.0 seconds
[0m13:09:43.265123 [debug] [Thread-3 (]: Using postgres connection "test.customer360.macro_test2"
[0m13:09:43.265732 [debug] [Thread-3 (]: On test.customer360.macro_test2: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.macro_test2"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      with marco_result as (
    select  as expect_result
)
select
    1
from marco_result
where cast(pg_typeof(expect_result) as text) not like '%timestamp%'
      
    ) dbt_internal_test
[0m13:09:43.266841 [debug] [Thread-3 (]: Postgres adapter: Postgres error: syntax error at or near "as"
LINE 8:     select  as expect_result
                    ^

[0m13:09:43.267352 [debug] [Thread-3 (]: On test.customer360.macro_test2: ROLLBACK
[0m13:09:43.268318 [debug] [Thread-3 (]: Timing info for test.customer360.macro_test2 (execute): 13:09:43.255595 => 13:09:43.267989
[0m13:09:43.268806 [debug] [Thread-3 (]: On test.customer360.macro_test2: Close
[0m13:09:43.275236 [debug] [Thread-3 (]: Database Error in test macro_test2 (tests/macro_test2.sql)
  syntax error at or near "as"
  LINE 8:     select  as expect_result
                      ^
  compiled Code at target/run/customer360/tests/macro_test2.sql
[0m13:09:43.275975 [error] [Thread-3 (]: 4 of 15 ERROR macro_test2 ...................................................... [[31mERROR[0m in 0.03s]
[0m13:09:43.276768 [debug] [Thread-3 (]: Finished running node test.customer360.macro_test2
[0m13:09:43.277379 [debug] [Thread-3 (]: Began running node test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247
[0m13:09:43.277924 [info ] [Thread-3 (]: 5 of 15 START test source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors  [RUN]
[0m13:09:43.278959 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.customer360.macro_test2, now test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247)
[0m13:09:43.279513 [debug] [Thread-3 (]: Began compiling node test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247
[0m13:09:43.304325 [debug] [Thread-3 (]: Writing injected SQL for node "test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247"
[0m13:09:43.305250 [debug] [Thread-3 (]: Timing info for test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247 (compile): 13:09:43.279828 => 13:09:43.304923
[0m13:09:43.305817 [debug] [Thread-3 (]: Began executing node test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247
[0m13:09:43.309481 [debug] [Thread-3 (]: Writing runtime sql for node "test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247"
[0m13:09:43.310209 [debug] [Thread-3 (]: Using postgres connection "test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247"
[0m13:09:43.310765 [debug] [Thread-3 (]: On test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247: BEGIN
[0m13:09:43.311250 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m13:09:43.313412 [debug] [Thread-1 (]: SQL status: COMMIT in 0.0 seconds
[0m13:09:43.314664 [debug] [Thread-1 (]: Timing info for seed.integration_tests.contacts (execute): 13:09:42.970668 => 13:09:43.314362
[0m13:09:43.315170 [debug] [Thread-1 (]: On seed.integration_tests.contacts: Close
[0m13:09:43.316118 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'aeaf32a1-2e71-4a2e-a7ff-005349db65e8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd4da51ad50>]}
[0m13:09:43.316972 [info ] [Thread-1 (]: 1 of 15 OK loaded seed file public.contacts .................................... [[32mINSERT 10[0m in 0.36s]
[0m13:09:43.317724 [debug] [Thread-1 (]: Finished running node seed.integration_tests.contacts
[0m13:09:43.318231 [debug] [Thread-1 (]: Began running node test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d
[0m13:09:43.318691 [info ] [Thread-1 (]: 6 of 15 START test source_not_null_salesforce_contacts_id ...................... [RUN]
[0m13:09:43.319818 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly seed.integration_tests.contacts, now test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d)
[0m13:09:43.320345 [debug] [Thread-1 (]: Began compiling node test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d
[0m13:09:43.353450 [debug] [Thread-1 (]: Writing injected SQL for node "test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d"
[0m13:09:43.354395 [debug] [Thread-1 (]: Timing info for test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d (compile): 13:09:43.320651 => 13:09:43.354078
[0m13:09:43.354937 [debug] [Thread-1 (]: Began executing node test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d
[0m13:09:43.385945 [debug] [Thread-1 (]: Writing runtime sql for node "test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d"
[0m13:09:43.386828 [debug] [Thread-1 (]: Using postgres connection "test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d"
[0m13:09:43.387391 [debug] [Thread-1 (]: On test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d: BEGIN
[0m13:09:43.387899 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:09:43.413631 [debug] [Thread-3 (]: SQL status: BEGIN in 0.0 seconds
[0m13:09:43.414206 [debug] [Thread-3 (]: Using postgres connection "test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247"
[0m13:09:43.414687 [debug] [Thread-3 (]: On test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

with all_values as (

    select
        category as value_field,
        count(*) as n_records

    from "dbt"."public"."transactions"
    group by category

)

select *
from all_values
where value_field not in (
    'Apps & Games','Beauty','Books','Clothing, Shoes & Accessories','Movies & TV','Sports, Fitness & Outdoors'
)



      
    ) dbt_internal_test
[0m13:09:43.415135 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m13:09:43.415787 [debug] [Thread-1 (]: Using postgres connection "test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d"
[0m13:09:43.416374 [debug] [Thread-1 (]: On test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select id
from "dbt"."public"."contacts"
where id is null



      
    ) dbt_internal_test
[0m13:09:43.418311 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.0 seconds
[0m13:09:43.420401 [debug] [Thread-1 (]: Timing info for test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d (execute): 13:09:43.355244 => 13:09:43.420070
[0m13:09:43.420919 [debug] [Thread-1 (]: On test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d: ROLLBACK
[0m13:09:43.434679 [debug] [Thread-1 (]: On test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d: Close
[0m13:09:43.435923 [info ] [Thread-1 (]: 6 of 15 PASS source_not_null_salesforce_contacts_id ............................ [[32mPASS[0m in 0.12s]
[0m13:09:43.438911 [debug] [Thread-1 (]: Finished running node test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d
[0m13:09:43.439586 [debug] [Thread-1 (]: Began running node test.customer360.source_not_null_web_transactions_id.88a47bf7e5
[0m13:09:43.440073 [info ] [Thread-1 (]: 7 of 15 START test source_not_null_web_transactions_id ......................... [RUN]
[0m13:09:43.441013 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d, now test.customer360.source_not_null_web_transactions_id.88a47bf7e5)
[0m13:09:43.441574 [debug] [Thread-1 (]: Began compiling node test.customer360.source_not_null_web_transactions_id.88a47bf7e5
[0m13:09:43.447788 [debug] [Thread-1 (]: Writing injected SQL for node "test.customer360.source_not_null_web_transactions_id.88a47bf7e5"
[0m13:09:43.448743 [debug] [Thread-1 (]: Timing info for test.customer360.source_not_null_web_transactions_id.88a47bf7e5 (compile): 13:09:43.441877 => 13:09:43.448500
[0m13:09:43.449096 [debug] [Thread-1 (]: Began executing node test.customer360.source_not_null_web_transactions_id.88a47bf7e5
[0m13:09:43.452112 [debug] [Thread-1 (]: Writing runtime sql for node "test.customer360.source_not_null_web_transactions_id.88a47bf7e5"
[0m13:09:43.452649 [debug] [Thread-1 (]: Using postgres connection "test.customer360.source_not_null_web_transactions_id.88a47bf7e5"
[0m13:09:43.453083 [debug] [Thread-1 (]: On test.customer360.source_not_null_web_transactions_id.88a47bf7e5: BEGIN
[0m13:09:43.453461 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:09:43.475346 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m13:09:43.475926 [debug] [Thread-1 (]: Using postgres connection "test.customer360.source_not_null_web_transactions_id.88a47bf7e5"
[0m13:09:43.476473 [debug] [Thread-1 (]: On test.customer360.source_not_null_web_transactions_id.88a47bf7e5: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.source_not_null_web_transactions_id.88a47bf7e5"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select id
from "dbt"."public"."transactions"
where id is null



      
    ) dbt_internal_test
[0m13:09:43.503280 [debug] [Thread-2 (]: Using postgres connection "seed.integration_tests.transactions"
[0m13:09:43.503945 [debug] [Thread-2 (]: On seed.integration_tests.transactions: 
          insert into "dbt"."public"."transactions" ("contact_id", "id", "transaction_date", "amount", "item_count", "category", "_loaded_at_utc") values
          (%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%...
[0m13:09:43.506869 [debug] [Thread-2 (]: SQL status: INSERT 0 74 in 0.0 seconds
[0m13:09:43.508000 [debug] [Thread-2 (]: Writing runtime SQL for node "seed.integration_tests.transactions"
[0m13:09:43.510469 [debug] [Thread-2 (]: On seed.integration_tests.transactions: COMMIT
[0m13:09:43.510960 [debug] [Thread-2 (]: Using postgres connection "seed.integration_tests.transactions"
[0m13:09:43.511432 [debug] [Thread-2 (]: On seed.integration_tests.transactions: COMMIT
[0m13:09:43.514836 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.0 seconds
[0m13:09:43.517046 [debug] [Thread-1 (]: Timing info for test.customer360.source_not_null_web_transactions_id.88a47bf7e5 (execute): 13:09:43.449316 => 13:09:43.516730
[0m13:09:43.517611 [debug] [Thread-1 (]: On test.customer360.source_not_null_web_transactions_id.88a47bf7e5: ROLLBACK
[0m13:09:43.518105 [debug] [Thread-2 (]: SQL status: COMMIT in 0.0 seconds
[0m13:09:43.519413 [debug] [Thread-2 (]: Timing info for seed.integration_tests.transactions (execute): 13:09:42.958646 => 13:09:43.519064
[0m13:09:43.519902 [debug] [Thread-2 (]: On seed.integration_tests.transactions: Close
[0m13:09:43.520890 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'aeaf32a1-2e71-4a2e-a7ff-005349db65e8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd4dad710d0>]}
[0m13:09:43.522598 [debug] [Thread-3 (]: SQL status: SELECT 1 in 0.0 seconds
[0m13:09:43.524268 [debug] [Thread-3 (]: Timing info for test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247 (execute): 13:09:43.306128 => 13:09:43.523990
[0m13:09:43.524858 [debug] [Thread-3 (]: On test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247: ROLLBACK
[0m13:09:43.521600 [info ] [Thread-2 (]: 2 of 15 OK loaded seed file public.transactions ................................ [[32mINSERT 74[0m in 0.57s]
[0m13:09:43.525775 [debug] [Thread-2 (]: Finished running node seed.integration_tests.transactions
[0m13:09:43.526397 [debug] [Thread-2 (]: Began running node test.customer360.source_unique_salesforce_contacts_id.01cadaaf43
[0m13:09:43.526927 [info ] [Thread-2 (]: 8 of 15 START test source_unique_salesforce_contacts_id ........................ [RUN]
[0m13:09:43.527803 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly seed.integration_tests.transactions, now test.customer360.source_unique_salesforce_contacts_id.01cadaaf43)
[0m13:09:43.528284 [debug] [Thread-2 (]: Began compiling node test.customer360.source_unique_salesforce_contacts_id.01cadaaf43
[0m13:09:43.537421 [debug] [Thread-2 (]: Writing injected SQL for node "test.customer360.source_unique_salesforce_contacts_id.01cadaaf43"
[0m13:09:43.538242 [debug] [Thread-2 (]: Timing info for test.customer360.source_unique_salesforce_contacts_id.01cadaaf43 (compile): 13:09:43.528661 => 13:09:43.537932
[0m13:09:43.538779 [debug] [Thread-2 (]: Began executing node test.customer360.source_unique_salesforce_contacts_id.01cadaaf43
[0m13:09:43.542350 [debug] [Thread-2 (]: Writing runtime sql for node "test.customer360.source_unique_salesforce_contacts_id.01cadaaf43"
[0m13:09:43.543047 [debug] [Thread-2 (]: Using postgres connection "test.customer360.source_unique_salesforce_contacts_id.01cadaaf43"
[0m13:09:43.543547 [debug] [Thread-2 (]: On test.customer360.source_unique_salesforce_contacts_id.01cadaaf43: BEGIN
[0m13:09:43.544067 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m13:09:43.545470 [debug] [Thread-3 (]: On test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247: Close
[0m13:09:43.546516 [info ] [Thread-3 (]: 5 of 15 PASS source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors  [[32mPASS[0m in 0.27s]
[0m13:09:43.547344 [debug] [Thread-3 (]: Finished running node test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247
[0m13:09:43.547938 [debug] [Thread-3 (]: Began running node test.customer360.source_unique_web_transactions_id.ba28079761
[0m13:09:43.548463 [info ] [Thread-3 (]: 9 of 15 START test source_unique_web_transactions_id ........................... [RUN]
[0m13:09:43.549272 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247, now test.customer360.source_unique_web_transactions_id.ba28079761)
[0m13:09:43.551545 [debug] [Thread-3 (]: Began compiling node test.customer360.source_unique_web_transactions_id.ba28079761
[0m13:09:43.557219 [debug] [Thread-3 (]: Writing injected SQL for node "test.customer360.source_unique_web_transactions_id.ba28079761"
[0m13:09:43.558010 [debug] [Thread-3 (]: Timing info for test.customer360.source_unique_web_transactions_id.ba28079761 (compile): 13:09:43.551839 => 13:09:43.557720
[0m13:09:43.558523 [debug] [Thread-3 (]: Began executing node test.customer360.source_unique_web_transactions_id.ba28079761
[0m13:09:43.562075 [debug] [Thread-3 (]: Writing runtime sql for node "test.customer360.source_unique_web_transactions_id.ba28079761"
[0m13:09:43.562845 [debug] [Thread-3 (]: Using postgres connection "test.customer360.source_unique_web_transactions_id.ba28079761"
[0m13:09:43.563348 [debug] [Thread-3 (]: On test.customer360.source_unique_web_transactions_id.ba28079761: BEGIN
[0m13:09:43.563815 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m13:09:43.567330 [debug] [Thread-2 (]: SQL status: BEGIN in 0.0 seconds
[0m13:09:43.567902 [debug] [Thread-2 (]: Using postgres connection "test.customer360.source_unique_salesforce_contacts_id.01cadaaf43"
[0m13:09:43.568440 [debug] [Thread-2 (]: On test.customer360.source_unique_salesforce_contacts_id.01cadaaf43: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.source_unique_salesforce_contacts_id.01cadaaf43"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

select
    id as unique_field,
    count(*) as n_records

from "dbt"."public"."contacts"
where id is not null
group by id
having count(*) > 1



      
    ) dbt_internal_test
[0m13:09:43.571403 [debug] [Thread-2 (]: SQL status: SELECT 1 in 0.0 seconds
[0m13:09:43.573479 [debug] [Thread-2 (]: Timing info for test.customer360.source_unique_salesforce_contacts_id.01cadaaf43 (execute): 13:09:43.539085 => 13:09:43.573092
[0m13:09:43.573995 [debug] [Thread-2 (]: On test.customer360.source_unique_salesforce_contacts_id.01cadaaf43: ROLLBACK
[0m13:09:43.574909 [debug] [Thread-2 (]: On test.customer360.source_unique_salesforce_contacts_id.01cadaaf43: Close
[0m13:09:43.575964 [info ] [Thread-2 (]: 8 of 15 PASS source_unique_salesforce_contacts_id .............................. [[32mPASS[0m in 0.05s]
[0m13:09:43.578941 [debug] [Thread-2 (]: Finished running node test.customer360.source_unique_salesforce_contacts_id.01cadaaf43
[0m13:09:43.579555 [debug] [Thread-2 (]: Began running node test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344
[0m13:09:43.580086 [info ] [Thread-2 (]: 10 of 15 START test source_relationships_web_transactions_contact_id__id__ref_contacts_  [RUN]
[0m13:09:43.580960 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.customer360.source_unique_salesforce_contacts_id.01cadaaf43, now test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344)
[0m13:09:43.581534 [debug] [Thread-2 (]: Began compiling node test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344
[0m13:09:43.589111 [debug] [Thread-2 (]: Writing injected SQL for node "test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344"
[0m13:09:43.589931 [debug] [Thread-2 (]: Timing info for test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344 (compile): 13:09:43.581885 => 13:09:43.589628
[0m13:09:43.590790 [debug] [Thread-2 (]: Began executing node test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344
[0m13:09:43.595331 [debug] [Thread-2 (]: Writing runtime sql for node "test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344"
[0m13:09:43.596056 [debug] [Thread-2 (]: Using postgres connection "test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344"
[0m13:09:43.596821 [debug] [Thread-2 (]: On test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344: BEGIN
[0m13:09:43.597322 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m13:09:43.598482 [debug] [Thread-3 (]: SQL status: BEGIN in 0.0 seconds
[0m13:09:43.598965 [debug] [Thread-3 (]: Using postgres connection "test.customer360.source_unique_web_transactions_id.ba28079761"
[0m13:09:43.599501 [debug] [Thread-3 (]: On test.customer360.source_unique_web_transactions_id.ba28079761: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.source_unique_web_transactions_id.ba28079761"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

select
    id as unique_field,
    count(*) as n_records

from "dbt"."public"."transactions"
where id is not null
group by id
having count(*) > 1



      
    ) dbt_internal_test
[0m13:09:43.602547 [debug] [Thread-3 (]: SQL status: SELECT 1 in 0.0 seconds
[0m13:09:43.604552 [debug] [Thread-3 (]: Timing info for test.customer360.source_unique_web_transactions_id.ba28079761 (execute): 13:09:43.558829 => 13:09:43.604218
[0m13:09:43.605067 [debug] [Thread-3 (]: On test.customer360.source_unique_web_transactions_id.ba28079761: ROLLBACK
[0m13:09:43.605943 [debug] [Thread-3 (]: On test.customer360.source_unique_web_transactions_id.ba28079761: Close
[0m13:09:43.607002 [info ] [Thread-3 (]: 9 of 15 PASS source_unique_web_transactions_id ................................. [[32mPASS[0m in 0.06s]
[0m13:09:43.607725 [debug] [Thread-3 (]: Finished running node test.customer360.source_unique_web_transactions_id.ba28079761
[0m13:09:43.611734 [debug] [Thread-3 (]: Began running node model.customer360.stg_sf__contacts
[0m13:09:43.612447 [info ] [Thread-3 (]: 11 of 15 START sql table model public.stg_sf__contacts ......................... [RUN]
[0m13:09:43.613465 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.customer360.source_unique_web_transactions_id.ba28079761, now model.customer360.stg_sf__contacts)
[0m13:09:43.613959 [debug] [Thread-3 (]: Began compiling node model.customer360.stg_sf__contacts
[0m13:09:43.686264 [debug] [Thread-1 (]: On test.customer360.source_not_null_web_transactions_id.88a47bf7e5: Close
[0m13:09:43.689657 [info ] [Thread-1 (]: 7 of 15 PASS source_not_null_web_transactions_id ............................... [[32mPASS[0m in 0.25s]
[0m13:09:43.690641 [debug] [Thread-1 (]: Finished running node test.customer360.source_not_null_web_transactions_id.88a47bf7e5
[0m13:09:43.688619 [debug] [Thread-3 (]: Writing injected SQL for node "model.customer360.stg_sf__contacts"
[0m13:09:43.691347 [debug] [Thread-1 (]: Began running node model.customer360.stg_web__transactions
[0m13:09:43.692267 [info ] [Thread-1 (]: 12 of 15 START sql table model public.stg_web__transactions .................... [RUN]
[0m13:09:43.692907 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.customer360.source_not_null_web_transactions_id.88a47bf7e5, now model.customer360.stg_web__transactions)
[0m13:09:43.691734 [debug] [Thread-2 (]: SQL status: BEGIN in 0.0 seconds
[0m13:09:43.693498 [debug] [Thread-3 (]: Timing info for model.customer360.stg_sf__contacts (compile): 13:09:43.614250 => 13:09:43.693224
[0m13:09:43.693875 [debug] [Thread-1 (]: Began compiling node model.customer360.stg_web__transactions
[0m13:09:43.694255 [debug] [Thread-2 (]: Using postgres connection "test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344"
[0m13:09:43.694645 [debug] [Thread-3 (]: Began executing node model.customer360.stg_sf__contacts
[0m13:09:43.697473 [debug] [Thread-1 (]: Writing injected SQL for node "model.customer360.stg_web__transactions"
[0m13:09:43.697878 [debug] [Thread-2 (]: On test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

with child as (
    select contact_id as from_field
    from "dbt"."public"."transactions"
    where contact_id is not null
),

parent as (
    select id as to_field
    from "dbt"."public"."contacts"
)

select
    from_field

from child
left join parent
    on child.from_field = parent.to_field

where parent.to_field is null



      
    ) dbt_internal_test
[0m13:09:43.713997 [debug] [Thread-1 (]: Timing info for model.customer360.stg_web__transactions (compile): 13:09:43.694872 => 13:09:43.713666
[0m13:09:43.714513 [debug] [Thread-1 (]: Began executing node model.customer360.stg_web__transactions
[0m13:09:43.731855 [debug] [Thread-2 (]: SQL status: SELECT 1 in 0.0 seconds
[0m13:09:43.738465 [debug] [Thread-2 (]: Timing info for test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344 (execute): 13:09:43.591117 => 13:09:43.738209
[0m13:09:43.746314 [debug] [Thread-1 (]: Writing runtime sql for node "model.customer360.stg_web__transactions"
[0m13:09:43.746701 [debug] [Thread-2 (]: On test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344: ROLLBACK
[0m13:09:43.748041 [debug] [Thread-3 (]: Writing runtime sql for node "model.customer360.stg_sf__contacts"
[0m13:09:43.748804 [debug] [Thread-1 (]: Using postgres connection "model.customer360.stg_web__transactions"
[0m13:09:43.749214 [debug] [Thread-2 (]: On test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344: Close
[0m13:09:43.749598 [debug] [Thread-1 (]: On model.customer360.stg_web__transactions: BEGIN
[0m13:09:43.750620 [info ] [Thread-2 (]: 10 of 15 PASS source_relationships_web_transactions_contact_id__id__ref_contacts_  [[32mPASS[0m in 0.17s]
[0m13:09:43.752141 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:09:43.752527 [debug] [Thread-3 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m13:09:43.753622 [debug] [Thread-3 (]: On model.customer360.stg_sf__contacts: BEGIN
[0m13:09:43.754088 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m13:09:43.753039 [debug] [Thread-2 (]: Finished running node test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344
[0m13:09:43.757466 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m13:09:43.757895 [debug] [Thread-1 (]: Using postgres connection "model.customer360.stg_web__transactions"
[0m13:09:43.758241 [debug] [Thread-1 (]: On model.customer360.stg_web__transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_web__transactions"} */

  
    

  create  table "dbt"."public"."stg_web__transactions__dbt_tmp"
  
  
    as
  
  (
    with source as (
    select * from "dbt"."public"."transactions"
),

renamed as (
    select
        id,
        contact_id,
         as transaction_date,
        amount,
        item_count,
        category, 
        _loaded_at_utc
    from source    
),

clean_older as (
    select * from renamed 
--    where transaction_date >= (current_date - 1)  过滤超过1天的数据
    where transaction_date >= (to_date('2023-04-12','yyyy-MM-dd') - 1)  --测试用,假设跑数日期为2023-04-12
    and transaction_date < to_date('2023-04-12','yyyy-MM-dd')
)

select * from clean_older
  );
  
[0m13:09:43.759229 [debug] [Thread-1 (]: Postgres adapter: Postgres error: syntax error at or near "as"
LINE 20:          as transaction_date,
                  ^

[0m13:09:43.759711 [debug] [Thread-3 (]: SQL status: BEGIN in 0.0 seconds
[0m13:09:43.760449 [debug] [Thread-3 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m13:09:43.760802 [debug] [Thread-3 (]: On model.customer360.stg_sf__contacts: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_sf__contacts"} */

  
    

  create  table "dbt"."public"."stg_sf__contacts__dbt_tmp"
  
  
    as
  
  (
    with source as (
    select * from "dbt"."public"."contacts"
),

renamed as (
    select
        id,
        username as user_name,
        name,
        gender,
        address, 
        mail as email_address,
        birthdate as birth_date,
        _loaded_at_utc
    from source     
)

select * from renamed
  );
  
[0m13:09:43.760061 [debug] [Thread-1 (]: On model.customer360.stg_web__transactions: ROLLBACK
[0m13:09:43.761674 [debug] [Thread-1 (]: Timing info for model.customer360.stg_web__transactions (execute): 13:09:43.714853 => 13:09:43.761332
[0m13:09:43.762147 [debug] [Thread-1 (]: On model.customer360.stg_web__transactions: Close
[0m13:09:43.764948 [debug] [Thread-1 (]: Database Error in model stg_web__transactions (models/staging/web/stg_web__transactions.sql)
  syntax error at or near "as"
  LINE 20:          as transaction_date,
                    ^
  compiled Code at target/run/customer360/models/staging/web/stg_web__transactions.sql
[0m13:09:43.766014 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'aeaf32a1-2e71-4a2e-a7ff-005349db65e8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd4da3c9510>]}
[0m13:09:43.766790 [error] [Thread-1 (]: 12 of 15 ERROR creating sql table model public.stg_web__transactions ........... [[31mERROR[0m in 0.07s]
[0m13:09:43.767424 [debug] [Thread-1 (]: Finished running node model.customer360.stg_web__transactions
[0m13:09:43.768771 [debug] [Thread-3 (]: SQL status: SELECT 10 in 0.0 seconds
[0m13:09:43.774558 [debug] [Thread-3 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m13:09:43.774918 [debug] [Thread-3 (]: On model.customer360.stg_sf__contacts: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_sf__contacts"} */
alter table "dbt"."public"."stg_sf__contacts" rename to "stg_sf__contacts__dbt_backup"
[0m13:09:43.775660 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m13:09:43.778110 [debug] [Thread-3 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m13:09:43.778453 [debug] [Thread-3 (]: On model.customer360.stg_sf__contacts: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_sf__contacts"} */
alter table "dbt"."public"."stg_sf__contacts__dbt_tmp" rename to "stg_sf__contacts"
[0m13:09:43.779062 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m13:09:43.785619 [debug] [Thread-3 (]: On model.customer360.stg_sf__contacts: COMMIT
[0m13:09:43.785967 [debug] [Thread-3 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m13:09:43.786288 [debug] [Thread-3 (]: On model.customer360.stg_sf__contacts: COMMIT
[0m13:09:43.788998 [debug] [Thread-3 (]: SQL status: COMMIT in 0.0 seconds
[0m13:09:43.794603 [debug] [Thread-3 (]: Applying DROP to: "dbt"."public"."stg_sf__contacts__dbt_backup"
[0m13:09:43.799247 [debug] [Thread-3 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m13:09:43.799606 [debug] [Thread-3 (]: On model.customer360.stg_sf__contacts: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_sf__contacts"} */
drop table if exists "dbt"."public"."stg_sf__contacts__dbt_backup" cascade
[0m13:09:43.802990 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.0 seconds
[0m13:09:43.804353 [debug] [Thread-3 (]: Timing info for model.customer360.stg_sf__contacts (execute): 13:09:43.698142 => 13:09:43.804121
[0m13:09:43.804696 [debug] [Thread-3 (]: On model.customer360.stg_sf__contacts: Close
[0m13:09:43.805531 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'aeaf32a1-2e71-4a2e-a7ff-005349db65e8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd4d807cfd0>]}
[0m13:09:43.806175 [info ] [Thread-3 (]: 11 of 15 OK created sql table model public.stg_sf__contacts .................... [[32mSELECT 10[0m in 0.19s]
[0m13:09:43.806851 [debug] [Thread-3 (]: Finished running node model.customer360.stg_sf__contacts
[0m13:09:43.807794 [debug] [Thread-2 (]: Began running node model.customer360.contacts_joined_with_transactions
[0m13:09:43.808228 [info ] [Thread-2 (]: 13 of 15 SKIP relation public.contacts_joined_with_transactions ................ [[33mSKIP[0m]
[0m13:09:43.808649 [debug] [Thread-2 (]: Finished running node model.customer360.contacts_joined_with_transactions
[0m13:09:43.809226 [debug] [Thread-3 (]: Began running node test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311
[0m13:09:43.809662 [info ] [Thread-3 (]: 14 of 15 SKIP test not_null_contacts_joined_with_transactions_id ............... [[33mSKIP[0m]
[0m13:09:43.810033 [debug] [Thread-3 (]: Finished running node test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311
[0m13:09:43.810649 [debug] [Thread-2 (]: Began running node model.customer360.customers
[0m13:09:43.811027 [info ] [Thread-2 (]: 15 of 15 SKIP relation public.customers ........................................ [[33mSKIP[0m]
[0m13:09:43.811434 [debug] [Thread-2 (]: Finished running node model.customer360.customers
[0m13:09:43.812947 [debug] [MainThread]: Using postgres connection "master"
[0m13:09:43.813228 [debug] [MainThread]: On master: BEGIN
[0m13:09:43.813533 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m13:09:43.816689 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m13:09:43.817005 [debug] [MainThread]: On master: COMMIT
[0m13:09:43.817261 [debug] [MainThread]: Using postgres connection "master"
[0m13:09:43.817553 [debug] [MainThread]: On master: COMMIT
[0m13:09:43.817987 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m13:09:43.818264 [debug] [MainThread]: On master: Close
[0m13:09:43.818871 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:09:43.819133 [debug] [MainThread]: Connection 'model.customer360.stg_web__transactions' was properly closed.
[0m13:09:43.819426 [debug] [MainThread]: Connection 'test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344' was properly closed.
[0m13:09:43.819709 [debug] [MainThread]: Connection 'model.customer360.stg_sf__contacts' was properly closed.
[0m13:09:43.820033 [info ] [MainThread]: 
[0m13:09:43.820384 [info ] [MainThread]: Finished running 9 tests, 2 seeds, 3 table models, 1 view model in 0 hours 0 minutes and 0.93 seconds (0.93s).
[0m13:09:43.822828 [debug] [MainThread]: Command end result
[0m13:09:43.831796 [info ] [MainThread]: 
[0m13:09:43.832222 [info ] [MainThread]: [31mCompleted with 2 errors and 0 warnings:[0m
[0m13:09:43.832568 [info ] [MainThread]: 
[0m13:09:43.832842 [error] [MainThread]:   Database Error in test macro_test2 (tests/macro_test2.sql)
  syntax error at or near "as"
  LINE 8:     select  as expect_result
                      ^
  compiled Code at target/run/customer360/tests/macro_test2.sql
[0m13:09:43.833127 [info ] [MainThread]: 
[0m13:09:43.833422 [error] [MainThread]:   Database Error in model stg_web__transactions (models/staging/web/stg_web__transactions.sql)
  syntax error at or near "as"
  LINE 20:          as transaction_date,
                    ^
  compiled Code at target/run/customer360/models/staging/web/stg_web__transactions.sql
[0m13:09:43.833715 [info ] [MainThread]: 
[0m13:09:43.834013 [info ] [MainThread]: Done. PASS=10 WARN=0 ERROR=2 SKIP=3 TOTAL=15
[0m13:09:43.834722 [debug] [MainThread]: Resource report: {"command_name": "build", "command_wall_clock_time": 3.0536687, "process_user_time": 4.733076, "process_kernel_time": 0.113562, "process_mem_max_rss": "120788", "process_out_blocks": "2800", "command_success": false, "process_in_blocks": "0"}
[0m13:09:43.835173 [debug] [MainThread]: Command `dbt build` failed at 13:09:43.835059 after 3.05 seconds
[0m13:09:43.835542 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd4e14b4590>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd4e14b46d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd4da776650>]}
[0m13:09:43.835870 [debug] [MainThread]: Flushing usage events
[0m13:09:51.193877 [debug] [MainThread]: Error sending anonymous usage statistics. Disabling tracking for this execution. If you wish to permanently disable tracking, see: https://docs.getdbt.com/reference/global-configs#send-anonymous-usage-stats.
[0m13:12:57.025860 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd4cd6a8590>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd4cd35c110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd4cd3be310>]}


============================== 13:12:57.028396 | 4792bdbb-d188-47ac-a61d-9ad17e3af497 ==============================
[0m13:12:57.028396 [info ] [MainThread]: Running with dbt=1.7.8
[0m13:12:57.028885 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/root/option1-customer360/integration_tests/logs', 'profiles_dir': '/root/option1-customer360/integration_tests', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt build', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m13:12:57.240239 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '4792bdbb-d188-47ac-a61d-9ad17e3af497', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd4cd34bc10>]}
[0m13:12:57.424418 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '4792bdbb-d188-47ac-a61d-9ad17e3af497', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd4ccfdcb10>]}
[0m13:12:57.425397 [info ] [MainThread]: Registered adapter: postgres=1.7.8
[0m13:12:57.479399 [debug] [MainThread]: checksum: 67f0013ca5f0bd43af9a0873dd50792fde83ef69de63b71cacd0b4ac656c52e5, vars: {}, profile: , target: , version: 1.7.8
[0m13:12:57.562256 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m13:12:57.565729 [debug] [MainThread]: Partial parsing: updated file: customer360://macros/as_timestamp_utc.sql
[0m13:12:58.427473 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '4792bdbb-d188-47ac-a61d-9ad17e3af497', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd4cb39c090>]}
[0m13:12:58.451057 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '4792bdbb-d188-47ac-a61d-9ad17e3af497', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd4cae98f10>]}
[0m13:12:58.452020 [info ] [MainThread]: Found 2 seeds, 4 models, 9 tests, 2 sources, 0 exposures, 0 metrics, 403 macros, 0 groups, 0 semantic models
[0m13:12:58.455039 [info ] [MainThread]: 
[0m13:12:58.456134 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m13:12:58.483115 [debug] [ThreadPool]: Acquiring new postgres connection 'list_dbt'
[0m13:12:58.509665 [debug] [ThreadPool]: Using postgres connection "list_dbt"
[0m13:12:58.510214 [debug] [ThreadPool]: On list_dbt: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "connection_name": "list_dbt"} */

    select distinct nspname from pg_namespace
  
[0m13:12:58.510656 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:12:58.534729 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.0 seconds
[0m13:12:58.536611 [debug] [ThreadPool]: On list_dbt: Close
[0m13:12:58.548266 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dbt, now list_dbt_public)
[0m13:12:58.557388 [debug] [ThreadPool]: Using postgres connection "list_dbt_public"
[0m13:12:58.557886 [debug] [ThreadPool]: On list_dbt_public: BEGIN
[0m13:12:58.558287 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:12:58.572347 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m13:12:58.572862 [debug] [ThreadPool]: Using postgres connection "list_dbt_public"
[0m13:12:58.573273 [debug] [ThreadPool]: On list_dbt_public: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "connection_name": "list_dbt_public"} */
select
      'dbt' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'dbt' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'dbt' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m13:12:58.577438 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.0 seconds
[0m13:12:58.579242 [debug] [ThreadPool]: On list_dbt_public: ROLLBACK
[0m13:12:58.579903 [debug] [ThreadPool]: On list_dbt_public: Close
[0m13:12:58.589167 [debug] [MainThread]: Using postgres connection "master"
[0m13:12:58.589675 [debug] [MainThread]: On master: BEGIN
[0m13:12:58.590070 [debug] [MainThread]: Opening a new connection, currently in state init
[0m13:12:58.617894 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m13:12:58.618396 [debug] [MainThread]: Using postgres connection "master"
[0m13:12:58.618930 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m13:12:58.635050 [debug] [MainThread]: SQL status: SELECT 0 in 0.0 seconds
[0m13:12:58.636710 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4792bdbb-d188-47ac-a61d-9ad17e3af497', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd4cb38d090>]}
[0m13:12:58.637313 [debug] [MainThread]: On master: ROLLBACK
[0m13:12:58.638050 [debug] [MainThread]: Using postgres connection "master"
[0m13:12:58.638503 [debug] [MainThread]: On master: BEGIN
[0m13:12:58.639375 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m13:12:58.639783 [debug] [MainThread]: On master: COMMIT
[0m13:12:58.640188 [debug] [MainThread]: Using postgres connection "master"
[0m13:12:58.640617 [debug] [MainThread]: On master: COMMIT
[0m13:12:58.641171 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m13:12:58.641620 [debug] [MainThread]: On master: Close
[0m13:12:58.642558 [info ] [MainThread]: Concurrency: 3 threads (target='local')
[0m13:12:58.643008 [info ] [MainThread]: 
[0m13:12:58.658089 [debug] [Thread-1 (]: Began running node seed.integration_tests.contacts
[0m13:12:58.658798 [info ] [Thread-1 (]: 1 of 15 START seed file public.contacts ........................................ [RUN]
[0m13:12:58.659758 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dbt_public, now seed.integration_tests.contacts)
[0m13:12:58.660253 [debug] [Thread-1 (]: Began compiling node seed.integration_tests.contacts
[0m13:12:58.660878 [debug] [Thread-1 (]: Timing info for seed.integration_tests.contacts (compile): 13:12:58.660584 => 13:12:58.660587
[0m13:12:58.661375 [debug] [Thread-1 (]: Began executing node seed.integration_tests.contacts
[0m13:12:58.690692 [debug] [Thread-2 (]: Began running node seed.integration_tests.transactions
[0m13:12:58.691438 [info ] [Thread-2 (]: 2 of 15 START seed file public.transactions .................................... [RUN]
[0m13:12:58.692536 [debug] [Thread-2 (]: Acquiring new postgres connection 'seed.integration_tests.transactions'
[0m13:12:58.693021 [debug] [Thread-2 (]: Began compiling node seed.integration_tests.transactions
[0m13:12:58.693639 [debug] [Thread-2 (]: Timing info for seed.integration_tests.transactions (compile): 13:12:58.693345 => 13:12:58.693348
[0m13:12:58.694103 [debug] [Thread-2 (]: Began executing node seed.integration_tests.transactions
[0m13:12:58.713734 [debug] [Thread-3 (]: Began running node test.customer360.macro_test1
[0m13:12:58.714370 [info ] [Thread-3 (]: 3 of 15 START test macro_test1 ................................................. [RUN]
[0m13:12:58.715432 [debug] [Thread-3 (]: Acquiring new postgres connection 'test.customer360.macro_test1'
[0m13:12:58.716033 [debug] [Thread-3 (]: Began compiling node test.customer360.macro_test1
[0m13:12:58.778957 [debug] [Thread-1 (]: Using postgres connection "seed.integration_tests.contacts"
[0m13:12:58.780204 [debug] [Thread-1 (]: On seed.integration_tests.contacts: BEGIN
[0m13:12:58.780701 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:12:58.782588 [debug] [Thread-2 (]: Using postgres connection "seed.integration_tests.transactions"
[0m13:12:58.783063 [debug] [Thread-2 (]: On seed.integration_tests.transactions: BEGIN
[0m13:12:58.783531 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m13:12:58.779808 [debug] [Thread-3 (]: Writing injected SQL for node "test.customer360.macro_test1"
[0m13:12:58.786989 [debug] [Thread-3 (]: Timing info for test.customer360.macro_test1 (compile): 13:12:58.716338 => 13:12:58.784655
[0m13:12:58.787532 [debug] [Thread-3 (]: Began executing node test.customer360.macro_test1
[0m13:12:58.813084 [debug] [Thread-3 (]: Writing runtime sql for node "test.customer360.macro_test1"
[0m13:12:58.813903 [debug] [Thread-3 (]: Using postgres connection "test.customer360.macro_test1"
[0m13:12:58.814407 [debug] [Thread-3 (]: On test.customer360.macro_test1: BEGIN
[0m13:12:58.814876 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m13:12:58.816907 [debug] [Thread-2 (]: SQL status: BEGIN in 0.0 seconds
[0m13:12:58.817420 [debug] [Thread-2 (]: Using postgres connection "seed.integration_tests.transactions"
[0m13:12:58.817931 [debug] [Thread-2 (]: On seed.integration_tests.transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "seed.integration_tests.transactions"} */
truncate table "dbt"."public"."transactions"
[0m13:12:58.822117 [debug] [Thread-3 (]: SQL status: BEGIN in 0.0 seconds
[0m13:12:58.822676 [debug] [Thread-3 (]: Using postgres connection "test.customer360.macro_test1"
[0m13:12:58.823189 [debug] [Thread-3 (]: On test.customer360.macro_test1: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.macro_test1"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      with marco_result as (
    select 
    date_part('year', age(current_date, '2023-02-12'))
 as expect_result
)
select
    1
from marco_result
where expect_result <> 1
      
    ) dbt_internal_test
[0m13:12:58.825063 [debug] [Thread-3 (]: SQL status: SELECT 1 in 0.0 seconds
[0m13:12:58.825916 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m13:12:58.829961 [debug] [Thread-1 (]: Using postgres connection "seed.integration_tests.contacts"
[0m13:12:58.830483 [debug] [Thread-1 (]: On seed.integration_tests.contacts: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "seed.integration_tests.contacts"} */
truncate table "dbt"."public"."contacts"
[0m13:12:58.829477 [debug] [Thread-3 (]: Timing info for test.customer360.macro_test1 (execute): 13:12:58.787831 => 13:12:58.829072
[0m13:12:58.831036 [debug] [Thread-3 (]: On test.customer360.macro_test1: ROLLBACK
[0m13:12:58.831834 [debug] [Thread-3 (]: On test.customer360.macro_test1: Close
[0m13:12:58.832987 [info ] [Thread-3 (]: 3 of 15 PASS macro_test1 ....................................................... [[32mPASS[0m in 0.12s]
[0m13:12:58.833821 [debug] [Thread-3 (]: Finished running node test.customer360.macro_test1
[0m13:12:58.834392 [debug] [Thread-3 (]: Began running node test.customer360.macro_test2
[0m13:12:58.834914 [info ] [Thread-3 (]: 4 of 15 START test macro_test2 ................................................. [RUN]
[0m13:12:58.835816 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.customer360.macro_test1, now test.customer360.macro_test2)
[0m13:12:58.836272 [debug] [Thread-3 (]: Began compiling node test.customer360.macro_test2
[0m13:12:58.842811 [debug] [Thread-3 (]: Writing injected SQL for node "test.customer360.macro_test2"
[0m13:12:58.843768 [debug] [Thread-3 (]: Timing info for test.customer360.macro_test2 (compile): 13:12:58.836627 => 13:12:58.843411
[0m13:12:58.844250 [debug] [Thread-3 (]: Began executing node test.customer360.macro_test2
[0m13:12:58.847666 [debug] [Thread-3 (]: Writing runtime sql for node "test.customer360.macro_test2"
[0m13:12:58.848611 [debug] [Thread-3 (]: Using postgres connection "test.customer360.macro_test2"
[0m13:12:58.849115 [debug] [Thread-3 (]: On test.customer360.macro_test2: BEGIN
[0m13:12:58.849571 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m13:12:58.850726 [debug] [Thread-2 (]: SQL status: TRUNCATE TABLE in 0.0 seconds
[0m13:12:58.861604 [debug] [Thread-1 (]: SQL status: TRUNCATE TABLE in 0.0 seconds
[0m13:12:58.891894 [debug] [Thread-3 (]: SQL status: BEGIN in 0.0 seconds
[0m13:12:58.892482 [debug] [Thread-3 (]: Using postgres connection "test.customer360.macro_test2"
[0m13:12:58.893049 [debug] [Thread-3 (]: On test.customer360.macro_test2: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.macro_test2"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      with marco_result as (
    select  as expect_result
)
select
    1
from marco_result
where cast(pg_typeof(expect_result) as text) not like '%timestamp%'
      
    ) dbt_internal_test
[0m13:12:58.915542 [debug] [Thread-3 (]: Postgres adapter: Postgres error: syntax error at or near "as"
LINE 8:     select  as expect_result
                    ^

[0m13:12:58.923636 [debug] [Thread-3 (]: On test.customer360.macro_test2: ROLLBACK
[0m13:12:58.931873 [debug] [Thread-3 (]: Timing info for test.customer360.macro_test2 (execute): 13:12:58.844626 => 13:12:58.931476
[0m13:12:58.932432 [debug] [Thread-3 (]: On test.customer360.macro_test2: Close
[0m13:12:58.937434 [debug] [Thread-3 (]: Database Error in test macro_test2 (tests/macro_test2.sql)
  syntax error at or near "as"
  LINE 8:     select  as expect_result
                      ^
  compiled Code at target/run/customer360/tests/macro_test2.sql
[0m13:12:58.938143 [error] [Thread-3 (]: 4 of 15 ERROR macro_test2 ...................................................... [[31mERROR[0m in 0.10s]
[0m13:12:58.938963 [debug] [Thread-3 (]: Finished running node test.customer360.macro_test2
[0m13:12:58.939590 [debug] [Thread-3 (]: Began running node test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247
[0m13:12:58.940190 [info ] [Thread-3 (]: 5 of 15 START test source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors  [RUN]
[0m13:12:58.941372 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.customer360.macro_test2, now test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247)
[0m13:12:58.941951 [debug] [Thread-3 (]: Began compiling node test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247
[0m13:12:58.969745 [debug] [Thread-1 (]: Using postgres connection "seed.integration_tests.contacts"
[0m13:12:58.970440 [debug] [Thread-1 (]: On seed.integration_tests.contacts: 
          insert into "dbt"."public"."contacts" ("id", "username", "name", "gender", "address", "mail", "birthdate", "_loaded_at_utc") values
          (%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s)
      ...
[0m13:12:58.981895 [debug] [Thread-1 (]: SQL status: INSERT 0 10 in 0.0 seconds
[0m13:12:58.990414 [debug] [Thread-1 (]: Writing runtime SQL for node "seed.integration_tests.contacts"
[0m13:12:59.004517 [debug] [Thread-3 (]: Writing injected SQL for node "test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247"
[0m13:12:59.019004 [debug] [Thread-1 (]: On seed.integration_tests.contacts: COMMIT
[0m13:12:59.030539 [debug] [Thread-1 (]: Using postgres connection "seed.integration_tests.contacts"
[0m13:12:59.030904 [debug] [Thread-1 (]: On seed.integration_tests.contacts: COMMIT
[0m13:12:59.041703 [debug] [Thread-3 (]: Timing info for test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247 (compile): 13:12:58.942268 => 13:12:59.041432
[0m13:12:59.047215 [debug] [Thread-1 (]: SQL status: COMMIT in 0.0 seconds
[0m13:12:59.057451 [debug] [Thread-3 (]: Began executing node test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247
[0m13:12:59.063516 [debug] [Thread-1 (]: Timing info for seed.integration_tests.contacts (execute): 13:12:58.661665 => 13:12:59.063315
[0m13:12:59.089496 [debug] [Thread-1 (]: On seed.integration_tests.contacts: Close
[0m13:12:59.070912 [debug] [Thread-3 (]: Writing runtime sql for node "test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247"
[0m13:12:59.100498 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4792bdbb-d188-47ac-a61d-9ad17e3af497', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd4cac6d310>]}
[0m13:12:59.120978 [info ] [Thread-1 (]: 1 of 15 OK loaded seed file public.contacts .................................... [[32mINSERT 10[0m in 0.44s]
[0m13:12:59.120238 [debug] [Thread-2 (]: Using postgres connection "seed.integration_tests.transactions"
[0m13:12:59.121543 [debug] [Thread-1 (]: Finished running node seed.integration_tests.contacts
[0m13:12:59.122099 [debug] [Thread-3 (]: Using postgres connection "test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247"
[0m13:12:59.123497 [debug] [Thread-3 (]: On test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247: BEGIN
[0m13:12:59.123025 [debug] [Thread-1 (]: Began running node test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d
[0m13:12:59.122535 [debug] [Thread-2 (]: On seed.integration_tests.transactions: 
          insert into "dbt"."public"."transactions" ("contact_id", "id", "transaction_date", "amount", "item_count", "category", "_loaded_at_utc") values
          (%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%...
[0m13:12:59.123925 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m13:12:59.124350 [info ] [Thread-1 (]: 6 of 15 START test source_not_null_salesforce_contacts_id ...................... [RUN]
[0m13:12:59.125975 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly seed.integration_tests.contacts, now test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d)
[0m13:12:59.126510 [debug] [Thread-1 (]: Began compiling node test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d
[0m13:12:59.134454 [debug] [Thread-1 (]: Writing injected SQL for node "test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d"
[0m13:12:59.135612 [debug] [Thread-1 (]: Timing info for test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d (compile): 13:12:59.126810 => 13:12:59.135325
[0m13:12:59.134862 [debug] [Thread-2 (]: SQL status: INSERT 0 74 in 0.0 seconds
[0m13:12:59.136087 [debug] [Thread-3 (]: SQL status: BEGIN in 0.0 seconds
[0m13:12:59.136459 [debug] [Thread-1 (]: Began executing node test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d
[0m13:12:59.137224 [debug] [Thread-2 (]: Writing runtime SQL for node "seed.integration_tests.transactions"
[0m13:12:59.137790 [debug] [Thread-3 (]: Using postgres connection "test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247"
[0m13:12:59.140386 [debug] [Thread-3 (]: On test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

with all_values as (

    select
        category as value_field,
        count(*) as n_records

    from "dbt"."public"."transactions"
    group by category

)

select *
from all_values
where value_field not in (
    'Apps & Games','Beauty','Books','Clothing, Shoes & Accessories','Movies & TV','Sports, Fitness & Outdoors'
)



      
    ) dbt_internal_test
[0m13:12:59.139855 [debug] [Thread-1 (]: Writing runtime sql for node "test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d"
[0m13:12:59.141049 [debug] [Thread-1 (]: Using postgres connection "test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d"
[0m13:12:59.141461 [debug] [Thread-1 (]: On test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d: BEGIN
[0m13:12:59.141907 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:12:59.144160 [debug] [Thread-2 (]: On seed.integration_tests.transactions: COMMIT
[0m13:12:59.144512 [debug] [Thread-2 (]: Using postgres connection "seed.integration_tests.transactions"
[0m13:12:59.144823 [debug] [Thread-2 (]: On seed.integration_tests.transactions: COMMIT
[0m13:12:59.147572 [debug] [Thread-2 (]: SQL status: COMMIT in 0.0 seconds
[0m13:12:59.148591 [debug] [Thread-2 (]: Timing info for seed.integration_tests.transactions (execute): 13:12:58.694405 => 13:12:59.148380
[0m13:12:59.148922 [debug] [Thread-2 (]: On seed.integration_tests.transactions: Close
[0m13:12:59.149733 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4792bdbb-d188-47ac-a61d-9ad17e3af497', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd4cac6ec10>]}
[0m13:12:59.150358 [info ] [Thread-2 (]: 2 of 15 OK loaded seed file public.transactions ................................ [[32mINSERT 74[0m in 0.46s]
[0m13:12:59.151066 [debug] [Thread-2 (]: Finished running node seed.integration_tests.transactions
[0m13:12:59.151499 [debug] [Thread-2 (]: Began running node test.customer360.source_not_null_web_transactions_id.88a47bf7e5
[0m13:12:59.152400 [info ] [Thread-2 (]: 7 of 15 START test source_not_null_web_transactions_id ......................... [RUN]
[0m13:12:59.152980 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly seed.integration_tests.transactions, now test.customer360.source_not_null_web_transactions_id.88a47bf7e5)
[0m13:12:59.153480 [debug] [Thread-2 (]: Began compiling node test.customer360.source_not_null_web_transactions_id.88a47bf7e5
[0m13:12:59.151949 [debug] [Thread-3 (]: SQL status: SELECT 1 in 0.0 seconds
[0m13:12:59.159903 [debug] [Thread-3 (]: Timing info for test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247 (execute): 13:12:59.068862 => 13:12:59.159655
[0m13:12:59.160870 [debug] [Thread-3 (]: On test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247: ROLLBACK
[0m13:12:59.160371 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m13:12:59.161479 [debug] [Thread-1 (]: Using postgres connection "test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d"
[0m13:12:59.161945 [debug] [Thread-1 (]: On test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select id
from "dbt"."public"."contacts"
where id is null



      
    ) dbt_internal_test
[0m13:12:59.164492 [debug] [Thread-3 (]: On test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247: Close
[0m13:12:59.165609 [info ] [Thread-3 (]: 5 of 15 PASS source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors  [[32mPASS[0m in 0.22s]
[0m13:12:59.168373 [debug] [Thread-3 (]: Finished running node test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247
[0m13:12:59.169190 [debug] [Thread-3 (]: Began running node test.customer360.source_unique_salesforce_contacts_id.01cadaaf43
[0m13:12:59.158116 [debug] [Thread-2 (]: Writing injected SQL for node "test.customer360.source_not_null_web_transactions_id.88a47bf7e5"
[0m13:12:59.169752 [info ] [Thread-3 (]: 8 of 15 START test source_unique_salesforce_contacts_id ........................ [RUN]
[0m13:12:59.171524 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247, now test.customer360.source_unique_salesforce_contacts_id.01cadaaf43)
[0m13:12:59.171998 [debug] [Thread-3 (]: Began compiling node test.customer360.source_unique_salesforce_contacts_id.01cadaaf43
[0m13:12:59.170417 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.0 seconds
[0m13:12:59.179785 [debug] [Thread-3 (]: Writing injected SQL for node "test.customer360.source_unique_salesforce_contacts_id.01cadaaf43"
[0m13:12:59.182382 [debug] [Thread-3 (]: Timing info for test.customer360.source_unique_salesforce_contacts_id.01cadaaf43 (compile): 13:12:59.172276 => 13:12:59.182125
[0m13:12:59.181807 [debug] [Thread-2 (]: Timing info for test.customer360.source_not_null_web_transactions_id.88a47bf7e5 (compile): 13:12:59.153694 => 13:12:59.181575
[0m13:12:59.183427 [debug] [Thread-2 (]: Began executing node test.customer360.source_not_null_web_transactions_id.88a47bf7e5
[0m13:12:59.181286 [debug] [Thread-1 (]: Timing info for test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d (execute): 13:12:59.138045 => 13:12:59.181070
[0m13:12:59.187069 [debug] [Thread-1 (]: On test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d: ROLLBACK
[0m13:12:59.182755 [debug] [Thread-3 (]: Began executing node test.customer360.source_unique_salesforce_contacts_id.01cadaaf43
[0m13:12:59.186587 [debug] [Thread-2 (]: Writing runtime sql for node "test.customer360.source_not_null_web_transactions_id.88a47bf7e5"
[0m13:12:59.190610 [debug] [Thread-2 (]: Using postgres connection "test.customer360.source_not_null_web_transactions_id.88a47bf7e5"
[0m13:12:59.191609 [debug] [Thread-2 (]: On test.customer360.source_not_null_web_transactions_id.88a47bf7e5: BEGIN
[0m13:12:59.192048 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m13:12:59.191157 [debug] [Thread-1 (]: On test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d: Close
[0m13:12:59.193136 [info ] [Thread-1 (]: 6 of 15 PASS source_not_null_salesforce_contacts_id ............................ [[32mPASS[0m in 0.07s]
[0m13:12:59.193849 [debug] [Thread-1 (]: Finished running node test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d
[0m13:12:59.194377 [debug] [Thread-1 (]: Began running node test.customer360.source_unique_web_transactions_id.ba28079761
[0m13:12:59.194865 [info ] [Thread-1 (]: 9 of 15 START test source_unique_web_transactions_id ........................... [RUN]
[0m13:12:59.195680 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d, now test.customer360.source_unique_web_transactions_id.ba28079761)
[0m13:12:59.189996 [debug] [Thread-3 (]: Writing runtime sql for node "test.customer360.source_unique_salesforce_contacts_id.01cadaaf43"
[0m13:12:59.197187 [debug] [Thread-3 (]: Using postgres connection "test.customer360.source_unique_salesforce_contacts_id.01cadaaf43"
[0m13:12:59.197690 [debug] [Thread-3 (]: On test.customer360.source_unique_salesforce_contacts_id.01cadaaf43: BEGIN
[0m13:12:59.198258 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m13:12:59.196205 [debug] [Thread-1 (]: Began compiling node test.customer360.source_unique_web_transactions_id.ba28079761
[0m13:12:59.198749 [debug] [Thread-2 (]: SQL status: BEGIN in 0.0 seconds
[0m13:12:59.204591 [debug] [Thread-2 (]: Using postgres connection "test.customer360.source_not_null_web_transactions_id.88a47bf7e5"
[0m13:12:59.205067 [debug] [Thread-2 (]: On test.customer360.source_not_null_web_transactions_id.88a47bf7e5: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.source_not_null_web_transactions_id.88a47bf7e5"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select id
from "dbt"."public"."transactions"
where id is null



      
    ) dbt_internal_test
[0m13:12:59.204004 [debug] [Thread-1 (]: Writing injected SQL for node "test.customer360.source_unique_web_transactions_id.ba28079761"
[0m13:12:59.206147 [debug] [Thread-1 (]: Timing info for test.customer360.source_unique_web_transactions_id.ba28079761 (compile): 13:12:59.199099 => 13:12:59.205855
[0m13:12:59.206645 [debug] [Thread-1 (]: Began executing node test.customer360.source_unique_web_transactions_id.ba28079761
[0m13:12:59.205476 [debug] [Thread-3 (]: SQL status: BEGIN in 0.0 seconds
[0m13:12:59.210030 [debug] [Thread-1 (]: Writing runtime sql for node "test.customer360.source_unique_web_transactions_id.ba28079761"
[0m13:12:59.210415 [debug] [Thread-2 (]: SQL status: SELECT 1 in 0.0 seconds
[0m13:12:59.210776 [debug] [Thread-3 (]: Using postgres connection "test.customer360.source_unique_salesforce_contacts_id.01cadaaf43"
[0m13:12:59.212707 [debug] [Thread-3 (]: On test.customer360.source_unique_salesforce_contacts_id.01cadaaf43: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.source_unique_salesforce_contacts_id.01cadaaf43"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

select
    id as unique_field,
    count(*) as n_records

from "dbt"."public"."contacts"
where id is not null
group by id
having count(*) > 1



      
    ) dbt_internal_test
[0m13:12:59.212210 [debug] [Thread-2 (]: Timing info for test.customer360.source_not_null_web_transactions_id.88a47bf7e5 (execute): 13:12:59.183772 => 13:12:59.211995
[0m13:12:59.213110 [debug] [Thread-1 (]: Using postgres connection "test.customer360.source_unique_web_transactions_id.ba28079761"
[0m13:12:59.213956 [debug] [Thread-1 (]: On test.customer360.source_unique_web_transactions_id.ba28079761: BEGIN
[0m13:12:59.214471 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:12:59.213557 [debug] [Thread-2 (]: On test.customer360.source_not_null_web_transactions_id.88a47bf7e5: ROLLBACK
[0m13:12:59.216165 [debug] [Thread-3 (]: SQL status: SELECT 1 in 0.0 seconds
[0m13:12:59.217896 [debug] [Thread-3 (]: Timing info for test.customer360.source_unique_salesforce_contacts_id.01cadaaf43 (execute): 13:12:59.187463 => 13:12:59.217692
[0m13:12:59.218218 [debug] [Thread-3 (]: On test.customer360.source_unique_salesforce_contacts_id.01cadaaf43: ROLLBACK
[0m13:12:59.216592 [debug] [Thread-2 (]: On test.customer360.source_not_null_web_transactions_id.88a47bf7e5: Close
[0m13:12:59.219261 [info ] [Thread-2 (]: 7 of 15 PASS source_not_null_web_transactions_id ............................... [[32mPASS[0m in 0.07s]
[0m13:12:59.220021 [debug] [Thread-2 (]: Finished running node test.customer360.source_not_null_web_transactions_id.88a47bf7e5
[0m13:12:59.220611 [debug] [Thread-2 (]: Began running node test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344
[0m13:12:59.221075 [info ] [Thread-2 (]: 10 of 15 START test source_relationships_web_transactions_contact_id__id__ref_contacts_  [RUN]
[0m13:12:59.221880 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.customer360.source_not_null_web_transactions_id.88a47bf7e5, now test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344)
[0m13:12:59.222221 [debug] [Thread-2 (]: Began compiling node test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344
[0m13:12:59.228391 [debug] [Thread-3 (]: On test.customer360.source_unique_salesforce_contacts_id.01cadaaf43: Close
[0m13:12:59.230065 [debug] [Thread-2 (]: Writing injected SQL for node "test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344"
[0m13:12:59.230642 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m13:12:59.231105 [debug] [Thread-1 (]: Using postgres connection "test.customer360.source_unique_web_transactions_id.ba28079761"
[0m13:12:59.231748 [debug] [Thread-1 (]: On test.customer360.source_unique_web_transactions_id.ba28079761: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.source_unique_web_transactions_id.ba28079761"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

select
    id as unique_field,
    count(*) as n_records

from "dbt"."public"."transactions"
where id is not null
group by id
having count(*) > 1



      
    ) dbt_internal_test
[0m13:12:59.232619 [info ] [Thread-3 (]: 8 of 15 PASS source_unique_salesforce_contacts_id .............................. [[32mPASS[0m in 0.06s]
[0m13:12:59.234010 [debug] [Thread-3 (]: Finished running node test.customer360.source_unique_salesforce_contacts_id.01cadaaf43
[0m13:12:59.233248 [debug] [Thread-2 (]: Timing info for test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344 (compile): 13:12:59.222627 => 13:12:59.232953
[0m13:12:59.234689 [debug] [Thread-2 (]: Began executing node test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344
[0m13:12:59.235149 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.0 seconds
[0m13:12:59.235533 [debug] [Thread-3 (]: Began running node model.customer360.stg_sf__contacts
[0m13:12:59.237973 [debug] [Thread-2 (]: Writing runtime sql for node "test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344"
[0m13:12:59.240466 [debug] [Thread-2 (]: Using postgres connection "test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344"
[0m13:12:59.239839 [info ] [Thread-3 (]: 11 of 15 START sql table model public.stg_sf__contacts ......................... [RUN]
[0m13:12:59.240844 [debug] [Thread-2 (]: On test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344: BEGIN
[0m13:12:59.239389 [debug] [Thread-1 (]: Timing info for test.customer360.source_unique_web_transactions_id.ba28079761 (execute): 13:12:59.206930 => 13:12:59.239158
[0m13:12:59.241433 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.customer360.source_unique_salesforce_contacts_id.01cadaaf43, now model.customer360.stg_sf__contacts)
[0m13:12:59.241804 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m13:12:59.242167 [debug] [Thread-1 (]: On test.customer360.source_unique_web_transactions_id.ba28079761: ROLLBACK
[0m13:12:59.242542 [debug] [Thread-3 (]: Began compiling node model.customer360.stg_sf__contacts
[0m13:12:59.245327 [debug] [Thread-3 (]: Writing injected SQL for node "model.customer360.stg_sf__contacts"
[0m13:12:59.246452 [debug] [Thread-3 (]: Timing info for model.customer360.stg_sf__contacts (compile): 13:12:59.242959 => 13:12:59.246149
[0m13:12:59.246923 [debug] [Thread-3 (]: Began executing node model.customer360.stg_sf__contacts
[0m13:12:59.245781 [debug] [Thread-1 (]: On test.customer360.source_unique_web_transactions_id.ba28079761: Close
[0m13:12:59.254198 [info ] [Thread-1 (]: 9 of 15 PASS source_unique_web_transactions_id ................................. [[32mPASS[0m in 0.06s]
[0m13:12:59.254893 [debug] [Thread-1 (]: Finished running node test.customer360.source_unique_web_transactions_id.ba28079761
[0m13:12:59.261561 [debug] [Thread-2 (]: SQL status: BEGIN in 0.0 seconds
[0m13:12:59.262029 [debug] [Thread-2 (]: Using postgres connection "test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344"
[0m13:12:59.262801 [debug] [Thread-2 (]: On test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

with child as (
    select contact_id as from_field
    from "dbt"."public"."transactions"
    where contact_id is not null
),

parent as (
    select id as to_field
    from "dbt"."public"."contacts"
)

select
    from_field

from child
left join parent
    on child.from_field = parent.to_field

where parent.to_field is null



      
    ) dbt_internal_test
[0m13:12:59.286608 [debug] [Thread-2 (]: SQL status: SELECT 1 in 0.0 seconds
[0m13:12:59.288577 [debug] [Thread-2 (]: Timing info for test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344 (execute): 13:12:59.235748 => 13:12:59.288238
[0m13:12:59.289090 [debug] [Thread-2 (]: On test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344: ROLLBACK
[0m13:12:59.289771 [debug] [Thread-1 (]: Began running node model.customer360.stg_web__transactions
[0m13:12:59.290604 [info ] [Thread-1 (]: 12 of 15 START sql table model public.stg_web__transactions .................... [RUN]
[0m13:12:59.291498 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.customer360.source_unique_web_transactions_id.ba28079761, now model.customer360.stg_web__transactions)
[0m13:12:59.291981 [debug] [Thread-1 (]: Began compiling node model.customer360.stg_web__transactions
[0m13:12:59.296205 [debug] [Thread-1 (]: Writing injected SQL for node "model.customer360.stg_web__transactions"
[0m13:12:59.296982 [debug] [Thread-1 (]: Timing info for model.customer360.stg_web__transactions (compile): 13:12:59.292281 => 13:12:59.296677
[0m13:12:59.297515 [debug] [Thread-1 (]: Began executing node model.customer360.stg_web__transactions
[0m13:12:59.312868 [debug] [Thread-1 (]: Writing runtime sql for node "model.customer360.stg_web__transactions"
[0m13:12:59.313626 [debug] [Thread-1 (]: Using postgres connection "model.customer360.stg_web__transactions"
[0m13:12:59.314129 [debug] [Thread-1 (]: On model.customer360.stg_web__transactions: BEGIN
[0m13:12:59.314621 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:12:59.316147 [debug] [Thread-2 (]: On test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344: Close
[0m13:12:59.317209 [info ] [Thread-2 (]: 10 of 15 PASS source_relationships_web_transactions_contact_id__id__ref_contacts_  [[32mPASS[0m in 0.10s]
[0m13:12:59.318028 [debug] [Thread-2 (]: Finished running node test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344
[0m13:12:59.323157 [debug] [Thread-3 (]: Writing runtime sql for node "model.customer360.stg_sf__contacts"
[0m13:12:59.323891 [debug] [Thread-3 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m13:12:59.324419 [debug] [Thread-3 (]: On model.customer360.stg_sf__contacts: BEGIN
[0m13:12:59.324897 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m13:12:59.329461 [debug] [Thread-3 (]: SQL status: BEGIN in 0.0 seconds
[0m13:12:59.329987 [debug] [Thread-3 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m13:12:59.330523 [debug] [Thread-3 (]: On model.customer360.stg_sf__contacts: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_sf__contacts"} */

  
    

  create  table "dbt"."public"."stg_sf__contacts__dbt_tmp"
  
  
    as
  
  (
    with source as (
    select * from "dbt"."public"."contacts"
),

renamed as (
    select
        id,
        username as user_name,
        name,
        gender,
        address, 
        mail as email_address,
        birthdate as birth_date,
        _loaded_at_utc
    from source     
)

select * from renamed
  );
  
[0m13:12:59.336777 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m13:12:59.337360 [debug] [Thread-1 (]: Using postgres connection "model.customer360.stg_web__transactions"
[0m13:12:59.337956 [debug] [Thread-1 (]: On model.customer360.stg_web__transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_web__transactions"} */

  
    

  create  table "dbt"."public"."stg_web__transactions__dbt_tmp"
  
  
    as
  
  (
    with source as (
    select * from "dbt"."public"."transactions"
),

renamed as (
    select
        id,
        contact_id,
         as transaction_date,
        amount,
        item_count,
        category, 
        _loaded_at_utc
    from source    
),

clean_older as (
    select * from renamed 
--    where transaction_date >= (current_date - 1)  过滤超过1天的数据
    where transaction_date >= (to_date('2023-04-12','yyyy-MM-dd') - 1)  --测试用,假设跑数日期为2023-04-12
    and transaction_date < to_date('2023-04-12','yyyy-MM-dd')
)

select * from clean_older
  );
  
[0m13:12:59.339468 [debug] [Thread-3 (]: SQL status: SELECT 10 in 0.0 seconds
[0m13:12:59.348621 [debug] [Thread-3 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m13:12:59.349211 [debug] [Thread-3 (]: On model.customer360.stg_sf__contacts: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_sf__contacts"} */
alter table "dbt"."public"."stg_sf__contacts" rename to "stg_sf__contacts__dbt_backup"
[0m13:12:59.349873 [debug] [Thread-1 (]: Postgres adapter: Postgres error: syntax error at or near "as"
LINE 20:          as transaction_date,
                  ^

[0m13:12:59.350934 [debug] [Thread-1 (]: On model.customer360.stg_web__transactions: ROLLBACK
[0m13:12:59.351527 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m13:12:59.355682 [debug] [Thread-3 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m13:12:59.356259 [debug] [Thread-3 (]: On model.customer360.stg_sf__contacts: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_sf__contacts"} */
alter table "dbt"."public"."stg_sf__contacts__dbt_tmp" rename to "stg_sf__contacts"
[0m13:12:59.357556 [debug] [Thread-1 (]: Timing info for model.customer360.stg_web__transactions (execute): 13:12:59.297823 => 13:12:59.357228
[0m13:12:59.358043 [debug] [Thread-1 (]: On model.customer360.stg_web__transactions: Close
[0m13:12:59.361678 [debug] [Thread-1 (]: Database Error in model stg_web__transactions (models/staging/web/stg_web__transactions.sql)
  syntax error at or near "as"
  LINE 20:          as transaction_date,
                    ^
  compiled Code at target/run/customer360/models/staging/web/stg_web__transactions.sql
[0m13:12:59.362262 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4792bdbb-d188-47ac-a61d-9ad17e3af497', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd4ab72e350>]}
[0m13:12:59.365666 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m13:12:59.363055 [error] [Thread-1 (]: 12 of 15 ERROR creating sql table model public.stg_web__transactions ........... [[31mERROR[0m in 0.07s]
[0m13:12:59.376096 [debug] [Thread-1 (]: Finished running node model.customer360.stg_web__transactions
[0m13:12:59.377281 [debug] [Thread-3 (]: On model.customer360.stg_sf__contacts: COMMIT
[0m13:12:59.377868 [debug] [Thread-3 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m13:12:59.378379 [debug] [Thread-3 (]: On model.customer360.stg_sf__contacts: COMMIT
[0m13:12:59.386897 [debug] [Thread-3 (]: SQL status: COMMIT in 0.0 seconds
[0m13:12:59.396434 [debug] [Thread-3 (]: Applying DROP to: "dbt"."public"."stg_sf__contacts__dbt_backup"
[0m13:12:59.406637 [debug] [Thread-3 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m13:12:59.407228 [debug] [Thread-3 (]: On model.customer360.stg_sf__contacts: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_sf__contacts"} */
drop table if exists "dbt"."public"."stg_sf__contacts__dbt_backup" cascade
[0m13:12:59.411079 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.0 seconds
[0m13:12:59.413318 [debug] [Thread-3 (]: Timing info for model.customer360.stg_sf__contacts (execute): 13:12:59.247461 => 13:12:59.412997
[0m13:12:59.413854 [debug] [Thread-3 (]: On model.customer360.stg_sf__contacts: Close
[0m13:12:59.417187 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4792bdbb-d188-47ac-a61d-9ad17e3af497', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd4cadb4d50>]}
[0m13:12:59.418078 [info ] [Thread-3 (]: 11 of 15 OK created sql table model public.stg_sf__contacts .................... [[32mSELECT 10[0m in 0.18s]
[0m13:12:59.419019 [debug] [Thread-3 (]: Finished running node model.customer360.stg_sf__contacts
[0m13:12:59.421668 [debug] [Thread-2 (]: Began running node model.customer360.contacts_joined_with_transactions
[0m13:12:59.422076 [info ] [Thread-2 (]: 13 of 15 SKIP relation public.contacts_joined_with_transactions ................ [[33mSKIP[0m]
[0m13:12:59.422559 [debug] [Thread-2 (]: Finished running node model.customer360.contacts_joined_with_transactions
[0m13:12:59.423556 [debug] [Thread-1 (]: Began running node test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311
[0m13:12:59.424108 [info ] [Thread-1 (]: 14 of 15 SKIP test not_null_contacts_joined_with_transactions_id ............... [[33mSKIP[0m]
[0m13:12:59.424666 [debug] [Thread-1 (]: Finished running node test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311
[0m13:12:59.426065 [debug] [Thread-2 (]: Began running node model.customer360.customers
[0m13:12:59.426604 [info ] [Thread-2 (]: 15 of 15 SKIP relation public.customers ........................................ [[33mSKIP[0m]
[0m13:12:59.427203 [debug] [Thread-2 (]: Finished running node model.customer360.customers
[0m13:12:59.429200 [debug] [MainThread]: Using postgres connection "master"
[0m13:12:59.429636 [debug] [MainThread]: On master: BEGIN
[0m13:12:59.430070 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m13:12:59.435619 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m13:12:59.436133 [debug] [MainThread]: On master: COMMIT
[0m13:12:59.436555 [debug] [MainThread]: Using postgres connection "master"
[0m13:12:59.436960 [debug] [MainThread]: On master: COMMIT
[0m13:12:59.437585 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m13:12:59.437992 [debug] [MainThread]: On master: Close
[0m13:12:59.438913 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:12:59.439369 [debug] [MainThread]: Connection 'model.customer360.stg_web__transactions' was properly closed.
[0m13:12:59.439762 [debug] [MainThread]: Connection 'test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344' was properly closed.
[0m13:12:59.440190 [debug] [MainThread]: Connection 'model.customer360.stg_sf__contacts' was properly closed.
[0m13:12:59.440694 [info ] [MainThread]: 
[0m13:12:59.441196 [info ] [MainThread]: Finished running 9 tests, 2 seeds, 3 table models, 1 view model in 0 hours 0 minutes and 0.98 seconds (0.98s).
[0m13:12:59.446414 [debug] [MainThread]: Command end result
[0m13:12:59.459233 [info ] [MainThread]: 
[0m13:12:59.459851 [info ] [MainThread]: [31mCompleted with 2 errors and 0 warnings:[0m
[0m13:12:59.460308 [info ] [MainThread]: 
[0m13:12:59.460797 [error] [MainThread]:   Database Error in test macro_test2 (tests/macro_test2.sql)
  syntax error at or near "as"
  LINE 8:     select  as expect_result
                      ^
  compiled Code at target/run/customer360/tests/macro_test2.sql
[0m13:12:59.461224 [info ] [MainThread]: 
[0m13:12:59.461723 [error] [MainThread]:   Database Error in model stg_web__transactions (models/staging/web/stg_web__transactions.sql)
  syntax error at or near "as"
  LINE 20:          as transaction_date,
                    ^
  compiled Code at target/run/customer360/models/staging/web/stg_web__transactions.sql
[0m13:12:59.462218 [info ] [MainThread]: 
[0m13:12:59.462735 [info ] [MainThread]: Done. PASS=10 WARN=0 ERROR=2 SKIP=3 TOTAL=15
[0m13:12:59.463766 [debug] [MainThread]: Resource report: {"command_name": "build", "command_wall_clock_time": 2.4732192, "process_user_time": 3.783098, "process_kernel_time": 0.13231, "process_mem_max_rss": "118800", "process_out_blocks": "2824", "command_success": false, "process_in_blocks": "0"}
[0m13:12:59.464435 [debug] [MainThread]: Command `dbt build` failed at 13:12:59.464246 after 2.47 seconds
[0m13:12:59.464994 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd4cd673fd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd4cd0a2050>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd4cb623090>]}
[0m13:12:59.465868 [debug] [MainThread]: Flushing usage events
[0m13:13:10.582829 [debug] [MainThread]: Error sending anonymous usage statistics. Disabling tracking for this execution. If you wish to permanently disable tracking, see: https://docs.getdbt.com/reference/global-configs#send-anonymous-usage-stats.
[0m13:16:41.691863 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff92fa04190>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff92f55d190>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff92f55d550>]}


============================== 13:16:41.694426 | 1380ee54-eec2-414c-a5ca-7e6022b3d717 ==============================
[0m13:16:41.694426 [info ] [MainThread]: Running with dbt=1.7.8
[0m13:16:41.694900 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'profiles_dir': '/root/option1-customer360/integration_tests', 'log_path': '/root/option1-customer360/integration_tests/logs', 'debug': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'invocation_command': 'dbt build', 'introspect': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m13:16:41.836062 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '1380ee54-eec2-414c-a5ca-7e6022b3d717', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff92fb2b410>]}
[0m13:16:41.911230 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '1380ee54-eec2-414c-a5ca-7e6022b3d717', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff92f53cdd0>]}
[0m13:16:41.911917 [info ] [MainThread]: Registered adapter: postgres=1.7.8
[0m13:16:41.922825 [debug] [MainThread]: checksum: 67f0013ca5f0bd43af9a0873dd50792fde83ef69de63b71cacd0b4ac656c52e5, vars: {}, profile: , target: , version: 1.7.8
[0m13:16:41.943669 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m13:16:41.944443 [debug] [MainThread]: Partial parsing: updated file: customer360://macros/as_timestamp_utc.sql
[0m13:16:42.310311 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '1380ee54-eec2-414c-a5ca-7e6022b3d717', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff92d851250>]}
[0m13:16:42.319383 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '1380ee54-eec2-414c-a5ca-7e6022b3d717', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff92da9c0d0>]}
[0m13:16:42.319798 [info ] [MainThread]: Found 2 seeds, 4 models, 9 tests, 2 sources, 0 exposures, 0 metrics, 403 macros, 0 groups, 0 semantic models
[0m13:16:42.321900 [info ] [MainThread]: 
[0m13:16:42.322771 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m13:16:42.323889 [debug] [ThreadPool]: Acquiring new postgres connection 'list_dbt'
[0m13:16:42.332867 [debug] [ThreadPool]: Using postgres connection "list_dbt"
[0m13:16:42.333164 [debug] [ThreadPool]: On list_dbt: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "connection_name": "list_dbt"} */

    select distinct nspname from pg_namespace
  
[0m13:16:42.333458 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:16:42.338233 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.0 seconds
[0m13:16:42.339405 [debug] [ThreadPool]: On list_dbt: Close
[0m13:16:42.341926 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dbt, now list_dbt_public)
[0m13:16:42.346951 [debug] [ThreadPool]: Using postgres connection "list_dbt_public"
[0m13:16:42.347258 [debug] [ThreadPool]: On list_dbt_public: BEGIN
[0m13:16:42.347602 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:16:42.350570 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m13:16:42.350881 [debug] [ThreadPool]: Using postgres connection "list_dbt_public"
[0m13:16:42.351159 [debug] [ThreadPool]: On list_dbt_public: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "connection_name": "list_dbt_public"} */
select
      'dbt' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'dbt' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'dbt' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m13:16:42.354083 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.0 seconds
[0m13:16:42.355282 [debug] [ThreadPool]: On list_dbt_public: ROLLBACK
[0m13:16:42.355775 [debug] [ThreadPool]: On list_dbt_public: Close
[0m13:16:42.361206 [debug] [MainThread]: Using postgres connection "master"
[0m13:16:42.361518 [debug] [MainThread]: On master: BEGIN
[0m13:16:42.361766 [debug] [MainThread]: Opening a new connection, currently in state init
[0m13:16:42.364704 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m13:16:42.365009 [debug] [MainThread]: Using postgres connection "master"
[0m13:16:42.365390 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m13:16:42.374557 [debug] [MainThread]: SQL status: SELECT 0 in 0.0 seconds
[0m13:16:42.375645 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1380ee54-eec2-414c-a5ca-7e6022b3d717', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff92d388850>]}
[0m13:16:42.376044 [debug] [MainThread]: On master: ROLLBACK
[0m13:16:42.376568 [debug] [MainThread]: Using postgres connection "master"
[0m13:16:42.376846 [debug] [MainThread]: On master: BEGIN
[0m13:16:42.377498 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m13:16:42.377787 [debug] [MainThread]: On master: COMMIT
[0m13:16:42.378043 [debug] [MainThread]: Using postgres connection "master"
[0m13:16:42.378341 [debug] [MainThread]: On master: COMMIT
[0m13:16:42.378768 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m13:16:42.379048 [debug] [MainThread]: On master: Close
[0m13:16:42.379704 [info ] [MainThread]: Concurrency: 3 threads (target='local')
[0m13:16:42.379998 [info ] [MainThread]: 
[0m13:16:42.382265 [debug] [Thread-1 (]: Began running node seed.integration_tests.contacts
[0m13:16:42.382850 [info ] [Thread-1 (]: 1 of 15 START seed file public.contacts ........................................ [RUN]
[0m13:16:42.383691 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dbt_public, now seed.integration_tests.contacts)
[0m13:16:42.384141 [debug] [Thread-1 (]: Began compiling node seed.integration_tests.contacts
[0m13:16:42.385010 [debug] [Thread-1 (]: Timing info for seed.integration_tests.contacts (compile): 13:16:42.384612 => 13:16:42.384615
[0m13:16:42.385370 [debug] [Thread-1 (]: Began executing node seed.integration_tests.contacts
[0m13:16:42.392672 [debug] [Thread-2 (]: Began running node seed.integration_tests.transactions
[0m13:16:42.398800 [debug] [Thread-3 (]: Began running node test.customer360.macro_test1
[0m13:16:42.401974 [info ] [Thread-2 (]: 2 of 15 START seed file public.transactions .................................... [RUN]
[0m13:16:42.402441 [info ] [Thread-3 (]: 3 of 15 START test macro_test1 ................................................. [RUN]
[0m13:16:42.417012 [debug] [Thread-2 (]: Acquiring new postgres connection 'seed.integration_tests.transactions'
[0m13:16:42.419657 [debug] [Thread-1 (]: Using postgres connection "seed.integration_tests.contacts"
[0m13:16:42.420347 [debug] [Thread-3 (]: Acquiring new postgres connection 'test.customer360.macro_test1'
[0m13:16:42.420732 [debug] [Thread-2 (]: Began compiling node seed.integration_tests.transactions
[0m13:16:42.421101 [debug] [Thread-1 (]: On seed.integration_tests.contacts: BEGIN
[0m13:16:42.421474 [debug] [Thread-3 (]: Began compiling node test.customer360.macro_test1
[0m13:16:42.421911 [debug] [Thread-2 (]: Timing info for seed.integration_tests.transactions (compile): 13:16:42.421708 => 13:16:42.421711
[0m13:16:42.422268 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:16:42.428443 [debug] [Thread-3 (]: Writing injected SQL for node "test.customer360.macro_test1"
[0m13:16:42.429645 [debug] [Thread-3 (]: Timing info for test.customer360.macro_test1 (compile): 13:16:42.422537 => 13:16:42.429353
[0m13:16:42.430001 [debug] [Thread-3 (]: Began executing node test.customer360.macro_test1
[0m13:16:42.428796 [debug] [Thread-2 (]: Began executing node seed.integration_tests.transactions
[0m13:16:42.447736 [debug] [Thread-2 (]: Using postgres connection "seed.integration_tests.transactions"
[0m13:16:42.452176 [debug] [Thread-3 (]: Writing runtime sql for node "test.customer360.macro_test1"
[0m13:16:42.452571 [debug] [Thread-2 (]: On seed.integration_tests.transactions: BEGIN
[0m13:16:42.453407 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m13:16:42.452920 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m13:16:42.454673 [debug] [Thread-1 (]: Using postgres connection "seed.integration_tests.contacts"
[0m13:16:42.455106 [debug] [Thread-1 (]: On seed.integration_tests.contacts: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "seed.integration_tests.contacts"} */
truncate table "dbt"."public"."contacts"
[0m13:16:42.454016 [debug] [Thread-3 (]: Using postgres connection "test.customer360.macro_test1"
[0m13:16:42.455652 [debug] [Thread-3 (]: On test.customer360.macro_test1: BEGIN
[0m13:16:42.456001 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m13:16:42.460362 [debug] [Thread-3 (]: SQL status: BEGIN in 0.0 seconds
[0m13:16:42.460819 [debug] [Thread-3 (]: Using postgres connection "test.customer360.macro_test1"
[0m13:16:42.461182 [debug] [Thread-1 (]: SQL status: TRUNCATE TABLE in 0.0 seconds
[0m13:16:42.461556 [debug] [Thread-3 (]: On test.customer360.macro_test1: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.macro_test1"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      with marco_result as (
    select 
    date_part('year', age(current_date, '2023-02-12'))
 as expect_result
)
select
    1
from marco_result
where expect_result <> 1
      
    ) dbt_internal_test
[0m13:16:42.461910 [debug] [Thread-2 (]: SQL status: BEGIN in 0.0 seconds
[0m13:16:42.486594 [debug] [Thread-2 (]: Using postgres connection "seed.integration_tests.transactions"
[0m13:16:42.487138 [debug] [Thread-2 (]: On seed.integration_tests.transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "seed.integration_tests.transactions"} */
truncate table "dbt"."public"."transactions"
[0m13:16:42.473536 [debug] [Thread-3 (]: SQL status: SELECT 1 in 0.0 seconds
[0m13:16:42.489900 [debug] [Thread-3 (]: Timing info for test.customer360.macro_test1 (execute): 13:16:42.430218 => 13:16:42.489589
[0m13:16:42.490457 [debug] [Thread-3 (]: On test.customer360.macro_test1: ROLLBACK
[0m13:16:42.504579 [debug] [Thread-3 (]: On test.customer360.macro_test1: Close
[0m13:16:42.505812 [info ] [Thread-3 (]: 3 of 15 PASS macro_test1 ....................................................... [[32mPASS[0m in 0.09s]
[0m13:16:42.506865 [debug] [Thread-3 (]: Finished running node test.customer360.macro_test1
[0m13:16:42.507451 [debug] [Thread-3 (]: Began running node test.customer360.macro_test2
[0m13:16:42.507886 [info ] [Thread-3 (]: 4 of 15 START test macro_test2 ................................................. [RUN]
[0m13:16:42.508787 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.customer360.macro_test1, now test.customer360.macro_test2)
[0m13:16:42.509825 [debug] [Thread-3 (]: Began compiling node test.customer360.macro_test2
[0m13:16:42.513829 [debug] [Thread-3 (]: Writing injected SQL for node "test.customer360.macro_test2"
[0m13:16:42.514693 [debug] [Thread-3 (]: Timing info for test.customer360.macro_test2 (compile): 13:16:42.510151 => 13:16:42.514370
[0m13:16:42.515202 [debug] [Thread-3 (]: Began executing node test.customer360.macro_test2
[0m13:16:42.518267 [debug] [Thread-3 (]: Writing runtime sql for node "test.customer360.macro_test2"
[0m13:16:42.518941 [debug] [Thread-3 (]: Using postgres connection "test.customer360.macro_test2"
[0m13:16:42.519496 [debug] [Thread-3 (]: On test.customer360.macro_test2: BEGIN
[0m13:16:42.519951 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m13:16:42.521203 [debug] [Thread-2 (]: SQL status: TRUNCATE TABLE in 0.0 seconds
[0m13:16:42.570638 [debug] [Thread-3 (]: SQL status: BEGIN in 0.0 seconds
[0m13:16:42.571265 [debug] [Thread-3 (]: Using postgres connection "test.customer360.macro_test2"
[0m13:16:42.571830 [debug] [Thread-3 (]: On test.customer360.macro_test2: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.macro_test2"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      with marco_result as (
    select  as expect_result
)
select
    1
from marco_result
where cast(pg_typeof(expect_result) as text) not like '%timestamp%'
      
    ) dbt_internal_test
[0m13:16:42.578869 [debug] [Thread-1 (]: Using postgres connection "seed.integration_tests.contacts"
[0m13:16:42.579474 [debug] [Thread-1 (]: On seed.integration_tests.contacts: 
          insert into "dbt"."public"."contacts" ("id", "username", "name", "gender", "address", "mail", "birthdate", "_loaded_at_utc") values
          (%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s)
      ...
[0m13:16:42.580389 [debug] [Thread-3 (]: Postgres adapter: Postgres error: syntax error at or near "as"
LINE 8:     select  as expect_result
                    ^

[0m13:16:42.580898 [debug] [Thread-3 (]: On test.customer360.macro_test2: ROLLBACK
[0m13:16:42.599917 [debug] [Thread-3 (]: Timing info for test.customer360.macro_test2 (execute): 13:16:42.515568 => 13:16:42.599482
[0m13:16:42.600486 [debug] [Thread-3 (]: On test.customer360.macro_test2: Close
[0m13:16:42.607460 [debug] [Thread-3 (]: Database Error in test macro_test2 (tests/macro_test2.sql)
  syntax error at or near "as"
  LINE 8:     select  as expect_result
                      ^
  compiled Code at target/run/customer360/tests/macro_test2.sql
[0m13:16:42.608258 [error] [Thread-3 (]: 4 of 15 ERROR macro_test2 ...................................................... [[31mERROR[0m in 0.10s]
[0m13:16:42.609102 [debug] [Thread-3 (]: Finished running node test.customer360.macro_test2
[0m13:16:42.609898 [debug] [Thread-3 (]: Began running node test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247
[0m13:16:42.610476 [info ] [Thread-3 (]: 5 of 15 START test source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors  [RUN]
[0m13:16:42.611450 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.customer360.macro_test2, now test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247)
[0m13:16:42.612014 [debug] [Thread-3 (]: Began compiling node test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247
[0m13:16:42.633581 [debug] [Thread-1 (]: SQL status: INSERT 0 10 in 0.0 seconds
[0m13:16:42.658179 [debug] [Thread-3 (]: Writing injected SQL for node "test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247"
[0m13:16:42.667521 [debug] [Thread-3 (]: Timing info for test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247 (compile): 13:16:42.612353 => 13:16:42.667101
[0m13:16:42.668052 [debug] [Thread-3 (]: Began executing node test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247
[0m13:16:42.666587 [debug] [Thread-1 (]: Writing runtime SQL for node "seed.integration_tests.contacts"
[0m13:16:42.672147 [debug] [Thread-3 (]: Writing runtime sql for node "test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247"
[0m13:16:42.695859 [debug] [Thread-3 (]: Using postgres connection "test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247"
[0m13:16:42.696526 [debug] [Thread-3 (]: On test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247: BEGIN
[0m13:16:42.697077 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m13:16:42.737028 [debug] [Thread-1 (]: On seed.integration_tests.contacts: COMMIT
[0m13:16:42.738022 [debug] [Thread-1 (]: Using postgres connection "seed.integration_tests.contacts"
[0m13:16:42.738513 [debug] [Thread-1 (]: On seed.integration_tests.contacts: COMMIT
[0m13:16:42.749642 [debug] [Thread-1 (]: SQL status: COMMIT in 0.0 seconds
[0m13:16:42.751026 [debug] [Thread-1 (]: Timing info for seed.integration_tests.contacts (execute): 13:16:42.385662 => 13:16:42.750742
[0m13:16:42.751603 [debug] [Thread-1 (]: On seed.integration_tests.contacts: Close
[0m13:16:42.752640 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1380ee54-eec2-414c-a5ca-7e6022b3d717', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff92da7be90>]}
[0m13:16:42.753384 [info ] [Thread-1 (]: 1 of 15 OK loaded seed file public.contacts .................................... [[32mINSERT 10[0m in 0.37s]
[0m13:16:42.754158 [debug] [Thread-1 (]: Finished running node seed.integration_tests.contacts
[0m13:16:42.757017 [debug] [Thread-1 (]: Began running node test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d
[0m13:16:42.757604 [info ] [Thread-1 (]: 6 of 15 START test source_not_null_salesforce_contacts_id ...................... [RUN]
[0m13:16:42.758983 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly seed.integration_tests.contacts, now test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d)
[0m13:16:42.759670 [debug] [Thread-1 (]: Began compiling node test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d
[0m13:16:42.771026 [debug] [Thread-1 (]: Writing injected SQL for node "test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d"
[0m13:16:42.771971 [debug] [Thread-1 (]: Timing info for test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d (compile): 13:16:42.760077 => 13:16:42.771682
[0m13:16:42.773640 [debug] [Thread-1 (]: Began executing node test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d
[0m13:16:42.777196 [debug] [Thread-1 (]: Writing runtime sql for node "test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d"
[0m13:16:42.777965 [debug] [Thread-1 (]: Using postgres connection "test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d"
[0m13:16:42.780994 [debug] [Thread-1 (]: On test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d: BEGIN
[0m13:16:42.781512 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:16:42.782739 [debug] [Thread-3 (]: SQL status: BEGIN in 0.0 seconds
[0m13:16:42.783320 [debug] [Thread-3 (]: Using postgres connection "test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247"
[0m13:16:42.783868 [debug] [Thread-3 (]: On test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

with all_values as (

    select
        category as value_field,
        count(*) as n_records

    from "dbt"."public"."transactions"
    group by category

)

select *
from all_values
where value_field not in (
    'Apps & Games','Beauty','Books','Clothing, Shoes & Accessories','Movies & TV','Sports, Fitness & Outdoors'
)



      
    ) dbt_internal_test
[0m13:16:42.837602 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m13:16:42.838445 [debug] [Thread-1 (]: Using postgres connection "test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d"
[0m13:16:42.838986 [debug] [Thread-1 (]: On test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select id
from "dbt"."public"."contacts"
where id is null



      
    ) dbt_internal_test
[0m13:16:42.866699 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.0 seconds
[0m13:16:42.868858 [debug] [Thread-1 (]: Timing info for test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d (execute): 13:16:42.773975 => 13:16:42.868502
[0m13:16:42.869596 [debug] [Thread-1 (]: On test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d: ROLLBACK
[0m13:16:42.880623 [debug] [Thread-1 (]: On test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d: Close
[0m13:16:42.881880 [info ] [Thread-1 (]: 6 of 15 PASS source_not_null_salesforce_contacts_id ............................ [[32mPASS[0m in 0.12s]
[0m13:16:42.882673 [debug] [Thread-1 (]: Finished running node test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d
[0m13:16:42.885273 [debug] [Thread-1 (]: Began running node test.customer360.source_not_null_web_transactions_id.88a47bf7e5
[0m13:16:42.885873 [info ] [Thread-1 (]: 7 of 15 START test source_not_null_web_transactions_id ......................... [RUN]
[0m13:16:42.886815 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d, now test.customer360.source_not_null_web_transactions_id.88a47bf7e5)
[0m13:16:42.887382 [debug] [Thread-1 (]: Began compiling node test.customer360.source_not_null_web_transactions_id.88a47bf7e5
[0m13:16:42.894541 [debug] [Thread-1 (]: Writing injected SQL for node "test.customer360.source_not_null_web_transactions_id.88a47bf7e5"
[0m13:16:42.898478 [debug] [Thread-1 (]: Timing info for test.customer360.source_not_null_web_transactions_id.88a47bf7e5 (compile): 13:16:42.887693 => 13:16:42.895059
[0m13:16:42.899008 [debug] [Thread-1 (]: Began executing node test.customer360.source_not_null_web_transactions_id.88a47bf7e5
[0m13:16:42.902607 [debug] [Thread-1 (]: Writing runtime sql for node "test.customer360.source_not_null_web_transactions_id.88a47bf7e5"
[0m13:16:42.931465 [debug] [Thread-1 (]: Using postgres connection "test.customer360.source_not_null_web_transactions_id.88a47bf7e5"
[0m13:16:42.932335 [debug] [Thread-1 (]: On test.customer360.source_not_null_web_transactions_id.88a47bf7e5: BEGIN
[0m13:16:42.932815 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:16:42.984675 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m13:16:42.985336 [debug] [Thread-1 (]: Using postgres connection "test.customer360.source_not_null_web_transactions_id.88a47bf7e5"
[0m13:16:42.985852 [debug] [Thread-1 (]: On test.customer360.source_not_null_web_transactions_id.88a47bf7e5: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.source_not_null_web_transactions_id.88a47bf7e5"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select id
from "dbt"."public"."transactions"
where id is null



      
    ) dbt_internal_test
[0m13:16:43.011873 [debug] [Thread-2 (]: Using postgres connection "seed.integration_tests.transactions"
[0m13:16:43.019612 [debug] [Thread-2 (]: On seed.integration_tests.transactions: 
          insert into "dbt"."public"."transactions" ("contact_id", "id", "transaction_date", "amount", "item_count", "category", "_loaded_at_utc") values
          (%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%...
[0m13:16:43.027593 [debug] [Thread-2 (]: SQL status: INSERT 0 74 in 0.0 seconds
[0m13:16:43.028893 [debug] [Thread-2 (]: Writing runtime SQL for node "seed.integration_tests.transactions"
[0m13:16:43.031687 [debug] [Thread-2 (]: On seed.integration_tests.transactions: COMMIT
[0m13:16:43.032245 [debug] [Thread-2 (]: Using postgres connection "seed.integration_tests.transactions"
[0m13:16:43.032760 [debug] [Thread-2 (]: On seed.integration_tests.transactions: COMMIT
[0m13:16:43.044345 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.0 seconds
[0m13:16:43.046637 [debug] [Thread-1 (]: Timing info for test.customer360.source_not_null_web_transactions_id.88a47bf7e5 (execute): 13:16:42.899371 => 13:16:43.046236
[0m13:16:43.047146 [debug] [Thread-1 (]: On test.customer360.source_not_null_web_transactions_id.88a47bf7e5: ROLLBACK
[0m13:16:43.047764 [debug] [Thread-3 (]: SQL status: SELECT 1 in 0.0 seconds
[0m13:16:43.049831 [debug] [Thread-3 (]: Timing info for test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247 (execute): 13:16:42.668456 => 13:16:43.049179
[0m13:16:43.050398 [debug] [Thread-3 (]: On test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247: ROLLBACK
[0m13:16:43.050974 [debug] [Thread-2 (]: SQL status: COMMIT in 0.0 seconds
[0m13:16:43.052261 [debug] [Thread-2 (]: Timing info for seed.integration_tests.transactions (execute): 13:16:42.442059 => 13:16:43.051983
[0m13:16:43.052806 [debug] [Thread-2 (]: On seed.integration_tests.transactions: Close
[0m13:16:43.053799 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1380ee54-eec2-414c-a5ca-7e6022b3d717', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff92d288590>]}
[0m13:16:43.054476 [info ] [Thread-2 (]: 2 of 15 OK loaded seed file public.transactions ................................ [[32mINSERT 74[0m in 0.64s]
[0m13:16:43.055263 [debug] [Thread-2 (]: Finished running node seed.integration_tests.transactions
[0m13:16:43.056251 [debug] [Thread-2 (]: Began running node test.customer360.source_unique_salesforce_contacts_id.01cadaaf43
[0m13:16:43.056983 [info ] [Thread-2 (]: 8 of 15 START test source_unique_salesforce_contacts_id ........................ [RUN]
[0m13:16:43.057908 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly seed.integration_tests.transactions, now test.customer360.source_unique_salesforce_contacts_id.01cadaaf43)
[0m13:16:43.058371 [debug] [Thread-2 (]: Began compiling node test.customer360.source_unique_salesforce_contacts_id.01cadaaf43
[0m13:16:43.081808 [debug] [Thread-3 (]: On test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247: Close
[0m13:16:43.084514 [debug] [Thread-1 (]: On test.customer360.source_not_null_web_transactions_id.88a47bf7e5: Close
[0m13:16:43.085665 [info ] [Thread-1 (]: 7 of 15 PASS source_not_null_web_transactions_id ............................... [[32mPASS[0m in 0.20s]
[0m13:16:43.086481 [debug] [Thread-1 (]: Finished running node test.customer360.source_not_null_web_transactions_id.88a47bf7e5
[0m13:16:43.087010 [debug] [Thread-1 (]: Began running node test.customer360.source_unique_web_transactions_id.ba28079761
[0m13:16:43.089528 [info ] [Thread-1 (]: 9 of 15 START test source_unique_web_transactions_id ........................... [RUN]
[0m13:16:43.090386 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.customer360.source_not_null_web_transactions_id.88a47bf7e5, now test.customer360.source_unique_web_transactions_id.ba28079761)
[0m13:16:43.090897 [debug] [Thread-1 (]: Began compiling node test.customer360.source_unique_web_transactions_id.ba28079761
[0m13:16:43.099932 [debug] [Thread-1 (]: Writing injected SQL for node "test.customer360.source_unique_web_transactions_id.ba28079761"
[0m13:16:43.100820 [debug] [Thread-1 (]: Timing info for test.customer360.source_unique_web_transactions_id.ba28079761 (compile): 13:16:43.091192 => 13:16:43.100461
[0m13:16:43.101382 [debug] [Thread-1 (]: Began executing node test.customer360.source_unique_web_transactions_id.ba28079761
[0m13:16:43.104911 [debug] [Thread-1 (]: Writing runtime sql for node "test.customer360.source_unique_web_transactions_id.ba28079761"
[0m13:16:43.105622 [debug] [Thread-1 (]: Using postgres connection "test.customer360.source_unique_web_transactions_id.ba28079761"
[0m13:16:43.112494 [info ] [Thread-3 (]: 5 of 15 PASS source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors  [[32mPASS[0m in 0.50s]
[0m13:16:43.113490 [debug] [Thread-3 (]: Finished running node test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247
[0m13:16:43.114120 [debug] [Thread-3 (]: Began running node test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344
[0m13:16:43.114676 [info ] [Thread-3 (]: 10 of 15 START test source_relationships_web_transactions_contact_id__id__ref_contacts_  [RUN]
[0m13:16:43.115754 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247, now test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344)
[0m13:16:43.116335 [debug] [Thread-3 (]: Began compiling node test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344
[0m13:16:43.130751 [debug] [Thread-3 (]: Writing injected SQL for node "test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344"
[0m13:16:43.131710 [debug] [Thread-3 (]: Timing info for test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344 (compile): 13:16:43.116644 => 13:16:43.131322
[0m13:16:43.132231 [debug] [Thread-3 (]: Began executing node test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344
[0m13:16:43.137362 [debug] [Thread-3 (]: Writing runtime sql for node "test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344"
[0m13:16:43.138139 [debug] [Thread-3 (]: Using postgres connection "test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344"
[0m13:16:43.138635 [debug] [Thread-3 (]: On test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344: BEGIN
[0m13:16:43.139127 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m13:16:43.142706 [debug] [Thread-2 (]: Writing injected SQL for node "test.customer360.source_unique_salesforce_contacts_id.01cadaaf43"
[0m13:16:43.143534 [debug] [Thread-2 (]: Timing info for test.customer360.source_unique_salesforce_contacts_id.01cadaaf43 (compile): 13:16:43.058637 => 13:16:43.143204
[0m13:16:43.144043 [debug] [Thread-2 (]: Began executing node test.customer360.source_unique_salesforce_contacts_id.01cadaaf43
[0m13:16:43.147959 [debug] [Thread-2 (]: Writing runtime sql for node "test.customer360.source_unique_salesforce_contacts_id.01cadaaf43"
[0m13:16:43.148658 [debug] [Thread-2 (]: Using postgres connection "test.customer360.source_unique_salesforce_contacts_id.01cadaaf43"
[0m13:16:43.149193 [debug] [Thread-2 (]: On test.customer360.source_unique_salesforce_contacts_id.01cadaaf43: BEGIN
[0m13:16:43.149694 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m13:16:43.106162 [debug] [Thread-1 (]: On test.customer360.source_unique_web_transactions_id.ba28079761: BEGIN
[0m13:16:43.151387 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:16:43.161977 [debug] [Thread-3 (]: SQL status: BEGIN in 0.0 seconds
[0m13:16:43.162644 [debug] [Thread-3 (]: Using postgres connection "test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344"
[0m13:16:43.163211 [debug] [Thread-3 (]: On test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

with child as (
    select contact_id as from_field
    from "dbt"."public"."transactions"
    where contact_id is not null
),

parent as (
    select id as to_field
    from "dbt"."public"."contacts"
)

select
    from_field

from child
left join parent
    on child.from_field = parent.to_field

where parent.to_field is null



      
    ) dbt_internal_test
[0m13:16:43.164202 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m13:16:43.164754 [debug] [Thread-1 (]: Using postgres connection "test.customer360.source_unique_web_transactions_id.ba28079761"
[0m13:16:43.165257 [debug] [Thread-1 (]: On test.customer360.source_unique_web_transactions_id.ba28079761: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.source_unique_web_transactions_id.ba28079761"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

select
    id as unique_field,
    count(*) as n_records

from "dbt"."public"."transactions"
where id is not null
group by id
having count(*) > 1



      
    ) dbt_internal_test
[0m13:16:43.169176 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.0 seconds
[0m13:16:43.171229 [debug] [Thread-1 (]: Timing info for test.customer360.source_unique_web_transactions_id.ba28079761 (execute): 13:16:43.101711 => 13:16:43.170920
[0m13:16:43.171828 [debug] [Thread-1 (]: On test.customer360.source_unique_web_transactions_id.ba28079761: ROLLBACK
[0m13:16:43.172691 [debug] [Thread-2 (]: SQL status: BEGIN in 0.0 seconds
[0m13:16:43.173185 [debug] [Thread-2 (]: Using postgres connection "test.customer360.source_unique_salesforce_contacts_id.01cadaaf43"
[0m13:16:43.173759 [debug] [Thread-2 (]: On test.customer360.source_unique_salesforce_contacts_id.01cadaaf43: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.source_unique_salesforce_contacts_id.01cadaaf43"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

select
    id as unique_field,
    count(*) as n_records

from "dbt"."public"."contacts"
where id is not null
group by id
having count(*) > 1



      
    ) dbt_internal_test
[0m13:16:43.174341 [debug] [Thread-1 (]: On test.customer360.source_unique_web_transactions_id.ba28079761: Close
[0m13:16:43.175473 [info ] [Thread-1 (]: 9 of 15 PASS source_unique_web_transactions_id ................................. [[32mPASS[0m in 0.09s]
[0m13:16:43.176259 [debug] [Thread-1 (]: Finished running node test.customer360.source_unique_web_transactions_id.ba28079761
[0m13:16:43.180214 [debug] [Thread-3 (]: SQL status: SELECT 1 in 0.0 seconds
[0m13:16:43.182381 [debug] [Thread-3 (]: Timing info for test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344 (execute): 13:16:43.132620 => 13:16:43.182027
[0m13:16:43.182947 [debug] [Thread-3 (]: On test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344: ROLLBACK
[0m13:16:43.183565 [debug] [Thread-2 (]: SQL status: SELECT 1 in 0.0 seconds
[0m13:16:43.185631 [debug] [Thread-2 (]: Timing info for test.customer360.source_unique_salesforce_contacts_id.01cadaaf43 (execute): 13:16:43.144367 => 13:16:43.185063
[0m13:16:43.186178 [debug] [Thread-2 (]: On test.customer360.source_unique_salesforce_contacts_id.01cadaaf43: ROLLBACK
[0m13:16:43.186814 [debug] [Thread-1 (]: Began running node model.customer360.stg_web__transactions
[0m13:16:43.187442 [info ] [Thread-1 (]: 11 of 15 START sql table model public.stg_web__transactions .................... [RUN]
[0m13:16:43.188762 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.customer360.source_unique_web_transactions_id.ba28079761, now model.customer360.stg_web__transactions)
[0m13:16:43.189323 [debug] [Thread-1 (]: Began compiling node model.customer360.stg_web__transactions
[0m13:16:43.194018 [debug] [Thread-1 (]: Writing injected SQL for node "model.customer360.stg_web__transactions"
[0m13:16:43.194821 [debug] [Thread-1 (]: Timing info for model.customer360.stg_web__transactions (compile): 13:16:43.189621 => 13:16:43.194511
[0m13:16:43.195699 [debug] [Thread-1 (]: Began executing node model.customer360.stg_web__transactions
[0m13:16:43.213826 [debug] [Thread-2 (]: On test.customer360.source_unique_salesforce_contacts_id.01cadaaf43: Close
[0m13:16:43.215095 [info ] [Thread-2 (]: 8 of 15 PASS source_unique_salesforce_contacts_id .............................. [[32mPASS[0m in 0.16s]
[0m13:16:43.215949 [debug] [Thread-2 (]: Finished running node test.customer360.source_unique_salesforce_contacts_id.01cadaaf43
[0m13:16:43.216559 [debug] [Thread-3 (]: On test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344: Close
[0m13:16:43.217624 [info ] [Thread-3 (]: 10 of 15 PASS source_relationships_web_transactions_contact_id__id__ref_contacts_  [[32mPASS[0m in 0.10s]
[0m13:16:43.218427 [debug] [Thread-3 (]: Finished running node test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344
[0m13:16:43.223133 [debug] [Thread-2 (]: Began running node model.customer360.stg_sf__contacts
[0m13:16:43.223869 [info ] [Thread-2 (]: 12 of 15 START sql table model public.stg_sf__contacts ......................... [RUN]
[0m13:16:43.224823 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.customer360.source_unique_salesforce_contacts_id.01cadaaf43, now model.customer360.stg_sf__contacts)
[0m13:16:43.225351 [debug] [Thread-2 (]: Began compiling node model.customer360.stg_sf__contacts
[0m13:16:43.229500 [debug] [Thread-2 (]: Writing injected SQL for node "model.customer360.stg_sf__contacts"
[0m13:16:43.230333 [debug] [Thread-2 (]: Timing info for model.customer360.stg_sf__contacts (compile): 13:16:43.225707 => 13:16:43.230005
[0m13:16:43.230862 [debug] [Thread-2 (]: Began executing node model.customer360.stg_sf__contacts
[0m13:16:43.299516 [debug] [Thread-1 (]: Writing runtime sql for node "model.customer360.stg_web__transactions"
[0m13:16:43.300660 [debug] [Thread-1 (]: Using postgres connection "model.customer360.stg_web__transactions"
[0m13:16:43.301173 [debug] [Thread-1 (]: On model.customer360.stg_web__transactions: BEGIN
[0m13:16:43.301701 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:16:43.302692 [debug] [Thread-2 (]: Writing runtime sql for node "model.customer360.stg_sf__contacts"
[0m13:16:43.303798 [debug] [Thread-2 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m13:16:43.304315 [debug] [Thread-2 (]: On model.customer360.stg_sf__contacts: BEGIN
[0m13:16:43.304856 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m13:16:43.309540 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m13:16:43.310167 [debug] [Thread-1 (]: Using postgres connection "model.customer360.stg_web__transactions"
[0m13:16:43.310743 [debug] [Thread-1 (]: On model.customer360.stg_web__transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_web__transactions"} */

  
    

  create  table "dbt"."public"."stg_web__transactions__dbt_tmp"
  
  
    as
  
  (
    with source as (
    select * from "dbt"."public"."transactions"
),

renamed as (
    select
        id,
        contact_id,
         as transaction_date,
        amount,
        item_count,
        category, 
        _loaded_at_utc
    from source    
),

clean_older as (
    select * from renamed 
--    where transaction_date >= (current_date - 1)  过滤超过1天的数据
    where transaction_date >= (to_date('2023-04-12','yyyy-MM-dd') - 1)  --测试用,假设跑数日期为2023-04-12
    and transaction_date < to_date('2023-04-12','yyyy-MM-dd')
)

select * from clean_older
  );
  
[0m13:16:43.312581 [debug] [Thread-1 (]: Postgres adapter: Postgres error: syntax error at or near "as"
LINE 20:          as transaction_date,
                  ^

[0m13:16:43.313126 [debug] [Thread-1 (]: On model.customer360.stg_web__transactions: ROLLBACK
[0m13:16:43.315155 [debug] [Thread-1 (]: Timing info for model.customer360.stg_web__transactions (execute): 13:16:43.196064 => 13:16:43.314781
[0m13:16:43.315681 [debug] [Thread-1 (]: On model.customer360.stg_web__transactions: Close
[0m13:16:43.321322 [debug] [Thread-1 (]: Database Error in model stg_web__transactions (models/staging/web/stg_web__transactions.sql)
  syntax error at or near "as"
  LINE 20:          as transaction_date,
                    ^
  compiled Code at target/run/customer360/models/staging/web/stg_web__transactions.sql
[0m13:16:43.321992 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1380ee54-eec2-414c-a5ca-7e6022b3d717', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff92c5c3390>]}
[0m13:16:43.323481 [error] [Thread-1 (]: 11 of 15 ERROR creating sql table model public.stg_web__transactions ........... [[31mERROR[0m in 0.13s]
[0m13:16:43.324322 [debug] [Thread-1 (]: Finished running node model.customer360.stg_web__transactions
[0m13:16:43.324878 [debug] [Thread-2 (]: SQL status: BEGIN in 0.0 seconds
[0m13:16:43.325424 [debug] [Thread-2 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m13:16:43.325945 [debug] [Thread-2 (]: On model.customer360.stg_sf__contacts: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_sf__contacts"} */

  
    

  create  table "dbt"."public"."stg_sf__contacts__dbt_tmp"
  
  
    as
  
  (
    with source as (
    select * from "dbt"."public"."contacts"
),

renamed as (
    select
        id,
        username as user_name,
        name,
        gender,
        address, 
        mail as email_address,
        birthdate as birth_date,
        _loaded_at_utc
    from source     
)

select * from renamed
  );
  
[0m13:16:43.340187 [debug] [Thread-2 (]: SQL status: SELECT 10 in 0.0 seconds
[0m13:16:43.349380 [debug] [Thread-2 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m13:16:43.350003 [debug] [Thread-2 (]: On model.customer360.stg_sf__contacts: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_sf__contacts"} */
alter table "dbt"."public"."stg_sf__contacts" rename to "stg_sf__contacts__dbt_backup"
[0m13:16:43.362533 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m13:16:43.366881 [debug] [Thread-2 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m13:16:43.367432 [debug] [Thread-2 (]: On model.customer360.stg_sf__contacts: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_sf__contacts"} */
alter table "dbt"."public"."stg_sf__contacts__dbt_tmp" rename to "stg_sf__contacts"
[0m13:16:43.368867 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m13:16:43.381873 [debug] [Thread-2 (]: On model.customer360.stg_sf__contacts: COMMIT
[0m13:16:43.382511 [debug] [Thread-2 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m13:16:43.382998 [debug] [Thread-2 (]: On model.customer360.stg_sf__contacts: COMMIT
[0m13:16:43.395697 [debug] [Thread-2 (]: SQL status: COMMIT in 0.0 seconds
[0m13:16:43.417132 [debug] [Thread-2 (]: Applying DROP to: "dbt"."public"."stg_sf__contacts__dbt_backup"
[0m13:16:43.436431 [debug] [Thread-2 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m13:16:43.437039 [debug] [Thread-2 (]: On model.customer360.stg_sf__contacts: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_sf__contacts"} */
drop table if exists "dbt"."public"."stg_sf__contacts__dbt_backup" cascade
[0m13:16:43.442744 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.0 seconds
[0m13:16:43.449329 [debug] [Thread-2 (]: Timing info for model.customer360.stg_sf__contacts (execute): 13:16:43.231167 => 13:16:43.448948
[0m13:16:43.449876 [debug] [Thread-2 (]: On model.customer360.stg_sf__contacts: Close
[0m13:16:43.450914 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1380ee54-eec2-414c-a5ca-7e6022b3d717', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff92c5f30d0>]}
[0m13:16:43.451697 [info ] [Thread-2 (]: 12 of 15 OK created sql table model public.stg_sf__contacts .................... [[32mSELECT 10[0m in 0.23s]
[0m13:16:43.465937 [debug] [Thread-2 (]: Finished running node model.customer360.stg_sf__contacts
[0m13:16:43.466954 [debug] [Thread-3 (]: Began running node model.customer360.contacts_joined_with_transactions
[0m13:16:43.467580 [info ] [Thread-3 (]: 13 of 15 SKIP relation public.contacts_joined_with_transactions ................ [[33mSKIP[0m]
[0m13:16:43.468177 [debug] [Thread-3 (]: Finished running node model.customer360.contacts_joined_with_transactions
[0m13:16:43.469192 [debug] [Thread-2 (]: Began running node test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311
[0m13:16:43.469758 [info ] [Thread-2 (]: 14 of 15 SKIP test not_null_contacts_joined_with_transactions_id ............... [[33mSKIP[0m]
[0m13:16:43.470317 [debug] [Thread-2 (]: Finished running node test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311
[0m13:16:43.470958 [debug] [Thread-1 (]: Began running node model.customer360.customers
[0m13:16:43.471453 [info ] [Thread-1 (]: 15 of 15 SKIP relation public.customers ........................................ [[33mSKIP[0m]
[0m13:16:43.472028 [debug] [Thread-1 (]: Finished running node model.customer360.customers
[0m13:16:43.476546 [debug] [MainThread]: Using postgres connection "master"
[0m13:16:43.477035 [debug] [MainThread]: On master: BEGIN
[0m13:16:43.477442 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m13:16:43.493949 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m13:16:43.494700 [debug] [MainThread]: On master: COMMIT
[0m13:16:43.495155 [debug] [MainThread]: Using postgres connection "master"
[0m13:16:43.495568 [debug] [MainThread]: On master: COMMIT
[0m13:16:43.496312 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m13:16:43.496731 [debug] [MainThread]: On master: Close
[0m13:16:43.497678 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:16:43.498106 [debug] [MainThread]: Connection 'model.customer360.stg_web__transactions' was properly closed.
[0m13:16:43.500228 [debug] [MainThread]: Connection 'model.customer360.stg_sf__contacts' was properly closed.
[0m13:16:43.500620 [debug] [MainThread]: Connection 'test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344' was properly closed.
[0m13:16:43.501107 [info ] [MainThread]: 
[0m13:16:43.501626 [info ] [MainThread]: Finished running 9 tests, 2 seeds, 3 table models, 1 view model in 0 hours 0 minutes and 1.18 seconds (1.18s).
[0m13:16:43.505012 [debug] [MainThread]: Command end result
[0m13:16:43.538078 [info ] [MainThread]: 
[0m13:16:43.538678 [info ] [MainThread]: [31mCompleted with 2 errors and 0 warnings:[0m
[0m13:16:43.539143 [info ] [MainThread]: 
[0m13:16:43.539595 [error] [MainThread]:   Database Error in test macro_test2 (tests/macro_test2.sql)
  syntax error at or near "as"
  LINE 8:     select  as expect_result
                      ^
  compiled Code at target/run/customer360/tests/macro_test2.sql
[0m13:16:43.540065 [info ] [MainThread]: 
[0m13:16:43.558555 [error] [MainThread]:   Database Error in model stg_web__transactions (models/staging/web/stg_web__transactions.sql)
  syntax error at or near "as"
  LINE 20:          as transaction_date,
                    ^
  compiled Code at target/run/customer360/models/staging/web/stg_web__transactions.sql
[0m13:16:43.559105 [info ] [MainThread]: 
[0m13:16:43.559646 [info ] [MainThread]: Done. PASS=10 WARN=0 ERROR=2 SKIP=3 TOTAL=15
[0m13:16:43.560698 [debug] [MainThread]: Resource report: {"command_name": "build", "command_wall_clock_time": 1.9060283, "process_user_time": 3.719089, "process_kernel_time": 0.119843, "process_mem_max_rss": "118596", "process_out_blocks": "2816", "command_success": false, "process_in_blocks": "0"}
[0m13:16:43.567407 [debug] [MainThread]: Command `dbt build` failed at 13:16:43.561182 after 1.91 seconds
[0m13:16:43.568019 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff92fb43050>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff92fb35690>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff933fec710>]}
[0m13:16:43.568541 [debug] [MainThread]: Flushing usage events
[0m13:17:42.488106 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe893b8d590>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe893344d50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe8932adc50>]}


============================== 13:17:42.490595 | ea140df6-2fc0-4583-85cd-03d79f1999cf ==============================
[0m13:17:42.490595 [info ] [MainThread]: Running with dbt=1.7.8
[0m13:17:42.491124 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/root/option1-customer360/integration_tests', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/root/option1-customer360/integration_tests/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt build', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m13:17:42.635763 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'ea140df6-2fc0-4583-85cd-03d79f1999cf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe8935c33d0>]}
[0m13:17:42.711261 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'ea140df6-2fc0-4583-85cd-03d79f1999cf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe893405b90>]}
[0m13:17:42.711969 [info ] [MainThread]: Registered adapter: postgres=1.7.8
[0m13:17:42.728571 [debug] [MainThread]: checksum: 67f0013ca5f0bd43af9a0873dd50792fde83ef69de63b71cacd0b4ac656c52e5, vars: {}, profile: , target: , version: 1.7.8
[0m13:17:42.763891 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m13:17:42.765005 [debug] [MainThread]: Partial parsing: updated file: customer360://macros/as_timestamp_utc.sql
[0m13:17:43.330494 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'ea140df6-2fc0-4583-85cd-03d79f1999cf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe890d51a50>]}
[0m13:17:43.345917 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'ea140df6-2fc0-4583-85cd-03d79f1999cf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe89139ce10>]}
[0m13:17:43.346648 [info ] [MainThread]: Found 2 seeds, 4 models, 9 tests, 2 sources, 0 exposures, 0 metrics, 403 macros, 0 groups, 0 semantic models
[0m13:17:43.351060 [info ] [MainThread]: 
[0m13:17:43.352129 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m13:17:43.353894 [debug] [ThreadPool]: Acquiring new postgres connection 'list_dbt'
[0m13:17:43.390101 [debug] [ThreadPool]: Using postgres connection "list_dbt"
[0m13:17:43.390799 [debug] [ThreadPool]: On list_dbt: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "connection_name": "list_dbt"} */

    select distinct nspname from pg_namespace
  
[0m13:17:43.391230 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:17:43.402804 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.0 seconds
[0m13:17:43.404868 [debug] [ThreadPool]: On list_dbt: Close
[0m13:17:43.410139 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dbt, now list_dbt_public)
[0m13:17:43.436657 [debug] [ThreadPool]: Using postgres connection "list_dbt_public"
[0m13:17:43.437217 [debug] [ThreadPool]: On list_dbt_public: BEGIN
[0m13:17:43.437764 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:17:43.464955 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m13:17:43.465563 [debug] [ThreadPool]: Using postgres connection "list_dbt_public"
[0m13:17:43.466170 [debug] [ThreadPool]: On list_dbt_public: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "connection_name": "list_dbt_public"} */
select
      'dbt' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'dbt' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'dbt' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m13:17:43.472866 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.0 seconds
[0m13:17:43.475001 [debug] [ThreadPool]: On list_dbt_public: ROLLBACK
[0m13:17:43.478829 [debug] [ThreadPool]: On list_dbt_public: Close
[0m13:17:43.496385 [debug] [MainThread]: Using postgres connection "master"
[0m13:17:43.497095 [debug] [MainThread]: On master: BEGIN
[0m13:17:43.497520 [debug] [MainThread]: Opening a new connection, currently in state init
[0m13:17:43.548102 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m13:17:43.548813 [debug] [MainThread]: Using postgres connection "master"
[0m13:17:43.549446 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m13:17:43.570334 [debug] [MainThread]: SQL status: SELECT 0 in 0.0 seconds
[0m13:17:43.572345 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ea140df6-2fc0-4583-85cd-03d79f1999cf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe890cfcc90>]}
[0m13:17:43.572991 [debug] [MainThread]: On master: ROLLBACK
[0m13:17:43.576709 [debug] [MainThread]: Using postgres connection "master"
[0m13:17:43.577289 [debug] [MainThread]: On master: BEGIN
[0m13:17:43.584997 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m13:17:43.585572 [debug] [MainThread]: On master: COMMIT
[0m13:17:43.586128 [debug] [MainThread]: Using postgres connection "master"
[0m13:17:43.586582 [debug] [MainThread]: On master: COMMIT
[0m13:17:43.590806 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m13:17:43.591360 [debug] [MainThread]: On master: Close
[0m13:17:43.592474 [info ] [MainThread]: Concurrency: 3 threads (target='local')
[0m13:17:43.593015 [info ] [MainThread]: 
[0m13:17:43.690802 [debug] [Thread-1 (]: Began running node seed.integration_tests.contacts
[0m13:17:43.691674 [info ] [Thread-1 (]: 1 of 15 START seed file public.contacts ........................................ [RUN]
[0m13:17:43.692915 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dbt_public, now seed.integration_tests.contacts)
[0m13:17:43.693545 [debug] [Thread-1 (]: Began compiling node seed.integration_tests.contacts
[0m13:17:43.694327 [debug] [Thread-1 (]: Timing info for seed.integration_tests.contacts (compile): 13:17:43.693897 => 13:17:43.693900
[0m13:17:43.694876 [debug] [Thread-1 (]: Began executing node seed.integration_tests.contacts
[0m13:17:43.713694 [debug] [Thread-2 (]: Began running node seed.integration_tests.transactions
[0m13:17:43.714503 [info ] [Thread-2 (]: 2 of 15 START seed file public.transactions .................................... [RUN]
[0m13:17:43.715634 [debug] [Thread-2 (]: Acquiring new postgres connection 'seed.integration_tests.transactions'
[0m13:17:43.716175 [debug] [Thread-2 (]: Began compiling node seed.integration_tests.transactions
[0m13:17:43.716856 [debug] [Thread-2 (]: Timing info for seed.integration_tests.transactions (compile): 13:17:43.716508 => 13:17:43.716511
[0m13:17:43.717367 [debug] [Thread-2 (]: Began executing node seed.integration_tests.transactions
[0m13:17:43.729709 [debug] [Thread-3 (]: Began running node test.customer360.macro_test1
[0m13:17:43.730284 [info ] [Thread-3 (]: 3 of 15 START test macro_test1 ................................................. [RUN]
[0m13:17:43.731465 [debug] [Thread-3 (]: Acquiring new postgres connection 'test.customer360.macro_test1'
[0m13:17:43.731944 [debug] [Thread-3 (]: Began compiling node test.customer360.macro_test1
[0m13:17:43.812101 [debug] [Thread-3 (]: Writing injected SQL for node "test.customer360.macro_test1"
[0m13:17:43.813083 [debug] [Thread-3 (]: Timing info for test.customer360.macro_test1 (compile): 13:17:43.732241 => 13:17:43.812772
[0m13:17:43.813930 [debug] [Thread-3 (]: Began executing node test.customer360.macro_test1
[0m13:17:43.865920 [debug] [Thread-1 (]: Using postgres connection "seed.integration_tests.contacts"
[0m13:17:43.866578 [debug] [Thread-1 (]: On seed.integration_tests.contacts: BEGIN
[0m13:17:43.867055 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:17:43.876506 [debug] [Thread-3 (]: Writing runtime sql for node "test.customer360.macro_test1"
[0m13:17:43.887215 [debug] [Thread-2 (]: Using postgres connection "seed.integration_tests.transactions"
[0m13:17:43.887849 [debug] [Thread-2 (]: On seed.integration_tests.transactions: BEGIN
[0m13:17:43.888351 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m13:17:43.889395 [debug] [Thread-3 (]: Using postgres connection "test.customer360.macro_test1"
[0m13:17:43.889949 [debug] [Thread-3 (]: On test.customer360.macro_test1: BEGIN
[0m13:17:43.890421 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m13:17:43.922177 [debug] [Thread-3 (]: SQL status: BEGIN in 0.0 seconds
[0m13:17:43.922850 [debug] [Thread-3 (]: Using postgres connection "test.customer360.macro_test1"
[0m13:17:43.923406 [debug] [Thread-3 (]: On test.customer360.macro_test1: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.macro_test1"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      with marco_result as (
    select 
    date_part('year', age(current_date, '2023-02-12'))
 as expect_result
)
select
    1
from marco_result
where expect_result <> 1
      
    ) dbt_internal_test
[0m13:17:43.924017 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m13:17:43.924835 [debug] [Thread-1 (]: Using postgres connection "seed.integration_tests.contacts"
[0m13:17:43.925363 [debug] [Thread-1 (]: On seed.integration_tests.contacts: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "seed.integration_tests.contacts"} */
truncate table "dbt"."public"."contacts"
[0m13:17:43.930278 [debug] [Thread-3 (]: SQL status: SELECT 1 in 0.0 seconds
[0m13:17:43.933221 [debug] [Thread-3 (]: Timing info for test.customer360.macro_test1 (execute): 13:17:43.814242 => 13:17:43.932874
[0m13:17:43.937855 [debug] [Thread-3 (]: On test.customer360.macro_test1: ROLLBACK
[0m13:17:43.943244 [debug] [Thread-2 (]: SQL status: BEGIN in 0.0 seconds
[0m13:17:43.943918 [debug] [Thread-2 (]: Using postgres connection "seed.integration_tests.transactions"
[0m13:17:43.944489 [debug] [Thread-2 (]: On seed.integration_tests.transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "seed.integration_tests.transactions"} */
truncate table "dbt"."public"."transactions"
[0m13:17:43.945018 [debug] [Thread-3 (]: On test.customer360.macro_test1: Close
[0m13:17:43.946255 [info ] [Thread-3 (]: 3 of 15 PASS macro_test1 ....................................................... [[32mPASS[0m in 0.22s]
[0m13:17:43.947076 [debug] [Thread-3 (]: Finished running node test.customer360.macro_test1
[0m13:17:43.947709 [debug] [Thread-3 (]: Began running node test.customer360.macro_test2
[0m13:17:43.948222 [info ] [Thread-3 (]: 4 of 15 START test macro_test2 ................................................. [RUN]
[0m13:17:43.951249 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.customer360.macro_test1, now test.customer360.macro_test2)
[0m13:17:43.951751 [debug] [Thread-3 (]: Began compiling node test.customer360.macro_test2
[0m13:17:43.961738 [debug] [Thread-1 (]: SQL status: TRUNCATE TABLE in 0.0 seconds
[0m13:17:43.962395 [debug] [Thread-2 (]: SQL status: TRUNCATE TABLE in 0.0 seconds
[0m13:17:43.973085 [debug] [Thread-3 (]: Writing injected SQL for node "test.customer360.macro_test2"
[0m13:17:44.029090 [debug] [Thread-1 (]: Using postgres connection "seed.integration_tests.contacts"
[0m13:17:44.029870 [debug] [Thread-1 (]: On seed.integration_tests.contacts: 
          insert into "dbt"."public"."contacts" ("id", "username", "name", "gender", "address", "mail", "birthdate", "_loaded_at_utc") values
          (%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s)
      ...
[0m13:17:44.030928 [debug] [Thread-3 (]: Timing info for test.customer360.macro_test2 (compile): 13:17:43.952046 => 13:17:44.030615
[0m13:17:44.031575 [debug] [Thread-3 (]: Began executing node test.customer360.macro_test2
[0m13:17:44.036510 [debug] [Thread-3 (]: Writing runtime sql for node "test.customer360.macro_test2"
[0m13:17:44.037332 [debug] [Thread-3 (]: Using postgres connection "test.customer360.macro_test2"
[0m13:17:44.037852 [debug] [Thread-3 (]: On test.customer360.macro_test2: BEGIN
[0m13:17:44.038432 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m13:17:44.056694 [debug] [Thread-1 (]: SQL status: INSERT 0 10 in 0.0 seconds
[0m13:17:44.070044 [debug] [Thread-1 (]: Writing runtime SQL for node "seed.integration_tests.contacts"
[0m13:17:44.105963 [debug] [Thread-3 (]: SQL status: BEGIN in 0.0 seconds
[0m13:17:44.106681 [debug] [Thread-3 (]: Using postgres connection "test.customer360.macro_test2"
[0m13:17:44.107231 [debug] [Thread-3 (]: On test.customer360.macro_test2: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.macro_test2"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      with marco_result as (
    select 
        to_timestamp('2023-02-27 21:00:00','YYYY-MM-DD HH24:MI:SS.MS') :: timestamp at TIME zone 'UTC'
     as expect_result
)
select
    1
from marco_result
where cast(pg_typeof(expect_result) as text) not like '%timestamp%'
      
    ) dbt_internal_test
[0m13:17:44.116791 [debug] [Thread-1 (]: On seed.integration_tests.contacts: COMMIT
[0m13:17:44.117518 [debug] [Thread-1 (]: Using postgres connection "seed.integration_tests.contacts"
[0m13:17:44.118054 [debug] [Thread-1 (]: On seed.integration_tests.contacts: COMMIT
[0m13:17:44.118696 [debug] [Thread-3 (]: SQL status: SELECT 1 in 0.0 seconds
[0m13:17:44.120859 [debug] [Thread-3 (]: Timing info for test.customer360.macro_test2 (execute): 13:17:44.031870 => 13:17:44.120545
[0m13:17:44.121701 [debug] [Thread-3 (]: On test.customer360.macro_test2: ROLLBACK
[0m13:17:44.144766 [debug] [Thread-3 (]: On test.customer360.macro_test2: Close
[0m13:17:44.146130 [info ] [Thread-3 (]: 4 of 15 PASS macro_test2 ....................................................... [[32mPASS[0m in 0.20s]
[0m13:17:44.147071 [debug] [Thread-3 (]: Finished running node test.customer360.macro_test2
[0m13:17:44.148037 [debug] [Thread-3 (]: Began running node test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247
[0m13:17:44.148742 [info ] [Thread-3 (]: 5 of 15 START test source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors  [RUN]
[0m13:17:44.149727 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.customer360.macro_test2, now test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247)
[0m13:17:44.150200 [debug] [Thread-3 (]: Began compiling node test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247
[0m13:17:44.156834 [debug] [Thread-1 (]: SQL status: COMMIT in 0.0 seconds
[0m13:17:44.158254 [debug] [Thread-1 (]: Timing info for seed.integration_tests.contacts (execute): 13:17:43.695279 => 13:17:44.157916
[0m13:17:44.158787 [debug] [Thread-1 (]: On seed.integration_tests.contacts: Close
[0m13:17:44.159817 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ea140df6-2fc0-4583-85cd-03d79f1999cf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe890c272d0>]}
[0m13:17:44.162337 [info ] [Thread-1 (]: 1 of 15 OK loaded seed file public.contacts .................................... [[32mINSERT 10[0m in 0.47s]
[0m13:17:44.163217 [debug] [Thread-1 (]: Finished running node seed.integration_tests.contacts
[0m13:17:44.163875 [debug] [Thread-1 (]: Began running node test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d
[0m13:17:44.164466 [info ] [Thread-1 (]: 6 of 15 START test source_not_null_salesforce_contacts_id ...................... [RUN]
[0m13:17:44.168418 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly seed.integration_tests.contacts, now test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d)
[0m13:17:44.169016 [debug] [Thread-1 (]: Began compiling node test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d
[0m13:17:44.210106 [debug] [Thread-1 (]: Writing injected SQL for node "test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d"
[0m13:17:44.211208 [debug] [Thread-1 (]: Timing info for test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d (compile): 13:17:44.169359 => 13:17:44.210743
[0m13:17:44.211866 [debug] [Thread-1 (]: Began executing node test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d
[0m13:17:44.231062 [debug] [Thread-1 (]: Writing runtime sql for node "test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d"
[0m13:17:44.232047 [debug] [Thread-1 (]: Using postgres connection "test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d"
[0m13:17:44.232728 [debug] [Thread-1 (]: On test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d: BEGIN
[0m13:17:44.233202 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:17:44.244506 [debug] [Thread-3 (]: Writing injected SQL for node "test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247"
[0m13:17:44.248644 [debug] [Thread-3 (]: Timing info for test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247 (compile): 13:17:44.150769 => 13:17:44.245147
[0m13:17:44.249404 [debug] [Thread-3 (]: Began executing node test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247
[0m13:17:44.273169 [debug] [Thread-3 (]: Writing runtime sql for node "test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247"
[0m13:17:44.274168 [debug] [Thread-3 (]: Using postgres connection "test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247"
[0m13:17:44.274881 [debug] [Thread-3 (]: On test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247: BEGIN
[0m13:17:44.275578 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m13:17:44.298663 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m13:17:44.299387 [debug] [Thread-1 (]: Using postgres connection "test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d"
[0m13:17:44.299959 [debug] [Thread-1 (]: On test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select id
from "dbt"."public"."contacts"
where id is null



      
    ) dbt_internal_test
[0m13:17:44.326697 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.0 seconds
[0m13:17:44.328904 [debug] [Thread-1 (]: Timing info for test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d (execute): 13:17:44.212222 => 13:17:44.328584
[0m13:17:44.329508 [debug] [Thread-1 (]: On test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d: ROLLBACK
[0m13:17:44.330138 [debug] [Thread-3 (]: SQL status: BEGIN in 0.0 seconds
[0m13:17:44.331101 [debug] [Thread-3 (]: Using postgres connection "test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247"
[0m13:17:44.331723 [debug] [Thread-3 (]: On test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

with all_values as (

    select
        category as value_field,
        count(*) as n_records

    from "dbt"."public"."transactions"
    group by category

)

select *
from all_values
where value_field not in (
    'Apps & Games','Beauty','Books','Clothing, Shoes & Accessories','Movies & TV','Sports, Fitness & Outdoors'
)



      
    ) dbt_internal_test
[0m13:17:44.332408 [debug] [Thread-1 (]: On test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d: Close
[0m13:17:44.333533 [info ] [Thread-1 (]: 6 of 15 PASS source_not_null_salesforce_contacts_id ............................ [[32mPASS[0m in 0.17s]
[0m13:17:44.334396 [debug] [Thread-1 (]: Finished running node test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d
[0m13:17:44.335027 [debug] [Thread-1 (]: Began running node test.customer360.source_not_null_web_transactions_id.88a47bf7e5
[0m13:17:44.335567 [info ] [Thread-1 (]: 7 of 15 START test source_not_null_web_transactions_id ......................... [RUN]
[0m13:17:44.338723 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d, now test.customer360.source_not_null_web_transactions_id.88a47bf7e5)
[0m13:17:44.339404 [debug] [Thread-1 (]: Began compiling node test.customer360.source_not_null_web_transactions_id.88a47bf7e5
[0m13:17:44.345822 [debug] [Thread-1 (]: Writing injected SQL for node "test.customer360.source_not_null_web_transactions_id.88a47bf7e5"
[0m13:17:44.346772 [debug] [Thread-1 (]: Timing info for test.customer360.source_not_null_web_transactions_id.88a47bf7e5 (compile): 13:17:44.339729 => 13:17:44.346414
[0m13:17:44.347242 [debug] [Thread-1 (]: Began executing node test.customer360.source_not_null_web_transactions_id.88a47bf7e5
[0m13:17:44.388937 [debug] [Thread-1 (]: Writing runtime sql for node "test.customer360.source_not_null_web_transactions_id.88a47bf7e5"
[0m13:17:44.389819 [debug] [Thread-1 (]: Using postgres connection "test.customer360.source_not_null_web_transactions_id.88a47bf7e5"
[0m13:17:44.390289 [debug] [Thread-1 (]: On test.customer360.source_not_null_web_transactions_id.88a47bf7e5: BEGIN
[0m13:17:44.390831 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:17:44.434928 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m13:17:44.435620 [debug] [Thread-1 (]: Using postgres connection "test.customer360.source_not_null_web_transactions_id.88a47bf7e5"
[0m13:17:44.436178 [debug] [Thread-1 (]: On test.customer360.source_not_null_web_transactions_id.88a47bf7e5: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.source_not_null_web_transactions_id.88a47bf7e5"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select id
from "dbt"."public"."transactions"
where id is null



      
    ) dbt_internal_test
[0m13:17:44.518415 [debug] [Thread-2 (]: Using postgres connection "seed.integration_tests.transactions"
[0m13:17:44.519092 [debug] [Thread-2 (]: On seed.integration_tests.transactions: 
          insert into "dbt"."public"."transactions" ("contact_id", "id", "transaction_date", "amount", "item_count", "category", "_loaded_at_utc") values
          (%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%...
[0m13:17:44.525550 [debug] [Thread-2 (]: SQL status: INSERT 0 74 in 0.0 seconds
[0m13:17:44.526942 [debug] [Thread-2 (]: Writing runtime SQL for node "seed.integration_tests.transactions"
[0m13:17:44.530156 [debug] [Thread-2 (]: On seed.integration_tests.transactions: COMMIT
[0m13:17:44.530710 [debug] [Thread-2 (]: Using postgres connection "seed.integration_tests.transactions"
[0m13:17:44.531342 [debug] [Thread-2 (]: On seed.integration_tests.transactions: COMMIT
[0m13:17:44.537661 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.0 seconds
[0m13:17:44.539979 [debug] [Thread-1 (]: Timing info for test.customer360.source_not_null_web_transactions_id.88a47bf7e5 (execute): 13:17:44.347551 => 13:17:44.539590
[0m13:17:44.540560 [debug] [Thread-1 (]: On test.customer360.source_not_null_web_transactions_id.88a47bf7e5: ROLLBACK
[0m13:17:44.541222 [debug] [Thread-3 (]: SQL status: SELECT 1 in 0.0 seconds
[0m13:17:44.543258 [debug] [Thread-3 (]: Timing info for test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247 (execute): 13:17:44.249752 => 13:17:44.542852
[0m13:17:44.544280 [debug] [Thread-3 (]: On test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247: ROLLBACK
[0m13:17:44.544914 [debug] [Thread-1 (]: On test.customer360.source_not_null_web_transactions_id.88a47bf7e5: Close
[0m13:17:44.546138 [info ] [Thread-1 (]: 7 of 15 PASS source_not_null_web_transactions_id ............................... [[32mPASS[0m in 0.21s]
[0m13:17:44.547064 [debug] [Thread-1 (]: Finished running node test.customer360.source_not_null_web_transactions_id.88a47bf7e5
[0m13:17:44.550350 [debug] [Thread-1 (]: Began running node test.customer360.source_unique_salesforce_contacts_id.01cadaaf43
[0m13:17:44.551015 [info ] [Thread-1 (]: 8 of 15 START test source_unique_salesforce_contacts_id ........................ [RUN]
[0m13:17:44.552057 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.customer360.source_not_null_web_transactions_id.88a47bf7e5, now test.customer360.source_unique_salesforce_contacts_id.01cadaaf43)
[0m13:17:44.552673 [debug] [Thread-1 (]: Began compiling node test.customer360.source_unique_salesforce_contacts_id.01cadaaf43
[0m13:17:44.562553 [debug] [Thread-1 (]: Writing injected SQL for node "test.customer360.source_unique_salesforce_contacts_id.01cadaaf43"
[0m13:17:44.564963 [debug] [Thread-1 (]: Timing info for test.customer360.source_unique_salesforce_contacts_id.01cadaaf43 (compile): 13:17:44.552993 => 13:17:44.563108
[0m13:17:44.565619 [debug] [Thread-1 (]: Began executing node test.customer360.source_unique_salesforce_contacts_id.01cadaaf43
[0m13:17:44.568541 [debug] [Thread-1 (]: Writing runtime sql for node "test.customer360.source_unique_salesforce_contacts_id.01cadaaf43"
[0m13:17:44.570941 [debug] [Thread-1 (]: Using postgres connection "test.customer360.source_unique_salesforce_contacts_id.01cadaaf43"
[0m13:17:44.571624 [debug] [Thread-1 (]: On test.customer360.source_unique_salesforce_contacts_id.01cadaaf43: BEGIN
[0m13:17:44.572222 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:17:44.568969 [debug] [Thread-3 (]: On test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247: Close
[0m13:17:44.574225 [info ] [Thread-3 (]: 5 of 15 PASS source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors  [[32mPASS[0m in 0.42s]
[0m13:17:44.575187 [debug] [Thread-3 (]: Finished running node test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247
[0m13:17:44.575786 [debug] [Thread-3 (]: Began running node test.customer360.source_unique_web_transactions_id.ba28079761
[0m13:17:44.576446 [info ] [Thread-3 (]: 9 of 15 START test source_unique_web_transactions_id ........................... [RUN]
[0m13:17:44.569764 [debug] [Thread-2 (]: SQL status: COMMIT in 0.0 seconds
[0m13:17:44.580068 [debug] [Thread-2 (]: Timing info for seed.integration_tests.transactions (execute): 13:17:43.717703 => 13:17:44.579602
[0m13:17:44.580737 [debug] [Thread-2 (]: On seed.integration_tests.transactions: Close
[0m13:17:44.581834 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ea140df6-2fc0-4583-85cd-03d79f1999cf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe890c01f90>]}
[0m13:17:44.582619 [info ] [Thread-2 (]: 2 of 15 OK loaded seed file public.transactions ................................ [[32mINSERT 74[0m in 0.87s]
[0m13:17:44.583692 [debug] [Thread-2 (]: Finished running node seed.integration_tests.transactions
[0m13:17:44.584415 [debug] [Thread-2 (]: Began running node test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344
[0m13:17:44.585088 [info ] [Thread-2 (]: 10 of 15 START test source_relationships_web_transactions_contact_id__id__ref_contacts_  [RUN]
[0m13:17:44.586086 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly seed.integration_tests.transactions, now test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344)
[0m13:17:44.586624 [debug] [Thread-2 (]: Began compiling node test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344
[0m13:17:44.578439 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247, now test.customer360.source_unique_web_transactions_id.ba28079761)
[0m13:17:44.597133 [debug] [Thread-3 (]: Began compiling node test.customer360.source_unique_web_transactions_id.ba28079761
[0m13:17:44.604290 [debug] [Thread-3 (]: Writing injected SQL for node "test.customer360.source_unique_web_transactions_id.ba28079761"
[0m13:17:44.605574 [debug] [Thread-3 (]: Timing info for test.customer360.source_unique_web_transactions_id.ba28079761 (compile): 13:17:44.597662 => 13:17:44.605096
[0m13:17:44.606108 [debug] [Thread-3 (]: Began executing node test.customer360.source_unique_web_transactions_id.ba28079761
[0m13:17:44.609801 [debug] [Thread-3 (]: Writing runtime sql for node "test.customer360.source_unique_web_transactions_id.ba28079761"
[0m13:17:44.610642 [debug] [Thread-3 (]: Using postgres connection "test.customer360.source_unique_web_transactions_id.ba28079761"
[0m13:17:44.611138 [debug] [Thread-3 (]: On test.customer360.source_unique_web_transactions_id.ba28079761: BEGIN
[0m13:17:44.612497 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m13:17:44.616590 [debug] [Thread-2 (]: Writing injected SQL for node "test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344"
[0m13:17:44.618579 [debug] [Thread-2 (]: Timing info for test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344 (compile): 13:17:44.587039 => 13:17:44.617189
[0m13:17:44.619253 [debug] [Thread-2 (]: Began executing node test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344
[0m13:17:44.623170 [debug] [Thread-2 (]: Writing runtime sql for node "test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344"
[0m13:17:44.623996 [debug] [Thread-2 (]: Using postgres connection "test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344"
[0m13:17:44.624559 [debug] [Thread-2 (]: On test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344: BEGIN
[0m13:17:44.625178 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m13:17:44.626438 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m13:17:44.627237 [debug] [Thread-1 (]: Using postgres connection "test.customer360.source_unique_salesforce_contacts_id.01cadaaf43"
[0m13:17:44.628909 [debug] [Thread-1 (]: On test.customer360.source_unique_salesforce_contacts_id.01cadaaf43: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.source_unique_salesforce_contacts_id.01cadaaf43"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

select
    id as unique_field,
    count(*) as n_records

from "dbt"."public"."contacts"
where id is not null
group by id
having count(*) > 1



      
    ) dbt_internal_test
[0m13:17:44.632104 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.0 seconds
[0m13:17:44.634406 [debug] [Thread-1 (]: Timing info for test.customer360.source_unique_salesforce_contacts_id.01cadaaf43 (execute): 13:17:44.565908 => 13:17:44.634019
[0m13:17:44.635028 [debug] [Thread-1 (]: On test.customer360.source_unique_salesforce_contacts_id.01cadaaf43: ROLLBACK
[0m13:17:44.636994 [debug] [Thread-1 (]: On test.customer360.source_unique_salesforce_contacts_id.01cadaaf43: Close
[0m13:17:44.638268 [info ] [Thread-1 (]: 8 of 15 PASS source_unique_salesforce_contacts_id .............................. [[32mPASS[0m in 0.09s]
[0m13:17:44.639175 [debug] [Thread-1 (]: Finished running node test.customer360.source_unique_salesforce_contacts_id.01cadaaf43
[0m13:17:44.643083 [debug] [Thread-3 (]: SQL status: BEGIN in 0.0 seconds
[0m13:17:44.643749 [debug] [Thread-3 (]: Using postgres connection "test.customer360.source_unique_web_transactions_id.ba28079761"
[0m13:17:44.644266 [debug] [Thread-3 (]: On test.customer360.source_unique_web_transactions_id.ba28079761: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.source_unique_web_transactions_id.ba28079761"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

select
    id as unique_field,
    count(*) as n_records

from "dbt"."public"."transactions"
where id is not null
group by id
having count(*) > 1



      
    ) dbt_internal_test
[0m13:17:44.645688 [debug] [Thread-1 (]: Began running node model.customer360.stg_sf__contacts
[0m13:17:44.646284 [info ] [Thread-1 (]: 11 of 15 START sql table model public.stg_sf__contacts ......................... [RUN]
[0m13:17:44.647228 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.customer360.source_unique_salesforce_contacts_id.01cadaaf43, now model.customer360.stg_sf__contacts)
[0m13:17:44.647765 [debug] [Thread-1 (]: Began compiling node model.customer360.stg_sf__contacts
[0m13:17:44.651578 [debug] [Thread-1 (]: Writing injected SQL for node "model.customer360.stg_sf__contacts"
[0m13:17:44.652424 [debug] [Thread-1 (]: Timing info for model.customer360.stg_sf__contacts (compile): 13:17:44.648060 => 13:17:44.652050
[0m13:17:44.652915 [debug] [Thread-1 (]: Began executing node model.customer360.stg_sf__contacts
[0m13:17:44.673604 [debug] [Thread-3 (]: SQL status: SELECT 1 in 0.0 seconds
[0m13:17:44.675777 [debug] [Thread-3 (]: Timing info for test.customer360.source_unique_web_transactions_id.ba28079761 (execute): 13:17:44.606585 => 13:17:44.675406
[0m13:17:44.676325 [debug] [Thread-3 (]: On test.customer360.source_unique_web_transactions_id.ba28079761: ROLLBACK
[0m13:17:44.690982 [debug] [Thread-3 (]: On test.customer360.source_unique_web_transactions_id.ba28079761: Close
[0m13:17:44.692170 [info ] [Thread-3 (]: 9 of 15 PASS source_unique_web_transactions_id ................................. [[32mPASS[0m in 0.12s]
[0m13:17:44.693026 [debug] [Thread-3 (]: Finished running node test.customer360.source_unique_web_transactions_id.ba28079761
[0m13:17:44.693653 [debug] [Thread-2 (]: SQL status: BEGIN in 0.0 seconds
[0m13:17:44.694169 [debug] [Thread-2 (]: Using postgres connection "test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344"
[0m13:17:44.694804 [debug] [Thread-2 (]: On test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

with child as (
    select contact_id as from_field
    from "dbt"."public"."transactions"
    where contact_id is not null
),

parent as (
    select id as to_field
    from "dbt"."public"."contacts"
)

select
    from_field

from child
left join parent
    on child.from_field = parent.to_field

where parent.to_field is null



      
    ) dbt_internal_test
[0m13:17:44.706803 [debug] [Thread-3 (]: Began running node model.customer360.stg_web__transactions
[0m13:17:44.707562 [info ] [Thread-3 (]: 12 of 15 START sql table model public.stg_web__transactions .................... [RUN]
[0m13:17:44.708520 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.customer360.source_unique_web_transactions_id.ba28079761, now model.customer360.stg_web__transactions)
[0m13:17:44.709083 [debug] [Thread-3 (]: Began compiling node model.customer360.stg_web__transactions
[0m13:17:44.713652 [debug] [Thread-3 (]: Writing injected SQL for node "model.customer360.stg_web__transactions"
[0m13:17:44.714579 [debug] [Thread-3 (]: Timing info for model.customer360.stg_web__transactions (compile): 13:17:44.709404 => 13:17:44.714250
[0m13:17:44.715111 [debug] [Thread-3 (]: Began executing node model.customer360.stg_web__transactions
[0m13:17:44.729657 [debug] [Thread-2 (]: SQL status: SELECT 1 in 0.0 seconds
[0m13:17:44.731757 [debug] [Thread-2 (]: Timing info for test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344 (execute): 13:17:44.619609 => 13:17:44.731440
[0m13:17:44.735714 [debug] [Thread-2 (]: On test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344: ROLLBACK
[0m13:17:44.738062 [debug] [Thread-1 (]: Writing runtime sql for node "model.customer360.stg_sf__contacts"
[0m13:17:44.739002 [debug] [Thread-1 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m13:17:44.739637 [debug] [Thread-1 (]: On model.customer360.stg_sf__contacts: BEGIN
[0m13:17:44.740250 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:17:44.734990 [debug] [Thread-3 (]: Writing runtime sql for node "model.customer360.stg_web__transactions"
[0m13:17:44.741656 [debug] [Thread-3 (]: Using postgres connection "model.customer360.stg_web__transactions"
[0m13:17:44.742320 [debug] [Thread-3 (]: On model.customer360.stg_web__transactions: BEGIN
[0m13:17:44.742841 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m13:17:44.745105 [debug] [Thread-2 (]: On test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344: Close
[0m13:17:44.746369 [info ] [Thread-2 (]: 10 of 15 PASS source_relationships_web_transactions_contact_id__id__ref_contacts_  [[32mPASS[0m in 0.16s]
[0m13:17:44.747348 [debug] [Thread-2 (]: Finished running node test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344
[0m13:17:44.751951 [debug] [Thread-3 (]: SQL status: BEGIN in 0.0 seconds
[0m13:17:44.752557 [debug] [Thread-3 (]: Using postgres connection "model.customer360.stg_web__transactions"
[0m13:17:44.753266 [debug] [Thread-3 (]: On model.customer360.stg_web__transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_web__transactions"} */

  
    

  create  table "dbt"."public"."stg_web__transactions__dbt_tmp"
  
  
    as
  
  (
    with source as (
    select * from "dbt"."public"."transactions"
),

renamed as (
    select
        id,
        contact_id,
        
        to_timestamp(transaction_date,'YYYY-MM-DD HH24:MI:SS.MS') :: timestamp at TIME zone 'UTC'
     as transaction_date,
        amount,
        item_count,
        category, 
        _loaded_at_utc
    from source    
),

clean_older as (
    select * from renamed 
--    where transaction_date >= (current_date - 1)  过滤超过1天的数据
    where transaction_date >= (to_date('2023-04-12','yyyy-MM-dd') - 1)  --测试用,假设跑数日期为2023-04-12
    and transaction_date < to_date('2023-04-12','yyyy-MM-dd')
)

select * from clean_older
  );
  
[0m13:17:44.759139 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m13:17:44.760738 [debug] [Thread-1 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m13:17:44.761365 [debug] [Thread-1 (]: On model.customer360.stg_sf__contacts: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_sf__contacts"} */

  
    

  create  table "dbt"."public"."stg_sf__contacts__dbt_tmp"
  
  
    as
  
  (
    with source as (
    select * from "dbt"."public"."contacts"
),

renamed as (
    select
        id,
        username as user_name,
        name,
        gender,
        address, 
        mail as email_address,
        birthdate as birth_date,
        _loaded_at_utc
    from source     
)

select * from renamed
  );
  
[0m13:17:44.765192 [debug] [Thread-3 (]: SQL status: SELECT 4 in 0.0 seconds
[0m13:17:44.775501 [debug] [Thread-3 (]: Using postgres connection "model.customer360.stg_web__transactions"
[0m13:17:44.776117 [debug] [Thread-3 (]: On model.customer360.stg_web__transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_web__transactions"} */
alter table "dbt"."public"."stg_web__transactions" rename to "stg_web__transactions__dbt_backup"
[0m13:17:44.777817 [debug] [Thread-1 (]: SQL status: SELECT 10 in 0.0 seconds
[0m13:17:44.782698 [debug] [Thread-1 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m13:17:44.783464 [debug] [Thread-1 (]: On model.customer360.stg_sf__contacts: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_sf__contacts"} */
alter table "dbt"."public"."stg_sf__contacts" rename to "stg_sf__contacts__dbt_backup"
[0m13:17:44.784147 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m13:17:44.789161 [debug] [Thread-3 (]: Using postgres connection "model.customer360.stg_web__transactions"
[0m13:17:44.789734 [debug] [Thread-3 (]: On model.customer360.stg_web__transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_web__transactions"} */
alter table "dbt"."public"."stg_web__transactions__dbt_tmp" rename to "stg_web__transactions"
[0m13:17:44.790447 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m13:17:44.795668 [debug] [Thread-1 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m13:17:44.796377 [debug] [Thread-1 (]: On model.customer360.stg_sf__contacts: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_sf__contacts"} */
alter table "dbt"."public"."stg_sf__contacts__dbt_tmp" rename to "stg_sf__contacts"
[0m13:17:44.797019 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m13:17:44.807850 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m13:17:44.812615 [debug] [Thread-1 (]: On model.customer360.stg_sf__contacts: COMMIT
[0m13:17:44.813156 [debug] [Thread-1 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m13:17:44.813827 [debug] [Thread-1 (]: On model.customer360.stg_sf__contacts: COMMIT
[0m13:17:44.815581 [debug] [Thread-3 (]: On model.customer360.stg_web__transactions: COMMIT
[0m13:17:44.816113 [debug] [Thread-3 (]: Using postgres connection "model.customer360.stg_web__transactions"
[0m13:17:44.816827 [debug] [Thread-3 (]: On model.customer360.stg_web__transactions: COMMIT
[0m13:17:44.819059 [debug] [Thread-3 (]: SQL status: COMMIT in 0.0 seconds
[0m13:17:44.831629 [debug] [Thread-1 (]: SQL status: COMMIT in 0.0 seconds
[0m13:17:44.837905 [debug] [Thread-1 (]: Applying DROP to: "dbt"."public"."stg_sf__contacts__dbt_backup"
[0m13:17:44.844802 [debug] [Thread-3 (]: Applying DROP to: "dbt"."public"."stg_web__transactions__dbt_backup"
[0m13:17:44.847363 [debug] [Thread-3 (]: Using postgres connection "model.customer360.stg_web__transactions"
[0m13:17:44.847998 [debug] [Thread-3 (]: On model.customer360.stg_web__transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_web__transactions"} */
drop table if exists "dbt"."public"."stg_web__transactions__dbt_backup" cascade
[0m13:17:44.849938 [debug] [Thread-1 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m13:17:44.850590 [debug] [Thread-1 (]: On model.customer360.stg_sf__contacts: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_sf__contacts"} */
drop table if exists "dbt"."public"."stg_sf__contacts__dbt_backup" cascade
[0m13:17:44.854164 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.0 seconds
[0m13:17:44.857723 [debug] [Thread-3 (]: Timing info for model.customer360.stg_web__transactions (execute): 13:17:44.715439 => 13:17:44.857178
[0m13:17:44.858381 [debug] [Thread-3 (]: On model.customer360.stg_web__transactions: Close
[0m13:17:44.859546 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ea140df6-2fc0-4583-85cd-03d79f1999cf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe890b1a550>]}
[0m13:17:44.863662 [info ] [Thread-3 (]: 12 of 15 OK created sql table model public.stg_web__transactions ............... [[32mSELECT 4[0m in 0.15s]
[0m13:17:44.864727 [debug] [Thread-3 (]: Finished running node model.customer360.stg_web__transactions
[0m13:17:44.865453 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.0 seconds
[0m13:17:44.867704 [debug] [Thread-1 (]: Timing info for model.customer360.stg_sf__contacts (execute): 13:17:44.653216 => 13:17:44.867418
[0m13:17:44.868377 [debug] [Thread-1 (]: On model.customer360.stg_sf__contacts: Close
[0m13:17:44.872132 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ea140df6-2fc0-4583-85cd-03d79f1999cf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe890bb7fd0>]}
[0m13:17:44.873112 [info ] [Thread-1 (]: 11 of 15 OK created sql table model public.stg_sf__contacts .................... [[32mSELECT 10[0m in 0.23s]
[0m13:17:44.873980 [debug] [Thread-1 (]: Finished running node model.customer360.stg_sf__contacts
[0m13:17:44.877368 [debug] [Thread-2 (]: Began running node model.customer360.contacts_joined_with_transactions
[0m13:17:44.877940 [info ] [Thread-2 (]: 13 of 15 START sql view model public.contacts_joined_with_transactions ......... [RUN]
[0m13:17:44.878711 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344, now model.customer360.contacts_joined_with_transactions)
[0m13:17:44.879281 [debug] [Thread-2 (]: Began compiling node model.customer360.contacts_joined_with_transactions
[0m13:17:44.883560 [debug] [Thread-2 (]: Writing injected SQL for node "model.customer360.contacts_joined_with_transactions"
[0m13:17:44.884606 [debug] [Thread-2 (]: Timing info for model.customer360.contacts_joined_with_transactions (compile): 13:17:44.879595 => 13:17:44.884265
[0m13:17:44.885141 [debug] [Thread-2 (]: Began executing node model.customer360.contacts_joined_with_transactions
[0m13:17:44.905493 [debug] [Thread-2 (]: Writing runtime sql for node "model.customer360.contacts_joined_with_transactions"
[0m13:17:44.906135 [debug] [Thread-2 (]: Using postgres connection "model.customer360.contacts_joined_with_transactions"
[0m13:17:44.906623 [debug] [Thread-2 (]: On model.customer360.contacts_joined_with_transactions: BEGIN
[0m13:17:44.906946 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m13:17:44.910519 [debug] [Thread-2 (]: SQL status: BEGIN in 0.0 seconds
[0m13:17:44.910873 [debug] [Thread-2 (]: Using postgres connection "model.customer360.contacts_joined_with_transactions"
[0m13:17:44.911290 [debug] [Thread-2 (]: On model.customer360.contacts_joined_with_transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.contacts_joined_with_transactions"} */

  create view "dbt"."public"."contacts_joined_with_transactions__dbt_tmp"
    
    
  as (
    SELECT 
    contacts.*,
    transactions.id as transaction_id,
    transactions.transaction_date,
    transactions.amount,
    transactions.item_count,
    transactions.category
FROM "dbt"."public"."stg_web__transactions" as transactions
LEFT JOIN "dbt"."public"."stg_sf__contacts" as contacts ON contacts.id = transactions.contact_id
  );
[0m13:17:44.913629 [debug] [Thread-2 (]: SQL status: CREATE VIEW in 0.0 seconds
[0m13:17:44.916788 [debug] [Thread-2 (]: Using postgres connection "model.customer360.contacts_joined_with_transactions"
[0m13:17:44.917282 [debug] [Thread-2 (]: On model.customer360.contacts_joined_with_transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.contacts_joined_with_transactions"} */
alter table "dbt"."public"."contacts_joined_with_transactions__dbt_tmp" rename to "contacts_joined_with_transactions"
[0m13:17:44.918137 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m13:17:44.919670 [debug] [Thread-2 (]: On model.customer360.contacts_joined_with_transactions: COMMIT
[0m13:17:44.920072 [debug] [Thread-2 (]: Using postgres connection "model.customer360.contacts_joined_with_transactions"
[0m13:17:44.920438 [debug] [Thread-2 (]: On model.customer360.contacts_joined_with_transactions: COMMIT
[0m13:17:44.922820 [debug] [Thread-2 (]: SQL status: COMMIT in 0.0 seconds
[0m13:17:44.925223 [debug] [Thread-2 (]: Applying DROP to: "dbt"."public"."contacts_joined_with_transactions__dbt_backup"
[0m13:17:44.928356 [debug] [Thread-2 (]: Using postgres connection "model.customer360.contacts_joined_with_transactions"
[0m13:17:44.928815 [debug] [Thread-2 (]: On model.customer360.contacts_joined_with_transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.contacts_joined_with_transactions"} */
drop view if exists "dbt"."public"."contacts_joined_with_transactions__dbt_backup" cascade
[0m13:17:44.929433 [debug] [Thread-2 (]: SQL status: DROP VIEW in 0.0 seconds
[0m13:17:44.930826 [debug] [Thread-2 (]: Timing info for model.customer360.contacts_joined_with_transactions (execute): 13:17:44.885455 => 13:17:44.930618
[0m13:17:44.931156 [debug] [Thread-2 (]: On model.customer360.contacts_joined_with_transactions: Close
[0m13:17:44.932056 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ea140df6-2fc0-4583-85cd-03d79f1999cf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe890b26890>]}
[0m13:17:44.932815 [info ] [Thread-2 (]: 13 of 15 OK created sql view model public.contacts_joined_with_transactions .... [[32mCREATE VIEW[0m in 0.05s]
[0m13:17:44.933621 [debug] [Thread-2 (]: Finished running node model.customer360.contacts_joined_with_transactions
[0m13:17:44.934515 [debug] [Thread-1 (]: Began running node test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311
[0m13:17:44.934933 [info ] [Thread-1 (]: 14 of 15 START test not_null_contacts_joined_with_transactions_id .............. [RUN]
[0m13:17:44.935642 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.customer360.stg_sf__contacts, now test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311)
[0m13:17:44.935974 [debug] [Thread-1 (]: Began compiling node test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311
[0m13:17:44.940130 [debug] [Thread-1 (]: Writing injected SQL for node "test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311"
[0m13:17:44.940909 [debug] [Thread-1 (]: Timing info for test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311 (compile): 13:17:44.936169 => 13:17:44.940657
[0m13:17:44.941234 [debug] [Thread-1 (]: Began executing node test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311
[0m13:17:44.943436 [debug] [Thread-1 (]: Writing runtime sql for node "test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311"
[0m13:17:44.943934 [debug] [Thread-1 (]: Using postgres connection "test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311"
[0m13:17:44.944403 [debug] [Thread-1 (]: On test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311: BEGIN
[0m13:17:44.944725 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:17:44.948383 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m13:17:44.948732 [debug] [Thread-1 (]: Using postgres connection "test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311"
[0m13:17:44.949148 [debug] [Thread-1 (]: On test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select id
from "dbt"."public"."contacts_joined_with_transactions"
where id is null



      
    ) dbt_internal_test
[0m13:17:44.950894 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.0 seconds
[0m13:17:44.952620 [debug] [Thread-1 (]: Timing info for test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311 (execute): 13:17:44.941558 => 13:17:44.952402
[0m13:17:44.953035 [debug] [Thread-1 (]: On test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311: ROLLBACK
[0m13:17:44.953606 [debug] [Thread-1 (]: On test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311: Close
[0m13:17:44.954537 [info ] [Thread-1 (]: 14 of 15 PASS not_null_contacts_joined_with_transactions_id .................... [[32mPASS[0m in 0.02s]
[0m13:17:44.955329 [debug] [Thread-1 (]: Finished running node test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311
[0m13:17:44.956633 [debug] [Thread-2 (]: Began running node model.customer360.customers
[0m13:17:44.957095 [info ] [Thread-2 (]: 15 of 15 START sql table model public.customers ................................ [RUN]
[0m13:17:44.957708 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.customer360.contacts_joined_with_transactions, now model.customer360.customers)
[0m13:17:44.958090 [debug] [Thread-2 (]: Began compiling node model.customer360.customers
[0m13:17:44.961213 [debug] [Thread-2 (]: Writing injected SQL for node "model.customer360.customers"
[0m13:17:44.961959 [debug] [Thread-2 (]: Timing info for model.customer360.customers (compile): 13:17:44.958289 => 13:17:44.961663
[0m13:17:44.962421 [debug] [Thread-2 (]: Began executing node model.customer360.customers
[0m13:17:44.968313 [debug] [Thread-2 (]: Writing runtime sql for node "model.customer360.customers"
[0m13:17:44.968985 [debug] [Thread-2 (]: Using postgres connection "model.customer360.customers"
[0m13:17:44.969379 [debug] [Thread-2 (]: On model.customer360.customers: BEGIN
[0m13:17:44.969737 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m13:17:44.973199 [debug] [Thread-2 (]: SQL status: BEGIN in 0.0 seconds
[0m13:17:44.973635 [debug] [Thread-2 (]: Using postgres connection "model.customer360.customers"
[0m13:17:44.973961 [debug] [Thread-2 (]: On model.customer360.customers: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.customers"} */

  
    

  create  table "dbt"."public"."customers__dbt_tmp"
  
  
    as
  
  (
    SELECT
    id,
    gender,
    
    date_part('year', age(current_date, birth_date))
 AS age,
    sum(amount) as total_expense
FROM "dbt"."public"."contacts_joined_with_transactions"
GROUP BY
    1,2,3
  );
  
[0m13:17:44.983770 [debug] [Thread-2 (]: SQL status: SELECT 2 in 0.0 seconds
[0m13:17:44.988576 [debug] [Thread-2 (]: Using postgres connection "model.customer360.customers"
[0m13:17:44.988914 [debug] [Thread-2 (]: On model.customer360.customers: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.customers"} */
alter table "dbt"."public"."customers" rename to "customers__dbt_backup"
[0m13:17:44.989664 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m13:17:44.992432 [debug] [Thread-2 (]: Using postgres connection "model.customer360.customers"
[0m13:17:44.992772 [debug] [Thread-2 (]: On model.customer360.customers: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.customers"} */
alter table "dbt"."public"."customers__dbt_tmp" rename to "customers"
[0m13:17:44.993450 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m13:17:44.995708 [debug] [Thread-2 (]: On model.customer360.customers: COMMIT
[0m13:17:44.996113 [debug] [Thread-2 (]: Using postgres connection "model.customer360.customers"
[0m13:17:44.996490 [debug] [Thread-2 (]: On model.customer360.customers: COMMIT
[0m13:17:44.997788 [debug] [Thread-2 (]: SQL status: COMMIT in 0.0 seconds
[0m13:17:45.000371 [debug] [Thread-2 (]: Applying DROP to: "dbt"."public"."customers__dbt_backup"
[0m13:17:45.001206 [debug] [Thread-2 (]: Using postgres connection "model.customer360.customers"
[0m13:17:45.001599 [debug] [Thread-2 (]: On model.customer360.customers: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.customers"} */
drop table if exists "dbt"."public"."customers__dbt_backup" cascade
[0m13:17:45.003963 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.0 seconds
[0m13:17:45.005571 [debug] [Thread-2 (]: Timing info for model.customer360.customers (execute): 13:17:44.962709 => 13:17:45.005378
[0m13:17:45.005986 [debug] [Thread-2 (]: On model.customer360.customers: Close
[0m13:17:45.006902 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ea140df6-2fc0-4583-85cd-03d79f1999cf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe890be6990>]}
[0m13:17:45.007593 [info ] [Thread-2 (]: 15 of 15 OK created sql table model public.customers ........................... [[32mSELECT 2[0m in 0.05s]
[0m13:17:45.008352 [debug] [Thread-2 (]: Finished running node model.customer360.customers
[0m13:17:45.010212 [debug] [MainThread]: Using postgres connection "master"
[0m13:17:45.010541 [debug] [MainThread]: On master: BEGIN
[0m13:17:45.010902 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m13:17:45.014214 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m13:17:45.014625 [debug] [MainThread]: On master: COMMIT
[0m13:17:45.014903 [debug] [MainThread]: Using postgres connection "master"
[0m13:17:45.015174 [debug] [MainThread]: On master: COMMIT
[0m13:17:45.015826 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m13:17:45.016129 [debug] [MainThread]: On master: Close
[0m13:17:45.016822 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:17:45.017093 [debug] [MainThread]: Connection 'test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311' was properly closed.
[0m13:17:45.017395 [debug] [MainThread]: Connection 'model.customer360.customers' was properly closed.
[0m13:17:45.017895 [debug] [MainThread]: Connection 'model.customer360.stg_web__transactions' was properly closed.
[0m13:17:45.018368 [info ] [MainThread]: 
[0m13:17:45.018883 [info ] [MainThread]: Finished running 9 tests, 2 seeds, 3 table models, 1 view model in 0 hours 0 minutes and 1.67 seconds (1.67s).
[0m13:17:45.021515 [debug] [MainThread]: Command end result
[0m13:17:45.029012 [info ] [MainThread]: 
[0m13:17:45.029589 [info ] [MainThread]: [32mCompleted successfully[0m
[0m13:17:45.029889 [info ] [MainThread]: 
[0m13:17:45.030263 [info ] [MainThread]: Done. PASS=15 WARN=0 ERROR=0 SKIP=0 TOTAL=15
[0m13:17:45.031011 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 2.5796783, "process_user_time": 4.108153, "process_kernel_time": 0.129762, "process_mem_max_rss": "118652", "process_out_blocks": "2896", "process_in_blocks": "0"}
[0m13:17:45.031616 [debug] [MainThread]: Command `dbt build` succeeded at 13:17:45.031492 after 2.58 seconds
[0m13:17:45.031938 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe89307bb50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe8932afc90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe897a77d50>]}
[0m13:17:45.032420 [debug] [MainThread]: Flushing usage events
[0m13:17:54.624571 [debug] [MainThread]: Error sending anonymous usage statistics. Disabling tracking for this execution. If you wish to permanently disable tracking, see: https://docs.getdbt.com/reference/global-configs#send-anonymous-usage-stats.
[0m13:19:10.176132 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fea65b15d10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fea662da290>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fea657b3890>]}


============================== 13:19:10.179616 | a3f0076d-0e65-45d3-b719-49c03a8ba284 ==============================
[0m13:19:10.179616 [info ] [MainThread]: Running with dbt=1.7.8
[0m13:19:10.180340 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/root/option1-customer360/integration_tests', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/root/option1-customer360/integration_tests/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'target_path': 'None', 'invocation_command': 'dbt build', 'send_anonymous_usage_stats': 'True'}
[0m13:19:10.410823 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a3f0076d-0e65-45d3-b719-49c03a8ba284', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fea653806d0>]}
[0m13:19:10.523035 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'a3f0076d-0e65-45d3-b719-49c03a8ba284', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fea6397cb10>]}
[0m13:19:10.523917 [info ] [MainThread]: Registered adapter: postgres=1.7.8
[0m13:19:10.542161 [debug] [MainThread]: checksum: 67f0013ca5f0bd43af9a0873dd50792fde83ef69de63b71cacd0b4ac656c52e5, vars: {}, profile: , target: , version: 1.7.8
[0m13:19:10.575849 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m13:19:10.576964 [debug] [MainThread]: Partial parsing: updated file: customer360://macros/as_timestamp_utc.sql
[0m13:19:11.338550 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'a3f0076d-0e65-45d3-b719-49c03a8ba284', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fea632f3c90>]}
[0m13:19:11.347934 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'a3f0076d-0e65-45d3-b719-49c03a8ba284', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fea638841d0>]}
[0m13:19:11.348408 [info ] [MainThread]: Found 2 seeds, 4 models, 9 tests, 2 sources, 0 exposures, 0 metrics, 403 macros, 0 groups, 0 semantic models
[0m13:19:11.350368 [info ] [MainThread]: 
[0m13:19:11.351040 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m13:19:11.352199 [debug] [ThreadPool]: Acquiring new postgres connection 'list_dbt'
[0m13:19:11.364083 [debug] [ThreadPool]: Using postgres connection "list_dbt"
[0m13:19:11.365084 [debug] [ThreadPool]: On list_dbt: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "connection_name": "list_dbt"} */

    select distinct nspname from pg_namespace
  
[0m13:19:11.365508 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:19:11.373900 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.0 seconds
[0m13:19:11.375705 [debug] [ThreadPool]: On list_dbt: Close
[0m13:19:11.379682 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dbt, now list_dbt_public)
[0m13:19:11.388464 [debug] [ThreadPool]: Using postgres connection "list_dbt_public"
[0m13:19:11.388981 [debug] [ThreadPool]: On list_dbt_public: BEGIN
[0m13:19:11.389412 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:19:11.394647 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m13:19:11.395198 [debug] [ThreadPool]: Using postgres connection "list_dbt_public"
[0m13:19:11.395652 [debug] [ThreadPool]: On list_dbt_public: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "connection_name": "list_dbt_public"} */
select
      'dbt' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'dbt' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'dbt' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m13:19:11.400320 [debug] [ThreadPool]: SQL status: SELECT 6 in 0.0 seconds
[0m13:19:11.402184 [debug] [ThreadPool]: On list_dbt_public: ROLLBACK
[0m13:19:11.403614 [debug] [ThreadPool]: On list_dbt_public: Close
[0m13:19:11.414071 [debug] [MainThread]: Using postgres connection "master"
[0m13:19:11.414617 [debug] [MainThread]: On master: BEGIN
[0m13:19:11.415140 [debug] [MainThread]: Opening a new connection, currently in state init
[0m13:19:11.419940 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m13:19:11.420475 [debug] [MainThread]: Using postgres connection "master"
[0m13:19:11.421031 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m13:19:11.436942 [debug] [MainThread]: SQL status: SELECT 2 in 0.0 seconds
[0m13:19:11.439442 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a3f0076d-0e65-45d3-b719-49c03a8ba284', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fea6323cd50>]}
[0m13:19:11.440070 [debug] [MainThread]: On master: ROLLBACK
[0m13:19:11.440776 [debug] [MainThread]: Using postgres connection "master"
[0m13:19:11.441243 [debug] [MainThread]: On master: BEGIN
[0m13:19:11.442259 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m13:19:11.442691 [debug] [MainThread]: On master: COMMIT
[0m13:19:11.443147 [debug] [MainThread]: Using postgres connection "master"
[0m13:19:11.443563 [debug] [MainThread]: On master: COMMIT
[0m13:19:11.444186 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m13:19:11.444637 [debug] [MainThread]: On master: Close
[0m13:19:11.445610 [info ] [MainThread]: Concurrency: 3 threads (target='local')
[0m13:19:11.446062 [info ] [MainThread]: 
[0m13:19:11.454083 [debug] [Thread-1 (]: Began running node seed.integration_tests.contacts
[0m13:19:11.454821 [info ] [Thread-1 (]: 1 of 15 START seed file public.contacts ........................................ [RUN]
[0m13:19:11.455780 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dbt_public, now seed.integration_tests.contacts)
[0m13:19:11.456241 [debug] [Thread-1 (]: Began compiling node seed.integration_tests.contacts
[0m13:19:11.457139 [debug] [Thread-1 (]: Timing info for seed.integration_tests.contacts (compile): 13:19:11.456750 => 13:19:11.456753
[0m13:19:11.457723 [debug] [Thread-1 (]: Began executing node seed.integration_tests.contacts
[0m13:19:11.472876 [debug] [Thread-2 (]: Began running node seed.integration_tests.transactions
[0m13:19:11.473583 [info ] [Thread-2 (]: 2 of 15 START seed file public.transactions .................................... [RUN]
[0m13:19:11.474695 [debug] [Thread-2 (]: Acquiring new postgres connection 'seed.integration_tests.transactions'
[0m13:19:11.475232 [debug] [Thread-2 (]: Began compiling node seed.integration_tests.transactions
[0m13:19:11.476031 [debug] [Thread-2 (]: Timing info for seed.integration_tests.transactions (compile): 13:19:11.475696 => 13:19:11.475699
[0m13:19:11.476543 [debug] [Thread-2 (]: Began executing node seed.integration_tests.transactions
[0m13:19:11.488636 [debug] [Thread-3 (]: Began running node test.customer360.macro_test1
[0m13:19:11.489286 [info ] [Thread-3 (]: 3 of 15 START test macro_test1 ................................................. [RUN]
[0m13:19:11.490377 [debug] [Thread-3 (]: Acquiring new postgres connection 'test.customer360.macro_test1'
[0m13:19:11.490848 [debug] [Thread-3 (]: Began compiling node test.customer360.macro_test1
[0m13:19:11.546030 [debug] [Thread-3 (]: Writing injected SQL for node "test.customer360.macro_test1"
[0m13:19:11.546986 [debug] [Thread-3 (]: Timing info for test.customer360.macro_test1 (compile): 13:19:11.491183 => 13:19:11.546664
[0m13:19:11.547632 [debug] [Thread-3 (]: Began executing node test.customer360.macro_test1
[0m13:19:11.569427 [debug] [Thread-2 (]: Using postgres connection "seed.integration_tests.transactions"
[0m13:19:11.570201 [debug] [Thread-2 (]: On seed.integration_tests.transactions: BEGIN
[0m13:19:11.570700 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m13:19:11.573586 [debug] [Thread-1 (]: Using postgres connection "seed.integration_tests.contacts"
[0m13:19:11.574142 [debug] [Thread-1 (]: On seed.integration_tests.contacts: BEGIN
[0m13:19:11.574618 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:19:11.585022 [debug] [Thread-3 (]: Writing runtime sql for node "test.customer360.macro_test1"
[0m13:19:11.585874 [debug] [Thread-3 (]: Using postgres connection "test.customer360.macro_test1"
[0m13:19:11.587780 [debug] [Thread-3 (]: On test.customer360.macro_test1: BEGIN
[0m13:19:11.588263 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m13:19:11.591695 [debug] [Thread-2 (]: SQL status: BEGIN in 0.0 seconds
[0m13:19:11.592206 [debug] [Thread-2 (]: Using postgres connection "seed.integration_tests.transactions"
[0m13:19:11.592755 [debug] [Thread-2 (]: On seed.integration_tests.transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "seed.integration_tests.transactions"} */
truncate table "dbt"."public"."transactions"
[0m13:19:11.595974 [debug] [Thread-3 (]: SQL status: BEGIN in 0.0 seconds
[0m13:19:11.597344 [debug] [Thread-3 (]: Using postgres connection "test.customer360.macro_test1"
[0m13:19:11.597892 [debug] [Thread-3 (]: On test.customer360.macro_test1: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.macro_test1"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      with marco_result as (
    select 
    date_part('year', age(current_date, '2023-02-12'))
 as expect_result
)
select
    1
from marco_result
where expect_result <> 1
      
    ) dbt_internal_test
[0m13:19:11.596818 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m13:19:11.598483 [debug] [Thread-1 (]: Using postgres connection "seed.integration_tests.contacts"
[0m13:19:11.599027 [debug] [Thread-1 (]: On seed.integration_tests.contacts: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "seed.integration_tests.contacts"} */
truncate table "dbt"."public"."contacts"
[0m13:19:11.606350 [debug] [Thread-2 (]: SQL status: TRUNCATE TABLE in 0.0 seconds
[0m13:19:11.618912 [debug] [Thread-1 (]: SQL status: TRUNCATE TABLE in 0.0 seconds
[0m13:19:11.638694 [debug] [Thread-3 (]: SQL status: SELECT 1 in 0.0 seconds
[0m13:19:11.641529 [debug] [Thread-3 (]: Timing info for test.customer360.macro_test1 (execute): 13:19:11.547954 => 13:19:11.641166
[0m13:19:11.642093 [debug] [Thread-3 (]: On test.customer360.macro_test1: ROLLBACK
[0m13:19:11.672685 [debug] [Thread-3 (]: On test.customer360.macro_test1: Close
[0m13:19:11.674034 [info ] [Thread-3 (]: 3 of 15 PASS macro_test1 ....................................................... [[32mPASS[0m in 0.18s]
[0m13:19:11.674872 [debug] [Thread-3 (]: Finished running node test.customer360.macro_test1
[0m13:19:11.677587 [debug] [Thread-3 (]: Began running node test.customer360.macro_test2
[0m13:19:11.678202 [info ] [Thread-3 (]: 4 of 15 START test macro_test2 ................................................. [RUN]
[0m13:19:11.679196 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.customer360.macro_test1, now test.customer360.macro_test2)
[0m13:19:11.679781 [debug] [Thread-3 (]: Began compiling node test.customer360.macro_test2
[0m13:19:11.743362 [debug] [Thread-3 (]: Writing injected SQL for node "test.customer360.macro_test2"
[0m13:19:11.744265 [debug] [Thread-3 (]: Timing info for test.customer360.macro_test2 (compile): 13:19:11.680087 => 13:19:11.743927
[0m13:19:11.744765 [debug] [Thread-3 (]: Began executing node test.customer360.macro_test2
[0m13:19:11.749787 [debug] [Thread-3 (]: Writing runtime sql for node "test.customer360.macro_test2"
[0m13:19:11.750533 [debug] [Thread-3 (]: Using postgres connection "test.customer360.macro_test2"
[0m13:19:11.751002 [debug] [Thread-3 (]: On test.customer360.macro_test2: BEGIN
[0m13:19:11.798745 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m13:19:11.800558 [debug] [Thread-1 (]: Using postgres connection "seed.integration_tests.contacts"
[0m13:19:11.801082 [debug] [Thread-1 (]: On seed.integration_tests.contacts: 
          insert into "dbt"."public"."contacts" ("id", "username", "name", "gender", "address", "mail", "birthdate", "_loaded_at_utc") values
          (%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s)
      ...
[0m13:19:11.818687 [debug] [Thread-1 (]: SQL status: INSERT 0 10 in 0.0 seconds
[0m13:19:11.827964 [debug] [Thread-1 (]: Writing runtime SQL for node "seed.integration_tests.contacts"
[0m13:19:11.853703 [debug] [Thread-3 (]: SQL status: BEGIN in 0.0 seconds
[0m13:19:11.854317 [debug] [Thread-3 (]: Using postgres connection "test.customer360.macro_test2"
[0m13:19:11.854878 [debug] [Thread-3 (]: On test.customer360.macro_test2: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.macro_test2"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      with marco_result as (
    select  as expect_result
)
select
    1
from marco_result
where cast(pg_typeof(expect_result) as text) not like '%timestamp%'
      
    ) dbt_internal_test
[0m13:19:11.867933 [debug] [Thread-1 (]: On seed.integration_tests.contacts: COMMIT
[0m13:19:11.868768 [debug] [Thread-1 (]: Using postgres connection "seed.integration_tests.contacts"
[0m13:19:11.869317 [debug] [Thread-1 (]: On seed.integration_tests.contacts: COMMIT
[0m13:19:11.869913 [debug] [Thread-3 (]: Postgres adapter: Postgres error: syntax error at or near "as"
LINE 8:     select  as expect_result
                    ^

[0m13:19:11.870889 [debug] [Thread-3 (]: On test.customer360.macro_test2: ROLLBACK
[0m13:19:11.884661 [debug] [Thread-1 (]: SQL status: COMMIT in 0.0 seconds
[0m13:19:11.886148 [debug] [Thread-1 (]: Timing info for seed.integration_tests.contacts (execute): 13:19:11.458030 => 13:19:11.885842
[0m13:19:11.886741 [debug] [Thread-1 (]: On seed.integration_tests.contacts: Close
[0m13:19:11.891542 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a3f0076d-0e65-45d3-b719-49c03a8ba284', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fea630b6510>]}
[0m13:19:11.892779 [info ] [Thread-1 (]: 1 of 15 OK loaded seed file public.contacts .................................... [[32mINSERT 10[0m in 0.44s]
[0m13:19:11.893809 [debug] [Thread-1 (]: Finished running node seed.integration_tests.contacts
[0m13:19:11.894446 [debug] [Thread-1 (]: Began running node test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247
[0m13:19:11.895046 [info ] [Thread-1 (]: 5 of 15 START test source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors  [RUN]
[0m13:19:11.895987 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly seed.integration_tests.contacts, now test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247)
[0m13:19:11.896622 [debug] [Thread-1 (]: Began compiling node test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247
[0m13:19:11.929388 [debug] [Thread-3 (]: Timing info for test.customer360.macro_test2 (execute): 13:19:11.745057 => 13:19:11.928909
[0m13:19:11.930029 [debug] [Thread-3 (]: On test.customer360.macro_test2: Close
[0m13:19:11.937898 [debug] [Thread-3 (]: Database Error in test macro_test2 (tests/macro_test2.sql)
  syntax error at or near "as"
  LINE 8:     select  as expect_result
                      ^
  compiled Code at target/run/customer360/tests/macro_test2.sql
[0m13:19:11.938604 [error] [Thread-3 (]: 4 of 15 ERROR macro_test2 ...................................................... [[31mERROR[0m in 0.26s]
[0m13:19:11.943981 [debug] [Thread-3 (]: Finished running node test.customer360.macro_test2
[0m13:19:11.944671 [debug] [Thread-3 (]: Began running node test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d
[0m13:19:11.945242 [info ] [Thread-3 (]: 6 of 15 START test source_not_null_salesforce_contacts_id ...................... [RUN]
[0m13:19:11.946475 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.customer360.macro_test2, now test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d)
[0m13:19:11.946980 [debug] [Thread-3 (]: Began compiling node test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d
[0m13:19:11.996847 [debug] [Thread-1 (]: Writing injected SQL for node "test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247"
[0m13:19:12.002017 [debug] [Thread-1 (]: Timing info for test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247 (compile): 13:19:11.896970 => 13:19:12.001585
[0m13:19:12.002670 [debug] [Thread-1 (]: Began executing node test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247
[0m13:19:12.009561 [debug] [Thread-1 (]: Writing runtime sql for node "test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247"
[0m13:19:12.010403 [debug] [Thread-1 (]: Using postgres connection "test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247"
[0m13:19:12.010957 [debug] [Thread-1 (]: On test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247: BEGIN
[0m13:19:12.011489 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:19:12.018003 [debug] [Thread-3 (]: Writing injected SQL for node "test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d"
[0m13:19:12.018929 [debug] [Thread-3 (]: Timing info for test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d (compile): 13:19:11.947363 => 13:19:12.018612
[0m13:19:12.019464 [debug] [Thread-3 (]: Began executing node test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d
[0m13:19:12.067937 [debug] [Thread-3 (]: Writing runtime sql for node "test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d"
[0m13:19:12.068779 [debug] [Thread-3 (]: Using postgres connection "test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d"
[0m13:19:12.069497 [debug] [Thread-3 (]: On test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d: BEGIN
[0m13:19:12.069982 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m13:19:12.070972 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m13:19:12.071697 [debug] [Thread-1 (]: Using postgres connection "test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247"
[0m13:19:12.072235 [debug] [Thread-1 (]: On test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

with all_values as (

    select
        category as value_field,
        count(*) as n_records

    from "dbt"."public"."transactions"
    group by category

)

select *
from all_values
where value_field not in (
    'Apps & Games','Beauty','Books','Clothing, Shoes & Accessories','Movies & TV','Sports, Fitness & Outdoors'
)



      
    ) dbt_internal_test
[0m13:19:12.097746 [debug] [Thread-3 (]: SQL status: BEGIN in 0.0 seconds
[0m13:19:12.098349 [debug] [Thread-3 (]: Using postgres connection "test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d"
[0m13:19:12.098841 [debug] [Thread-3 (]: On test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select id
from "dbt"."public"."contacts"
where id is null



      
    ) dbt_internal_test
[0m13:19:12.111603 [debug] [Thread-3 (]: SQL status: SELECT 1 in 0.0 seconds
[0m13:19:12.113553 [debug] [Thread-3 (]: Timing info for test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d (execute): 13:19:12.019764 => 13:19:12.113231
[0m13:19:12.113985 [debug] [Thread-3 (]: On test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d: ROLLBACK
[0m13:19:12.115652 [debug] [Thread-3 (]: On test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d: Close
[0m13:19:12.116763 [info ] [Thread-3 (]: 6 of 15 PASS source_not_null_salesforce_contacts_id ............................ [[32mPASS[0m in 0.17s]
[0m13:19:12.117901 [debug] [Thread-3 (]: Finished running node test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d
[0m13:19:12.118676 [debug] [Thread-3 (]: Began running node test.customer360.source_not_null_web_transactions_id.88a47bf7e5
[0m13:19:12.119134 [info ] [Thread-3 (]: 7 of 15 START test source_not_null_web_transactions_id ......................... [RUN]
[0m13:19:12.120039 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d, now test.customer360.source_not_null_web_transactions_id.88a47bf7e5)
[0m13:19:12.120673 [debug] [Thread-3 (]: Began compiling node test.customer360.source_not_null_web_transactions_id.88a47bf7e5
[0m13:19:12.126682 [debug] [Thread-3 (]: Writing injected SQL for node "test.customer360.source_not_null_web_transactions_id.88a47bf7e5"
[0m13:19:12.127554 [debug] [Thread-3 (]: Timing info for test.customer360.source_not_null_web_transactions_id.88a47bf7e5 (compile): 13:19:12.120980 => 13:19:12.127216
[0m13:19:12.128067 [debug] [Thread-3 (]: Began executing node test.customer360.source_not_null_web_transactions_id.88a47bf7e5
[0m13:19:12.131721 [debug] [Thread-3 (]: Writing runtime sql for node "test.customer360.source_not_null_web_transactions_id.88a47bf7e5"
[0m13:19:12.148797 [debug] [Thread-3 (]: Using postgres connection "test.customer360.source_not_null_web_transactions_id.88a47bf7e5"
[0m13:19:12.149163 [debug] [Thread-3 (]: On test.customer360.source_not_null_web_transactions_id.88a47bf7e5: BEGIN
[0m13:19:12.149634 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m13:19:12.166155 [debug] [Thread-3 (]: SQL status: BEGIN in 0.0 seconds
[0m13:19:12.171691 [debug] [Thread-3 (]: Using postgres connection "test.customer360.source_not_null_web_transactions_id.88a47bf7e5"
[0m13:19:12.171441 [debug] [Thread-2 (]: Using postgres connection "seed.integration_tests.transactions"
[0m13:19:12.172193 [debug] [Thread-3 (]: On test.customer360.source_not_null_web_transactions_id.88a47bf7e5: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.source_not_null_web_transactions_id.88a47bf7e5"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select id
from "dbt"."public"."transactions"
where id is null



      
    ) dbt_internal_test
[0m13:19:12.172628 [debug] [Thread-2 (]: On seed.integration_tests.transactions: 
          insert into "dbt"."public"."transactions" ("contact_id", "id", "transaction_date", "amount", "item_count", "category", "_loaded_at_utc") values
          (%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%...
[0m13:19:12.175013 [debug] [Thread-2 (]: SQL status: INSERT 0 74 in 0.0 seconds
[0m13:19:12.175818 [debug] [Thread-2 (]: Writing runtime SQL for node "seed.integration_tests.transactions"
[0m13:19:12.177560 [debug] [Thread-2 (]: On seed.integration_tests.transactions: COMMIT
[0m13:19:12.177898 [debug] [Thread-2 (]: Using postgres connection "seed.integration_tests.transactions"
[0m13:19:12.178206 [debug] [Thread-2 (]: On seed.integration_tests.transactions: COMMIT
[0m13:19:12.180496 [debug] [Thread-2 (]: SQL status: COMMIT in 0.0 seconds
[0m13:19:12.181736 [debug] [Thread-2 (]: Timing info for seed.integration_tests.transactions (execute): 13:19:11.476883 => 13:19:12.181452
[0m13:19:12.182227 [debug] [Thread-2 (]: On seed.integration_tests.transactions: Close
[0m13:19:12.182954 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a3f0076d-0e65-45d3-b719-49c03a8ba284', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fea62f3b850>]}
[0m13:19:12.183881 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.0 seconds
[0m13:19:12.185601 [debug] [Thread-1 (]: Timing info for test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247 (execute): 13:19:12.002996 => 13:19:12.185381
[0m13:19:12.185964 [debug] [Thread-1 (]: On test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247: ROLLBACK
[0m13:19:12.186364 [debug] [Thread-3 (]: SQL status: SELECT 1 in 0.0 seconds
[0m13:19:12.187606 [debug] [Thread-3 (]: Timing info for test.customer360.source_not_null_web_transactions_id.88a47bf7e5 (execute): 13:19:12.128378 => 13:19:12.187405
[0m13:19:12.187927 [debug] [Thread-3 (]: On test.customer360.source_not_null_web_transactions_id.88a47bf7e5: ROLLBACK
[0m13:19:12.183484 [info ] [Thread-2 (]: 2 of 15 OK loaded seed file public.transactions ................................ [[32mINSERT 74[0m in 0.71s]
[0m13:19:12.188689 [debug] [Thread-2 (]: Finished running node seed.integration_tests.transactions
[0m13:19:12.189224 [debug] [Thread-2 (]: Began running node test.customer360.source_unique_salesforce_contacts_id.01cadaaf43
[0m13:19:12.189742 [info ] [Thread-2 (]: 8 of 15 START test source_unique_salesforce_contacts_id ........................ [RUN]
[0m13:19:12.190708 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly seed.integration_tests.transactions, now test.customer360.source_unique_salesforce_contacts_id.01cadaaf43)
[0m13:19:12.191178 [debug] [Thread-2 (]: Began compiling node test.customer360.source_unique_salesforce_contacts_id.01cadaaf43
[0m13:19:12.199481 [debug] [Thread-2 (]: Writing injected SQL for node "test.customer360.source_unique_salesforce_contacts_id.01cadaaf43"
[0m13:19:12.200049 [debug] [Thread-1 (]: On test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247: Close
[0m13:19:12.200696 [debug] [Thread-2 (]: Timing info for test.customer360.source_unique_salesforce_contacts_id.01cadaaf43 (compile): 13:19:12.191494 => 13:19:12.200396
[0m13:19:12.205623 [debug] [Thread-2 (]: Began executing node test.customer360.source_unique_salesforce_contacts_id.01cadaaf43
[0m13:19:12.201211 [debug] [Thread-3 (]: On test.customer360.source_not_null_web_transactions_id.88a47bf7e5: Close
[0m13:19:12.209968 [info ] [Thread-3 (]: 7 of 15 PASS source_not_null_web_transactions_id ............................... [[32mPASS[0m in 0.09s]
[0m13:19:12.210754 [debug] [Thread-3 (]: Finished running node test.customer360.source_not_null_web_transactions_id.88a47bf7e5
[0m13:19:12.211332 [debug] [Thread-3 (]: Began running node test.customer360.source_unique_web_transactions_id.ba28079761
[0m13:19:12.205106 [info ] [Thread-1 (]: 5 of 15 PASS source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors  [[32mPASS[0m in 0.31s]
[0m13:19:12.212991 [debug] [Thread-1 (]: Finished running node test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247
[0m13:19:12.213550 [debug] [Thread-1 (]: Began running node test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344
[0m13:19:12.214059 [info ] [Thread-1 (]: 10 of 15 START test source_relationships_web_transactions_contact_id__id__ref_contacts_  [RUN]
[0m13:19:12.214931 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247, now test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344)
[0m13:19:12.215460 [debug] [Thread-1 (]: Began compiling node test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344
[0m13:19:12.212061 [info ] [Thread-3 (]: 9 of 15 START test source_unique_web_transactions_id ........................... [RUN]
[0m13:19:12.225062 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.customer360.source_not_null_web_transactions_id.88a47bf7e5, now test.customer360.source_unique_web_transactions_id.ba28079761)
[0m13:19:12.225673 [debug] [Thread-3 (]: Began compiling node test.customer360.source_unique_web_transactions_id.ba28079761
[0m13:19:12.208969 [debug] [Thread-2 (]: Writing runtime sql for node "test.customer360.source_unique_salesforce_contacts_id.01cadaaf43"
[0m13:19:12.232048 [debug] [Thread-2 (]: Using postgres connection "test.customer360.source_unique_salesforce_contacts_id.01cadaaf43"
[0m13:19:12.232538 [debug] [Thread-2 (]: On test.customer360.source_unique_salesforce_contacts_id.01cadaaf43: BEGIN
[0m13:19:12.233003 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m13:19:12.231337 [debug] [Thread-3 (]: Writing injected SQL for node "test.customer360.source_unique_web_transactions_id.ba28079761"
[0m13:19:12.238070 [debug] [Thread-3 (]: Timing info for test.customer360.source_unique_web_transactions_id.ba28079761 (compile): 13:19:12.225970 => 13:19:12.237763
[0m13:19:12.238618 [debug] [Thread-3 (]: Began executing node test.customer360.source_unique_web_transactions_id.ba28079761
[0m13:19:12.237329 [debug] [Thread-1 (]: Writing injected SQL for node "test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344"
[0m13:19:12.244757 [debug] [Thread-1 (]: Timing info for test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344 (compile): 13:19:12.215773 => 13:19:12.244443
[0m13:19:12.245274 [debug] [Thread-1 (]: Began executing node test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344
[0m13:19:12.248534 [debug] [Thread-1 (]: Writing runtime sql for node "test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344"
[0m13:19:12.249201 [debug] [Thread-1 (]: Using postgres connection "test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344"
[0m13:19:12.249780 [debug] [Thread-1 (]: On test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344: BEGIN
[0m13:19:12.250266 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:19:12.243938 [debug] [Thread-3 (]: Writing runtime sql for node "test.customer360.source_unique_web_transactions_id.ba28079761"
[0m13:19:12.251543 [debug] [Thread-3 (]: Using postgres connection "test.customer360.source_unique_web_transactions_id.ba28079761"
[0m13:19:12.252046 [debug] [Thread-3 (]: On test.customer360.source_unique_web_transactions_id.ba28079761: BEGIN
[0m13:19:12.252541 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m13:19:12.263899 [debug] [Thread-2 (]: SQL status: BEGIN in 0.0 seconds
[0m13:19:12.264512 [debug] [Thread-2 (]: Using postgres connection "test.customer360.source_unique_salesforce_contacts_id.01cadaaf43"
[0m13:19:12.265038 [debug] [Thread-2 (]: On test.customer360.source_unique_salesforce_contacts_id.01cadaaf43: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.source_unique_salesforce_contacts_id.01cadaaf43"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

select
    id as unique_field,
    count(*) as n_records

from "dbt"."public"."contacts"
where id is not null
group by id
having count(*) > 1



      
    ) dbt_internal_test
[0m13:19:12.267548 [debug] [Thread-2 (]: SQL status: SELECT 1 in 0.0 seconds
[0m13:19:12.269515 [debug] [Thread-2 (]: Timing info for test.customer360.source_unique_salesforce_contacts_id.01cadaaf43 (execute): 13:19:12.205905 => 13:19:12.269181
[0m13:19:12.270024 [debug] [Thread-2 (]: On test.customer360.source_unique_salesforce_contacts_id.01cadaaf43: ROLLBACK
[0m13:19:12.272457 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m13:19:12.272940 [debug] [Thread-1 (]: Using postgres connection "test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344"
[0m13:19:12.273495 [debug] [Thread-1 (]: On test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

with child as (
    select contact_id as from_field
    from "dbt"."public"."transactions"
    where contact_id is not null
),

parent as (
    select id as to_field
    from "dbt"."public"."contacts"
)

select
    from_field

from child
left join parent
    on child.from_field = parent.to_field

where parent.to_field is null



      
    ) dbt_internal_test
[0m13:19:12.274060 [debug] [Thread-3 (]: SQL status: BEGIN in 0.0 seconds
[0m13:19:12.274790 [debug] [Thread-3 (]: Using postgres connection "test.customer360.source_unique_web_transactions_id.ba28079761"
[0m13:19:12.275331 [debug] [Thread-3 (]: On test.customer360.source_unique_web_transactions_id.ba28079761: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.source_unique_web_transactions_id.ba28079761"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

select
    id as unique_field,
    count(*) as n_records

from "dbt"."public"."transactions"
where id is not null
group by id
having count(*) > 1



      
    ) dbt_internal_test
[0m13:19:12.275926 [debug] [Thread-2 (]: On test.customer360.source_unique_salesforce_contacts_id.01cadaaf43: Close
[0m13:19:12.277027 [info ] [Thread-2 (]: 8 of 15 PASS source_unique_salesforce_contacts_id .............................. [[32mPASS[0m in 0.09s]
[0m13:19:12.283128 [debug] [Thread-2 (]: Finished running node test.customer360.source_unique_salesforce_contacts_id.01cadaaf43
[0m13:19:12.283893 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.0 seconds
[0m13:19:12.285814 [debug] [Thread-1 (]: Timing info for test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344 (execute): 13:19:12.245595 => 13:19:12.285494
[0m13:19:12.286346 [debug] [Thread-1 (]: On test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344: ROLLBACK
[0m13:19:12.286871 [debug] [Thread-3 (]: SQL status: SELECT 1 in 0.0 seconds
[0m13:19:12.289172 [debug] [Thread-3 (]: Timing info for test.customer360.source_unique_web_transactions_id.ba28079761 (execute): 13:19:12.238932 => 13:19:12.288277
[0m13:19:12.289667 [debug] [Thread-3 (]: On test.customer360.source_unique_web_transactions_id.ba28079761: ROLLBACK
[0m13:19:12.290283 [debug] [Thread-1 (]: On test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344: Close
[0m13:19:12.291400 [info ] [Thread-1 (]: 10 of 15 PASS source_relationships_web_transactions_contact_id__id__ref_contacts_  [[32mPASS[0m in 0.08s]
[0m13:19:12.292175 [debug] [Thread-1 (]: Finished running node test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344
[0m13:19:12.292764 [debug] [Thread-1 (]: Began running node model.customer360.stg_sf__contacts
[0m13:19:12.295353 [info ] [Thread-1 (]: 11 of 15 START sql table model public.stg_sf__contacts ......................... [RUN]
[0m13:19:12.296233 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344, now model.customer360.stg_sf__contacts)
[0m13:19:12.296759 [debug] [Thread-1 (]: Began compiling node model.customer360.stg_sf__contacts
[0m13:19:12.300865 [debug] [Thread-1 (]: Writing injected SQL for node "model.customer360.stg_sf__contacts"
[0m13:19:12.301638 [debug] [Thread-1 (]: Timing info for model.customer360.stg_sf__contacts (compile): 13:19:12.297062 => 13:19:12.301350
[0m13:19:12.302145 [debug] [Thread-1 (]: Began executing node model.customer360.stg_sf__contacts
[0m13:19:12.316014 [debug] [Thread-3 (]: On test.customer360.source_unique_web_transactions_id.ba28079761: Close
[0m13:19:12.317239 [info ] [Thread-3 (]: 9 of 15 PASS source_unique_web_transactions_id ................................. [[32mPASS[0m in 0.09s]
[0m13:19:12.318002 [debug] [Thread-3 (]: Finished running node test.customer360.source_unique_web_transactions_id.ba28079761
[0m13:19:12.318674 [debug] [Thread-3 (]: Began running node model.customer360.stg_web__transactions
[0m13:19:12.319265 [info ] [Thread-3 (]: 12 of 15 START sql table model public.stg_web__transactions .................... [RUN]
[0m13:19:12.320149 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.customer360.source_unique_web_transactions_id.ba28079761, now model.customer360.stg_web__transactions)
[0m13:19:12.320675 [debug] [Thread-3 (]: Began compiling node model.customer360.stg_web__transactions
[0m13:19:12.327212 [debug] [Thread-3 (]: Writing injected SQL for node "model.customer360.stg_web__transactions"
[0m13:19:12.328082 [debug] [Thread-3 (]: Timing info for model.customer360.stg_web__transactions (compile): 13:19:12.320981 => 13:19:12.327769
[0m13:19:12.328581 [debug] [Thread-3 (]: Began executing node model.customer360.stg_web__transactions
[0m13:19:12.413847 [debug] [Thread-3 (]: Writing runtime sql for node "model.customer360.stg_web__transactions"
[0m13:19:12.416922 [debug] [Thread-1 (]: Writing runtime sql for node "model.customer360.stg_sf__contacts"
[0m13:19:12.417725 [debug] [Thread-1 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m13:19:12.418283 [debug] [Thread-1 (]: On model.customer360.stg_sf__contacts: BEGIN
[0m13:19:12.418785 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:19:12.423115 [debug] [Thread-3 (]: Using postgres connection "model.customer360.stg_web__transactions"
[0m13:19:12.423677 [debug] [Thread-3 (]: On model.customer360.stg_web__transactions: BEGIN
[0m13:19:12.424157 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m13:19:12.453219 [debug] [Thread-3 (]: SQL status: BEGIN in 0.0 seconds
[0m13:19:12.453890 [debug] [Thread-3 (]: Using postgres connection "model.customer360.stg_web__transactions"
[0m13:19:12.454532 [debug] [Thread-3 (]: On model.customer360.stg_web__transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_web__transactions"} */

  
    

  create  table "dbt"."public"."stg_web__transactions__dbt_tmp"
  
  
    as
  
  (
    with source as (
    select * from "dbt"."public"."transactions"
),

renamed as (
    select
        id,
        contact_id,
         as transaction_date,
        amount,
        item_count,
        category, 
        _loaded_at_utc
    from source    
),

clean_older as (
    select * from renamed 
--    where transaction_date >= (current_date - 1)  过滤超过1天的数据
    where transaction_date >= (to_date('2023-04-12','yyyy-MM-dd') - 1)  --测试用,假设跑数日期为2023-04-12
    and transaction_date < to_date('2023-04-12','yyyy-MM-dd')
)

select * from clean_older
  );
  
[0m13:19:12.455148 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m13:19:12.455701 [debug] [Thread-1 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m13:19:12.456212 [debug] [Thread-1 (]: On model.customer360.stg_sf__contacts: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_sf__contacts"} */

  
    

  create  table "dbt"."public"."stg_sf__contacts__dbt_tmp"
  
  
    as
  
  (
    with source as (
    select * from "dbt"."public"."contacts"
),

renamed as (
    select
        id,
        username as user_name,
        name,
        gender,
        address, 
        mail as email_address,
        birthdate as birth_date,
        _loaded_at_utc
    from source     
)

select * from renamed
  );
  
[0m13:19:12.462077 [debug] [Thread-3 (]: Postgres adapter: Postgres error: syntax error at or near "as"
LINE 20:          as transaction_date,
                  ^

[0m13:19:12.462767 [debug] [Thread-3 (]: On model.customer360.stg_web__transactions: ROLLBACK
[0m13:19:12.469118 [debug] [Thread-3 (]: Timing info for model.customer360.stg_web__transactions (execute): 13:19:12.328867 => 13:19:12.468773
[0m13:19:12.471589 [debug] [Thread-3 (]: On model.customer360.stg_web__transactions: Close
[0m13:19:12.477824 [debug] [Thread-3 (]: Database Error in model stg_web__transactions (models/staging/web/stg_web__transactions.sql)
  syntax error at or near "as"
  LINE 20:          as transaction_date,
                    ^
  compiled Code at target/run/customer360/models/staging/web/stg_web__transactions.sql
[0m13:19:12.478548 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a3f0076d-0e65-45d3-b719-49c03a8ba284', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fea630b0850>]}
[0m13:19:12.479375 [error] [Thread-3 (]: 12 of 15 ERROR creating sql table model public.stg_web__transactions ........... [[31mERROR[0m in 0.16s]
[0m13:19:12.480219 [debug] [Thread-3 (]: Finished running node model.customer360.stg_web__transactions
[0m13:19:12.480951 [debug] [Thread-1 (]: SQL status: SELECT 10 in 0.0 seconds
[0m13:19:12.489914 [debug] [Thread-1 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m13:19:12.490575 [debug] [Thread-1 (]: On model.customer360.stg_sf__contacts: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_sf__contacts"} */
alter table "dbt"."public"."stg_sf__contacts" rename to "stg_sf__contacts__dbt_backup"
[0m13:19:12.498686 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m13:19:12.503058 [debug] [Thread-1 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m13:19:12.510809 [debug] [Thread-1 (]: On model.customer360.stg_sf__contacts: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_sf__contacts"} */
alter table "dbt"."public"."stg_sf__contacts__dbt_tmp" rename to "stg_sf__contacts"
[0m13:19:12.512012 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m13:19:12.524621 [debug] [Thread-1 (]: On model.customer360.stg_sf__contacts: COMMIT
[0m13:19:12.525158 [debug] [Thread-1 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m13:19:12.525670 [debug] [Thread-1 (]: On model.customer360.stg_sf__contacts: COMMIT
[0m13:19:12.529768 [debug] [Thread-1 (]: SQL status: COMMIT in 0.0 seconds
[0m13:19:12.538709 [debug] [Thread-1 (]: Applying DROP to: "dbt"."public"."stg_sf__contacts__dbt_backup"
[0m13:19:12.545798 [debug] [Thread-1 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m13:19:12.546356 [debug] [Thread-1 (]: On model.customer360.stg_sf__contacts: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_sf__contacts"} */
drop table if exists "dbt"."public"."stg_sf__contacts__dbt_backup" cascade
[0m13:19:12.549911 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.0 seconds
[0m13:19:12.552067 [debug] [Thread-1 (]: Timing info for model.customer360.stg_sf__contacts (execute): 13:19:12.302473 => 13:19:12.551750
[0m13:19:12.552657 [debug] [Thread-1 (]: On model.customer360.stg_sf__contacts: Close
[0m13:19:12.553677 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a3f0076d-0e65-45d3-b719-49c03a8ba284', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fea630dda50>]}
[0m13:19:12.554426 [info ] [Thread-1 (]: 11 of 15 OK created sql table model public.stg_sf__contacts .................... [[32mSELECT 10[0m in 0.26s]
[0m13:19:12.557567 [debug] [Thread-1 (]: Finished running node model.customer360.stg_sf__contacts
[0m13:19:12.558776 [debug] [Thread-2 (]: Began running node model.customer360.contacts_joined_with_transactions
[0m13:19:12.559371 [info ] [Thread-2 (]: 13 of 15 SKIP relation public.contacts_joined_with_transactions ................ [[33mSKIP[0m]
[0m13:19:12.559975 [debug] [Thread-2 (]: Finished running node model.customer360.contacts_joined_with_transactions
[0m13:19:12.560765 [debug] [Thread-1 (]: Began running node test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311
[0m13:19:12.561343 [info ] [Thread-1 (]: 14 of 15 SKIP test not_null_contacts_joined_with_transactions_id ............... [[33mSKIP[0m]
[0m13:19:12.561937 [debug] [Thread-1 (]: Finished running node test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311
[0m13:19:12.562639 [debug] [Thread-3 (]: Began running node model.customer360.customers
[0m13:19:12.563207 [info ] [Thread-3 (]: 15 of 15 SKIP relation public.customers ........................................ [[33mSKIP[0m]
[0m13:19:12.563795 [debug] [Thread-3 (]: Finished running node model.customer360.customers
[0m13:19:12.566083 [debug] [MainThread]: Using postgres connection "master"
[0m13:19:12.566566 [debug] [MainThread]: On master: BEGIN
[0m13:19:12.567005 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m13:19:12.571970 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m13:19:12.572527 [debug] [MainThread]: On master: COMMIT
[0m13:19:12.572893 [debug] [MainThread]: Using postgres connection "master"
[0m13:19:12.573336 [debug] [MainThread]: On master: COMMIT
[0m13:19:12.573949 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m13:19:12.574422 [debug] [MainThread]: On master: Close
[0m13:19:12.575352 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:19:12.575733 [debug] [MainThread]: Connection 'model.customer360.stg_sf__contacts' was properly closed.
[0m13:19:12.576103 [debug] [MainThread]: Connection 'test.customer360.source_unique_salesforce_contacts_id.01cadaaf43' was properly closed.
[0m13:19:12.576544 [debug] [MainThread]: Connection 'model.customer360.stg_web__transactions' was properly closed.
[0m13:19:12.577046 [info ] [MainThread]: 
[0m13:19:12.579835 [info ] [MainThread]: Finished running 9 tests, 2 seeds, 3 table models, 1 view model in 0 hours 0 minutes and 1.23 seconds (1.23s).
[0m13:19:12.583087 [debug] [MainThread]: Command end result
[0m13:19:12.595532 [info ] [MainThread]: 
[0m13:19:12.596144 [info ] [MainThread]: [31mCompleted with 2 errors and 0 warnings:[0m
[0m13:19:12.596642 [info ] [MainThread]: 
[0m13:19:12.597080 [error] [MainThread]:   Database Error in test macro_test2 (tests/macro_test2.sql)
  syntax error at or near "as"
  LINE 8:     select  as expect_result
                      ^
  compiled Code at target/run/customer360/tests/macro_test2.sql
[0m13:19:12.597581 [info ] [MainThread]: 
[0m13:19:12.598067 [error] [MainThread]:   Database Error in model stg_web__transactions (models/staging/web/stg_web__transactions.sql)
  syntax error at or near "as"
  LINE 20:          as transaction_date,
                    ^
  compiled Code at target/run/customer360/models/staging/web/stg_web__transactions.sql
[0m13:19:12.599162 [info ] [MainThread]: 
[0m13:19:12.599662 [info ] [MainThread]: Done. PASS=10 WARN=0 ERROR=2 SKIP=3 TOTAL=15
[0m13:19:12.600724 [debug] [MainThread]: Resource report: {"command_name": "build", "command_wall_clock_time": 2.4863648, "process_user_time": 3.987003, "process_kernel_time": 0.149193, "process_mem_max_rss": "118940", "process_out_blocks": "2816", "command_success": false, "process_in_blocks": "0"}
[0m13:19:12.601393 [debug] [MainThread]: Command `dbt build` failed at 13:19:12.601203 after 2.49 seconds
[0m13:19:12.601943 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fea6552a610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fea65b23690>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fea65b110d0>]}
[0m13:19:12.602504 [debug] [MainThread]: Flushing usage events
[0m13:25:48.805432 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc73fa5f1d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc73f483490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc73f6f8510>]}


============================== 13:25:48.813441 | d2af3c87-b8ff-4f5a-9415-f7e7cdb8d3fc ==============================
[0m13:25:48.813441 [info ] [MainThread]: Running with dbt=1.7.8
[0m13:25:48.814157 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/root/option1-customer360/integration_tests', 'version_check': 'True', 'warn_error': 'None', 'log_path': '/root/option1-customer360/integration_tests/logs', 'debug': 'False', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'static_parser': 'True', 'log_format': 'default', 'target_path': 'None', 'invocation_command': 'dbt build', 'send_anonymous_usage_stats': 'True'}
[0m13:25:49.109002 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd2af3c87-b8ff-4f5a-9415-f7e7cdb8d3fc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc73fa74bd0>]}
[0m13:25:49.225500 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'd2af3c87-b8ff-4f5a-9415-f7e7cdb8d3fc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc73f3a29d0>]}
[0m13:25:49.226172 [info ] [MainThread]: Registered adapter: postgres=1.7.8
[0m13:25:49.237155 [debug] [MainThread]: checksum: 67f0013ca5f0bd43af9a0873dd50792fde83ef69de63b71cacd0b4ac656c52e5, vars: {}, profile: , target: , version: 1.7.8
[0m13:25:49.258344 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m13:25:49.259084 [debug] [MainThread]: Partial parsing: updated file: customer360://macros/as_timestamp_utc.sql
[0m13:25:49.742864 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'd2af3c87-b8ff-4f5a-9415-f7e7cdb8d3fc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc73d77c090>]}
[0m13:25:49.752053 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'd2af3c87-b8ff-4f5a-9415-f7e7cdb8d3fc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc73d7e4290>]}
[0m13:25:49.752538 [info ] [MainThread]: Found 2 seeds, 4 models, 9 tests, 2 sources, 0 exposures, 0 metrics, 403 macros, 0 groups, 0 semantic models
[0m13:25:49.754505 [info ] [MainThread]: 
[0m13:25:49.755226 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m13:25:49.756437 [debug] [ThreadPool]: Acquiring new postgres connection 'list_dbt'
[0m13:25:49.765761 [debug] [ThreadPool]: Using postgres connection "list_dbt"
[0m13:25:49.766064 [debug] [ThreadPool]: On list_dbt: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "connection_name": "list_dbt"} */

    select distinct nspname from pg_namespace
  
[0m13:25:49.766364 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:25:49.771133 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.0 seconds
[0m13:25:49.772286 [debug] [ThreadPool]: On list_dbt: Close
[0m13:25:49.774086 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dbt, now list_dbt_public)
[0m13:25:49.779365 [debug] [ThreadPool]: Using postgres connection "list_dbt_public"
[0m13:25:49.779758 [debug] [ThreadPool]: On list_dbt_public: BEGIN
[0m13:25:49.780025 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:25:49.783183 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m13:25:49.783502 [debug] [ThreadPool]: Using postgres connection "list_dbt_public"
[0m13:25:49.783797 [debug] [ThreadPool]: On list_dbt_public: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "connection_name": "list_dbt_public"} */
select
      'dbt' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'dbt' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'dbt' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m13:25:49.786703 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.0 seconds
[0m13:25:49.787897 [debug] [ThreadPool]: On list_dbt_public: ROLLBACK
[0m13:25:49.788379 [debug] [ThreadPool]: On list_dbt_public: Close
[0m13:25:49.793965 [debug] [MainThread]: Using postgres connection "master"
[0m13:25:49.794267 [debug] [MainThread]: On master: BEGIN
[0m13:25:49.794590 [debug] [MainThread]: Opening a new connection, currently in state init
[0m13:25:49.797620 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m13:25:49.797938 [debug] [MainThread]: Using postgres connection "master"
[0m13:25:49.798285 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m13:25:49.807243 [debug] [MainThread]: SQL status: SELECT 0 in 0.0 seconds
[0m13:25:49.808323 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd2af3c87-b8ff-4f5a-9415-f7e7cdb8d3fc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc73d79d8d0>]}
[0m13:25:49.808727 [debug] [MainThread]: On master: ROLLBACK
[0m13:25:49.809215 [debug] [MainThread]: Using postgres connection "master"
[0m13:25:49.809519 [debug] [MainThread]: On master: BEGIN
[0m13:25:49.810185 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m13:25:49.810498 [debug] [MainThread]: On master: COMMIT
[0m13:25:49.810760 [debug] [MainThread]: Using postgres connection "master"
[0m13:25:49.811025 [debug] [MainThread]: On master: COMMIT
[0m13:25:49.811502 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m13:25:49.811789 [debug] [MainThread]: On master: Close
[0m13:25:49.812452 [info ] [MainThread]: Concurrency: 3 threads (target='local')
[0m13:25:49.812754 [info ] [MainThread]: 
[0m13:25:49.815569 [debug] [Thread-1 (]: Began running node seed.integration_tests.contacts
[0m13:25:49.815974 [debug] [Thread-2 (]: Began running node seed.integration_tests.transactions
[0m13:25:49.816360 [debug] [Thread-3 (]: Began running node test.customer360.macro_test1
[0m13:25:49.817907 [info ] [Thread-3 (]: 3 of 15 START test macro_test1 ................................................. [RUN]
[0m13:25:49.817462 [info ] [Thread-2 (]: 2 of 15 START seed file public.transactions .................................... [RUN]
[0m13:25:49.816771 [info ] [Thread-1 (]: 1 of 15 START seed file public.contacts ........................................ [RUN]
[0m13:25:49.818645 [debug] [Thread-3 (]: Acquiring new postgres connection 'test.customer360.macro_test1'
[0m13:25:49.819367 [debug] [Thread-2 (]: Acquiring new postgres connection 'seed.integration_tests.transactions'
[0m13:25:49.819927 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dbt_public, now seed.integration_tests.contacts)
[0m13:25:49.820334 [debug] [Thread-3 (]: Began compiling node test.customer360.macro_test1
[0m13:25:49.820688 [debug] [Thread-2 (]: Began compiling node seed.integration_tests.transactions
[0m13:25:49.821034 [debug] [Thread-1 (]: Began compiling node seed.integration_tests.contacts
[0m13:25:49.827397 [debug] [Thread-3 (]: Writing injected SQL for node "test.customer360.macro_test1"
[0m13:25:49.827828 [debug] [Thread-2 (]: Timing info for seed.integration_tests.transactions (compile): 13:25:49.827624 => 13:25:49.827628
[0m13:25:49.828723 [debug] [Thread-2 (]: Began executing node seed.integration_tests.transactions
[0m13:25:49.828256 [debug] [Thread-1 (]: Timing info for seed.integration_tests.contacts (compile): 13:25:49.828059 => 13:25:49.828061
[0m13:25:49.848678 [debug] [Thread-1 (]: Began executing node seed.integration_tests.contacts
[0m13:25:49.849194 [debug] [Thread-3 (]: Timing info for test.customer360.macro_test1 (compile): 13:25:49.821284 => 13:25:49.848987
[0m13:25:49.857282 [debug] [Thread-2 (]: Using postgres connection "seed.integration_tests.transactions"
[0m13:25:49.864133 [debug] [Thread-1 (]: Using postgres connection "seed.integration_tests.contacts"
[0m13:25:49.864631 [debug] [Thread-3 (]: Began executing node test.customer360.macro_test1
[0m13:25:49.865008 [debug] [Thread-2 (]: On seed.integration_tests.transactions: BEGIN
[0m13:25:49.865387 [debug] [Thread-1 (]: On seed.integration_tests.contacts: BEGIN
[0m13:25:49.870881 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m13:25:49.880467 [debug] [Thread-3 (]: Writing runtime sql for node "test.customer360.macro_test1"
[0m13:25:49.881605 [debug] [Thread-3 (]: Using postgres connection "test.customer360.macro_test1"
[0m13:25:49.882078 [debug] [Thread-3 (]: On test.customer360.macro_test1: BEGIN
[0m13:25:49.882532 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m13:25:49.880841 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:25:49.887174 [debug] [Thread-2 (]: SQL status: BEGIN in 0.0 seconds
[0m13:25:49.887580 [debug] [Thread-2 (]: Using postgres connection "seed.integration_tests.transactions"
[0m13:25:49.887899 [debug] [Thread-2 (]: On seed.integration_tests.transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "seed.integration_tests.transactions"} */
truncate table "dbt"."public"."transactions"
[0m13:25:49.888288 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m13:25:49.889250 [debug] [Thread-1 (]: Using postgres connection "seed.integration_tests.contacts"
[0m13:25:49.889735 [debug] [Thread-1 (]: On seed.integration_tests.contacts: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "seed.integration_tests.contacts"} */
truncate table "dbt"."public"."contacts"
[0m13:25:49.888780 [debug] [Thread-3 (]: SQL status: BEGIN in 0.0 seconds
[0m13:25:49.890175 [debug] [Thread-3 (]: Using postgres connection "test.customer360.macro_test1"
[0m13:25:49.892055 [debug] [Thread-3 (]: On test.customer360.macro_test1: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.macro_test1"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      with marco_result as (
    select 
    date_part('year', age(current_date, '2023-02-12'))
 as expect_result
)
select
    1
from marco_result
where expect_result <> 1
      
    ) dbt_internal_test
[0m13:25:49.892929 [debug] [Thread-2 (]: SQL status: TRUNCATE TABLE in 0.0 seconds
[0m13:25:49.899202 [debug] [Thread-3 (]: SQL status: SELECT 1 in 0.0 seconds
[0m13:25:49.906453 [debug] [Thread-3 (]: Timing info for test.customer360.macro_test1 (execute): 13:25:49.865617 => 13:25:49.906206
[0m13:25:49.911945 [debug] [Thread-3 (]: On test.customer360.macro_test1: ROLLBACK
[0m13:25:49.904701 [debug] [Thread-1 (]: SQL status: TRUNCATE TABLE in 0.0 seconds
[0m13:25:49.917474 [debug] [Thread-3 (]: On test.customer360.macro_test1: Close
[0m13:25:49.956767 [debug] [Thread-1 (]: Using postgres connection "seed.integration_tests.contacts"
[0m13:25:49.977704 [debug] [Thread-1 (]: On seed.integration_tests.contacts: 
          insert into "dbt"."public"."contacts" ("id", "username", "name", "gender", "address", "mail", "birthdate", "_loaded_at_utc") values
          (%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s)
      ...
[0m13:25:49.983601 [info ] [Thread-3 (]: 3 of 15 PASS macro_test1 ....................................................... [[32mPASS[0m in 0.17s]
[0m13:25:49.989558 [debug] [Thread-1 (]: SQL status: INSERT 0 10 in 0.0 seconds
[0m13:25:49.995278 [debug] [Thread-3 (]: Finished running node test.customer360.macro_test1
[0m13:25:50.026001 [debug] [Thread-1 (]: Writing runtime SQL for node "seed.integration_tests.contacts"
[0m13:25:50.031620 [debug] [Thread-3 (]: Began running node test.customer360.macro_test2
[0m13:25:50.052281 [info ] [Thread-3 (]: 4 of 15 START test macro_test2 ................................................. [RUN]
[0m13:25:50.053068 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.customer360.macro_test1, now test.customer360.macro_test2)
[0m13:25:50.062257 [debug] [Thread-3 (]: Began compiling node test.customer360.macro_test2
[0m13:25:50.066810 [debug] [Thread-1 (]: On seed.integration_tests.contacts: COMMIT
[0m13:25:50.069373 [debug] [Thread-3 (]: Writing injected SQL for node "test.customer360.macro_test2"
[0m13:25:50.070697 [debug] [Thread-2 (]: Using postgres connection "seed.integration_tests.transactions"
[0m13:25:50.071546 [debug] [Thread-2 (]: On seed.integration_tests.transactions: 
          insert into "dbt"."public"."transactions" ("contact_id", "id", "transaction_date", "amount", "item_count", "category", "_loaded_at_utc") values
          (%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%...
[0m13:25:50.071076 [debug] [Thread-1 (]: Using postgres connection "seed.integration_tests.contacts"
[0m13:25:50.073115 [debug] [Thread-1 (]: On seed.integration_tests.contacts: COMMIT
[0m13:25:50.072654 [debug] [Thread-3 (]: Timing info for test.customer360.macro_test2 (compile): 13:25:50.067063 => 13:25:50.072396
[0m13:25:50.073652 [debug] [Thread-3 (]: Began executing node test.customer360.macro_test2
[0m13:25:50.076685 [debug] [Thread-3 (]: Writing runtime sql for node "test.customer360.macro_test2"
[0m13:25:50.077096 [debug] [Thread-2 (]: SQL status: INSERT 0 74 in 0.0 seconds
[0m13:25:50.077505 [debug] [Thread-1 (]: SQL status: COMMIT in 0.0 seconds
[0m13:25:50.077942 [debug] [Thread-3 (]: Using postgres connection "test.customer360.macro_test2"
[0m13:25:50.079968 [debug] [Thread-3 (]: On test.customer360.macro_test2: BEGIN
[0m13:25:50.079592 [debug] [Thread-1 (]: Timing info for seed.integration_tests.contacts (execute): 13:25:49.857535 => 13:25:50.079399
[0m13:25:50.078695 [debug] [Thread-2 (]: Writing runtime SQL for node "seed.integration_tests.transactions"
[0m13:25:50.080309 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m13:25:50.080730 [debug] [Thread-1 (]: On seed.integration_tests.contacts: Close
[0m13:25:50.083788 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd2af3c87-b8ff-4f5a-9415-f7e7cdb8d3fc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc73d0005d0>]}
[0m13:25:50.084362 [info ] [Thread-1 (]: 1 of 15 OK loaded seed file public.contacts .................................... [[32mINSERT 10[0m in 0.26s]
[0m13:25:50.084871 [debug] [Thread-1 (]: Finished running node seed.integration_tests.contacts
[0m13:25:50.082797 [debug] [Thread-2 (]: On seed.integration_tests.transactions: COMMIT
[0m13:25:50.086135 [debug] [Thread-2 (]: Using postgres connection "seed.integration_tests.transactions"
[0m13:25:50.086568 [debug] [Thread-2 (]: On seed.integration_tests.transactions: COMMIT
[0m13:25:50.085521 [debug] [Thread-1 (]: Began running node test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247
[0m13:25:50.087108 [info ] [Thread-1 (]: 5 of 15 START test source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors  [RUN]
[0m13:25:50.087843 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly seed.integration_tests.contacts, now test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247)
[0m13:25:50.088196 [debug] [Thread-1 (]: Began compiling node test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247
[0m13:25:50.095601 [debug] [Thread-2 (]: SQL status: COMMIT in 0.0 seconds
[0m13:25:50.101787 [debug] [Thread-2 (]: Timing info for seed.integration_tests.transactions (execute): 13:25:49.828951 => 13:25:50.101586
[0m13:25:50.102207 [debug] [Thread-2 (]: On seed.integration_tests.transactions: Close
[0m13:25:50.103956 [debug] [Thread-1 (]: Writing injected SQL for node "test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247"
[0m13:25:50.105955 [debug] [Thread-1 (]: Timing info for test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247 (compile): 13:25:50.088476 => 13:25:50.105680
[0m13:25:50.105228 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd2af3c87-b8ff-4f5a-9415-f7e7cdb8d3fc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc73d7dd350>]}
[0m13:25:50.104422 [debug] [Thread-3 (]: SQL status: BEGIN in 0.0 seconds
[0m13:25:50.107420 [debug] [Thread-3 (]: Using postgres connection "test.customer360.macro_test2"
[0m13:25:50.106483 [debug] [Thread-1 (]: Began executing node test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247
[0m13:25:50.107045 [info ] [Thread-2 (]: 2 of 15 OK loaded seed file public.transactions ................................ [[32mINSERT 74[0m in 0.29s]
[0m13:25:50.107889 [debug] [Thread-3 (]: On test.customer360.macro_test2: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.macro_test2"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      with marco_result as (
    select 
        to_timestamp('2023-02-27 21:00:00','YYYY-MM-DD HH24:MI:SS.MS') :: timestamp at TIME zone 'UTC'
     as expect_result
)
select
    1
from marco_result
where cast(pg_typeof(expect_result) as text) not like '%timestamp%'
      
    ) dbt_internal_test
[0m13:25:50.110194 [debug] [Thread-1 (]: Writing runtime sql for node "test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247"
[0m13:25:50.111484 [debug] [Thread-1 (]: Using postgres connection "test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247"
[0m13:25:50.111993 [debug] [Thread-1 (]: On test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247: BEGIN
[0m13:25:50.112460 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:25:50.110780 [debug] [Thread-2 (]: Finished running node seed.integration_tests.transactions
[0m13:25:50.112836 [debug] [Thread-3 (]: SQL status: SELECT 1 in 0.0 seconds
[0m13:25:50.115157 [debug] [Thread-3 (]: Timing info for test.customer360.macro_test2 (execute): 13:25:50.073992 => 13:25:50.114952
[0m13:25:50.115553 [debug] [Thread-3 (]: On test.customer360.macro_test2: ROLLBACK
[0m13:25:50.113434 [debug] [Thread-2 (]: Began running node test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d
[0m13:25:50.116679 [info ] [Thread-2 (]: 6 of 15 START test source_not_null_salesforce_contacts_id ...................... [RUN]
[0m13:25:50.117269 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly seed.integration_tests.transactions, now test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d)
[0m13:25:50.117756 [debug] [Thread-2 (]: Began compiling node test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d
[0m13:25:50.116152 [debug] [Thread-3 (]: On test.customer360.macro_test2: Close
[0m13:25:50.126543 [info ] [Thread-3 (]: 4 of 15 PASS macro_test2 ....................................................... [[32mPASS[0m in 0.07s]
[0m13:25:50.127240 [debug] [Thread-3 (]: Finished running node test.customer360.macro_test2
[0m13:25:50.127882 [debug] [Thread-3 (]: Began running node test.customer360.source_not_null_web_transactions_id.88a47bf7e5
[0m13:25:50.128370 [info ] [Thread-3 (]: 7 of 15 START test source_not_null_web_transactions_id ......................... [RUN]
[0m13:25:50.129172 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.customer360.macro_test2, now test.customer360.source_not_null_web_transactions_id.88a47bf7e5)
[0m13:25:50.129695 [debug] [Thread-3 (]: Began compiling node test.customer360.source_not_null_web_transactions_id.88a47bf7e5
[0m13:25:50.125383 [debug] [Thread-2 (]: Writing injected SQL for node "test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d"
[0m13:25:50.134013 [debug] [Thread-3 (]: Writing injected SQL for node "test.customer360.source_not_null_web_transactions_id.88a47bf7e5"
[0m13:25:50.134911 [debug] [Thread-3 (]: Timing info for test.customer360.source_not_null_web_transactions_id.88a47bf7e5 (compile): 13:25:50.130086 => 13:25:50.134610
[0m13:25:50.135434 [debug] [Thread-3 (]: Began executing node test.customer360.source_not_null_web_transactions_id.88a47bf7e5
[0m13:25:50.135802 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m13:25:50.138420 [debug] [Thread-1 (]: Using postgres connection "test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247"
[0m13:25:50.138810 [debug] [Thread-1 (]: On test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

with all_values as (

    select
        category as value_field,
        count(*) as n_records

    from "dbt"."public"."transactions"
    group by category

)

select *
from all_values
where value_field not in (
    'Apps & Games','Beauty','Books','Clothing, Shoes & Accessories','Movies & TV','Sports, Fitness & Outdoors'
)



      
    ) dbt_internal_test
[0m13:25:50.139385 [debug] [Thread-2 (]: Timing info for test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d (compile): 13:25:50.118058 => 13:25:50.139087
[0m13:25:50.139866 [debug] [Thread-2 (]: Began executing node test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d
[0m13:25:50.137948 [debug] [Thread-3 (]: Writing runtime sql for node "test.customer360.source_not_null_web_transactions_id.88a47bf7e5"
[0m13:25:50.142171 [debug] [Thread-2 (]: Writing runtime sql for node "test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d"
[0m13:25:50.142557 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.0 seconds
[0m13:25:50.144685 [debug] [Thread-1 (]: Timing info for test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247 (execute): 13:25:50.108144 => 13:25:50.144465
[0m13:25:50.145036 [debug] [Thread-1 (]: On test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247: ROLLBACK
[0m13:25:50.145602 [debug] [Thread-2 (]: Using postgres connection "test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d"
[0m13:25:50.143197 [debug] [Thread-3 (]: Using postgres connection "test.customer360.source_not_null_web_transactions_id.88a47bf7e5"
[0m13:25:50.146007 [debug] [Thread-1 (]: On test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247: Close
[0m13:25:50.146390 [debug] [Thread-2 (]: On test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d: BEGIN
[0m13:25:50.147159 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m13:25:50.146755 [debug] [Thread-3 (]: On test.customer360.source_not_null_web_transactions_id.88a47bf7e5: BEGIN
[0m13:25:50.148150 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m13:25:50.149844 [info ] [Thread-1 (]: 5 of 15 PASS source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors  [[32mPASS[0m in 0.06s]
[0m13:25:50.150484 [debug] [Thread-1 (]: Finished running node test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247
[0m13:25:50.151044 [debug] [Thread-1 (]: Began running node test.customer360.source_unique_salesforce_contacts_id.01cadaaf43
[0m13:25:50.151564 [info ] [Thread-1 (]: 8 of 15 START test source_unique_salesforce_contacts_id ........................ [RUN]
[0m13:25:50.152401 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247, now test.customer360.source_unique_salesforce_contacts_id.01cadaaf43)
[0m13:25:50.153210 [debug] [Thread-1 (]: Began compiling node test.customer360.source_unique_salesforce_contacts_id.01cadaaf43
[0m13:25:50.153735 [debug] [Thread-2 (]: SQL status: BEGIN in 0.0 seconds
[0m13:25:50.160572 [debug] [Thread-2 (]: Using postgres connection "test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d"
[0m13:25:50.161708 [debug] [Thread-2 (]: On test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select id
from "dbt"."public"."contacts"
where id is null



      
    ) dbt_internal_test
[0m13:25:50.161197 [debug] [Thread-3 (]: SQL status: BEGIN in 0.0 seconds
[0m13:25:50.162326 [debug] [Thread-3 (]: Using postgres connection "test.customer360.source_not_null_web_transactions_id.88a47bf7e5"
[0m13:25:50.162855 [debug] [Thread-3 (]: On test.customer360.source_not_null_web_transactions_id.88a47bf7e5: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.source_not_null_web_transactions_id.88a47bf7e5"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select id
from "dbt"."public"."transactions"
where id is null



      
    ) dbt_internal_test
[0m13:25:50.164695 [debug] [Thread-3 (]: SQL status: SELECT 1 in 0.0 seconds
[0m13:25:50.159949 [debug] [Thread-1 (]: Writing injected SQL for node "test.customer360.source_unique_salesforce_contacts_id.01cadaaf43"
[0m13:25:50.167486 [debug] [Thread-1 (]: Timing info for test.customer360.source_unique_salesforce_contacts_id.01cadaaf43 (compile): 13:25:50.153997 => 13:25:50.167195
[0m13:25:50.168027 [debug] [Thread-1 (]: Began executing node test.customer360.source_unique_salesforce_contacts_id.01cadaaf43
[0m13:25:50.171542 [debug] [Thread-1 (]: Writing runtime sql for node "test.customer360.source_unique_salesforce_contacts_id.01cadaaf43"
[0m13:25:50.172229 [debug] [Thread-1 (]: Using postgres connection "test.customer360.source_unique_salesforce_contacts_id.01cadaaf43"
[0m13:25:50.172780 [debug] [Thread-1 (]: On test.customer360.source_unique_salesforce_contacts_id.01cadaaf43: BEGIN
[0m13:25:50.166748 [debug] [Thread-3 (]: Timing info for test.customer360.source_not_null_web_transactions_id.88a47bf7e5 (execute): 13:25:50.136096 => 13:25:50.166399
[0m13:25:50.174263 [debug] [Thread-3 (]: On test.customer360.source_not_null_web_transactions_id.88a47bf7e5: ROLLBACK
[0m13:25:50.173771 [debug] [Thread-2 (]: SQL status: SELECT 1 in 0.0 seconds
[0m13:25:50.176340 [debug] [Thread-2 (]: Timing info for test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d (execute): 13:25:50.140156 => 13:25:50.176012
[0m13:25:50.177027 [debug] [Thread-2 (]: On test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d: ROLLBACK
[0m13:25:50.173225 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:25:50.178612 [debug] [Thread-3 (]: On test.customer360.source_not_null_web_transactions_id.88a47bf7e5: Close
[0m13:25:50.179680 [info ] [Thread-3 (]: 7 of 15 PASS source_not_null_web_transactions_id ............................... [[32mPASS[0m in 0.05s]
[0m13:25:50.182753 [debug] [Thread-3 (]: Finished running node test.customer360.source_not_null_web_transactions_id.88a47bf7e5
[0m13:25:50.183392 [debug] [Thread-3 (]: Began running node test.customer360.source_unique_web_transactions_id.ba28079761
[0m13:25:50.183965 [info ] [Thread-3 (]: 9 of 15 START test source_unique_web_transactions_id ........................... [RUN]
[0m13:25:50.184899 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.customer360.source_not_null_web_transactions_id.88a47bf7e5, now test.customer360.source_unique_web_transactions_id.ba28079761)
[0m13:25:50.185637 [debug] [Thread-3 (]: Began compiling node test.customer360.source_unique_web_transactions_id.ba28079761
[0m13:25:50.192123 [debug] [Thread-2 (]: On test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d: Close
[0m13:25:50.193367 [info ] [Thread-2 (]: 6 of 15 PASS source_not_null_salesforce_contacts_id ............................ [[32mPASS[0m in 0.08s]
[0m13:25:50.194119 [debug] [Thread-2 (]: Finished running node test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d
[0m13:25:50.194693 [debug] [Thread-2 (]: Began running node test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344
[0m13:25:50.195216 [info ] [Thread-2 (]: 10 of 15 START test source_relationships_web_transactions_contact_id__id__ref_contacts_  [RUN]
[0m13:25:50.198782 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d, now test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344)
[0m13:25:50.199283 [debug] [Thread-2 (]: Began compiling node test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344
[0m13:25:50.191913 [debug] [Thread-3 (]: Writing injected SQL for node "test.customer360.source_unique_web_transactions_id.ba28079761"
[0m13:25:50.213575 [debug] [Thread-3 (]: Timing info for test.customer360.source_unique_web_transactions_id.ba28079761 (compile): 13:25:50.185955 => 13:25:50.213217
[0m13:25:50.214078 [debug] [Thread-3 (]: Began executing node test.customer360.source_unique_web_transactions_id.ba28079761
[0m13:25:50.219825 [debug] [Thread-3 (]: Writing runtime sql for node "test.customer360.source_unique_web_transactions_id.ba28079761"
[0m13:25:50.220586 [debug] [Thread-3 (]: Using postgres connection "test.customer360.source_unique_web_transactions_id.ba28079761"
[0m13:25:50.221085 [debug] [Thread-3 (]: On test.customer360.source_unique_web_transactions_id.ba28079761: BEGIN
[0m13:25:50.221579 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m13:25:50.224261 [debug] [Thread-2 (]: Writing injected SQL for node "test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344"
[0m13:25:50.230246 [debug] [Thread-2 (]: Timing info for test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344 (compile): 13:25:50.199616 => 13:25:50.229868
[0m13:25:50.230783 [debug] [Thread-2 (]: Began executing node test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344
[0m13:25:50.237274 [debug] [Thread-2 (]: Writing runtime sql for node "test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344"
[0m13:25:50.237983 [debug] [Thread-2 (]: Using postgres connection "test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344"
[0m13:25:50.238523 [debug] [Thread-2 (]: On test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344: BEGIN
[0m13:25:50.238987 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m13:25:50.243394 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m13:25:50.243886 [debug] [Thread-1 (]: Using postgres connection "test.customer360.source_unique_salesforce_contacts_id.01cadaaf43"
[0m13:25:50.244690 [debug] [Thread-1 (]: On test.customer360.source_unique_salesforce_contacts_id.01cadaaf43: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.source_unique_salesforce_contacts_id.01cadaaf43"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

select
    id as unique_field,
    count(*) as n_records

from "dbt"."public"."contacts"
where id is not null
group by id
having count(*) > 1



      
    ) dbt_internal_test
[0m13:25:50.247945 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.0 seconds
[0m13:25:50.249997 [debug] [Thread-1 (]: Timing info for test.customer360.source_unique_salesforce_contacts_id.01cadaaf43 (execute): 13:25:50.168348 => 13:25:50.249671
[0m13:25:50.250589 [debug] [Thread-1 (]: On test.customer360.source_unique_salesforce_contacts_id.01cadaaf43: ROLLBACK
[0m13:25:50.253918 [debug] [Thread-1 (]: On test.customer360.source_unique_salesforce_contacts_id.01cadaaf43: Close
[0m13:25:50.255222 [info ] [Thread-1 (]: 8 of 15 PASS source_unique_salesforce_contacts_id .............................. [[32mPASS[0m in 0.10s]
[0m13:25:50.256053 [debug] [Thread-1 (]: Finished running node test.customer360.source_unique_salesforce_contacts_id.01cadaaf43
[0m13:25:50.257362 [debug] [Thread-1 (]: Began running node model.customer360.stg_sf__contacts
[0m13:25:50.257966 [info ] [Thread-1 (]: 11 of 15 START sql table model public.stg_sf__contacts ......................... [RUN]
[0m13:25:50.258806 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.customer360.source_unique_salesforce_contacts_id.01cadaaf43, now model.customer360.stg_sf__contacts)
[0m13:25:50.259252 [debug] [Thread-1 (]: Began compiling node model.customer360.stg_sf__contacts
[0m13:25:50.268722 [debug] [Thread-3 (]: SQL status: BEGIN in 0.0 seconds
[0m13:25:50.269342 [debug] [Thread-3 (]: Using postgres connection "test.customer360.source_unique_web_transactions_id.ba28079761"
[0m13:25:50.269829 [debug] [Thread-3 (]: On test.customer360.source_unique_web_transactions_id.ba28079761: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.source_unique_web_transactions_id.ba28079761"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

select
    id as unique_field,
    count(*) as n_records

from "dbt"."public"."transactions"
where id is not null
group by id
having count(*) > 1



      
    ) dbt_internal_test
[0m13:25:50.270859 [debug] [Thread-1 (]: Writing injected SQL for node "model.customer360.stg_sf__contacts"
[0m13:25:50.271680 [debug] [Thread-1 (]: Timing info for model.customer360.stg_sf__contacts (compile): 13:25:50.259537 => 13:25:50.271378
[0m13:25:50.272236 [debug] [Thread-1 (]: Began executing node model.customer360.stg_sf__contacts
[0m13:25:50.288646 [debug] [Thread-3 (]: SQL status: SELECT 1 in 0.0 seconds
[0m13:25:50.290734 [debug] [Thread-3 (]: Timing info for test.customer360.source_unique_web_transactions_id.ba28079761 (execute): 13:25:50.214443 => 13:25:50.290373
[0m13:25:50.291241 [debug] [Thread-3 (]: On test.customer360.source_unique_web_transactions_id.ba28079761: ROLLBACK
[0m13:25:50.291870 [debug] [Thread-2 (]: SQL status: BEGIN in 0.0 seconds
[0m13:25:50.292386 [debug] [Thread-2 (]: Using postgres connection "test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344"
[0m13:25:50.292953 [debug] [Thread-2 (]: On test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

with child as (
    select contact_id as from_field
    from "dbt"."public"."transactions"
    where contact_id is not null
),

parent as (
    select id as to_field
    from "dbt"."public"."contacts"
)

select
    from_field

from child
left join parent
    on child.from_field = parent.to_field

where parent.to_field is null



      
    ) dbt_internal_test
[0m13:25:50.301650 [debug] [Thread-2 (]: SQL status: SELECT 1 in 0.0 seconds
[0m13:25:50.303798 [debug] [Thread-2 (]: Timing info for test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344 (execute): 13:25:50.231131 => 13:25:50.303448
[0m13:25:50.304337 [debug] [Thread-2 (]: On test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344: ROLLBACK
[0m13:25:50.304904 [debug] [Thread-3 (]: On test.customer360.source_unique_web_transactions_id.ba28079761: Close
[0m13:25:50.306028 [info ] [Thread-3 (]: 9 of 15 PASS source_unique_web_transactions_id ................................. [[32mPASS[0m in 0.12s]
[0m13:25:50.306842 [debug] [Thread-3 (]: Finished running node test.customer360.source_unique_web_transactions_id.ba28079761
[0m13:25:50.354635 [debug] [Thread-2 (]: On test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344: Close
[0m13:25:50.356016 [info ] [Thread-2 (]: 10 of 15 PASS source_relationships_web_transactions_contact_id__id__ref_contacts_  [[32mPASS[0m in 0.16s]
[0m13:25:50.356831 [debug] [Thread-2 (]: Finished running node test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344
[0m13:25:50.357628 [debug] [Thread-2 (]: Began running node model.customer360.stg_web__transactions
[0m13:25:50.358309 [info ] [Thread-2 (]: 12 of 15 START sql table model public.stg_web__transactions .................... [RUN]
[0m13:25:50.359205 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344, now model.customer360.stg_web__transactions)
[0m13:25:50.359726 [debug] [Thread-2 (]: Began compiling node model.customer360.stg_web__transactions
[0m13:25:50.373326 [debug] [Thread-2 (]: Writing injected SQL for node "model.customer360.stg_web__transactions"
[0m13:25:50.374246 [debug] [Thread-2 (]: Timing info for model.customer360.stg_web__transactions (compile): 13:25:50.360031 => 13:25:50.373927
[0m13:25:50.375070 [debug] [Thread-2 (]: Began executing node model.customer360.stg_web__transactions
[0m13:25:50.472432 [debug] [Thread-1 (]: Writing runtime sql for node "model.customer360.stg_sf__contacts"
[0m13:25:50.473238 [debug] [Thread-1 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m13:25:50.478877 [debug] [Thread-1 (]: On model.customer360.stg_sf__contacts: BEGIN
[0m13:25:50.479383 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:25:50.480800 [debug] [Thread-2 (]: Writing runtime sql for node "model.customer360.stg_web__transactions"
[0m13:25:50.481503 [debug] [Thread-2 (]: Using postgres connection "model.customer360.stg_web__transactions"
[0m13:25:50.481934 [debug] [Thread-2 (]: On model.customer360.stg_web__transactions: BEGIN
[0m13:25:50.482424 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m13:25:50.511095 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m13:25:50.511739 [debug] [Thread-1 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m13:25:50.512272 [debug] [Thread-1 (]: On model.customer360.stg_sf__contacts: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_sf__contacts"} */

  
    

  create  table "dbt"."public"."stg_sf__contacts__dbt_tmp"
  
  
    as
  
  (
    with source as (
    select * from "dbt"."public"."contacts"
),

renamed as (
    select
        id,
        username as user_name,
        name,
        gender,
        address, 
        mail as email_address,
        birthdate as birth_date,
        _loaded_at_utc
    from source     
)

select * from renamed
  );
  
[0m13:25:50.512917 [debug] [Thread-2 (]: SQL status: BEGIN in 0.0 seconds
[0m13:25:50.513412 [debug] [Thread-2 (]: Using postgres connection "model.customer360.stg_web__transactions"
[0m13:25:50.514004 [debug] [Thread-2 (]: On model.customer360.stg_web__transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_web__transactions"} */

  
    

  create  table "dbt"."public"."stg_web__transactions__dbt_tmp"
  
  
    as
  
  (
    with source as (
    select * from "dbt"."public"."transactions"
),

renamed as (
    select
        id,
        contact_id,
        
        to_timestamp(transaction_date,'YYYY-MM-DD HH24:MI:SS.MS') :: timestamp at TIME zone 'UTC'
     as transaction_date,
        amount,
        item_count,
        category, 
        _loaded_at_utc
    from source    
),

clean_older as (
    select * from renamed 
--    where transaction_date >= (current_date - 1)  过滤超过1天的数据
    where transaction_date >= (to_date('2023-04-12','yyyy-MM-dd') - 1)  --测试用,假设跑数日期为2023-04-12
    and transaction_date < to_date('2023-04-12','yyyy-MM-dd')
)

select * from clean_older
  );
  
[0m13:25:50.530582 [debug] [Thread-2 (]: SQL status: SELECT 4 in 0.0 seconds
[0m13:25:50.539676 [debug] [Thread-2 (]: Using postgres connection "model.customer360.stg_web__transactions"
[0m13:25:50.540290 [debug] [Thread-2 (]: On model.customer360.stg_web__transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_web__transactions"} */
alter table "dbt"."public"."stg_web__transactions" rename to "stg_web__transactions__dbt_backup"
[0m13:25:50.540896 [debug] [Thread-1 (]: SQL status: SELECT 10 in 0.0 seconds
[0m13:25:50.545439 [debug] [Thread-1 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m13:25:50.545966 [debug] [Thread-1 (]: On model.customer360.stg_sf__contacts: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_sf__contacts"} */
alter table "dbt"."public"."stg_sf__contacts" rename to "stg_sf__contacts__dbt_backup"
[0m13:25:50.550100 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m13:25:50.561959 [debug] [Thread-1 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m13:25:50.562609 [debug] [Thread-1 (]: On model.customer360.stg_sf__contacts: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_sf__contacts"} */
alter table "dbt"."public"."stg_sf__contacts__dbt_tmp" rename to "stg_sf__contacts"
[0m13:25:50.564439 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m13:25:50.568762 [debug] [Thread-2 (]: Using postgres connection "model.customer360.stg_web__transactions"
[0m13:25:50.569409 [debug] [Thread-2 (]: On model.customer360.stg_web__transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_web__transactions"} */
alter table "dbt"."public"."stg_web__transactions__dbt_tmp" rename to "stg_web__transactions"
[0m13:25:50.570010 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m13:25:50.585133 [debug] [Thread-1 (]: On model.customer360.stg_sf__contacts: COMMIT
[0m13:25:50.585777 [debug] [Thread-1 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m13:25:50.586119 [debug] [Thread-1 (]: On model.customer360.stg_sf__contacts: COMMIT
[0m13:25:50.586621 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m13:25:50.589739 [debug] [Thread-2 (]: On model.customer360.stg_web__transactions: COMMIT
[0m13:25:50.590254 [debug] [Thread-2 (]: Using postgres connection "model.customer360.stg_web__transactions"
[0m13:25:50.590734 [debug] [Thread-2 (]: On model.customer360.stg_web__transactions: COMMIT
[0m13:25:50.598918 [debug] [Thread-2 (]: SQL status: COMMIT in 0.0 seconds
[0m13:25:50.609870 [debug] [Thread-2 (]: Applying DROP to: "dbt"."public"."stg_web__transactions__dbt_backup"
[0m13:25:50.621023 [debug] [Thread-1 (]: SQL status: COMMIT in 0.0 seconds
[0m13:25:50.624813 [debug] [Thread-1 (]: Applying DROP to: "dbt"."public"."stg_sf__contacts__dbt_backup"
[0m13:25:50.628986 [debug] [Thread-1 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m13:25:50.629494 [debug] [Thread-1 (]: On model.customer360.stg_sf__contacts: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_sf__contacts"} */
drop table if exists "dbt"."public"."stg_sf__contacts__dbt_backup" cascade
[0m13:25:50.631227 [debug] [Thread-2 (]: Using postgres connection "model.customer360.stg_web__transactions"
[0m13:25:50.631749 [debug] [Thread-2 (]: On model.customer360.stg_web__transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_web__transactions"} */
drop table if exists "dbt"."public"."stg_web__transactions__dbt_backup" cascade
[0m13:25:50.634824 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.0 seconds
[0m13:25:50.636797 [debug] [Thread-1 (]: Timing info for model.customer360.stg_sf__contacts (execute): 13:25:50.276678 => 13:25:50.636498
[0m13:25:50.637323 [debug] [Thread-1 (]: On model.customer360.stg_sf__contacts: Close
[0m13:25:50.638288 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd2af3c87-b8ff-4f5a-9415-f7e7cdb8d3fc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc73d7d3810>]}
[0m13:25:50.641895 [info ] [Thread-1 (]: 11 of 15 OK created sql table model public.stg_sf__contacts .................... [[32mSELECT 10[0m in 0.38s]
[0m13:25:50.642686 [debug] [Thread-1 (]: Finished running node model.customer360.stg_sf__contacts
[0m13:25:50.643243 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.0 seconds
[0m13:25:50.645204 [debug] [Thread-2 (]: Timing info for model.customer360.stg_web__transactions (execute): 13:25:50.375398 => 13:25:50.644906
[0m13:25:50.645845 [debug] [Thread-2 (]: On model.customer360.stg_web__transactions: Close
[0m13:25:50.648693 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd2af3c87-b8ff-4f5a-9415-f7e7cdb8d3fc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc73da632d0>]}
[0m13:25:50.649455 [info ] [Thread-2 (]: 12 of 15 OK created sql table model public.stg_web__transactions ............... [[32mSELECT 4[0m in 0.29s]
[0m13:25:50.650227 [debug] [Thread-2 (]: Finished running node model.customer360.stg_web__transactions
[0m13:25:50.653275 [debug] [Thread-3 (]: Began running node model.customer360.contacts_joined_with_transactions
[0m13:25:50.653939 [info ] [Thread-3 (]: 13 of 15 START sql view model public.contacts_joined_with_transactions ......... [RUN]
[0m13:25:50.654849 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.customer360.source_unique_web_transactions_id.ba28079761, now model.customer360.contacts_joined_with_transactions)
[0m13:25:50.655359 [debug] [Thread-3 (]: Began compiling node model.customer360.contacts_joined_with_transactions
[0m13:25:50.658756 [debug] [Thread-3 (]: Writing injected SQL for node "model.customer360.contacts_joined_with_transactions"
[0m13:25:50.659435 [debug] [Thread-3 (]: Timing info for model.customer360.contacts_joined_with_transactions (compile): 13:25:50.655663 => 13:25:50.659168
[0m13:25:50.659917 [debug] [Thread-3 (]: Began executing node model.customer360.contacts_joined_with_transactions
[0m13:25:50.712867 [debug] [Thread-3 (]: Writing runtime sql for node "model.customer360.contacts_joined_with_transactions"
[0m13:25:50.713695 [debug] [Thread-3 (]: Using postgres connection "model.customer360.contacts_joined_with_transactions"
[0m13:25:50.714183 [debug] [Thread-3 (]: On model.customer360.contacts_joined_with_transactions: BEGIN
[0m13:25:50.714701 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m13:25:50.741042 [debug] [Thread-3 (]: SQL status: BEGIN in 0.0 seconds
[0m13:25:50.741650 [debug] [Thread-3 (]: Using postgres connection "model.customer360.contacts_joined_with_transactions"
[0m13:25:50.742236 [debug] [Thread-3 (]: On model.customer360.contacts_joined_with_transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.contacts_joined_with_transactions"} */

  create view "dbt"."public"."contacts_joined_with_transactions__dbt_tmp"
    
    
  as (
    SELECT 
    contacts.*,
    transactions.id as transaction_id,
    transactions.transaction_date,
    transactions.amount,
    transactions.item_count,
    transactions.category
FROM "dbt"."public"."stg_web__transactions" as transactions
LEFT JOIN "dbt"."public"."stg_sf__contacts" as contacts ON contacts.id = transactions.contact_id
  );
[0m13:25:50.747208 [debug] [Thread-3 (]: SQL status: CREATE VIEW in 0.0 seconds
[0m13:25:50.751687 [debug] [Thread-3 (]: Using postgres connection "model.customer360.contacts_joined_with_transactions"
[0m13:25:50.752328 [debug] [Thread-3 (]: On model.customer360.contacts_joined_with_transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.contacts_joined_with_transactions"} */
alter table "dbt"."public"."contacts_joined_with_transactions__dbt_tmp" rename to "contacts_joined_with_transactions"
[0m13:25:50.756208 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m13:25:50.758778 [debug] [Thread-3 (]: On model.customer360.contacts_joined_with_transactions: COMMIT
[0m13:25:50.759349 [debug] [Thread-3 (]: Using postgres connection "model.customer360.contacts_joined_with_transactions"
[0m13:25:50.759816 [debug] [Thread-3 (]: On model.customer360.contacts_joined_with_transactions: COMMIT
[0m13:25:50.772850 [debug] [Thread-3 (]: SQL status: COMMIT in 0.0 seconds
[0m13:25:50.782848 [debug] [Thread-3 (]: Applying DROP to: "dbt"."public"."contacts_joined_with_transactions__dbt_backup"
[0m13:25:50.799614 [debug] [Thread-3 (]: Using postgres connection "model.customer360.contacts_joined_with_transactions"
[0m13:25:50.800209 [debug] [Thread-3 (]: On model.customer360.contacts_joined_with_transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.contacts_joined_with_transactions"} */
drop view if exists "dbt"."public"."contacts_joined_with_transactions__dbt_backup" cascade
[0m13:25:50.808113 [debug] [Thread-3 (]: SQL status: DROP VIEW in 0.0 seconds
[0m13:25:50.810205 [debug] [Thread-3 (]: Timing info for model.customer360.contacts_joined_with_transactions (execute): 13:25:50.660211 => 13:25:50.809884
[0m13:25:50.826161 [debug] [Thread-3 (]: On model.customer360.contacts_joined_with_transactions: Close
[0m13:25:50.827423 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd2af3c87-b8ff-4f5a-9415-f7e7cdb8d3fc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc73cef62d0>]}
[0m13:25:50.828236 [info ] [Thread-3 (]: 13 of 15 OK created sql view model public.contacts_joined_with_transactions .... [[32mCREATE VIEW[0m in 0.17s]
[0m13:25:50.829142 [debug] [Thread-3 (]: Finished running node model.customer360.contacts_joined_with_transactions
[0m13:25:50.842965 [debug] [Thread-2 (]: Began running node test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311
[0m13:25:50.843540 [info ] [Thread-2 (]: 14 of 15 START test not_null_contacts_joined_with_transactions_id .............. [RUN]
[0m13:25:50.844472 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.customer360.stg_web__transactions, now test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311)
[0m13:25:50.844962 [debug] [Thread-2 (]: Began compiling node test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311
[0m13:25:50.851035 [debug] [Thread-2 (]: Writing injected SQL for node "test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311"
[0m13:25:50.851865 [debug] [Thread-2 (]: Timing info for test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311 (compile): 13:25:50.845348 => 13:25:50.851550
[0m13:25:50.852393 [debug] [Thread-2 (]: Began executing node test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311
[0m13:25:50.861642 [debug] [Thread-2 (]: Writing runtime sql for node "test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311"
[0m13:25:50.862414 [debug] [Thread-2 (]: Using postgres connection "test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311"
[0m13:25:50.862906 [debug] [Thread-2 (]: On test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311: BEGIN
[0m13:25:50.867450 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m13:25:50.894995 [debug] [Thread-2 (]: SQL status: BEGIN in 0.0 seconds
[0m13:25:50.895707 [debug] [Thread-2 (]: Using postgres connection "test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311"
[0m13:25:50.896197 [debug] [Thread-2 (]: On test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select id
from "dbt"."public"."contacts_joined_with_transactions"
where id is null



      
    ) dbt_internal_test
[0m13:25:50.901164 [debug] [Thread-2 (]: SQL status: SELECT 1 in 0.0 seconds
[0m13:25:50.903387 [debug] [Thread-2 (]: Timing info for test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311 (execute): 13:25:50.852709 => 13:25:50.903059
[0m13:25:50.903869 [debug] [Thread-2 (]: On test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311: ROLLBACK
[0m13:25:50.908844 [debug] [Thread-2 (]: On test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311: Close
[0m13:25:50.910038 [info ] [Thread-2 (]: 14 of 15 PASS not_null_contacts_joined_with_transactions_id .................... [[32mPASS[0m in 0.07s]
[0m13:25:50.912991 [debug] [Thread-2 (]: Finished running node test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311
[0m13:25:50.924791 [debug] [Thread-3 (]: Began running node model.customer360.customers
[0m13:25:50.938941 [info ] [Thread-3 (]: 15 of 15 START sql table model public.customers ................................ [RUN]
[0m13:25:50.940075 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.customer360.contacts_joined_with_transactions, now model.customer360.customers)
[0m13:25:50.940996 [debug] [Thread-3 (]: Began compiling node model.customer360.customers
[0m13:25:50.950720 [debug] [Thread-3 (]: Writing injected SQL for node "model.customer360.customers"
[0m13:25:50.951613 [debug] [Thread-3 (]: Timing info for model.customer360.customers (compile): 13:25:50.941355 => 13:25:50.951240
[0m13:25:50.952141 [debug] [Thread-3 (]: Began executing node model.customer360.customers
[0m13:25:50.966743 [debug] [Thread-3 (]: Writing runtime sql for node "model.customer360.customers"
[0m13:25:50.968035 [debug] [Thread-3 (]: Using postgres connection "model.customer360.customers"
[0m13:25:50.968512 [debug] [Thread-3 (]: On model.customer360.customers: BEGIN
[0m13:25:50.968983 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m13:25:50.991098 [debug] [Thread-3 (]: SQL status: BEGIN in 0.0 seconds
[0m13:25:50.991759 [debug] [Thread-3 (]: Using postgres connection "model.customer360.customers"
[0m13:25:50.992270 [debug] [Thread-3 (]: On model.customer360.customers: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.customers"} */

  
    

  create  table "dbt"."public"."customers__dbt_tmp"
  
  
    as
  
  (
    SELECT
    id,
    gender,
    
    date_part('year', age(current_date, birth_date))
 AS age,
    sum(amount) as total_expense
FROM "dbt"."public"."contacts_joined_with_transactions"
GROUP BY
    1,2,3
  );
  
[0m13:25:50.999312 [debug] [Thread-3 (]: SQL status: SELECT 2 in 0.0 seconds
[0m13:25:51.005974 [debug] [Thread-3 (]: Using postgres connection "model.customer360.customers"
[0m13:25:51.006554 [debug] [Thread-3 (]: On model.customer360.customers: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.customers"} */
alter table "dbt"."public"."customers" rename to "customers__dbt_backup"
[0m13:25:51.007557 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m13:25:51.011582 [debug] [Thread-3 (]: Using postgres connection "model.customer360.customers"
[0m13:25:51.012138 [debug] [Thread-3 (]: On model.customer360.customers: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.customers"} */
alter table "dbt"."public"."customers__dbt_tmp" rename to "customers"
[0m13:25:51.013674 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m13:25:51.017066 [debug] [Thread-3 (]: On model.customer360.customers: COMMIT
[0m13:25:51.017579 [debug] [Thread-3 (]: Using postgres connection "model.customer360.customers"
[0m13:25:51.018104 [debug] [Thread-3 (]: On model.customer360.customers: COMMIT
[0m13:25:51.019498 [debug] [Thread-3 (]: SQL status: COMMIT in 0.0 seconds
[0m13:25:51.023372 [debug] [Thread-3 (]: Applying DROP to: "dbt"."public"."customers__dbt_backup"
[0m13:25:51.024618 [debug] [Thread-3 (]: Using postgres connection "model.customer360.customers"
[0m13:25:51.025120 [debug] [Thread-3 (]: On model.customer360.customers: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.customers"} */
drop table if exists "dbt"."public"."customers__dbt_backup" cascade
[0m13:25:51.028033 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.0 seconds
[0m13:25:51.030031 [debug] [Thread-3 (]: Timing info for model.customer360.customers (execute): 13:25:50.960078 => 13:25:51.029744
[0m13:25:51.030593 [debug] [Thread-3 (]: On model.customer360.customers: Close
[0m13:25:51.034136 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd2af3c87-b8ff-4f5a-9415-f7e7cdb8d3fc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc73ceba8d0>]}
[0m13:25:51.034977 [info ] [Thread-3 (]: 15 of 15 OK created sql table model public.customers ........................... [[32mSELECT 2[0m in 0.09s]
[0m13:25:51.035798 [debug] [Thread-3 (]: Finished running node model.customer360.customers
[0m13:25:51.040463 [debug] [MainThread]: Using postgres connection "master"
[0m13:25:51.040877 [debug] [MainThread]: On master: BEGIN
[0m13:25:51.041267 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m13:25:51.109793 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m13:25:51.115847 [debug] [MainThread]: On master: COMMIT
[0m13:25:51.116406 [debug] [MainThread]: Using postgres connection "master"
[0m13:25:51.116780 [debug] [MainThread]: On master: COMMIT
[0m13:25:51.121781 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m13:25:51.122321 [debug] [MainThread]: On master: Close
[0m13:25:51.123334 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:25:51.123774 [debug] [MainThread]: Connection 'model.customer360.stg_sf__contacts' was properly closed.
[0m13:25:51.124147 [debug] [MainThread]: Connection 'model.customer360.customers' was properly closed.
[0m13:25:51.124575 [debug] [MainThread]: Connection 'test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311' was properly closed.
[0m13:25:51.125086 [info ] [MainThread]: 
[0m13:25:51.125603 [info ] [MainThread]: Finished running 9 tests, 2 seeds, 3 table models, 1 view model in 0 hours 0 minutes and 1.37 seconds (1.37s).
[0m13:25:51.134542 [debug] [MainThread]: Command end result
[0m13:25:51.155852 [info ] [MainThread]: 
[0m13:25:51.164614 [info ] [MainThread]: [32mCompleted successfully[0m
[0m13:25:51.165166 [info ] [MainThread]: 
[0m13:25:51.165706 [info ] [MainThread]: Done. PASS=15 WARN=0 ERROR=0 SKIP=0 TOTAL=15
[0m13:25:51.166772 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 2.4153738, "process_user_time": 3.738919, "process_kernel_time": 0.142209, "process_mem_max_rss": "118348", "process_out_blocks": "2888", "process_in_blocks": "0"}
[0m13:25:51.167694 [debug] [MainThread]: Command `dbt build` succeeded at 13:25:51.167254 after 2.42 seconds
[0m13:25:51.168219 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc73f2df310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc73d7478d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc743e19f50>]}
[0m13:25:51.168776 [debug] [MainThread]: Flushing usage events
[0m13:25:57.582927 [debug] [MainThread]: Error sending anonymous usage statistics. Disabling tracking for this execution. If you wish to permanently disable tracking, see: https://docs.getdbt.com/reference/global-configs#send-anonymous-usage-stats.
[0m18:32:55.664915 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa0930e71d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa0935263d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa094f0b310>]}


============================== 18:32:55.667378 | d4c82f8a-5e22-40a3-be75-5c184e203354 ==============================
[0m18:32:55.667378 [info ] [MainThread]: Running with dbt=1.7.8
[0m18:32:55.667856 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/root/option1-customer360/integration_tests', 'version_check': 'True', 'debug': 'False', 'log_path': '/root/option1-customer360/integration_tests/logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m18:32:55.807265 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd4c82f8a-5e22-40a3-be75-5c184e203354', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa093353a10>]}
[0m18:32:55.882062 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'd4c82f8a-5e22-40a3-be75-5c184e203354', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa0936a86d0>]}
[0m18:32:55.882771 [info ] [MainThread]: Registered adapter: postgres=1.7.8
[0m18:32:55.893858 [debug] [MainThread]: checksum: 67f0013ca5f0bd43af9a0873dd50792fde83ef69de63b71cacd0b4ac656c52e5, vars: {}, profile: , target: , version: 1.7.8
[0m18:32:55.915519 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m18:32:55.915893 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m18:32:55.921214 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'd4c82f8a-5e22-40a3-be75-5c184e203354', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa0930fb310>]}
[0m18:32:55.930670 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'd4c82f8a-5e22-40a3-be75-5c184e203354', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa0930db210>]}
[0m18:32:55.931123 [info ] [MainThread]: Found 2 seeds, 4 models, 9 tests, 2 sources, 0 exposures, 0 metrics, 403 macros, 0 groups, 0 semantic models
[0m18:32:55.931504 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd4c82f8a-5e22-40a3-be75-5c184e203354', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa0914ccf90>]}
[0m18:32:55.933028 [info ] [MainThread]: 
[0m18:32:55.933737 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m18:32:55.934819 [debug] [ThreadPool]: Acquiring new postgres connection 'list_dbt'
[0m18:32:55.944744 [debug] [ThreadPool]: Using postgres connection "list_dbt"
[0m18:32:55.945078 [debug] [ThreadPool]: On list_dbt: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "connection_name": "list_dbt"} */

    select distinct nspname from pg_namespace
  
[0m18:32:55.945383 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m18:32:55.949896 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.0 seconds
[0m18:32:55.951031 [debug] [ThreadPool]: On list_dbt: Close
[0m18:32:55.952858 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dbt, now list_dbt_public)
[0m18:32:55.958315 [debug] [ThreadPool]: Using postgres connection "list_dbt_public"
[0m18:32:55.958688 [debug] [ThreadPool]: On list_dbt_public: BEGIN
[0m18:32:55.958962 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:32:55.961944 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m18:32:55.962242 [debug] [ThreadPool]: Using postgres connection "list_dbt_public"
[0m18:32:55.962573 [debug] [ThreadPool]: On list_dbt_public: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "connection_name": "list_dbt_public"} */
select
      'dbt' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'dbt' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'dbt' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m18:32:55.965386 [debug] [ThreadPool]: SQL status: SELECT 6 in 0.0 seconds
[0m18:32:55.966589 [debug] [ThreadPool]: On list_dbt_public: ROLLBACK
[0m18:32:55.967081 [debug] [ThreadPool]: On list_dbt_public: Close
[0m18:32:55.972696 [debug] [MainThread]: Using postgres connection "master"
[0m18:32:55.973137 [debug] [MainThread]: On master: BEGIN
[0m18:32:55.973422 [debug] [MainThread]: Opening a new connection, currently in state init
[0m18:32:55.976445 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m18:32:55.976756 [debug] [MainThread]: Using postgres connection "master"
[0m18:32:55.977115 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m18:32:55.986929 [debug] [MainThread]: SQL status: SELECT 2 in 0.0 seconds
[0m18:32:55.988484 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd4c82f8a-5e22-40a3-be75-5c184e203354', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa0916335d0>]}
[0m18:32:55.988893 [debug] [MainThread]: On master: ROLLBACK
[0m18:32:55.989391 [debug] [MainThread]: Using postgres connection "master"
[0m18:32:55.989666 [debug] [MainThread]: On master: BEGIN
[0m18:32:55.990361 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m18:32:55.990636 [debug] [MainThread]: On master: COMMIT
[0m18:32:55.990902 [debug] [MainThread]: Using postgres connection "master"
[0m18:32:55.991161 [debug] [MainThread]: On master: COMMIT
[0m18:32:55.991608 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m18:32:55.991898 [debug] [MainThread]: On master: Close
[0m18:32:55.992553 [info ] [MainThread]: Concurrency: 3 threads (target='local')
[0m18:32:55.992850 [info ] [MainThread]: 
[0m18:32:55.995658 [debug] [Thread-1 (]: Began running node model.customer360.stg_sf__contacts
[0m18:32:55.996080 [debug] [Thread-2 (]: Began running node model.customer360.stg_web__transactions
[0m18:32:55.996510 [info ] [Thread-1 (]: 1 of 4 START sql table model public.stg_sf__contacts ........................... [RUN]
[0m18:32:55.997001 [info ] [Thread-2 (]: 2 of 4 START sql table model public.stg_web__transactions ...................... [RUN]
[0m18:32:55.997648 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dbt_public, now model.customer360.stg_sf__contacts)
[0m18:32:55.998335 [debug] [Thread-2 (]: Acquiring new postgres connection 'model.customer360.stg_web__transactions'
[0m18:32:55.998709 [debug] [Thread-1 (]: Began compiling node model.customer360.stg_sf__contacts
[0m18:32:55.999088 [debug] [Thread-2 (]: Began compiling node model.customer360.stg_web__transactions
[0m18:32:56.006283 [debug] [Thread-1 (]: Writing injected SQL for node "model.customer360.stg_sf__contacts"
[0m18:32:56.010321 [debug] [Thread-2 (]: Writing injected SQL for node "model.customer360.stg_web__transactions"
[0m18:32:56.011011 [debug] [Thread-2 (]: Timing info for model.customer360.stg_web__transactions (compile): 18:32:56.006600 => 18:32:56.010779
[0m18:32:56.011420 [debug] [Thread-2 (]: Began executing node model.customer360.stg_web__transactions
[0m18:32:56.011875 [debug] [Thread-1 (]: Timing info for model.customer360.stg_sf__contacts (compile): 18:32:55.999337 => 18:32:56.011678
[0m18:32:56.027597 [debug] [Thread-1 (]: Began executing node model.customer360.stg_sf__contacts
[0m18:32:56.061593 [debug] [Thread-2 (]: Writing runtime sql for node "model.customer360.stg_web__transactions"
[0m18:32:56.062141 [debug] [Thread-1 (]: Writing runtime sql for node "model.customer360.stg_sf__contacts"
[0m18:32:56.062812 [debug] [Thread-1 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m18:32:56.063329 [debug] [Thread-1 (]: On model.customer360.stg_sf__contacts: BEGIN
[0m18:32:56.063709 [debug] [Thread-2 (]: Using postgres connection "model.customer360.stg_web__transactions"
[0m18:32:56.064063 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:32:56.064443 [debug] [Thread-2 (]: On model.customer360.stg_web__transactions: BEGIN
[0m18:32:56.064969 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m18:32:56.069398 [debug] [Thread-2 (]: SQL status: BEGIN in 0.0 seconds
[0m18:32:56.069817 [debug] [Thread-2 (]: Using postgres connection "model.customer360.stg_web__transactions"
[0m18:32:56.070204 [debug] [Thread-2 (]: On model.customer360.stg_web__transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_web__transactions"} */

  
    

  create  table "dbt"."public"."stg_web__transactions__dbt_tmp"
  
  
    as
  
  (
    with source as (
    select * from "dbt"."public"."transactions"
),

renamed as (
    select
        id,
        contact_id,
        
        to_timestamp(transaction_date,'YYYY-MM-DD HH24:MI:SS.MS') :: timestamp at TIME zone 'UTC'
     as transaction_date,
        amount,
        item_count,
        category, 
        _loaded_at_utc
    from source    
),

clean_older as (
    select * from renamed 
--    where transaction_date >= (current_date - 1)  过滤超过1天的数据
    where transaction_date >= (to_date('2023-04-12','yyyy-MM-dd') - 1)  --测试用,假设跑数日期为2023-04-12
    and transaction_date < to_date('2023-04-12','yyyy-MM-dd')
)

select * from clean_older
  );
  
[0m18:32:56.070697 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m18:32:56.071153 [debug] [Thread-1 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m18:32:56.071654 [debug] [Thread-1 (]: On model.customer360.stg_sf__contacts: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_sf__contacts"} */

  
    

  create  table "dbt"."public"."stg_sf__contacts__dbt_tmp"
  
  
    as
  
  (
    with source as (
    select * from "dbt"."public"."contacts"
),

renamed as (
    select
        id,
        username as user_name,
        name,
        gender,
        address, 
        mail as email_address,
        birthdate as birth_date,
        _loaded_at_utc
    from source     
)

select * from renamed
  );
  
[0m18:32:56.081064 [debug] [Thread-1 (]: SQL status: SELECT 10 in 0.0 seconds
[0m18:32:56.087033 [debug] [Thread-1 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m18:32:56.087441 [debug] [Thread-2 (]: SQL status: SELECT 4 in 0.0 seconds
[0m18:32:56.087805 [debug] [Thread-1 (]: On model.customer360.stg_sf__contacts: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_sf__contacts"} */
alter table "dbt"."public"."stg_sf__contacts" rename to "stg_sf__contacts__dbt_backup"
[0m18:32:56.090466 [debug] [Thread-2 (]: Using postgres connection "model.customer360.stg_web__transactions"
[0m18:32:56.090994 [debug] [Thread-2 (]: On model.customer360.stg_web__transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_web__transactions"} */
alter table "dbt"."public"."stg_web__transactions" rename to "stg_web__transactions__dbt_backup"
[0m18:32:56.091469 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m18:32:56.094023 [debug] [Thread-1 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m18:32:56.095571 [debug] [Thread-1 (]: On model.customer360.stg_sf__contacts: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_sf__contacts"} */
alter table "dbt"."public"."stg_sf__contacts__dbt_tmp" rename to "stg_sf__contacts"
[0m18:32:56.095993 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m18:32:56.098903 [debug] [Thread-2 (]: Using postgres connection "model.customer360.stg_web__transactions"
[0m18:32:56.099415 [debug] [Thread-2 (]: On model.customer360.stg_web__transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_web__transactions"} */
alter table "dbt"."public"."stg_web__transactions__dbt_tmp" rename to "stg_web__transactions"
[0m18:32:56.099911 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m18:32:56.166899 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m18:32:56.202355 [debug] [Thread-1 (]: On model.customer360.stg_sf__contacts: COMMIT
[0m18:32:56.202952 [debug] [Thread-1 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m18:32:56.203506 [debug] [Thread-1 (]: On model.customer360.stg_sf__contacts: COMMIT
[0m18:32:56.206840 [debug] [Thread-2 (]: On model.customer360.stg_web__transactions: COMMIT
[0m18:32:56.207500 [debug] [Thread-2 (]: Using postgres connection "model.customer360.stg_web__transactions"
[0m18:32:56.207959 [debug] [Thread-2 (]: On model.customer360.stg_web__transactions: COMMIT
[0m18:32:56.210677 [debug] [Thread-1 (]: SQL status: COMMIT in 0.0 seconds
[0m18:32:56.219856 [debug] [Thread-1 (]: Applying DROP to: "dbt"."public"."stg_sf__contacts__dbt_backup"
[0m18:32:56.226875 [debug] [Thread-1 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m18:32:56.227442 [debug] [Thread-1 (]: On model.customer360.stg_sf__contacts: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_sf__contacts"} */
drop table if exists "dbt"."public"."stg_sf__contacts__dbt_backup" cascade
[0m18:32:56.228534 [debug] [Thread-2 (]: SQL status: COMMIT in 0.0 seconds
[0m18:32:56.232099 [debug] [Thread-2 (]: Applying DROP to: "dbt"."public"."stg_web__transactions__dbt_backup"
[0m18:32:56.233261 [debug] [Thread-2 (]: Using postgres connection "model.customer360.stg_web__transactions"
[0m18:32:56.233766 [debug] [Thread-2 (]: On model.customer360.stg_web__transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_web__transactions"} */
drop table if exists "dbt"."public"."stg_web__transactions__dbt_backup" cascade
[0m18:32:56.236124 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.0 seconds
[0m18:32:56.238156 [debug] [Thread-1 (]: Timing info for model.customer360.stg_sf__contacts (execute): 18:32:56.032956 => 18:32:56.237842
[0m18:32:56.238687 [debug] [Thread-1 (]: On model.customer360.stg_sf__contacts: Close
[0m18:32:56.239666 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd4c82f8a-5e22-40a3-be75-5c184e203354', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa0914cd290>]}
[0m18:32:56.240426 [info ] [Thread-1 (]: 1 of 4 OK created sql table model public.stg_sf__contacts ...................... [[32mSELECT 10[0m in 0.24s]
[0m18:32:56.243703 [debug] [Thread-1 (]: Finished running node model.customer360.stg_sf__contacts
[0m18:32:56.244253 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.0 seconds
[0m18:32:56.246134 [debug] [Thread-2 (]: Timing info for model.customer360.stg_web__transactions (execute): 18:32:56.012115 => 18:32:56.245842
[0m18:32:56.246650 [debug] [Thread-2 (]: On model.customer360.stg_web__transactions: Close
[0m18:32:56.247556 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd4c82f8a-5e22-40a3-be75-5c184e203354', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa09353b610>]}
[0m18:32:56.248241 [info ] [Thread-2 (]: 2 of 4 OK created sql table model public.stg_web__transactions ................. [[32mSELECT 4[0m in 0.25s]
[0m18:32:56.248983 [debug] [Thread-2 (]: Finished running node model.customer360.stg_web__transactions
[0m18:32:56.251809 [debug] [Thread-3 (]: Began running node model.customer360.contacts_joined_with_transactions
[0m18:32:56.252467 [info ] [Thread-3 (]: 3 of 4 START sql view model public.contacts_joined_with_transactions ........... [RUN]
[0m18:32:56.253452 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.customer360.contacts_joined_with_transactions'
[0m18:32:56.253932 [debug] [Thread-3 (]: Began compiling node model.customer360.contacts_joined_with_transactions
[0m18:32:56.258073 [debug] [Thread-3 (]: Writing injected SQL for node "model.customer360.contacts_joined_with_transactions"
[0m18:32:56.258894 [debug] [Thread-3 (]: Timing info for model.customer360.contacts_joined_with_transactions (compile): 18:32:56.254229 => 18:32:56.258587
[0m18:32:56.259411 [debug] [Thread-3 (]: Began executing node model.customer360.contacts_joined_with_transactions
[0m18:32:56.285852 [debug] [Thread-3 (]: Writing runtime sql for node "model.customer360.contacts_joined_with_transactions"
[0m18:32:56.286680 [debug] [Thread-3 (]: Using postgres connection "model.customer360.contacts_joined_with_transactions"
[0m18:32:56.287111 [debug] [Thread-3 (]: On model.customer360.contacts_joined_with_transactions: BEGIN
[0m18:32:56.287549 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m18:32:56.292275 [debug] [Thread-3 (]: SQL status: BEGIN in 0.0 seconds
[0m18:32:56.292815 [debug] [Thread-3 (]: Using postgres connection "model.customer360.contacts_joined_with_transactions"
[0m18:32:56.293367 [debug] [Thread-3 (]: On model.customer360.contacts_joined_with_transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.contacts_joined_with_transactions"} */

  create view "dbt"."public"."contacts_joined_with_transactions__dbt_tmp"
    
    
  as (
    SELECT 
    contacts.*,
    transactions.id as transaction_id,
    transactions.transaction_date,
    transactions.amount,
    transactions.item_count,
    transactions.category
FROM "dbt"."public"."stg_web__transactions" as transactions
LEFT JOIN "dbt"."public"."stg_sf__contacts" as contacts ON contacts.id = transactions.contact_id
  );
[0m18:32:56.296272 [debug] [Thread-3 (]: SQL status: CREATE VIEW in 0.0 seconds
[0m18:32:56.300769 [debug] [Thread-3 (]: Using postgres connection "model.customer360.contacts_joined_with_transactions"
[0m18:32:56.301289 [debug] [Thread-3 (]: On model.customer360.contacts_joined_with_transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.contacts_joined_with_transactions"} */
alter table "dbt"."public"."contacts_joined_with_transactions__dbt_tmp" rename to "contacts_joined_with_transactions"
[0m18:32:56.302426 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m18:32:56.304746 [debug] [Thread-3 (]: On model.customer360.contacts_joined_with_transactions: COMMIT
[0m18:32:56.305253 [debug] [Thread-3 (]: Using postgres connection "model.customer360.contacts_joined_with_transactions"
[0m18:32:56.305832 [debug] [Thread-3 (]: On model.customer360.contacts_joined_with_transactions: COMMIT
[0m18:32:56.307787 [debug] [Thread-3 (]: SQL status: COMMIT in 0.0 seconds
[0m18:32:56.311361 [debug] [Thread-3 (]: Applying DROP to: "dbt"."public"."contacts_joined_with_transactions__dbt_backup"
[0m18:32:56.315902 [debug] [Thread-3 (]: Using postgres connection "model.customer360.contacts_joined_with_transactions"
[0m18:32:56.316475 [debug] [Thread-3 (]: On model.customer360.contacts_joined_with_transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.contacts_joined_with_transactions"} */
drop view if exists "dbt"."public"."contacts_joined_with_transactions__dbt_backup" cascade
[0m18:32:56.317452 [debug] [Thread-3 (]: SQL status: DROP VIEW in 0.0 seconds
[0m18:32:56.319441 [debug] [Thread-3 (]: Timing info for model.customer360.contacts_joined_with_transactions (execute): 18:32:56.259683 => 18:32:56.319110
[0m18:32:56.320010 [debug] [Thread-3 (]: On model.customer360.contacts_joined_with_transactions: Close
[0m18:32:56.321025 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd4c82f8a-5e22-40a3-be75-5c184e203354', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa0915db110>]}
[0m18:32:56.323884 [info ] [Thread-3 (]: 3 of 4 OK created sql view model public.contacts_joined_with_transactions ...... [[32mCREATE VIEW[0m in 0.07s]
[0m18:32:56.324709 [debug] [Thread-3 (]: Finished running node model.customer360.contacts_joined_with_transactions
[0m18:32:56.330546 [debug] [Thread-2 (]: Began running node model.customer360.customers
[0m18:32:56.331011 [info ] [Thread-2 (]: 4 of 4 START sql table model public.customers .................................. [RUN]
[0m18:32:56.331804 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.customer360.stg_web__transactions, now model.customer360.customers)
[0m18:32:56.332281 [debug] [Thread-2 (]: Began compiling node model.customer360.customers
[0m18:32:56.337212 [debug] [Thread-2 (]: Writing injected SQL for node "model.customer360.customers"
[0m18:32:56.338011 [debug] [Thread-2 (]: Timing info for model.customer360.customers (compile): 18:32:56.332610 => 18:32:56.337711
[0m18:32:56.338786 [debug] [Thread-2 (]: Began executing node model.customer360.customers
[0m18:32:56.344688 [debug] [Thread-2 (]: Writing runtime sql for node "model.customer360.customers"
[0m18:32:56.345614 [debug] [Thread-2 (]: Using postgres connection "model.customer360.customers"
[0m18:32:56.346112 [debug] [Thread-2 (]: On model.customer360.customers: BEGIN
[0m18:32:56.346595 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m18:32:56.350954 [debug] [Thread-2 (]: SQL status: BEGIN in 0.0 seconds
[0m18:32:56.351484 [debug] [Thread-2 (]: Using postgres connection "model.customer360.customers"
[0m18:32:56.351996 [debug] [Thread-2 (]: On model.customer360.customers: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.customers"} */

  
    

  create  table "dbt"."public"."customers__dbt_tmp"
  
  
    as
  
  (
    SELECT
    id,
    gender,
    
    date_part('year', age(current_date, birth_date))
 AS age,
    sum(amount) as total_expense
FROM "dbt"."public"."contacts_joined_with_transactions"
GROUP BY
    1,2,3
  );
  
[0m18:32:56.359514 [debug] [Thread-2 (]: SQL status: SELECT 2 in 0.0 seconds
[0m18:32:56.364234 [debug] [Thread-2 (]: Using postgres connection "model.customer360.customers"
[0m18:32:56.364812 [debug] [Thread-2 (]: On model.customer360.customers: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.customers"} */
alter table "dbt"."public"."customers" rename to "customers__dbt_backup"
[0m18:32:56.365851 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m18:32:56.371793 [debug] [Thread-2 (]: Using postgres connection "model.customer360.customers"
[0m18:32:56.372464 [debug] [Thread-2 (]: On model.customer360.customers: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.customers"} */
alter table "dbt"."public"."customers__dbt_tmp" rename to "customers"
[0m18:32:56.373464 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m18:32:56.376662 [debug] [Thread-2 (]: On model.customer360.customers: COMMIT
[0m18:32:56.377200 [debug] [Thread-2 (]: Using postgres connection "model.customer360.customers"
[0m18:32:56.377700 [debug] [Thread-2 (]: On model.customer360.customers: COMMIT
[0m18:32:56.379345 [debug] [Thread-2 (]: SQL status: COMMIT in 0.0 seconds
[0m18:32:56.382899 [debug] [Thread-2 (]: Applying DROP to: "dbt"."public"."customers__dbt_backup"
[0m18:32:56.384061 [debug] [Thread-2 (]: Using postgres connection "model.customer360.customers"
[0m18:32:56.384621 [debug] [Thread-2 (]: On model.customer360.customers: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.customers"} */
drop table if exists "dbt"."public"."customers__dbt_backup" cascade
[0m18:32:56.387415 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.0 seconds
[0m18:32:56.389418 [debug] [Thread-2 (]: Timing info for model.customer360.customers (execute): 18:32:56.339078 => 18:32:56.389059
[0m18:32:56.389925 [debug] [Thread-2 (]: On model.customer360.customers: Close
[0m18:32:56.390897 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd4c82f8a-5e22-40a3-be75-5c184e203354', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa09139f2d0>]}
[0m18:32:56.391778 [info ] [Thread-2 (]: 4 of 4 OK created sql table model public.customers ............................. [[32mSELECT 2[0m in 0.06s]
[0m18:32:56.394961 [debug] [Thread-2 (]: Finished running node model.customer360.customers
[0m18:32:56.401340 [debug] [MainThread]: Using postgres connection "master"
[0m18:32:56.401833 [debug] [MainThread]: On master: BEGIN
[0m18:32:56.402225 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m18:32:56.407587 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m18:32:56.408147 [debug] [MainThread]: On master: COMMIT
[0m18:32:56.408561 [debug] [MainThread]: Using postgres connection "master"
[0m18:32:56.409012 [debug] [MainThread]: On master: COMMIT
[0m18:32:56.409638 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m18:32:56.410128 [debug] [MainThread]: On master: Close
[0m18:32:56.411079 [debug] [MainThread]: Connection 'master' was properly closed.
[0m18:32:56.411475 [debug] [MainThread]: Connection 'model.customer360.stg_sf__contacts' was properly closed.
[0m18:32:56.411897 [debug] [MainThread]: Connection 'model.customer360.customers' was properly closed.
[0m18:32:56.412259 [debug] [MainThread]: Connection 'model.customer360.contacts_joined_with_transactions' was properly closed.
[0m18:32:56.412789 [info ] [MainThread]: 
[0m18:32:56.413257 [info ] [MainThread]: Finished running 3 table models, 1 view model in 0 hours 0 minutes and 0.48 seconds (0.48s).
[0m18:32:56.414731 [debug] [MainThread]: Command end result
[0m18:32:56.425970 [info ] [MainThread]: 
[0m18:32:56.426601 [info ] [MainThread]: [32mCompleted successfully[0m
[0m18:32:56.427002 [info ] [MainThread]: 
[0m18:32:56.427453 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 TOTAL=4
[0m18:32:56.428266 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 0.79873526, "process_user_time": 2.69328, "process_kernel_time": 0.107452, "process_mem_max_rss": "111184", "process_in_blocks": "40", "process_out_blocks": "1816"}
[0m18:32:56.428760 [debug] [MainThread]: Command `dbt run` succeeded at 18:32:56.428644 after 0.80 seconds
[0m18:32:56.429090 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa09364b2d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa097a41f50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa09366f650>]}
[0m18:32:56.429465 [debug] [MainThread]: Flushing usage events
[0m18:35:13.553979 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fde519233d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fde5181aa10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fde513a40d0>]}


============================== 18:35:13.557136 | a2b0e069-0412-4a18-bbca-5c50bb9b8e98 ==============================
[0m18:35:13.557136 [info ] [MainThread]: Running with dbt=1.7.8
[0m18:35:13.557651 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/root/option1-customer360/integration_tests/logs', 'debug': 'False', 'profiles_dir': '/root/option1-customer360/integration_tests', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'invocation_command': 'dbt build', 'send_anonymous_usage_stats': 'True'}
[0m18:35:13.737207 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a2b0e069-0412-4a18-bbca-5c50bb9b8e98', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fde514af290>]}
[0m18:35:13.858225 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'a2b0e069-0412-4a18-bbca-5c50bb9b8e98', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fde51809110>]}
[0m18:35:13.859160 [info ] [MainThread]: Registered adapter: postgres=1.7.8
[0m18:35:13.876856 [debug] [MainThread]: checksum: 67f0013ca5f0bd43af9a0873dd50792fde83ef69de63b71cacd0b4ac656c52e5, vars: {}, profile: , target: , version: 1.7.8
[0m18:35:13.909278 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m18:35:13.909796 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m18:35:13.916814 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'a2b0e069-0412-4a18-bbca-5c50bb9b8e98', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fde4f575650>]}
[0m18:35:13.926166 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'a2b0e069-0412-4a18-bbca-5c50bb9b8e98', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fde4f6d2090>]}
[0m18:35:13.926613 [info ] [MainThread]: Found 2 seeds, 4 models, 9 tests, 2 sources, 0 exposures, 0 metrics, 403 macros, 0 groups, 0 semantic models
[0m18:35:13.928628 [info ] [MainThread]: 
[0m18:35:13.929323 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m18:35:13.930545 [debug] [ThreadPool]: Acquiring new postgres connection 'list_dbt'
[0m18:35:13.940423 [debug] [ThreadPool]: Using postgres connection "list_dbt"
[0m18:35:13.940756 [debug] [ThreadPool]: On list_dbt: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "connection_name": "list_dbt"} */

    select distinct nspname from pg_namespace
  
[0m18:35:13.941044 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m18:35:13.945599 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.0 seconds
[0m18:35:13.946803 [debug] [ThreadPool]: On list_dbt: Close
[0m18:35:13.948648 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dbt, now list_dbt_public)
[0m18:35:13.954176 [debug] [ThreadPool]: Using postgres connection "list_dbt_public"
[0m18:35:13.954522 [debug] [ThreadPool]: On list_dbt_public: BEGIN
[0m18:35:13.954854 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:35:13.957864 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m18:35:13.958168 [debug] [ThreadPool]: Using postgres connection "list_dbt_public"
[0m18:35:13.958500 [debug] [ThreadPool]: On list_dbt_public: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "connection_name": "list_dbt_public"} */
select
      'dbt' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'dbt' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'dbt' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m18:35:13.961426 [debug] [ThreadPool]: SQL status: SELECT 6 in 0.0 seconds
[0m18:35:13.962617 [debug] [ThreadPool]: On list_dbt_public: ROLLBACK
[0m18:35:13.963093 [debug] [ThreadPool]: On list_dbt_public: Close
[0m18:35:13.968940 [debug] [MainThread]: Using postgres connection "master"
[0m18:35:13.969241 [debug] [MainThread]: On master: BEGIN
[0m18:35:13.969544 [debug] [MainThread]: Opening a new connection, currently in state init
[0m18:35:13.972608 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m18:35:13.972896 [debug] [MainThread]: Using postgres connection "master"
[0m18:35:13.973241 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m18:35:13.983452 [debug] [MainThread]: SQL status: SELECT 2 in 0.0 seconds
[0m18:35:13.984966 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a2b0e069-0412-4a18-bbca-5c50bb9b8e98', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fde512274d0>]}
[0m18:35:13.985366 [debug] [MainThread]: On master: ROLLBACK
[0m18:35:13.985865 [debug] [MainThread]: Using postgres connection "master"
[0m18:35:13.986162 [debug] [MainThread]: On master: BEGIN
[0m18:35:13.986805 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m18:35:13.987082 [debug] [MainThread]: On master: COMMIT
[0m18:35:13.987371 [debug] [MainThread]: Using postgres connection "master"
[0m18:35:13.987631 [debug] [MainThread]: On master: COMMIT
[0m18:35:13.988093 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m18:35:13.988394 [debug] [MainThread]: On master: Close
[0m18:35:13.989189 [info ] [MainThread]: Concurrency: 3 threads (target='local')
[0m18:35:13.989608 [info ] [MainThread]: 
[0m18:35:13.992087 [debug] [Thread-1 (]: Began running node seed.integration_tests.contacts
[0m18:35:13.992502 [debug] [Thread-2 (]: Began running node seed.integration_tests.transactions
[0m18:35:13.992921 [info ] [Thread-1 (]: 1 of 15 START seed file public.contacts ........................................ [RUN]
[0m18:35:13.993415 [info ] [Thread-2 (]: 2 of 15 START seed file public.transactions .................................... [RUN]
[0m18:35:13.993823 [debug] [Thread-3 (]: Began running node test.customer360.macro_test1
[0m18:35:13.994496 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dbt_public, now seed.integration_tests.contacts)
[0m18:35:13.996172 [debug] [Thread-1 (]: Began compiling node seed.integration_tests.contacts
[0m18:35:13.995575 [info ] [Thread-3 (]: 3 of 15 START test macro_test1 ................................................. [RUN]
[0m18:35:13.996640 [debug] [Thread-1 (]: Timing info for seed.integration_tests.contacts (compile): 18:35:13.996412 => 18:35:13.996415
[0m18:35:13.995180 [debug] [Thread-2 (]: Acquiring new postgres connection 'seed.integration_tests.transactions'
[0m18:35:13.997275 [debug] [Thread-3 (]: Acquiring new postgres connection 'test.customer360.macro_test1'
[0m18:35:13.997646 [debug] [Thread-1 (]: Began executing node seed.integration_tests.contacts
[0m18:35:13.998022 [debug] [Thread-2 (]: Began compiling node seed.integration_tests.transactions
[0m18:35:13.998379 [debug] [Thread-3 (]: Began compiling node test.customer360.macro_test1
[0m18:35:14.012972 [debug] [Thread-2 (]: Timing info for seed.integration_tests.transactions (compile): 18:35:14.012733 => 18:35:14.012736
[0m18:35:14.027533 [debug] [Thread-1 (]: Using postgres connection "seed.integration_tests.contacts"
[0m18:35:14.034210 [debug] [Thread-3 (]: Writing injected SQL for node "test.customer360.macro_test1"
[0m18:35:14.034632 [debug] [Thread-2 (]: Began executing node seed.integration_tests.transactions
[0m18:35:14.035018 [debug] [Thread-1 (]: On seed.integration_tests.contacts: BEGIN
[0m18:35:14.037620 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:35:14.041000 [debug] [Thread-2 (]: Using postgres connection "seed.integration_tests.transactions"
[0m18:35:14.042219 [debug] [Thread-2 (]: On seed.integration_tests.transactions: BEGIN
[0m18:35:14.042769 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m18:35:14.041731 [debug] [Thread-3 (]: Timing info for test.customer360.macro_test1 (compile): 18:35:14.027769 => 18:35:14.041453
[0m18:35:14.043761 [debug] [Thread-3 (]: Began executing node test.customer360.macro_test1
[0m18:35:14.058782 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m18:35:14.060599 [debug] [Thread-3 (]: Writing runtime sql for node "test.customer360.macro_test1"
[0m18:35:14.060959 [debug] [Thread-1 (]: Using postgres connection "seed.integration_tests.contacts"
[0m18:35:14.061790 [debug] [Thread-1 (]: On seed.integration_tests.contacts: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "seed.integration_tests.contacts"} */
truncate table "dbt"."public"."contacts"
[0m18:35:14.061322 [debug] [Thread-2 (]: SQL status: BEGIN in 0.0 seconds
[0m18:35:14.062357 [debug] [Thread-2 (]: Using postgres connection "seed.integration_tests.transactions"
[0m18:35:14.062837 [debug] [Thread-2 (]: On seed.integration_tests.transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "seed.integration_tests.transactions"} */
truncate table "dbt"."public"."transactions"
[0m18:35:14.063446 [debug] [Thread-3 (]: Using postgres connection "test.customer360.macro_test1"
[0m18:35:14.063933 [debug] [Thread-3 (]: On test.customer360.macro_test1: BEGIN
[0m18:35:14.064444 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m18:35:14.067244 [debug] [Thread-1 (]: SQL status: TRUNCATE TABLE in 0.0 seconds
[0m18:35:14.074683 [debug] [Thread-2 (]: SQL status: TRUNCATE TABLE in 0.0 seconds
[0m18:35:14.090418 [debug] [Thread-3 (]: SQL status: BEGIN in 0.0 seconds
[0m18:35:14.158140 [debug] [Thread-3 (]: Using postgres connection "test.customer360.macro_test1"
[0m18:35:14.177820 [debug] [Thread-1 (]: Using postgres connection "seed.integration_tests.contacts"
[0m18:35:14.178207 [debug] [Thread-3 (]: On test.customer360.macro_test1: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.macro_test1"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      with marco_result as (
    select 
    date_part('year', age(current_date, '2023-02-12'))
 as expect_result
)
select
    1
from marco_result
where expect_result <> 1
      
    ) dbt_internal_test
[0m18:35:14.198751 [debug] [Thread-1 (]: On seed.integration_tests.contacts: 
          insert into "dbt"."public"."contacts" ("id", "username", "name", "gender", "address", "mail", "birthdate", "_loaded_at_utc") values
          (%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s)
      ...
[0m18:35:14.224723 [debug] [Thread-3 (]: SQL status: SELECT 1 in 0.0 seconds
[0m18:35:14.240681 [debug] [Thread-1 (]: SQL status: INSERT 0 10 in 0.0 seconds
[0m18:35:14.242568 [debug] [Thread-3 (]: Timing info for test.customer360.macro_test1 (execute): 18:35:14.044054 => 18:35:14.242347
[0m18:35:14.277748 [debug] [Thread-3 (]: On test.customer360.macro_test1: ROLLBACK
[0m18:35:14.278211 [debug] [Thread-1 (]: Writing runtime SQL for node "seed.integration_tests.contacts"
[0m18:35:14.288397 [debug] [Thread-2 (]: Using postgres connection "seed.integration_tests.transactions"
[0m18:35:14.293896 [debug] [Thread-2 (]: On seed.integration_tests.transactions: 
          insert into "dbt"."public"."transactions" ("contact_id", "id", "transaction_date", "amount", "item_count", "category", "_loaded_at_utc") values
          (%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%...
[0m18:35:14.299614 [debug] [Thread-3 (]: On test.customer360.macro_test1: Close
[0m18:35:14.304259 [info ] [Thread-3 (]: 3 of 15 PASS macro_test1 ....................................................... [[32mPASS[0m in 0.31s]
[0m18:35:14.305039 [debug] [Thread-3 (]: Finished running node test.customer360.macro_test1
[0m18:35:14.305720 [debug] [Thread-3 (]: Began running node test.customer360.macro_test2
[0m18:35:14.306170 [info ] [Thread-3 (]: 4 of 15 START test macro_test2 ................................................. [RUN]
[0m18:35:14.306932 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.customer360.macro_test1, now test.customer360.macro_test2)
[0m18:35:14.302776 [debug] [Thread-1 (]: On seed.integration_tests.contacts: COMMIT
[0m18:35:14.307414 [debug] [Thread-3 (]: Began compiling node test.customer360.macro_test2
[0m18:35:14.307756 [debug] [Thread-2 (]: SQL status: INSERT 0 74 in 0.0 seconds
[0m18:35:14.308409 [debug] [Thread-1 (]: Using postgres connection "seed.integration_tests.contacts"
[0m18:35:14.312258 [debug] [Thread-3 (]: Writing injected SQL for node "test.customer360.macro_test2"
[0m18:35:14.313053 [debug] [Thread-2 (]: Writing runtime SQL for node "seed.integration_tests.transactions"
[0m18:35:14.313430 [debug] [Thread-1 (]: On seed.integration_tests.contacts: COMMIT
[0m18:35:14.315427 [debug] [Thread-2 (]: On seed.integration_tests.transactions: COMMIT
[0m18:35:14.316435 [debug] [Thread-2 (]: Using postgres connection "seed.integration_tests.transactions"
[0m18:35:14.316882 [debug] [Thread-2 (]: On seed.integration_tests.transactions: COMMIT
[0m18:35:14.316001 [debug] [Thread-3 (]: Timing info for test.customer360.macro_test2 (compile): 18:35:14.308671 => 18:35:14.315668
[0m18:35:14.317286 [debug] [Thread-1 (]: SQL status: COMMIT in 0.0 seconds
[0m18:35:14.318594 [debug] [Thread-1 (]: Timing info for seed.integration_tests.contacts (execute): 18:35:13.998602 => 18:35:14.318410
[0m18:35:14.319078 [debug] [Thread-1 (]: On seed.integration_tests.contacts: Close
[0m18:35:14.317688 [debug] [Thread-3 (]: Began executing node test.customer360.macro_test2
[0m18:35:14.322982 [debug] [Thread-3 (]: Writing runtime sql for node "test.customer360.macro_test2"
[0m18:35:14.320235 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a2b0e069-0412-4a18-bbca-5c50bb9b8e98', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fde4f7be650>]}
[0m18:35:14.319516 [debug] [Thread-2 (]: SQL status: COMMIT in 0.0 seconds
[0m18:35:14.324596 [debug] [Thread-2 (]: Timing info for seed.integration_tests.transactions (execute): 18:35:14.035353 => 18:35:14.324405
[0m18:35:14.325035 [debug] [Thread-2 (]: On seed.integration_tests.transactions: Close
[0m18:35:14.325783 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a2b0e069-0412-4a18-bbca-5c50bb9b8e98', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fde4f4b8e10>]}
[0m18:35:14.326917 [info ] [Thread-2 (]: 2 of 15 OK loaded seed file public.transactions ................................ [[32mINSERT 74[0m in 0.33s]
[0m18:35:14.327623 [debug] [Thread-2 (]: Finished running node seed.integration_tests.transactions
[0m18:35:14.328050 [debug] [Thread-2 (]: Began running node test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247
[0m18:35:14.328552 [info ] [Thread-2 (]: 5 of 15 START test source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors  [RUN]
[0m18:35:14.326345 [debug] [Thread-3 (]: Using postgres connection "test.customer360.macro_test2"
[0m18:35:14.323593 [info ] [Thread-1 (]: 1 of 15 OK loaded seed file public.contacts .................................... [[32mINSERT 10[0m in 0.33s]
[0m18:35:14.329154 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly seed.integration_tests.transactions, now test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247)
[0m18:35:14.329610 [debug] [Thread-3 (]: On test.customer360.macro_test2: BEGIN
[0m18:35:14.330139 [debug] [Thread-1 (]: Finished running node seed.integration_tests.contacts
[0m18:35:14.330548 [debug] [Thread-2 (]: Began compiling node test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247
[0m18:35:14.330901 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m18:35:14.331355 [debug] [Thread-1 (]: Began running node test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d
[0m18:35:14.345637 [debug] [Thread-2 (]: Writing injected SQL for node "test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247"
[0m18:35:14.346137 [info ] [Thread-1 (]: 6 of 15 START test source_not_null_salesforce_contacts_id ...................... [RUN]
[0m18:35:14.347085 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly seed.integration_tests.contacts, now test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d)
[0m18:35:14.347501 [debug] [Thread-3 (]: SQL status: BEGIN in 0.0 seconds
[0m18:35:14.348235 [debug] [Thread-3 (]: Using postgres connection "test.customer360.macro_test2"
[0m18:35:14.348637 [debug] [Thread-3 (]: On test.customer360.macro_test2: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.macro_test2"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      with marco_result as (
    select 
        to_timestamp('2023-02-27 21:00:00','YYYY-MM-DD HH24:MI:SS.MS') :: timestamp at TIME zone 'UTC'
     as expect_result
)
select
    1
from marco_result
where cast(pg_typeof(expect_result) as text) not like '%timestamp%'
      
    ) dbt_internal_test
[0m18:35:14.347836 [debug] [Thread-1 (]: Began compiling node test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d
[0m18:35:14.349271 [debug] [Thread-2 (]: Timing info for test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247 (compile): 18:35:14.331728 => 18:35:14.349005
[0m18:35:14.356008 [debug] [Thread-1 (]: Writing injected SQL for node "test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d"
[0m18:35:14.356436 [debug] [Thread-2 (]: Began executing node test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247
[0m18:35:14.356800 [debug] [Thread-3 (]: SQL status: SELECT 1 in 0.0 seconds
[0m18:35:14.357483 [debug] [Thread-1 (]: Timing info for test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d (compile): 18:35:14.349574 => 18:35:14.357252
[0m18:35:14.359619 [debug] [Thread-2 (]: Writing runtime sql for node "test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247"
[0m18:35:14.361012 [debug] [Thread-3 (]: Timing info for test.customer360.macro_test2 (execute): 18:35:14.320478 => 18:35:14.360808
[0m18:35:14.361894 [debug] [Thread-3 (]: On test.customer360.macro_test2: ROLLBACK
[0m18:35:14.361405 [debug] [Thread-1 (]: Began executing node test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d
[0m18:35:14.362463 [debug] [Thread-2 (]: Using postgres connection "test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247"
[0m18:35:14.362875 [debug] [Thread-3 (]: On test.customer360.macro_test2: Close
[0m18:35:14.364867 [debug] [Thread-1 (]: Writing runtime sql for node "test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d"
[0m18:35:14.365262 [debug] [Thread-2 (]: On test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247: BEGIN
[0m18:35:14.367391 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m18:35:14.366253 [info ] [Thread-3 (]: 4 of 15 PASS macro_test2 ....................................................... [[32mPASS[0m in 0.06s]
[0m18:35:14.368563 [debug] [Thread-3 (]: Finished running node test.customer360.macro_test2
[0m18:35:14.369119 [debug] [Thread-3 (]: Began running node test.customer360.source_not_null_web_transactions_id.88a47bf7e5
[0m18:35:14.369636 [info ] [Thread-3 (]: 7 of 15 START test source_not_null_web_transactions_id ......................... [RUN]
[0m18:35:14.370462 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.customer360.macro_test2, now test.customer360.source_not_null_web_transactions_id.88a47bf7e5)
[0m18:35:14.371202 [debug] [Thread-1 (]: Using postgres connection "test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d"
[0m18:35:14.372005 [debug] [Thread-1 (]: On test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d: BEGIN
[0m18:35:14.372414 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:35:14.371571 [debug] [Thread-3 (]: Began compiling node test.customer360.source_not_null_web_transactions_id.88a47bf7e5
[0m18:35:14.373061 [debug] [Thread-2 (]: SQL status: BEGIN in 0.0 seconds
[0m18:35:14.378865 [debug] [Thread-3 (]: Writing injected SQL for node "test.customer360.source_not_null_web_transactions_id.88a47bf7e5"
[0m18:35:14.380093 [debug] [Thread-3 (]: Timing info for test.customer360.source_not_null_web_transactions_id.88a47bf7e5 (compile): 18:35:14.373472 => 18:35:14.379815
[0m18:35:14.380519 [debug] [Thread-3 (]: Began executing node test.customer360.source_not_null_web_transactions_id.88a47bf7e5
[0m18:35:14.379423 [debug] [Thread-2 (]: Using postgres connection "test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247"
[0m18:35:14.380942 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m18:35:14.383086 [debug] [Thread-3 (]: Writing runtime sql for node "test.customer360.source_not_null_web_transactions_id.88a47bf7e5"
[0m18:35:14.383520 [debug] [Thread-2 (]: On test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

with all_values as (

    select
        category as value_field,
        count(*) as n_records

    from "dbt"."public"."transactions"
    group by category

)

select *
from all_values
where value_field not in (
    'Apps & Games','Beauty','Books','Clothing, Shoes & Accessories','Movies & TV','Sports, Fitness & Outdoors'
)



      
    ) dbt_internal_test
[0m18:35:14.383922 [debug] [Thread-1 (]: Using postgres connection "test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d"
[0m18:35:14.384570 [debug] [Thread-1 (]: On test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select id
from "dbt"."public"."contacts"
where id is null



      
    ) dbt_internal_test
[0m18:35:14.385130 [debug] [Thread-3 (]: Using postgres connection "test.customer360.source_not_null_web_transactions_id.88a47bf7e5"
[0m18:35:14.385624 [debug] [Thread-3 (]: On test.customer360.source_not_null_web_transactions_id.88a47bf7e5: BEGIN
[0m18:35:14.386075 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m18:35:14.387457 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.0 seconds
[0m18:35:14.389841 [debug] [Thread-1 (]: Timing info for test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d (execute): 18:35:14.363098 => 18:35:14.389607
[0m18:35:14.390314 [debug] [Thread-1 (]: On test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d: ROLLBACK
[0m18:35:14.387964 [debug] [Thread-2 (]: SQL status: SELECT 1 in 0.0 seconds
[0m18:35:14.391687 [debug] [Thread-2 (]: Timing info for test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247 (execute): 18:35:14.357682 => 18:35:14.391473
[0m18:35:14.392508 [debug] [Thread-2 (]: On test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247: ROLLBACK
[0m18:35:14.392989 [debug] [Thread-3 (]: SQL status: BEGIN in 0.0 seconds
[0m18:35:14.392062 [debug] [Thread-1 (]: On test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d: Close
[0m18:35:14.393361 [debug] [Thread-2 (]: On test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247: Close
[0m18:35:14.394775 [info ] [Thread-2 (]: 5 of 15 PASS source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors  [[32mPASS[0m in 0.07s]
[0m18:35:14.395515 [debug] [Thread-2 (]: Finished running node test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247
[0m18:35:14.396092 [debug] [Thread-2 (]: Began running node test.customer360.source_unique_salesforce_contacts_id.01cadaaf43
[0m18:35:14.396607 [info ] [Thread-2 (]: 8 of 15 START test source_unique_salesforce_contacts_id ........................ [RUN]
[0m18:35:14.397416 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247, now test.customer360.source_unique_salesforce_contacts_id.01cadaaf43)
[0m18:35:14.397903 [debug] [Thread-2 (]: Began compiling node test.customer360.source_unique_salesforce_contacts_id.01cadaaf43
[0m18:35:14.393721 [debug] [Thread-3 (]: Using postgres connection "test.customer360.source_not_null_web_transactions_id.88a47bf7e5"
[0m18:35:14.398592 [info ] [Thread-1 (]: 6 of 15 PASS source_not_null_salesforce_contacts_id ............................ [[32mPASS[0m in 0.05s]
[0m18:35:14.404789 [debug] [Thread-2 (]: Writing injected SQL for node "test.customer360.source_unique_salesforce_contacts_id.01cadaaf43"
[0m18:35:14.405195 [debug] [Thread-3 (]: On test.customer360.source_not_null_web_transactions_id.88a47bf7e5: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.source_not_null_web_transactions_id.88a47bf7e5"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select id
from "dbt"."public"."transactions"
where id is null



      
    ) dbt_internal_test
[0m18:35:14.405752 [debug] [Thread-1 (]: Finished running node test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d
[0m18:35:14.406386 [debug] [Thread-1 (]: Began running node test.customer360.source_unique_web_transactions_id.ba28079761
[0m18:35:14.406871 [info ] [Thread-1 (]: 9 of 15 START test source_unique_web_transactions_id ........................... [RUN]
[0m18:35:14.407688 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d, now test.customer360.source_unique_web_transactions_id.ba28079761)
[0m18:35:14.408156 [debug] [Thread-1 (]: Began compiling node test.customer360.source_unique_web_transactions_id.ba28079761
[0m18:35:14.408638 [debug] [Thread-2 (]: Timing info for test.customer360.source_unique_salesforce_contacts_id.01cadaaf43 (compile): 18:35:14.398888 => 18:35:14.408390
[0m18:35:14.409022 [debug] [Thread-3 (]: SQL status: SELECT 1 in 0.0 seconds
[0m18:35:14.412688 [debug] [Thread-1 (]: Writing injected SQL for node "test.customer360.source_unique_web_transactions_id.ba28079761"
[0m18:35:14.413088 [debug] [Thread-2 (]: Began executing node test.customer360.source_unique_salesforce_contacts_id.01cadaaf43
[0m18:35:14.414420 [debug] [Thread-3 (]: Timing info for test.customer360.source_not_null_web_transactions_id.88a47bf7e5 (execute): 18:35:14.381200 => 18:35:14.414202
[0m18:35:14.416639 [debug] [Thread-2 (]: Writing runtime sql for node "test.customer360.source_unique_salesforce_contacts_id.01cadaaf43"
[0m18:35:14.417809 [debug] [Thread-2 (]: Using postgres connection "test.customer360.source_unique_salesforce_contacts_id.01cadaaf43"
[0m18:35:14.417094 [debug] [Thread-3 (]: On test.customer360.source_not_null_web_transactions_id.88a47bf7e5: ROLLBACK
[0m18:35:14.418186 [debug] [Thread-2 (]: On test.customer360.source_unique_salesforce_contacts_id.01cadaaf43: BEGIN
[0m18:35:14.419078 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m18:35:14.418589 [debug] [Thread-1 (]: Timing info for test.customer360.source_unique_web_transactions_id.ba28079761 (compile): 18:35:14.409229 => 18:35:14.418403
[0m18:35:14.419986 [debug] [Thread-1 (]: Began executing node test.customer360.source_unique_web_transactions_id.ba28079761
[0m18:35:14.419466 [debug] [Thread-3 (]: On test.customer360.source_not_null_web_transactions_id.88a47bf7e5: Close
[0m18:35:14.423590 [info ] [Thread-3 (]: 7 of 15 PASS source_not_null_web_transactions_id ............................... [[32mPASS[0m in 0.05s]
[0m18:35:14.422485 [debug] [Thread-1 (]: Writing runtime sql for node "test.customer360.source_unique_web_transactions_id.ba28079761"
[0m18:35:14.425953 [debug] [Thread-1 (]: Using postgres connection "test.customer360.source_unique_web_transactions_id.ba28079761"
[0m18:35:14.426317 [debug] [Thread-1 (]: On test.customer360.source_unique_web_transactions_id.ba28079761: BEGIN
[0m18:35:14.426662 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:35:14.425227 [debug] [Thread-3 (]: Finished running node test.customer360.source_not_null_web_transactions_id.88a47bf7e5
[0m18:35:14.427612 [debug] [Thread-3 (]: Began running node test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344
[0m18:35:14.428178 [info ] [Thread-3 (]: 10 of 15 START test source_relationships_web_transactions_contact_id__id__ref_contacts_  [RUN]
[0m18:35:14.428886 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.customer360.source_not_null_web_transactions_id.88a47bf7e5, now test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344)
[0m18:35:14.429223 [debug] [Thread-3 (]: Began compiling node test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344
[0m18:35:14.437749 [debug] [Thread-3 (]: Writing injected SQL for node "test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344"
[0m18:35:14.438145 [debug] [Thread-2 (]: SQL status: BEGIN in 0.0 seconds
[0m18:35:14.438543 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m18:35:14.438990 [debug] [Thread-2 (]: Using postgres connection "test.customer360.source_unique_salesforce_contacts_id.01cadaaf43"
[0m18:35:14.439868 [debug] [Thread-2 (]: On test.customer360.source_unique_salesforce_contacts_id.01cadaaf43: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.source_unique_salesforce_contacts_id.01cadaaf43"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

select
    id as unique_field,
    count(*) as n_records

from "dbt"."public"."contacts"
where id is not null
group by id
having count(*) > 1



      
    ) dbt_internal_test
[0m18:35:14.439376 [debug] [Thread-1 (]: Using postgres connection "test.customer360.source_unique_web_transactions_id.ba28079761"
[0m18:35:14.440396 [debug] [Thread-3 (]: Timing info for test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344 (compile): 18:35:14.429511 => 18:35:14.440142
[0m18:35:14.441271 [debug] [Thread-3 (]: Began executing node test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344
[0m18:35:14.440807 [debug] [Thread-1 (]: On test.customer360.source_unique_web_transactions_id.ba28079761: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.source_unique_web_transactions_id.ba28079761"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

select
    id as unique_field,
    count(*) as n_records

from "dbt"."public"."transactions"
where id is not null
group by id
having count(*) > 1



      
    ) dbt_internal_test
[0m18:35:14.443855 [debug] [Thread-3 (]: Writing runtime sql for node "test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344"
[0m18:35:14.444213 [debug] [Thread-2 (]: SQL status: SELECT 1 in 0.0 seconds
[0m18:35:14.446176 [debug] [Thread-2 (]: Timing info for test.customer360.source_unique_salesforce_contacts_id.01cadaaf43 (execute): 18:35:14.414761 => 18:35:14.445935
[0m18:35:14.446912 [debug] [Thread-2 (]: On test.customer360.source_unique_salesforce_contacts_id.01cadaaf43: ROLLBACK
[0m18:35:14.446589 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.0 seconds
[0m18:35:14.447347 [debug] [Thread-3 (]: Using postgres connection "test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344"
[0m18:35:14.449170 [debug] [Thread-3 (]: On test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344: BEGIN
[0m18:35:14.448636 [debug] [Thread-1 (]: Timing info for test.customer360.source_unique_web_transactions_id.ba28079761 (execute): 18:35:14.420289 => 18:35:14.448439
[0m18:35:14.449559 [debug] [Thread-2 (]: On test.customer360.source_unique_salesforce_contacts_id.01cadaaf43: Close
[0m18:35:14.449882 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m18:35:14.450248 [debug] [Thread-1 (]: On test.customer360.source_unique_web_transactions_id.ba28079761: ROLLBACK
[0m18:35:14.451177 [info ] [Thread-2 (]: 8 of 15 PASS source_unique_salesforce_contacts_id .............................. [[32mPASS[0m in 0.05s]
[0m18:35:14.452575 [debug] [Thread-2 (]: Finished running node test.customer360.source_unique_salesforce_contacts_id.01cadaaf43
[0m18:35:14.453142 [debug] [Thread-1 (]: On test.customer360.source_unique_web_transactions_id.ba28079761: Close
[0m18:35:14.454653 [info ] [Thread-1 (]: 9 of 15 PASS source_unique_web_transactions_id ................................. [[32mPASS[0m in 0.05s]
[0m18:35:14.455323 [debug] [Thread-1 (]: Finished running node test.customer360.source_unique_web_transactions_id.ba28079761
[0m18:35:14.453772 [debug] [Thread-2 (]: Began running node model.customer360.stg_sf__contacts
[0m18:35:14.456265 [info ] [Thread-2 (]: 11 of 15 START sql table model public.stg_sf__contacts ......................... [RUN]
[0m18:35:14.456760 [debug] [Thread-1 (]: Began running node model.customer360.stg_web__transactions
[0m18:35:14.457388 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.customer360.source_unique_salesforce_contacts_id.01cadaaf43, now model.customer360.stg_sf__contacts)
[0m18:35:14.459013 [debug] [Thread-2 (]: Began compiling node model.customer360.stg_sf__contacts
[0m18:35:14.458499 [info ] [Thread-1 (]: 12 of 15 START sql table model public.stg_web__transactions .................... [RUN]
[0m18:35:14.461849 [debug] [Thread-2 (]: Writing injected SQL for node "model.customer360.stg_sf__contacts"
[0m18:35:14.462203 [debug] [Thread-3 (]: SQL status: BEGIN in 0.0 seconds
[0m18:35:14.463288 [debug] [Thread-3 (]: Using postgres connection "test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344"
[0m18:35:14.463776 [debug] [Thread-3 (]: On test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

with child as (
    select contact_id as from_field
    from "dbt"."public"."transactions"
    where contact_id is not null
),

parent as (
    select id as to_field
    from "dbt"."public"."contacts"
)

select
    from_field

from child
left join parent
    on child.from_field = parent.to_field

where parent.to_field is null



      
    ) dbt_internal_test
[0m18:35:14.462790 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.customer360.source_unique_web_transactions_id.ba28079761, now model.customer360.stg_web__transactions)
[0m18:35:14.464855 [debug] [Thread-1 (]: Began compiling node model.customer360.stg_web__transactions
[0m18:35:14.468002 [debug] [Thread-1 (]: Writing injected SQL for node "model.customer360.stg_web__transactions"
[0m18:35:14.464312 [debug] [Thread-2 (]: Timing info for model.customer360.stg_sf__contacts (compile): 18:35:14.459225 => 18:35:14.464093
[0m18:35:14.468432 [debug] [Thread-3 (]: SQL status: SELECT 1 in 0.0 seconds
[0m18:35:14.468920 [debug] [Thread-2 (]: Began executing node model.customer360.stg_sf__contacts
[0m18:35:14.470246 [debug] [Thread-3 (]: Timing info for test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344 (execute): 18:35:14.441578 => 18:35:14.470040
[0m18:35:14.493554 [debug] [Thread-3 (]: On test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344: ROLLBACK
[0m18:35:14.504165 [debug] [Thread-2 (]: Writing runtime sql for node "model.customer360.stg_sf__contacts"
[0m18:35:14.504694 [debug] [Thread-1 (]: Timing info for model.customer360.stg_web__transactions (compile): 18:35:14.465158 => 18:35:14.504481
[0m18:35:14.505554 [debug] [Thread-1 (]: Began executing node model.customer360.stg_web__transactions
[0m18:35:14.505039 [debug] [Thread-3 (]: On test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344: Close
[0m18:35:14.510660 [debug] [Thread-1 (]: Writing runtime sql for node "model.customer360.stg_web__transactions"
[0m18:35:14.512793 [debug] [Thread-1 (]: Using postgres connection "model.customer360.stg_web__transactions"
[0m18:35:14.512155 [info ] [Thread-3 (]: 10 of 15 PASS source_relationships_web_transactions_contact_id__id__ref_contacts_  [[32mPASS[0m in 0.08s]
[0m18:35:14.513869 [debug] [Thread-3 (]: Finished running node test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344
[0m18:35:14.513220 [debug] [Thread-1 (]: On model.customer360.stg_web__transactions: BEGIN
[0m18:35:14.514395 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:35:14.511148 [debug] [Thread-2 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m18:35:14.515374 [debug] [Thread-2 (]: On model.customer360.stg_sf__contacts: BEGIN
[0m18:35:14.515721 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m18:35:14.518891 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m18:35:14.519382 [debug] [Thread-1 (]: Using postgres connection "model.customer360.stg_web__transactions"
[0m18:35:14.519754 [debug] [Thread-1 (]: On model.customer360.stg_web__transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_web__transactions"} */

  
    

  create  table "dbt"."public"."stg_web__transactions__dbt_tmp"
  
  
    as
  
  (
    with source as (
    select * from "dbt"."public"."transactions"
),

renamed as (
    select
        id,
        contact_id,
        
        to_timestamp(transaction_date,'YYYY-MM-DD HH24:MI:SS.MS') :: timestamp at TIME zone 'UTC'
     as transaction_date,
        amount,
        item_count,
        category, 
        _loaded_at_utc
    from source    
),

clean_older as (
    select * from renamed 
--    where transaction_date >= (current_date - 1)  过滤超过1天的数据
    where transaction_date >= (to_date('2023-04-12','yyyy-MM-dd') - 1)  --测试用,假设跑数日期为2023-04-12
    and transaction_date < to_date('2023-04-12','yyyy-MM-dd')
)

select * from clean_older
  );
  
[0m18:35:14.522017 [debug] [Thread-2 (]: SQL status: BEGIN in 0.0 seconds
[0m18:35:14.522513 [debug] [Thread-2 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m18:35:14.522878 [debug] [Thread-2 (]: On model.customer360.stg_sf__contacts: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_sf__contacts"} */

  
    

  create  table "dbt"."public"."stg_sf__contacts__dbt_tmp"
  
  
    as
  
  (
    with source as (
    select * from "dbt"."public"."contacts"
),

renamed as (
    select
        id,
        username as user_name,
        name,
        gender,
        address, 
        mail as email_address,
        birthdate as birth_date,
        _loaded_at_utc
    from source     
)

select * from renamed
  );
  
[0m18:35:14.526047 [debug] [Thread-1 (]: SQL status: SELECT 4 in 0.0 seconds
[0m18:35:14.532048 [debug] [Thread-1 (]: Using postgres connection "model.customer360.stg_web__transactions"
[0m18:35:14.532431 [debug] [Thread-2 (]: SQL status: SELECT 10 in 0.0 seconds
[0m18:35:14.532782 [debug] [Thread-1 (]: On model.customer360.stg_web__transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_web__transactions"} */
alter table "dbt"."public"."stg_web__transactions" rename to "stg_web__transactions__dbt_backup"
[0m18:35:14.535520 [debug] [Thread-2 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m18:35:14.536019 [debug] [Thread-2 (]: On model.customer360.stg_sf__contacts: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_sf__contacts"} */
alter table "dbt"."public"."stg_sf__contacts" rename to "stg_sf__contacts__dbt_backup"
[0m18:35:14.536484 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m18:35:14.539111 [debug] [Thread-1 (]: Using postgres connection "model.customer360.stg_web__transactions"
[0m18:35:14.539531 [debug] [Thread-1 (]: On model.customer360.stg_web__transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_web__transactions"} */
alter table "dbt"."public"."stg_web__transactions__dbt_tmp" rename to "stg_web__transactions"
[0m18:35:14.539960 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m18:35:14.542709 [debug] [Thread-2 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m18:35:14.543103 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m18:35:14.543442 [debug] [Thread-2 (]: On model.customer360.stg_sf__contacts: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_sf__contacts"} */
alter table "dbt"."public"."stg_sf__contacts__dbt_tmp" rename to "stg_sf__contacts"
[0m18:35:14.549922 [debug] [Thread-1 (]: On model.customer360.stg_web__transactions: COMMIT
[0m18:35:14.550423 [debug] [Thread-1 (]: Using postgres connection "model.customer360.stg_web__transactions"
[0m18:35:14.550798 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m18:35:14.551169 [debug] [Thread-1 (]: On model.customer360.stg_web__transactions: COMMIT
[0m18:35:14.553039 [debug] [Thread-2 (]: On model.customer360.stg_sf__contacts: COMMIT
[0m18:35:14.553530 [debug] [Thread-2 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m18:35:14.553849 [debug] [Thread-2 (]: On model.customer360.stg_sf__contacts: COMMIT
[0m18:35:14.555232 [debug] [Thread-1 (]: SQL status: COMMIT in 0.0 seconds
[0m18:35:14.561619 [debug] [Thread-1 (]: Applying DROP to: "dbt"."public"."stg_web__transactions__dbt_backup"
[0m18:35:14.562034 [debug] [Thread-2 (]: SQL status: COMMIT in 0.0 seconds
[0m18:35:14.566459 [debug] [Thread-1 (]: Using postgres connection "model.customer360.stg_web__transactions"
[0m18:35:14.568817 [debug] [Thread-2 (]: Applying DROP to: "dbt"."public"."stg_sf__contacts__dbt_backup"
[0m18:35:14.569194 [debug] [Thread-1 (]: On model.customer360.stg_web__transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_web__transactions"} */
drop table if exists "dbt"."public"."stg_web__transactions__dbt_backup" cascade
[0m18:35:14.569994 [debug] [Thread-2 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m18:35:14.570446 [debug] [Thread-2 (]: On model.customer360.stg_sf__contacts: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_sf__contacts"} */
drop table if exists "dbt"."public"."stg_sf__contacts__dbt_backup" cascade
[0m18:35:14.573561 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.0 seconds
[0m18:35:14.575209 [debug] [Thread-1 (]: Timing info for model.customer360.stg_web__transactions (execute): 18:35:14.505781 => 18:35:14.575012
[0m18:35:14.575609 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.0 seconds
[0m18:35:14.575971 [debug] [Thread-1 (]: On model.customer360.stg_web__transactions: Close
[0m18:35:14.577195 [debug] [Thread-2 (]: Timing info for model.customer360.stg_sf__contacts (execute): 18:35:14.470569 => 18:35:14.577015
[0m18:35:14.577678 [debug] [Thread-2 (]: On model.customer360.stg_sf__contacts: Close
[0m18:35:14.578574 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a2b0e069-0412-4a18-bbca-5c50bb9b8e98', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fde4f4fda50>]}
[0m18:35:14.579209 [info ] [Thread-2 (]: 11 of 15 OK created sql table model public.stg_sf__contacts .................... [[32mSELECT 10[0m in 0.12s]
[0m18:35:14.579847 [debug] [Thread-2 (]: Finished running node model.customer360.stg_sf__contacts
[0m18:35:14.580523 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a2b0e069-0412-4a18-bbca-5c50bb9b8e98', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fde4f528f10>]}
[0m18:35:14.582159 [info ] [Thread-1 (]: 12 of 15 OK created sql table model public.stg_web__transactions ............... [[32mSELECT 4[0m in 0.12s]
[0m18:35:14.582669 [debug] [Thread-1 (]: Finished running node model.customer360.stg_web__transactions
[0m18:35:14.583532 [debug] [Thread-3 (]: Began running node model.customer360.contacts_joined_with_transactions
[0m18:35:14.583960 [info ] [Thread-3 (]: 13 of 15 START sql view model public.contacts_joined_with_transactions ......... [RUN]
[0m18:35:14.584542 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344, now model.customer360.contacts_joined_with_transactions)
[0m18:35:14.584878 [debug] [Thread-3 (]: Began compiling node model.customer360.contacts_joined_with_transactions
[0m18:35:14.587465 [debug] [Thread-3 (]: Writing injected SQL for node "model.customer360.contacts_joined_with_transactions"
[0m18:35:14.588068 [debug] [Thread-3 (]: Timing info for model.customer360.contacts_joined_with_transactions (compile): 18:35:14.585072 => 18:35:14.587801
[0m18:35:14.588454 [debug] [Thread-3 (]: Began executing node model.customer360.contacts_joined_with_transactions
[0m18:35:14.607420 [debug] [Thread-3 (]: Writing runtime sql for node "model.customer360.contacts_joined_with_transactions"
[0m18:35:14.608241 [debug] [Thread-3 (]: Using postgres connection "model.customer360.contacts_joined_with_transactions"
[0m18:35:14.608842 [debug] [Thread-3 (]: On model.customer360.contacts_joined_with_transactions: BEGIN
[0m18:35:14.609969 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m18:35:14.613750 [debug] [Thread-3 (]: SQL status: BEGIN in 0.0 seconds
[0m18:35:14.614098 [debug] [Thread-3 (]: Using postgres connection "model.customer360.contacts_joined_with_transactions"
[0m18:35:14.614478 [debug] [Thread-3 (]: On model.customer360.contacts_joined_with_transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.contacts_joined_with_transactions"} */

  create view "dbt"."public"."contacts_joined_with_transactions__dbt_tmp"
    
    
  as (
    SELECT 
    contacts.*,
    transactions.id as transaction_id,
    transactions.transaction_date,
    transactions.amount,
    transactions.item_count,
    transactions.category
FROM "dbt"."public"."stg_web__transactions" as transactions
LEFT JOIN "dbt"."public"."stg_sf__contacts" as contacts ON contacts.id = transactions.contact_id
  );
[0m18:35:14.616494 [debug] [Thread-3 (]: SQL status: CREATE VIEW in 0.0 seconds
[0m18:35:14.619534 [debug] [Thread-3 (]: Using postgres connection "model.customer360.contacts_joined_with_transactions"
[0m18:35:14.619944 [debug] [Thread-3 (]: On model.customer360.contacts_joined_with_transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.contacts_joined_with_transactions"} */
alter table "dbt"."public"."contacts_joined_with_transactions__dbt_tmp" rename to "contacts_joined_with_transactions"
[0m18:35:14.620768 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m18:35:14.622239 [debug] [Thread-3 (]: On model.customer360.contacts_joined_with_transactions: COMMIT
[0m18:35:14.622604 [debug] [Thread-3 (]: Using postgres connection "model.customer360.contacts_joined_with_transactions"
[0m18:35:14.622914 [debug] [Thread-3 (]: On model.customer360.contacts_joined_with_transactions: COMMIT
[0m18:35:14.624343 [debug] [Thread-3 (]: SQL status: COMMIT in 0.0 seconds
[0m18:35:14.626577 [debug] [Thread-3 (]: Applying DROP to: "dbt"."public"."contacts_joined_with_transactions__dbt_backup"
[0m18:35:14.630705 [debug] [Thread-3 (]: Using postgres connection "model.customer360.contacts_joined_with_transactions"
[0m18:35:14.631043 [debug] [Thread-3 (]: On model.customer360.contacts_joined_with_transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.contacts_joined_with_transactions"} */
drop view if exists "dbt"."public"."contacts_joined_with_transactions__dbt_backup" cascade
[0m18:35:14.631736 [debug] [Thread-3 (]: SQL status: DROP VIEW in 0.0 seconds
[0m18:35:14.633448 [debug] [Thread-3 (]: Timing info for model.customer360.contacts_joined_with_transactions (execute): 18:35:14.588658 => 18:35:14.633119
[0m18:35:14.633942 [debug] [Thread-3 (]: On model.customer360.contacts_joined_with_transactions: Close
[0m18:35:14.634839 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a2b0e069-0412-4a18-bbca-5c50bb9b8e98', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fde4c1e7e10>]}
[0m18:35:14.635529 [info ] [Thread-3 (]: 13 of 15 OK created sql view model public.contacts_joined_with_transactions .... [[32mCREATE VIEW[0m in 0.05s]
[0m18:35:14.636251 [debug] [Thread-3 (]: Finished running node model.customer360.contacts_joined_with_transactions
[0m18:35:14.637360 [debug] [Thread-1 (]: Began running node test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311
[0m18:35:14.637847 [info ] [Thread-1 (]: 14 of 15 START test not_null_contacts_joined_with_transactions_id .............. [RUN]
[0m18:35:14.638633 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.customer360.stg_web__transactions, now test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311)
[0m18:35:14.639077 [debug] [Thread-1 (]: Began compiling node test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311
[0m18:35:14.644801 [debug] [Thread-1 (]: Writing injected SQL for node "test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311"
[0m18:35:14.645615 [debug] [Thread-1 (]: Timing info for test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311 (compile): 18:35:14.639492 => 18:35:14.645282
[0m18:35:14.646084 [debug] [Thread-1 (]: Began executing node test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311
[0m18:35:14.648812 [debug] [Thread-1 (]: Writing runtime sql for node "test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311"
[0m18:35:14.649446 [debug] [Thread-1 (]: Using postgres connection "test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311"
[0m18:35:14.649913 [debug] [Thread-1 (]: On test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311: BEGIN
[0m18:35:14.650381 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:35:14.681876 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m18:35:14.682519 [debug] [Thread-1 (]: Using postgres connection "test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311"
[0m18:35:14.683785 [debug] [Thread-1 (]: On test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select id
from "dbt"."public"."contacts_joined_with_transactions"
where id is null



      
    ) dbt_internal_test
[0m18:35:14.687216 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.0 seconds
[0m18:35:14.689634 [debug] [Thread-1 (]: Timing info for test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311 (execute): 18:35:14.646392 => 18:35:14.689308
[0m18:35:14.690218 [debug] [Thread-1 (]: On test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311: ROLLBACK
[0m18:35:14.692660 [debug] [Thread-1 (]: On test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311: Close
[0m18:35:14.693778 [info ] [Thread-1 (]: 14 of 15 PASS not_null_contacts_joined_with_transactions_id .................... [[32mPASS[0m in 0.06s]
[0m18:35:14.696527 [debug] [Thread-1 (]: Finished running node test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311
[0m18:35:14.697949 [debug] [Thread-3 (]: Began running node model.customer360.customers
[0m18:35:14.698540 [info ] [Thread-3 (]: 15 of 15 START sql table model public.customers ................................ [RUN]
[0m18:35:14.699423 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.customer360.contacts_joined_with_transactions, now model.customer360.customers)
[0m18:35:14.699895 [debug] [Thread-3 (]: Began compiling node model.customer360.customers
[0m18:35:14.703835 [debug] [Thread-3 (]: Writing injected SQL for node "model.customer360.customers"
[0m18:35:14.707659 [debug] [Thread-3 (]: Timing info for model.customer360.customers (compile): 18:35:14.700198 => 18:35:14.707314
[0m18:35:14.708198 [debug] [Thread-3 (]: Began executing node model.customer360.customers
[0m18:35:14.714556 [debug] [Thread-3 (]: Writing runtime sql for node "model.customer360.customers"
[0m18:35:14.715272 [debug] [Thread-3 (]: Using postgres connection "model.customer360.customers"
[0m18:35:14.715819 [debug] [Thread-3 (]: On model.customer360.customers: BEGIN
[0m18:35:14.716283 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m18:35:14.752902 [debug] [Thread-3 (]: SQL status: BEGIN in 0.0 seconds
[0m18:35:14.753592 [debug] [Thread-3 (]: Using postgres connection "model.customer360.customers"
[0m18:35:14.754122 [debug] [Thread-3 (]: On model.customer360.customers: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.customers"} */

  
    

  create  table "dbt"."public"."customers__dbt_tmp"
  
  
    as
  
  (
    SELECT
    id,
    gender,
    
    date_part('year', age(current_date, birth_date))
 AS age,
    sum(amount) as total_expense
FROM "dbt"."public"."contacts_joined_with_transactions"
GROUP BY
    1,2,3
  );
  
[0m18:35:14.783242 [debug] [Thread-3 (]: SQL status: SELECT 2 in 0.0 seconds
[0m18:35:14.787852 [debug] [Thread-3 (]: Using postgres connection "model.customer360.customers"
[0m18:35:14.788435 [debug] [Thread-3 (]: On model.customer360.customers: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.customers"} */
alter table "dbt"."public"."customers" rename to "customers__dbt_backup"
[0m18:35:14.791033 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m18:35:14.795319 [debug] [Thread-3 (]: Using postgres connection "model.customer360.customers"
[0m18:35:14.795863 [debug] [Thread-3 (]: On model.customer360.customers: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.customers"} */
alter table "dbt"."public"."customers__dbt_tmp" rename to "customers"
[0m18:35:14.805583 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m18:35:14.809467 [debug] [Thread-3 (]: On model.customer360.customers: COMMIT
[0m18:35:14.810040 [debug] [Thread-3 (]: Using postgres connection "model.customer360.customers"
[0m18:35:14.810521 [debug] [Thread-3 (]: On model.customer360.customers: COMMIT
[0m18:35:14.813250 [debug] [Thread-3 (]: SQL status: COMMIT in 0.0 seconds
[0m18:35:14.817330 [debug] [Thread-3 (]: Applying DROP to: "dbt"."public"."customers__dbt_backup"
[0m18:35:14.818578 [debug] [Thread-3 (]: Using postgres connection "model.customer360.customers"
[0m18:35:14.819113 [debug] [Thread-3 (]: On model.customer360.customers: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.customers"} */
drop table if exists "dbt"."public"."customers__dbt_backup" cascade
[0m18:35:14.822218 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.0 seconds
[0m18:35:14.824453 [debug] [Thread-3 (]: Timing info for model.customer360.customers (execute): 18:35:14.708520 => 18:35:14.824129
[0m18:35:14.825002 [debug] [Thread-3 (]: On model.customer360.customers: Close
[0m18:35:14.826058 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a2b0e069-0412-4a18-bbca-5c50bb9b8e98', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fde4c1e6a10>]}
[0m18:35:14.829339 [info ] [Thread-3 (]: 15 of 15 OK created sql table model public.customers ........................... [[32mSELECT 2[0m in 0.13s]
[0m18:35:14.830077 [debug] [Thread-3 (]: Finished running node model.customer360.customers
[0m18:35:14.831756 [debug] [MainThread]: Using postgres connection "master"
[0m18:35:14.832049 [debug] [MainThread]: On master: BEGIN
[0m18:35:14.832357 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m18:35:14.837123 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m18:35:14.837635 [debug] [MainThread]: On master: COMMIT
[0m18:35:14.838048 [debug] [MainThread]: Using postgres connection "master"
[0m18:35:14.838522 [debug] [MainThread]: On master: COMMIT
[0m18:35:14.839119 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m18:35:14.839615 [debug] [MainThread]: On master: Close
[0m18:35:14.840559 [debug] [MainThread]: Connection 'master' was properly closed.
[0m18:35:14.840966 [debug] [MainThread]: Connection 'test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311' was properly closed.
[0m18:35:14.843037 [debug] [MainThread]: Connection 'model.customer360.stg_sf__contacts' was properly closed.
[0m18:35:14.843480 [debug] [MainThread]: Connection 'model.customer360.customers' was properly closed.
[0m18:35:14.844002 [info ] [MainThread]: 
[0m18:35:14.844527 [info ] [MainThread]: Finished running 9 tests, 2 seeds, 3 table models, 1 view model in 0 hours 0 minutes and 0.91 seconds (0.91s).
[0m18:35:14.848632 [debug] [MainThread]: Command end result
[0m18:35:14.859961 [info ] [MainThread]: 
[0m18:35:14.860718 [info ] [MainThread]: [32mCompleted successfully[0m
[0m18:35:14.861224 [info ] [MainThread]: 
[0m18:35:14.861711 [info ] [MainThread]: Done. PASS=15 WARN=0 ERROR=0 SKIP=0 TOTAL=15
[0m18:35:14.862761 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 1.3455365, "process_user_time": 3.097318, "process_kernel_time": 0.113352, "process_mem_max_rss": "112960", "process_out_blocks": "2072", "process_in_blocks": "0"}
[0m18:35:14.863483 [debug] [MainThread]: Command `dbt build` succeeded at 18:35:14.863311 after 1.35 seconds
[0m18:35:14.863999 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fde51277c50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fde51809ed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fde55bddf90>]}
[0m18:35:14.864500 [debug] [MainThread]: Flushing usage events
[0m18:35:20.566091 [debug] [MainThread]: Error sending anonymous usage statistics. Disabling tracking for this execution. If you wish to permanently disable tracking, see: https://docs.getdbt.com/reference/global-configs#send-anonymous-usage-stats.
[0m18:38:15.168079 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fac90828d10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fac90fc35d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fac9082a250>]}


============================== 18:38:15.172117 | 0c78fcb1-050e-49cc-9c58-710f803e1633 ==============================
[0m18:38:15.172117 [info ] [MainThread]: Running with dbt=1.7.8
[0m18:38:15.173003 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': '/root/option1-customer360/integration_tests/logs', 'profiles_dir': '/root/option1-customer360/integration_tests', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt run', 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m18:38:15.787591 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '0c78fcb1-050e-49cc-9c58-710f803e1633', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fac90788b10>]}
[0m18:38:16.074363 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '0c78fcb1-050e-49cc-9c58-710f803e1633', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fac9076bb50>]}
[0m18:38:16.075282 [info ] [MainThread]: Registered adapter: postgres=1.7.8
[0m18:38:16.138449 [debug] [MainThread]: checksum: 67f0013ca5f0bd43af9a0873dd50792fde83ef69de63b71cacd0b4ac656c52e5, vars: {}, profile: , target: , version: 1.7.8
[0m18:38:16.233083 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m18:38:16.233947 [debug] [MainThread]: Partial parsing: updated file: customer360://models/staging/web/stg_web__transactions.sql
[0m18:38:16.485334 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '0c78fcb1-050e-49cc-9c58-710f803e1633', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fac8ee5ebd0>]}
[0m18:38:16.496791 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '0c78fcb1-050e-49cc-9c58-710f803e1633', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fac8ebd1f90>]}
[0m18:38:16.497444 [info ] [MainThread]: Found 2 seeds, 4 models, 9 tests, 2 sources, 0 exposures, 0 metrics, 403 macros, 0 groups, 0 semantic models
[0m18:38:16.497915 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0c78fcb1-050e-49cc-9c58-710f803e1633', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fac8eb01110>]}
[0m18:38:16.500081 [info ] [MainThread]: 
[0m18:38:16.501015 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m18:38:16.502607 [debug] [ThreadPool]: Acquiring new postgres connection 'list_dbt'
[0m18:38:16.516860 [debug] [ThreadPool]: Using postgres connection "list_dbt"
[0m18:38:16.517379 [debug] [ThreadPool]: On list_dbt: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "connection_name": "list_dbt"} */

    select distinct nspname from pg_namespace
  
[0m18:38:16.517794 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m18:38:16.524090 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.0 seconds
[0m18:38:16.525820 [debug] [ThreadPool]: On list_dbt: Close
[0m18:38:16.529825 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dbt, now list_dbt_public)
[0m18:38:16.537723 [debug] [ThreadPool]: Using postgres connection "list_dbt_public"
[0m18:38:16.538216 [debug] [ThreadPool]: On list_dbt_public: BEGIN
[0m18:38:16.538729 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:38:16.543410 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m18:38:16.543859 [debug] [ThreadPool]: Using postgres connection "list_dbt_public"
[0m18:38:16.544243 [debug] [ThreadPool]: On list_dbt_public: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "connection_name": "list_dbt_public"} */
select
      'dbt' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'dbt' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'dbt' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m18:38:16.548244 [debug] [ThreadPool]: SQL status: SELECT 6 in 0.0 seconds
[0m18:38:16.550011 [debug] [ThreadPool]: On list_dbt_public: ROLLBACK
[0m18:38:16.550655 [debug] [ThreadPool]: On list_dbt_public: Close
[0m18:38:16.559016 [debug] [MainThread]: Using postgres connection "master"
[0m18:38:16.559372 [debug] [MainThread]: On master: BEGIN
[0m18:38:16.559631 [debug] [MainThread]: Opening a new connection, currently in state init
[0m18:38:16.562905 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m18:38:16.563192 [debug] [MainThread]: Using postgres connection "master"
[0m18:38:16.563583 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m18:38:16.573552 [debug] [MainThread]: SQL status: SELECT 2 in 0.0 seconds
[0m18:38:16.575104 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0c78fcb1-050e-49cc-9c58-710f803e1633', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fac8eb8c0d0>]}
[0m18:38:16.575552 [debug] [MainThread]: On master: ROLLBACK
[0m18:38:16.576031 [debug] [MainThread]: Using postgres connection "master"
[0m18:38:16.576320 [debug] [MainThread]: On master: BEGIN
[0m18:38:16.576927 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m18:38:16.577198 [debug] [MainThread]: On master: COMMIT
[0m18:38:16.577490 [debug] [MainThread]: Using postgres connection "master"
[0m18:38:16.577754 [debug] [MainThread]: On master: COMMIT
[0m18:38:16.578166 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m18:38:16.578459 [debug] [MainThread]: On master: Close
[0m18:38:16.579092 [info ] [MainThread]: Concurrency: 3 threads (target='local')
[0m18:38:16.579452 [info ] [MainThread]: 
[0m18:38:16.582127 [debug] [Thread-1 (]: Began running node model.customer360.stg_sf__contacts
[0m18:38:16.582534 [debug] [Thread-2 (]: Began running node model.customer360.stg_web__transactions
[0m18:38:16.583017 [info ] [Thread-1 (]: 1 of 4 START sql table model public.stg_sf__contacts ........................... [RUN]
[0m18:38:16.583547 [info ] [Thread-2 (]: 2 of 4 START sql table model public.stg_web__transactions ...................... [RUN]
[0m18:38:16.584223 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dbt_public, now model.customer360.stg_sf__contacts)
[0m18:38:16.584897 [debug] [Thread-2 (]: Acquiring new postgres connection 'model.customer360.stg_web__transactions'
[0m18:38:16.585271 [debug] [Thread-1 (]: Began compiling node model.customer360.stg_sf__contacts
[0m18:38:16.585658 [debug] [Thread-2 (]: Began compiling node model.customer360.stg_web__transactions
[0m18:38:16.592092 [debug] [Thread-1 (]: Writing injected SQL for node "model.customer360.stg_sf__contacts"
[0m18:38:16.594667 [debug] [Thread-2 (]: Writing injected SQL for node "model.customer360.stg_web__transactions"
[0m18:38:16.595424 [debug] [Thread-2 (]: Timing info for model.customer360.stg_web__transactions (compile): 18:38:16.592352 => 18:38:16.595130
[0m18:38:16.595899 [debug] [Thread-1 (]: Timing info for model.customer360.stg_sf__contacts (compile): 18:38:16.585902 => 18:38:16.595668
[0m18:38:16.596373 [debug] [Thread-2 (]: Began executing node model.customer360.stg_web__transactions
[0m18:38:16.596746 [debug] [Thread-1 (]: Began executing node model.customer360.stg_sf__contacts
[0m18:38:16.646977 [debug] [Thread-1 (]: Writing runtime sql for node "model.customer360.stg_sf__contacts"
[0m18:38:16.642803 [debug] [Thread-2 (]: Writing runtime sql for node "model.customer360.stg_web__transactions"
[0m18:38:16.647829 [debug] [Thread-2 (]: Using postgres connection "model.customer360.stg_web__transactions"
[0m18:38:16.648261 [debug] [Thread-1 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m18:38:16.648621 [debug] [Thread-2 (]: On model.customer360.stg_web__transactions: BEGIN
[0m18:38:16.648993 [debug] [Thread-1 (]: On model.customer360.stg_sf__contacts: BEGIN
[0m18:38:16.649356 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m18:38:16.649690 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:38:16.654023 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m18:38:16.654441 [debug] [Thread-2 (]: SQL status: BEGIN in 0.0 seconds
[0m18:38:16.654746 [debug] [Thread-1 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m18:38:16.655112 [debug] [Thread-2 (]: Using postgres connection "model.customer360.stg_web__transactions"
[0m18:38:16.655505 [debug] [Thread-1 (]: On model.customer360.stg_sf__contacts: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_sf__contacts"} */

  
    

  create  table "dbt"."public"."stg_sf__contacts__dbt_tmp"
  
  
    as
  
  (
    with source as (
    select * from "dbt"."public"."contacts"
),

renamed as (
    select
        id,
        username as user_name,
        name,
        gender,
        address, 
        mail as email_address,
        birthdate as birth_date,
        _loaded_at_utc
    from source     
)

select * from renamed
  );
  
[0m18:38:16.655952 [debug] [Thread-2 (]: On model.customer360.stg_web__transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_web__transactions"} */

  
    

  create  table "dbt"."public"."stg_web__transactions__dbt_tmp"
  
  
    as
  
  (
    with source as (
    select * from "dbt"."public"."transactions"
),

renamed as (
    select
        id,
        contact_id,
        
        to_timestamp(transaction_date,'YYYY-MM-DD HH24:MI:SS.MS') :: timestamp at TIME zone 'UTC'
     as transaction_date,
        amount,
        item_count,
        category, 
        _loaded_at_utc
    from source    
),

clean_older as (
    select * from renamed 
--    where transaction_date >= (current_date - 1)  过滤超过1天的数据
--    where transaction_date >= (to_date('2023-04-12','yyyy-MM-dd') - 1)  --测试用,假设跑数日期为2023-04-12
--    and transaction_date < to_date('2023-04-12','yyyy-MM-dd')
)

select * from clean_older
  );
  
[0m18:38:16.664131 [debug] [Thread-2 (]: SQL status: SELECT 74 in 0.0 seconds
[0m18:38:16.670142 [debug] [Thread-2 (]: Using postgres connection "model.customer360.stg_web__transactions"
[0m18:38:16.670545 [debug] [Thread-1 (]: SQL status: SELECT 10 in 0.0 seconds
[0m18:38:16.670906 [debug] [Thread-2 (]: On model.customer360.stg_web__transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_web__transactions"} */
alter table "dbt"."public"."stg_web__transactions" rename to "stg_web__transactions__dbt_backup"
[0m18:38:16.673598 [debug] [Thread-1 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m18:38:16.674104 [debug] [Thread-1 (]: On model.customer360.stg_sf__contacts: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_sf__contacts"} */
alter table "dbt"."public"."stg_sf__contacts" rename to "stg_sf__contacts__dbt_backup"
[0m18:38:16.675031 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m18:38:16.677798 [debug] [Thread-2 (]: Using postgres connection "model.customer360.stg_web__transactions"
[0m18:38:16.678184 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m18:38:16.678615 [debug] [Thread-2 (]: On model.customer360.stg_web__transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_web__transactions"} */
alter table "dbt"."public"."stg_web__transactions__dbt_tmp" rename to "stg_web__transactions"
[0m18:38:16.681121 [debug] [Thread-1 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m18:38:16.681542 [debug] [Thread-1 (]: On model.customer360.stg_sf__contacts: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_sf__contacts"} */
alter table "dbt"."public"."stg_sf__contacts__dbt_tmp" rename to "stg_sf__contacts"
[0m18:38:16.682184 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m18:38:16.682565 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m18:38:16.702682 [debug] [Thread-2 (]: On model.customer360.stg_web__transactions: COMMIT
[0m18:38:16.705379 [debug] [Thread-1 (]: On model.customer360.stg_sf__contacts: COMMIT
[0m18:38:16.705826 [debug] [Thread-2 (]: Using postgres connection "model.customer360.stg_web__transactions"
[0m18:38:16.706207 [debug] [Thread-1 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m18:38:16.706587 [debug] [Thread-2 (]: On model.customer360.stg_web__transactions: COMMIT
[0m18:38:16.706932 [debug] [Thread-1 (]: On model.customer360.stg_sf__contacts: COMMIT
[0m18:38:16.709139 [debug] [Thread-1 (]: SQL status: COMMIT in 0.0 seconds
[0m18:38:16.714777 [debug] [Thread-2 (]: SQL status: COMMIT in 0.0 seconds
[0m18:38:16.715230 [debug] [Thread-1 (]: Applying DROP to: "dbt"."public"."stg_sf__contacts__dbt_backup"
[0m18:38:16.717587 [debug] [Thread-2 (]: Applying DROP to: "dbt"."public"."stg_web__transactions__dbt_backup"
[0m18:38:16.722174 [debug] [Thread-1 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m18:38:16.722983 [debug] [Thread-2 (]: Using postgres connection "model.customer360.stg_web__transactions"
[0m18:38:16.723360 [debug] [Thread-1 (]: On model.customer360.stg_sf__contacts: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_sf__contacts"} */
drop table if exists "dbt"."public"."stg_sf__contacts__dbt_backup" cascade
[0m18:38:16.723741 [debug] [Thread-2 (]: On model.customer360.stg_web__transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_web__transactions"} */
drop table if exists "dbt"."public"."stg_web__transactions__dbt_backup" cascade
[0m18:38:16.727111 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.0 seconds
[0m18:38:16.728726 [debug] [Thread-1 (]: Timing info for model.customer360.stg_sf__contacts (execute): 18:38:16.612403 => 18:38:16.728511
[0m18:38:16.729060 [debug] [Thread-1 (]: On model.customer360.stg_sf__contacts: Close
[0m18:38:16.729884 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0c78fcb1-050e-49cc-9c58-710f803e1633', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fac8eccdf90>]}
[0m18:38:16.730570 [info ] [Thread-1 (]: 1 of 4 OK created sql table model public.stg_sf__contacts ...................... [[32mSELECT 10[0m in 0.15s]
[0m18:38:16.731248 [debug] [Thread-1 (]: Finished running node model.customer360.stg_sf__contacts
[0m18:38:16.731922 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.0 seconds
[0m18:38:16.733211 [debug] [Thread-2 (]: Timing info for model.customer360.stg_web__transactions (execute): 18:38:16.596983 => 18:38:16.733023
[0m18:38:16.733554 [debug] [Thread-2 (]: On model.customer360.stg_web__transactions: Close
[0m18:38:16.734187 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0c78fcb1-050e-49cc-9c58-710f803e1633', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fac8ebea050>]}
[0m18:38:16.734667 [info ] [Thread-2 (]: 2 of 4 OK created sql table model public.stg_web__transactions ................. [[32mSELECT 74[0m in 0.15s]
[0m18:38:16.735163 [debug] [Thread-2 (]: Finished running node model.customer360.stg_web__transactions
[0m18:38:16.735947 [debug] [Thread-3 (]: Began running node model.customer360.contacts_joined_with_transactions
[0m18:38:16.736470 [info ] [Thread-3 (]: 3 of 4 START sql view model public.contacts_joined_with_transactions ........... [RUN]
[0m18:38:16.737457 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.customer360.contacts_joined_with_transactions'
[0m18:38:16.737821 [debug] [Thread-3 (]: Began compiling node model.customer360.contacts_joined_with_transactions
[0m18:38:16.740662 [debug] [Thread-3 (]: Writing injected SQL for node "model.customer360.contacts_joined_with_transactions"
[0m18:38:16.741266 [debug] [Thread-3 (]: Timing info for model.customer360.contacts_joined_with_transactions (compile): 18:38:16.738019 => 18:38:16.741014
[0m18:38:16.741617 [debug] [Thread-3 (]: Began executing node model.customer360.contacts_joined_with_transactions
[0m18:38:16.759548 [debug] [Thread-3 (]: Writing runtime sql for node "model.customer360.contacts_joined_with_transactions"
[0m18:38:16.760160 [debug] [Thread-3 (]: Using postgres connection "model.customer360.contacts_joined_with_transactions"
[0m18:38:16.760552 [debug] [Thread-3 (]: On model.customer360.contacts_joined_with_transactions: BEGIN
[0m18:38:16.760873 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m18:38:16.764183 [debug] [Thread-3 (]: SQL status: BEGIN in 0.0 seconds
[0m18:38:16.764548 [debug] [Thread-3 (]: Using postgres connection "model.customer360.contacts_joined_with_transactions"
[0m18:38:16.764872 [debug] [Thread-3 (]: On model.customer360.contacts_joined_with_transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.contacts_joined_with_transactions"} */

  create view "dbt"."public"."contacts_joined_with_transactions__dbt_tmp"
    
    
  as (
    SELECT 
    contacts.*,
    transactions.id as transaction_id,
    transactions.transaction_date,
    transactions.amount,
    transactions.item_count,
    transactions.category
FROM "dbt"."public"."stg_web__transactions" as transactions
LEFT JOIN "dbt"."public"."stg_sf__contacts" as contacts ON contacts.id = transactions.contact_id
  );
[0m18:38:16.766862 [debug] [Thread-3 (]: SQL status: CREATE VIEW in 0.0 seconds
[0m18:38:16.769868 [debug] [Thread-3 (]: Using postgres connection "model.customer360.contacts_joined_with_transactions"
[0m18:38:16.770200 [debug] [Thread-3 (]: On model.customer360.contacts_joined_with_transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.contacts_joined_with_transactions"} */
alter table "dbt"."public"."contacts_joined_with_transactions__dbt_tmp" rename to "contacts_joined_with_transactions"
[0m18:38:16.770939 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m18:38:16.772392 [debug] [Thread-3 (]: On model.customer360.contacts_joined_with_transactions: COMMIT
[0m18:38:16.772719 [debug] [Thread-3 (]: Using postgres connection "model.customer360.contacts_joined_with_transactions"
[0m18:38:16.773019 [debug] [Thread-3 (]: On model.customer360.contacts_joined_with_transactions: COMMIT
[0m18:38:16.774348 [debug] [Thread-3 (]: SQL status: COMMIT in 0.0 seconds
[0m18:38:16.776669 [debug] [Thread-3 (]: Applying DROP to: "dbt"."public"."contacts_joined_with_transactions__dbt_backup"
[0m18:38:16.779393 [debug] [Thread-3 (]: Using postgres connection "model.customer360.contacts_joined_with_transactions"
[0m18:38:16.779739 [debug] [Thread-3 (]: On model.customer360.contacts_joined_with_transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.contacts_joined_with_transactions"} */
drop view if exists "dbt"."public"."contacts_joined_with_transactions__dbt_backup" cascade
[0m18:38:16.780340 [debug] [Thread-3 (]: SQL status: DROP VIEW in 0.0 seconds
[0m18:38:16.781574 [debug] [Thread-3 (]: Timing info for model.customer360.contacts_joined_with_transactions (execute): 18:38:16.741804 => 18:38:16.781366
[0m18:38:16.781903 [debug] [Thread-3 (]: On model.customer360.contacts_joined_with_transactions: Close
[0m18:38:16.782718 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0c78fcb1-050e-49cc-9c58-710f803e1633', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fac8e5f6f10>]}
[0m18:38:16.783369 [info ] [Thread-3 (]: 3 of 4 OK created sql view model public.contacts_joined_with_transactions ...... [[32mCREATE VIEW[0m in 0.05s]
[0m18:38:16.784240 [debug] [Thread-3 (]: Finished running node model.customer360.contacts_joined_with_transactions
[0m18:38:16.785059 [debug] [Thread-2 (]: Began running node model.customer360.customers
[0m18:38:16.785478 [info ] [Thread-2 (]: 4 of 4 START sql table model public.customers .................................. [RUN]
[0m18:38:16.786058 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.customer360.stg_web__transactions, now model.customer360.customers)
[0m18:38:16.786403 [debug] [Thread-2 (]: Began compiling node model.customer360.customers
[0m18:38:16.789681 [debug] [Thread-2 (]: Writing injected SQL for node "model.customer360.customers"
[0m18:38:16.790269 [debug] [Thread-2 (]: Timing info for model.customer360.customers (compile): 18:38:16.786619 => 18:38:16.790024
[0m18:38:16.790614 [debug] [Thread-2 (]: Began executing node model.customer360.customers
[0m18:38:16.794391 [debug] [Thread-2 (]: Writing runtime sql for node "model.customer360.customers"
[0m18:38:16.794904 [debug] [Thread-2 (]: Using postgres connection "model.customer360.customers"
[0m18:38:16.795210 [debug] [Thread-2 (]: On model.customer360.customers: BEGIN
[0m18:38:16.795537 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m18:38:16.798755 [debug] [Thread-2 (]: SQL status: BEGIN in 0.0 seconds
[0m18:38:16.799127 [debug] [Thread-2 (]: Using postgres connection "model.customer360.customers"
[0m18:38:16.799593 [debug] [Thread-2 (]: On model.customer360.customers: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.customers"} */

  
    

  create  table "dbt"."public"."customers__dbt_tmp"
  
  
    as
  
  (
    SELECT
    id,
    gender,
    
    date_part('year', age(current_date, birth_date))
 AS age,
    sum(amount) as total_expense
FROM "dbt"."public"."contacts_joined_with_transactions"
GROUP BY
    1,2,3
  );
  
[0m18:38:16.805667 [debug] [Thread-2 (]: SQL status: SELECT 9 in 0.0 seconds
[0m18:38:16.808405 [debug] [Thread-2 (]: Using postgres connection "model.customer360.customers"
[0m18:38:16.808722 [debug] [Thread-2 (]: On model.customer360.customers: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.customers"} */
alter table "dbt"."public"."customers" rename to "customers__dbt_backup"
[0m18:38:16.809385 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m18:38:16.811869 [debug] [Thread-2 (]: Using postgres connection "model.customer360.customers"
[0m18:38:16.812193 [debug] [Thread-2 (]: On model.customer360.customers: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.customers"} */
alter table "dbt"."public"."customers__dbt_tmp" rename to "customers"
[0m18:38:16.812789 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m18:38:16.814605 [debug] [Thread-2 (]: On model.customer360.customers: COMMIT
[0m18:38:16.814914 [debug] [Thread-2 (]: Using postgres connection "model.customer360.customers"
[0m18:38:16.815423 [debug] [Thread-2 (]: On model.customer360.customers: COMMIT
[0m18:38:16.817015 [debug] [Thread-2 (]: SQL status: COMMIT in 0.0 seconds
[0m18:38:16.819493 [debug] [Thread-2 (]: Applying DROP to: "dbt"."public"."customers__dbt_backup"
[0m18:38:16.820427 [debug] [Thread-2 (]: Using postgres connection "model.customer360.customers"
[0m18:38:16.820782 [debug] [Thread-2 (]: On model.customer360.customers: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.customers"} */
drop table if exists "dbt"."public"."customers__dbt_backup" cascade
[0m18:38:16.822884 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.0 seconds
[0m18:38:16.824321 [debug] [Thread-2 (]: Timing info for model.customer360.customers (execute): 18:38:16.790816 => 18:38:16.824101
[0m18:38:16.824648 [debug] [Thread-2 (]: On model.customer360.customers: Close
[0m18:38:16.825451 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0c78fcb1-050e-49cc-9c58-710f803e1633', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fac8e5e3dd0>]}
[0m18:38:16.826077 [info ] [Thread-2 (]: 4 of 4 OK created sql table model public.customers ............................. [[32mSELECT 9[0m in 0.04s]
[0m18:38:16.826735 [debug] [Thread-2 (]: Finished running node model.customer360.customers
[0m18:38:16.828256 [debug] [MainThread]: Using postgres connection "master"
[0m18:38:16.828572 [debug] [MainThread]: On master: BEGIN
[0m18:38:16.828824 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m18:38:16.832045 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m18:38:16.832366 [debug] [MainThread]: On master: COMMIT
[0m18:38:16.832648 [debug] [MainThread]: Using postgres connection "master"
[0m18:38:16.832895 [debug] [MainThread]: On master: COMMIT
[0m18:38:16.833335 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m18:38:16.833625 [debug] [MainThread]: On master: Close
[0m18:38:16.834197 [debug] [MainThread]: Connection 'master' was properly closed.
[0m18:38:16.834558 [debug] [MainThread]: Connection 'model.customer360.stg_sf__contacts' was properly closed.
[0m18:38:16.834888 [debug] [MainThread]: Connection 'model.customer360.customers' was properly closed.
[0m18:38:16.835209 [debug] [MainThread]: Connection 'model.customer360.contacts_joined_with_transactions' was properly closed.
[0m18:38:16.835647 [info ] [MainThread]: 
[0m18:38:16.836019 [info ] [MainThread]: Finished running 3 table models, 1 view model in 0 hours 0 minutes and 0.34 seconds (0.34s).
[0m18:38:16.836979 [debug] [MainThread]: Command end result
[0m18:38:16.843589 [info ] [MainThread]: 
[0m18:38:16.843939 [info ] [MainThread]: [32mCompleted successfully[0m
[0m18:38:16.844210 [info ] [MainThread]: 
[0m18:38:16.844525 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 TOTAL=4
[0m18:38:16.845200 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 1.7779098, "process_user_time": 3.163611, "process_kernel_time": 0.138573, "process_mem_max_rss": "105864", "process_in_blocks": "160", "process_out_blocks": "2640"}
[0m18:38:16.845672 [debug] [MainThread]: Command `dbt run` succeeded at 18:38:16.845553 after 1.78 seconds
[0m18:38:16.845988 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fac94c9aad0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fac94d5e190>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fac94e18390>]}
[0m18:38:16.846448 [debug] [MainThread]: Flushing usage events
[0m19:10:26.633039 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f21696dd110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f21697268d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f21696dd050>]}


============================== 19:10:26.635610 | 1ff33c03-57ed-49d3-beb1-782015bc0e81 ==============================
[0m19:10:26.635610 [info ] [MainThread]: Running with dbt=1.7.8
[0m19:10:26.636094 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': '/root/option1-customer360/integration_tests/logs', 'profiles_dir': '/root/option1-customer360/integration_tests', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt run', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m19:10:26.945534 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '1ff33c03-57ed-49d3-beb1-782015bc0e81', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2167c16090>]}
[0m19:10:27.076099 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '1ff33c03-57ed-49d3-beb1-782015bc0e81', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f21695757d0>]}
[0m19:10:27.077067 [info ] [MainThread]: Registered adapter: postgres=1.7.8
[0m19:10:27.094845 [debug] [MainThread]: checksum: 67f0013ca5f0bd43af9a0873dd50792fde83ef69de63b71cacd0b4ac656c52e5, vars: {}, profile: , target: , version: 1.7.8
[0m19:10:27.127755 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m19:10:27.128603 [debug] [MainThread]: Partial parsing: updated file: customer360://models/marts/marketing/customers.sql
[0m19:10:27.311576 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '1ff33c03-57ed-49d3-beb1-782015bc0e81', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2167cdccd0>]}
[0m19:10:27.323994 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '1ff33c03-57ed-49d3-beb1-782015bc0e81', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2167a710d0>]}
[0m19:10:27.324673 [info ] [MainThread]: Found 2 seeds, 4 models, 9 tests, 2 sources, 0 exposures, 0 metrics, 403 macros, 0 groups, 0 semantic models
[0m19:10:27.325514 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1ff33c03-57ed-49d3-beb1-782015bc0e81', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2167a1d890>]}
[0m19:10:27.327731 [info ] [MainThread]: 
[0m19:10:27.328725 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m19:10:27.330473 [debug] [ThreadPool]: Acquiring new postgres connection 'list_dbt'
[0m19:10:27.345369 [debug] [ThreadPool]: Using postgres connection "list_dbt"
[0m19:10:27.345924 [debug] [ThreadPool]: On list_dbt: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "connection_name": "list_dbt"} */

    select distinct nspname from pg_namespace
  
[0m19:10:27.346364 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:10:27.354274 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.0 seconds
[0m19:10:27.356212 [debug] [ThreadPool]: On list_dbt: Close
[0m19:10:27.360320 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dbt, now list_dbt_public)
[0m19:10:27.368599 [debug] [ThreadPool]: Using postgres connection "list_dbt_public"
[0m19:10:27.369026 [debug] [ThreadPool]: On list_dbt_public: BEGIN
[0m19:10:27.369456 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:10:27.374112 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m19:10:27.374604 [debug] [ThreadPool]: Using postgres connection "list_dbt_public"
[0m19:10:27.375019 [debug] [ThreadPool]: On list_dbt_public: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "connection_name": "list_dbt_public"} */
select
      'dbt' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'dbt' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'dbt' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m19:10:27.379260 [debug] [ThreadPool]: SQL status: SELECT 6 in 0.0 seconds
[0m19:10:27.381147 [debug] [ThreadPool]: On list_dbt_public: ROLLBACK
[0m19:10:27.381849 [debug] [ThreadPool]: On list_dbt_public: Close
[0m19:10:27.392226 [debug] [MainThread]: Using postgres connection "master"
[0m19:10:27.392718 [debug] [MainThread]: On master: BEGIN
[0m19:10:27.393165 [debug] [MainThread]: Opening a new connection, currently in state init
[0m19:10:27.397720 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m19:10:27.398212 [debug] [MainThread]: Using postgres connection "master"
[0m19:10:27.398801 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m19:10:27.414064 [debug] [MainThread]: SQL status: SELECT 2 in 0.0 seconds
[0m19:10:27.416539 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1ff33c03-57ed-49d3-beb1-782015bc0e81', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2167af6810>]}
[0m19:10:27.417325 [debug] [MainThread]: On master: ROLLBACK
[0m19:10:27.418057 [debug] [MainThread]: Using postgres connection "master"
[0m19:10:27.418545 [debug] [MainThread]: On master: BEGIN
[0m19:10:27.419345 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m19:10:27.419799 [debug] [MainThread]: On master: COMMIT
[0m19:10:27.420212 [debug] [MainThread]: Using postgres connection "master"
[0m19:10:27.420668 [debug] [MainThread]: On master: COMMIT
[0m19:10:27.421303 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m19:10:27.421750 [debug] [MainThread]: On master: Close
[0m19:10:27.422709 [info ] [MainThread]: Concurrency: 3 threads (target='local')
[0m19:10:27.423111 [info ] [MainThread]: 
[0m19:10:27.428654 [debug] [Thread-1 (]: Began running node model.customer360.stg_sf__contacts
[0m19:10:27.429373 [info ] [Thread-1 (]: 1 of 4 START sql table model public.stg_sf__contacts ........................... [RUN]
[0m19:10:27.430481 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dbt_public, now model.customer360.stg_sf__contacts)
[0m19:10:27.431018 [debug] [Thread-1 (]: Began compiling node model.customer360.stg_sf__contacts
[0m19:10:27.441056 [debug] [Thread-2 (]: Began running node model.customer360.stg_web__transactions
[0m19:10:27.441750 [info ] [Thread-2 (]: 2 of 4 START sql table model public.stg_web__transactions ...................... [RUN]
[0m19:10:27.442783 [debug] [Thread-2 (]: Acquiring new postgres connection 'model.customer360.stg_web__transactions'
[0m19:10:27.443312 [debug] [Thread-2 (]: Began compiling node model.customer360.stg_web__transactions
[0m19:10:27.448828 [debug] [Thread-2 (]: Writing injected SQL for node "model.customer360.stg_web__transactions"
[0m19:10:27.449566 [debug] [Thread-1 (]: Writing injected SQL for node "model.customer360.stg_sf__contacts"
[0m19:10:27.450154 [debug] [Thread-2 (]: Timing info for model.customer360.stg_web__transactions (compile): 19:10:27.443602 => 19:10:27.449916
[0m19:10:27.450572 [debug] [Thread-2 (]: Began executing node model.customer360.stg_web__transactions
[0m19:10:27.462752 [debug] [Thread-1 (]: Timing info for model.customer360.stg_sf__contacts (compile): 19:10:27.431364 => 19:10:27.462515
[0m19:10:27.468249 [debug] [Thread-1 (]: Began executing node model.customer360.stg_sf__contacts
[0m19:10:27.501865 [debug] [Thread-2 (]: Writing runtime sql for node "model.customer360.stg_web__transactions"
[0m19:10:27.502484 [debug] [Thread-1 (]: Writing runtime sql for node "model.customer360.stg_sf__contacts"
[0m19:10:27.503168 [debug] [Thread-2 (]: Using postgres connection "model.customer360.stg_web__transactions"
[0m19:10:27.503627 [debug] [Thread-1 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m19:10:27.503963 [debug] [Thread-2 (]: On model.customer360.stg_web__transactions: BEGIN
[0m19:10:27.504351 [debug] [Thread-1 (]: On model.customer360.stg_sf__contacts: BEGIN
[0m19:10:27.504727 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m19:10:27.505128 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:10:27.509712 [debug] [Thread-2 (]: SQL status: BEGIN in 0.0 seconds
[0m19:10:27.510111 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m19:10:27.510598 [debug] [Thread-2 (]: Using postgres connection "model.customer360.stg_web__transactions"
[0m19:10:27.510952 [debug] [Thread-1 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m19:10:27.511391 [debug] [Thread-2 (]: On model.customer360.stg_web__transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_web__transactions"} */

  
    

  create  table "dbt"."public"."stg_web__transactions__dbt_tmp"
  
  
    as
  
  (
    with source as (
    select * from "dbt"."public"."transactions"
),

renamed as (
    select
        id,
        contact_id,
        
        to_timestamp(transaction_date,'YYYY-MM-DD HH24:MI:SS.MS') :: timestamp at TIME zone 'UTC'
     as transaction_date,
        amount,
        item_count,
        category, 
        _loaded_at_utc
    from source    
),

clean_older as (
    select * from renamed 
--    where transaction_date >= (current_date - 1)  过滤超过1天的数据
--    where transaction_date >= (to_date('2023-04-12','yyyy-MM-dd') - 1)  --测试用,假设跑数日期为2023-04-12
--    and transaction_date < to_date('2023-04-12','yyyy-MM-dd')
)

select * from clean_older
  );
  
[0m19:10:27.511797 [debug] [Thread-1 (]: On model.customer360.stg_sf__contacts: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_sf__contacts"} */

  
    

  create  table "dbt"."public"."stg_sf__contacts__dbt_tmp"
  
  
    as
  
  (
    with source as (
    select * from "dbt"."public"."contacts"
),

renamed as (
    select
        id,
        username as user_name,
        name,
        gender,
        address, 
        mail as email_address,
        birthdate as birth_date,
        _loaded_at_utc
    from source     
)

select * from renamed
  );
  
[0m19:10:27.517332 [debug] [Thread-2 (]: SQL status: SELECT 74 in 0.0 seconds
[0m19:10:27.523232 [debug] [Thread-2 (]: Using postgres connection "model.customer360.stg_web__transactions"
[0m19:10:27.523708 [debug] [Thread-1 (]: SQL status: SELECT 10 in 0.0 seconds
[0m19:10:27.524064 [debug] [Thread-2 (]: On model.customer360.stg_web__transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_web__transactions"} */
alter table "dbt"."public"."stg_web__transactions" rename to "stg_web__transactions__dbt_backup"
[0m19:10:27.527119 [debug] [Thread-1 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m19:10:27.527596 [debug] [Thread-1 (]: On model.customer360.stg_sf__contacts: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_sf__contacts"} */
alter table "dbt"."public"."stg_sf__contacts" rename to "stg_sf__contacts__dbt_backup"
[0m19:10:27.528314 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m19:10:27.528678 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m19:10:27.531238 [debug] [Thread-1 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m19:10:27.533738 [debug] [Thread-2 (]: Using postgres connection "model.customer360.stg_web__transactions"
[0m19:10:27.534117 [debug] [Thread-1 (]: On model.customer360.stg_sf__contacts: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_sf__contacts"} */
alter table "dbt"."public"."stg_sf__contacts__dbt_tmp" rename to "stg_sf__contacts"
[0m19:10:27.534498 [debug] [Thread-2 (]: On model.customer360.stg_web__transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_web__transactions"} */
alter table "dbt"."public"."stg_web__transactions__dbt_tmp" rename to "stg_web__transactions"
[0m19:10:27.535230 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m19:10:27.535576 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m19:10:27.561813 [debug] [Thread-2 (]: On model.customer360.stg_web__transactions: COMMIT
[0m19:10:27.562314 [debug] [Thread-2 (]: Using postgres connection "model.customer360.stg_web__transactions"
[0m19:10:27.562847 [debug] [Thread-1 (]: On model.customer360.stg_sf__contacts: COMMIT
[0m19:10:27.563190 [debug] [Thread-2 (]: On model.customer360.stg_web__transactions: COMMIT
[0m19:10:27.563560 [debug] [Thread-1 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m19:10:27.564002 [debug] [Thread-1 (]: On model.customer360.stg_sf__contacts: COMMIT
[0m19:10:27.565350 [debug] [Thread-2 (]: SQL status: COMMIT in 0.0 seconds
[0m19:10:27.570901 [debug] [Thread-1 (]: SQL status: COMMIT in 0.0 seconds
[0m19:10:27.572107 [debug] [Thread-2 (]: Applying DROP to: "dbt"."public"."stg_web__transactions__dbt_backup"
[0m19:10:27.574527 [debug] [Thread-1 (]: Applying DROP to: "dbt"."public"."stg_sf__contacts__dbt_backup"
[0m19:10:27.578931 [debug] [Thread-2 (]: Using postgres connection "model.customer360.stg_web__transactions"
[0m19:10:27.579730 [debug] [Thread-1 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m19:10:27.580110 [debug] [Thread-2 (]: On model.customer360.stg_web__transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_web__transactions"} */
drop table if exists "dbt"."public"."stg_web__transactions__dbt_backup" cascade
[0m19:10:27.580491 [debug] [Thread-1 (]: On model.customer360.stg_sf__contacts: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_sf__contacts"} */
drop table if exists "dbt"."public"."stg_sf__contacts__dbt_backup" cascade
[0m19:10:27.583434 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.0 seconds
[0m19:10:27.584949 [debug] [Thread-1 (]: Timing info for model.customer360.stg_sf__contacts (execute): 19:10:27.473627 => 19:10:27.584745
[0m19:10:27.585315 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.0 seconds
[0m19:10:27.585690 [debug] [Thread-1 (]: On model.customer360.stg_sf__contacts: Close
[0m19:10:27.587000 [debug] [Thread-2 (]: Timing info for model.customer360.stg_web__transactions (execute): 19:10:27.450766 => 19:10:27.586794
[0m19:10:27.587437 [debug] [Thread-2 (]: On model.customer360.stg_web__transactions: Close
[0m19:10:27.588969 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1ff33c03-57ed-49d3-beb1-782015bc0e81', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f21674364d0>]}
[0m19:10:27.589653 [info ] [Thread-2 (]: 2 of 4 OK created sql table model public.stg_web__transactions ................. [[32mSELECT 74[0m in 0.15s]
[0m19:10:27.588122 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1ff33c03-57ed-49d3-beb1-782015bc0e81', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f21679e56d0>]}
[0m19:10:27.591598 [debug] [Thread-2 (]: Finished running node model.customer360.stg_web__transactions
[0m19:10:27.592214 [info ] [Thread-1 (]: 1 of 4 OK created sql table model public.stg_sf__contacts ...................... [[32mSELECT 10[0m in 0.16s]
[0m19:10:27.592874 [debug] [Thread-1 (]: Finished running node model.customer360.stg_sf__contacts
[0m19:10:27.593632 [debug] [Thread-3 (]: Began running node model.customer360.contacts_joined_with_transactions
[0m19:10:27.594060 [info ] [Thread-3 (]: 3 of 4 START sql view model public.contacts_joined_with_transactions ........... [RUN]
[0m19:10:27.594730 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.customer360.contacts_joined_with_transactions'
[0m19:10:27.595055 [debug] [Thread-3 (]: Began compiling node model.customer360.contacts_joined_with_transactions
[0m19:10:27.597894 [debug] [Thread-3 (]: Writing injected SQL for node "model.customer360.contacts_joined_with_transactions"
[0m19:10:27.598561 [debug] [Thread-3 (]: Timing info for model.customer360.contacts_joined_with_transactions (compile): 19:10:27.595244 => 19:10:27.598232
[0m19:10:27.598904 [debug] [Thread-3 (]: Began executing node model.customer360.contacts_joined_with_transactions
[0m19:10:27.616731 [debug] [Thread-3 (]: Writing runtime sql for node "model.customer360.contacts_joined_with_transactions"
[0m19:10:27.617328 [debug] [Thread-3 (]: Using postgres connection "model.customer360.contacts_joined_with_transactions"
[0m19:10:27.617656 [debug] [Thread-3 (]: On model.customer360.contacts_joined_with_transactions: BEGIN
[0m19:10:27.617962 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m19:10:27.621492 [debug] [Thread-3 (]: SQL status: BEGIN in 0.0 seconds
[0m19:10:27.621851 [debug] [Thread-3 (]: Using postgres connection "model.customer360.contacts_joined_with_transactions"
[0m19:10:27.622170 [debug] [Thread-3 (]: On model.customer360.contacts_joined_with_transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.contacts_joined_with_transactions"} */

  create view "dbt"."public"."contacts_joined_with_transactions__dbt_tmp"
    
    
  as (
    SELECT 
    contacts.*,
    transactions.id as transaction_id,
    transactions.transaction_date,
    transactions.amount,
    transactions.item_count,
    transactions.category
FROM "dbt"."public"."stg_web__transactions" as transactions
LEFT JOIN "dbt"."public"."stg_sf__contacts" as contacts ON contacts.id = transactions.contact_id
  );
[0m19:10:27.624229 [debug] [Thread-3 (]: SQL status: CREATE VIEW in 0.0 seconds
[0m19:10:27.627012 [debug] [Thread-3 (]: Using postgres connection "model.customer360.contacts_joined_with_transactions"
[0m19:10:27.627403 [debug] [Thread-3 (]: On model.customer360.contacts_joined_with_transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.contacts_joined_with_transactions"} */
alter table "dbt"."public"."contacts_joined_with_transactions__dbt_tmp" rename to "contacts_joined_with_transactions"
[0m19:10:27.628104 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m19:10:27.629707 [debug] [Thread-3 (]: On model.customer360.contacts_joined_with_transactions: COMMIT
[0m19:10:27.630018 [debug] [Thread-3 (]: Using postgres connection "model.customer360.contacts_joined_with_transactions"
[0m19:10:27.630329 [debug] [Thread-3 (]: On model.customer360.contacts_joined_with_transactions: COMMIT
[0m19:10:27.631730 [debug] [Thread-3 (]: SQL status: COMMIT in 0.0 seconds
[0m19:10:27.633809 [debug] [Thread-3 (]: Applying DROP to: "dbt"."public"."contacts_joined_with_transactions__dbt_backup"
[0m19:10:27.636730 [debug] [Thread-3 (]: Using postgres connection "model.customer360.contacts_joined_with_transactions"
[0m19:10:27.637056 [debug] [Thread-3 (]: On model.customer360.contacts_joined_with_transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.contacts_joined_with_transactions"} */
drop view if exists "dbt"."public"."contacts_joined_with_transactions__dbt_backup" cascade
[0m19:10:27.637666 [debug] [Thread-3 (]: SQL status: DROP VIEW in 0.0 seconds
[0m19:10:27.638874 [debug] [Thread-3 (]: Timing info for model.customer360.contacts_joined_with_transactions (execute): 19:10:27.599096 => 19:10:27.638681
[0m19:10:27.639193 [debug] [Thread-3 (]: On model.customer360.contacts_joined_with_transactions: Close
[0m19:10:27.639997 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1ff33c03-57ed-49d3-beb1-782015bc0e81', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f21674b2850>]}
[0m19:10:27.640644 [info ] [Thread-3 (]: 3 of 4 OK created sql view model public.contacts_joined_with_transactions ...... [[32mCREATE VIEW[0m in 0.05s]
[0m19:10:27.641320 [debug] [Thread-3 (]: Finished running node model.customer360.contacts_joined_with_transactions
[0m19:10:27.642140 [debug] [Thread-1 (]: Began running node model.customer360.customers
[0m19:10:27.642735 [info ] [Thread-1 (]: 4 of 4 START sql table model public.customers .................................. [RUN]
[0m19:10:27.643593 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.customer360.stg_sf__contacts, now model.customer360.customers)
[0m19:10:27.644118 [debug] [Thread-1 (]: Began compiling node model.customer360.customers
[0m19:10:27.648841 [debug] [Thread-1 (]: Writing injected SQL for node "model.customer360.customers"
[0m19:10:27.649655 [debug] [Thread-1 (]: Timing info for model.customer360.customers (compile): 19:10:27.644429 => 19:10:27.649370
[0m19:10:27.650204 [debug] [Thread-1 (]: Began executing node model.customer360.customers
[0m19:10:27.657076 [debug] [Thread-1 (]: Writing runtime sql for node "model.customer360.customers"
[0m19:10:27.657729 [debug] [Thread-1 (]: Using postgres connection "model.customer360.customers"
[0m19:10:27.658084 [debug] [Thread-1 (]: On model.customer360.customers: BEGIN
[0m19:10:27.658435 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:10:27.669694 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m19:10:27.670283 [debug] [Thread-1 (]: Using postgres connection "model.customer360.customers"
[0m19:10:27.670793 [debug] [Thread-1 (]: On model.customer360.customers: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.customers"} */

  
    

  create  table "dbt"."public"."customers__dbt_tmp"
  
  
    as
  
  (
    SELECT
    id,
    gender,
    
    date_part('year', age(current_date, birth_date))
 AS age,
    sum(amount) as total_expense,
    date(min(transaction_date)) as first_purchase_date,
    date(max(transaction_date)) as last_purchase_date,
    sum(case when category = 'Apps & Games' then amount else 0 end) as apps_games_amount,
    sum(case when category = 'Beauty' then amount else 0 end)   as beauty_amount,
    sum(case when category = 'Books' then amount else 0 end)   as books_amount,
    sum(case when category = 'Clothing, Shoes & Accessories' then amount else 0 end)   as clothing_shoes_accessories_amount,
    sum(case when category = 'Movies & TV' then amount else 0 end)   as movies_tv_amount,
    sum(case when category = 'Sports, Fitness & Outdoors' then amount else 0 end)   as sports_fitness_outdoors_amount
FROM  "dbt"."public"."contacts_joined_with_transactions"
GROUP BY
    1,2,3
  );
  
[0m19:10:27.678182 [debug] [Thread-1 (]: SQL status: SELECT 9 in 0.0 seconds
[0m19:10:27.682520 [debug] [Thread-1 (]: Using postgres connection "model.customer360.customers"
[0m19:10:27.682958 [debug] [Thread-1 (]: On model.customer360.customers: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.customers"} */
alter table "dbt"."public"."customers" rename to "customers__dbt_backup"
[0m19:10:27.683851 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m19:10:27.687760 [debug] [Thread-1 (]: Using postgres connection "model.customer360.customers"
[0m19:10:27.688277 [debug] [Thread-1 (]: On model.customer360.customers: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.customers"} */
alter table "dbt"."public"."customers__dbt_tmp" rename to "customers"
[0m19:10:27.689829 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m19:10:27.693012 [debug] [Thread-1 (]: On model.customer360.customers: COMMIT
[0m19:10:27.693503 [debug] [Thread-1 (]: Using postgres connection "model.customer360.customers"
[0m19:10:27.694018 [debug] [Thread-1 (]: On model.customer360.customers: COMMIT
[0m19:10:27.695887 [debug] [Thread-1 (]: SQL status: COMMIT in 0.0 seconds
[0m19:10:27.699809 [debug] [Thread-1 (]: Applying DROP to: "dbt"."public"."customers__dbt_backup"
[0m19:10:27.700980 [debug] [Thread-1 (]: Using postgres connection "model.customer360.customers"
[0m19:10:27.701500 [debug] [Thread-1 (]: On model.customer360.customers: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.customers"} */
drop table if exists "dbt"."public"."customers__dbt_backup" cascade
[0m19:10:27.704485 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.0 seconds
[0m19:10:27.706630 [debug] [Thread-1 (]: Timing info for model.customer360.customers (execute): 19:10:27.650665 => 19:10:27.706326
[0m19:10:27.707185 [debug] [Thread-1 (]: On model.customer360.customers: Close
[0m19:10:27.708207 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1ff33c03-57ed-49d3-beb1-782015bc0e81', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f21674e41d0>]}
[0m19:10:27.708910 [info ] [Thread-1 (]: 4 of 4 OK created sql table model public.customers ............................. [[32mSELECT 9[0m in 0.06s]
[0m19:10:27.711925 [debug] [Thread-1 (]: Finished running node model.customer360.customers
[0m19:10:27.713972 [debug] [MainThread]: Using postgres connection "master"
[0m19:10:27.714468 [debug] [MainThread]: On master: BEGIN
[0m19:10:27.714864 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m19:10:27.721488 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m19:10:27.721971 [debug] [MainThread]: On master: COMMIT
[0m19:10:27.722385 [debug] [MainThread]: Using postgres connection "master"
[0m19:10:27.722743 [debug] [MainThread]: On master: COMMIT
[0m19:10:27.723355 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m19:10:27.723789 [debug] [MainThread]: On master: Close
[0m19:10:27.724592 [debug] [MainThread]: Connection 'master' was properly closed.
[0m19:10:27.724846 [debug] [MainThread]: Connection 'model.customer360.customers' was properly closed.
[0m19:10:27.725095 [debug] [MainThread]: Connection 'model.customer360.stg_web__transactions' was properly closed.
[0m19:10:27.725401 [debug] [MainThread]: Connection 'model.customer360.contacts_joined_with_transactions' was properly closed.
[0m19:10:27.725819 [info ] [MainThread]: 
[0m19:10:27.726233 [info ] [MainThread]: Finished running 3 table models, 1 view model in 0 hours 0 minutes and 0.40 seconds (0.40s).
[0m19:10:27.727700 [debug] [MainThread]: Command end result
[0m19:10:27.736818 [info ] [MainThread]: 
[0m19:10:27.737343 [info ] [MainThread]: [32mCompleted successfully[0m
[0m19:10:27.737712 [info ] [MainThread]: 
[0m19:10:27.738112 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 TOTAL=4
[0m19:10:27.739018 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 1.1466155, "process_user_time": 2.968301, "process_kernel_time": 0.100821, "process_mem_max_rss": "105668", "process_out_blocks": "2640", "process_in_blocks": "0"}
[0m19:10:27.739607 [debug] [MainThread]: Command `dbt run` succeeded at 19:10:27.739470 after 1.15 seconds
[0m19:10:27.740041 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2169725d90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f216db42a50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f216b06d290>]}
[0m19:10:27.740511 [debug] [MainThread]: Flushing usage events
[0m19:45:13.478750 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd1341f88d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd134aadc50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd134227210>]}


============================== 19:45:13.482196 | fd74f301-6783-44d6-9756-521af174ed2c ==============================
[0m19:45:13.482196 [info ] [MainThread]: Running with dbt=1.7.8
[0m19:45:13.482917 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': '/root/option1-customer360/integration_tests/logs', 'fail_fast': 'False', 'profiles_dir': '/root/option1-customer360/integration_tests', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m19:45:13.669544 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'fd74f301-6783-44d6-9756-521af174ed2c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd134226e10>]}
[0m19:45:13.744151 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'fd74f301-6783-44d6-9756-521af174ed2c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd1340f8dd0>]}
[0m19:45:13.744870 [info ] [MainThread]: Registered adapter: postgres=1.7.8
[0m19:45:13.755850 [debug] [MainThread]: checksum: 67f0013ca5f0bd43af9a0873dd50792fde83ef69de63b71cacd0b4ac656c52e5, vars: {}, profile: , target: , version: 1.7.8
[0m19:45:13.777159 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m19:45:13.779644 [debug] [MainThread]: Partial parsing: updated file: integration_tests://seeds/transactions.csv
[0m19:45:14.088260 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'fd74f301-6783-44d6-9756-521af174ed2c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd132614a50>]}
[0m19:45:14.116246 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'fd74f301-6783-44d6-9756-521af174ed2c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd13256d6d0>]}
[0m19:45:14.116912 [info ] [MainThread]: Found 2 seeds, 4 models, 9 tests, 2 sources, 0 exposures, 0 metrics, 403 macros, 0 groups, 0 semantic models
[0m19:45:14.117780 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'fd74f301-6783-44d6-9756-521af174ed2c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd13251dbd0>]}
[0m19:45:14.119916 [info ] [MainThread]: 
[0m19:45:14.123932 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m19:45:14.136005 [debug] [ThreadPool]: Acquiring new postgres connection 'list_dbt'
[0m19:45:14.167066 [debug] [ThreadPool]: Using postgres connection "list_dbt"
[0m19:45:14.167594 [debug] [ThreadPool]: On list_dbt: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "connection_name": "list_dbt"} */

    select distinct nspname from pg_namespace
  
[0m19:45:14.168004 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:45:14.205716 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.0 seconds
[0m19:45:14.207534 [debug] [ThreadPool]: On list_dbt: Close
[0m19:45:14.222023 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dbt, now list_dbt_public)
[0m19:45:14.235521 [debug] [ThreadPool]: Using postgres connection "list_dbt_public"
[0m19:45:14.236016 [debug] [ThreadPool]: On list_dbt_public: BEGIN
[0m19:45:14.236409 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:45:14.260037 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m19:45:14.260641 [debug] [ThreadPool]: Using postgres connection "list_dbt_public"
[0m19:45:14.261066 [debug] [ThreadPool]: On list_dbt_public: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "connection_name": "list_dbt_public"} */
select
      'dbt' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'dbt' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'dbt' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m19:45:14.265253 [debug] [ThreadPool]: SQL status: SELECT 6 in 0.0 seconds
[0m19:45:14.267623 [debug] [ThreadPool]: On list_dbt_public: ROLLBACK
[0m19:45:14.268244 [debug] [ThreadPool]: On list_dbt_public: Close
[0m19:45:14.277914 [debug] [MainThread]: Using postgres connection "master"
[0m19:45:14.278860 [debug] [MainThread]: On master: BEGIN
[0m19:45:14.279266 [debug] [MainThread]: Opening a new connection, currently in state init
[0m19:45:14.287623 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m19:45:14.288197 [debug] [MainThread]: Using postgres connection "master"
[0m19:45:14.288823 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m19:45:14.304195 [debug] [MainThread]: SQL status: SELECT 2 in 0.0 seconds
[0m19:45:14.306649 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'fd74f301-6783-44d6-9756-521af174ed2c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd1326cccd0>]}
[0m19:45:14.307249 [debug] [MainThread]: On master: ROLLBACK
[0m19:45:14.307918 [debug] [MainThread]: Using postgres connection "master"
[0m19:45:14.308376 [debug] [MainThread]: On master: BEGIN
[0m19:45:14.309234 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m19:45:14.309645 [debug] [MainThread]: On master: COMMIT
[0m19:45:14.310037 [debug] [MainThread]: Using postgres connection "master"
[0m19:45:14.310457 [debug] [MainThread]: On master: COMMIT
[0m19:45:14.311013 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m19:45:14.311453 [debug] [MainThread]: On master: Close
[0m19:45:14.312475 [info ] [MainThread]: Concurrency: 3 threads (target='local')
[0m19:45:14.312909 [info ] [MainThread]: 
[0m19:45:14.352935 [debug] [Thread-1 (]: Began running node model.customer360.stg_sf__contacts
[0m19:45:14.353713 [info ] [Thread-1 (]: 1 of 4 START sql table model public.stg_sf__contacts ........................... [RUN]
[0m19:45:14.354712 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dbt_public, now model.customer360.stg_sf__contacts)
[0m19:45:14.355250 [debug] [Thread-1 (]: Began compiling node model.customer360.stg_sf__contacts
[0m19:45:14.368672 [debug] [Thread-2 (]: Began running node model.customer360.stg_web__transactions
[0m19:45:14.369359 [info ] [Thread-2 (]: 2 of 4 START sql table model public.stg_web__transactions ...................... [RUN]
[0m19:45:14.370448 [debug] [Thread-2 (]: Acquiring new postgres connection 'model.customer360.stg_web__transactions'
[0m19:45:14.370980 [debug] [Thread-2 (]: Began compiling node model.customer360.stg_web__transactions
[0m19:45:14.377703 [debug] [Thread-2 (]: Writing injected SQL for node "model.customer360.stg_web__transactions"
[0m19:45:14.378600 [debug] [Thread-2 (]: Timing info for model.customer360.stg_web__transactions (compile): 19:45:14.371288 => 19:45:14.378275
[0m19:45:14.379155 [debug] [Thread-2 (]: Began executing node model.customer360.stg_web__transactions
[0m19:45:14.394604 [debug] [Thread-1 (]: Writing injected SQL for node "model.customer360.stg_sf__contacts"
[0m19:45:14.395544 [debug] [Thread-1 (]: Timing info for model.customer360.stg_sf__contacts (compile): 19:45:14.355616 => 19:45:14.395225
[0m19:45:14.396011 [debug] [Thread-1 (]: Began executing node model.customer360.stg_sf__contacts
[0m19:45:14.497742 [debug] [Thread-1 (]: Writing runtime sql for node "model.customer360.stg_sf__contacts"
[0m19:45:14.498687 [debug] [Thread-1 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m19:45:14.499129 [debug] [Thread-1 (]: On model.customer360.stg_sf__contacts: BEGIN
[0m19:45:14.500042 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:45:14.502595 [debug] [Thread-2 (]: Writing runtime sql for node "model.customer360.stg_web__transactions"
[0m19:45:14.503275 [debug] [Thread-2 (]: Using postgres connection "model.customer360.stg_web__transactions"
[0m19:45:14.503793 [debug] [Thread-2 (]: On model.customer360.stg_web__transactions: BEGIN
[0m19:45:14.504251 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m19:45:14.508821 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m19:45:14.509363 [debug] [Thread-1 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m19:45:14.509888 [debug] [Thread-1 (]: On model.customer360.stg_sf__contacts: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_sf__contacts"} */

  
    

  create  table "dbt"."public"."stg_sf__contacts__dbt_tmp"
  
  
    as
  
  (
    with source as (
    select * from "dbt"."public"."contacts"
),

renamed as (
    select
        id,
        username as user_name,
        name,
        gender,
        address, 
        mail as email_address,
        birthdate as birth_date,
        _loaded_at_utc
    from source     
)

select * from renamed
  );
  
[0m19:45:14.515515 [debug] [Thread-2 (]: SQL status: BEGIN in 0.0 seconds
[0m19:45:14.516055 [debug] [Thread-2 (]: Using postgres connection "model.customer360.stg_web__transactions"
[0m19:45:14.516640 [debug] [Thread-2 (]: On model.customer360.stg_web__transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_web__transactions"} */

  
    

  create  table "dbt"."public"."stg_web__transactions__dbt_tmp"
  
  
    as
  
  (
    with source as (
    select * from "dbt"."public"."transactions"
),

renamed as (
    select
        id,
        contact_id,
        
        to_timestamp(transaction_date,'YYYY-MM-DD HH24:MI:SS.MS') :: timestamp at TIME zone 'UTC'
     as transaction_date,
        amount,
        item_count,
        category, 
        _loaded_at_utc
    from source    
),

clean_older as (
    select * from renamed 
--    where transaction_date >= (current_date - 1)  过滤超过1天的数据
--    where transaction_date >= (to_date('2023-04-12','yyyy-MM-dd') - 1)  --测试用,假设跑数日期为2023-04-12
--    and transaction_date < to_date('2023-04-12','yyyy-MM-dd')
)

select * from clean_older
  );
  
[0m19:45:14.520433 [debug] [Thread-1 (]: SQL status: SELECT 10 in 0.0 seconds
[0m19:45:14.529535 [debug] [Thread-1 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m19:45:14.530091 [debug] [Thread-1 (]: On model.customer360.stg_sf__contacts: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_sf__contacts"} */
alter table "dbt"."public"."stg_sf__contacts" rename to "stg_sf__contacts__dbt_backup"
[0m19:45:14.531323 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m19:45:14.535479 [debug] [Thread-1 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m19:45:14.535986 [debug] [Thread-1 (]: On model.customer360.stg_sf__contacts: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_sf__contacts"} */
alter table "dbt"."public"."stg_sf__contacts__dbt_tmp" rename to "stg_sf__contacts"
[0m19:45:14.537565 [debug] [Thread-2 (]: SQL status: SELECT 74 in 0.0 seconds
[0m19:45:14.541737 [debug] [Thread-2 (]: Using postgres connection "model.customer360.stg_web__transactions"
[0m19:45:14.542450 [debug] [Thread-2 (]: On model.customer360.stg_web__transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_web__transactions"} */
alter table "dbt"."public"."stg_web__transactions" rename to "stg_web__transactions__dbt_backup"
[0m19:45:14.542933 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m19:45:14.550582 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m19:45:14.554846 [debug] [Thread-2 (]: Using postgres connection "model.customer360.stg_web__transactions"
[0m19:45:14.555378 [debug] [Thread-2 (]: On model.customer360.stg_web__transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_web__transactions"} */
alter table "dbt"."public"."stg_web__transactions__dbt_tmp" rename to "stg_web__transactions"
[0m19:45:14.564550 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m19:45:14.584474 [debug] [Thread-2 (]: On model.customer360.stg_web__transactions: COMMIT
[0m19:45:14.585070 [debug] [Thread-2 (]: Using postgres connection "model.customer360.stg_web__transactions"
[0m19:45:14.585625 [debug] [Thread-2 (]: On model.customer360.stg_web__transactions: COMMIT
[0m19:45:14.595366 [debug] [Thread-1 (]: On model.customer360.stg_sf__contacts: COMMIT
[0m19:45:14.595954 [debug] [Thread-1 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m19:45:14.596477 [debug] [Thread-1 (]: On model.customer360.stg_sf__contacts: COMMIT
[0m19:45:14.599546 [debug] [Thread-2 (]: SQL status: COMMIT in 0.0 seconds
[0m19:45:14.609011 [debug] [Thread-2 (]: Applying DROP to: "dbt"."public"."stg_web__transactions__dbt_backup"
[0m19:45:14.619587 [debug] [Thread-2 (]: Using postgres connection "model.customer360.stg_web__transactions"
[0m19:45:14.620158 [debug] [Thread-2 (]: On model.customer360.stg_web__transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_web__transactions"} */
drop table if exists "dbt"."public"."stg_web__transactions__dbt_backup" cascade
[0m19:45:14.620809 [debug] [Thread-1 (]: SQL status: COMMIT in 0.0 seconds
[0m19:45:14.626885 [debug] [Thread-1 (]: Applying DROP to: "dbt"."public"."stg_sf__contacts__dbt_backup"
[0m19:45:14.628964 [debug] [Thread-1 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m19:45:14.629565 [debug] [Thread-1 (]: On model.customer360.stg_sf__contacts: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_sf__contacts"} */
drop table if exists "dbt"."public"."stg_sf__contacts__dbt_backup" cascade
[0m19:45:14.630138 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.0 seconds
[0m19:45:14.632234 [debug] [Thread-2 (]: Timing info for model.customer360.stg_web__transactions (execute): 19:45:14.379466 => 19:45:14.631913
[0m19:45:14.632778 [debug] [Thread-2 (]: On model.customer360.stg_web__transactions: Close
[0m19:45:14.633999 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fd74f301-6783-44d6-9756-521af174ed2c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd132377b50>]}
[0m19:45:14.639271 [info ] [Thread-2 (]: 2 of 4 OK created sql table model public.stg_web__transactions ................. [[32mSELECT 74[0m in 0.26s]
[0m19:45:14.640058 [debug] [Thread-2 (]: Finished running node model.customer360.stg_web__transactions
[0m19:45:14.638393 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.0 seconds
[0m19:45:14.642405 [debug] [Thread-1 (]: Timing info for model.customer360.stg_sf__contacts (execute): 19:45:14.396399 => 19:45:14.642110
[0m19:45:14.642898 [debug] [Thread-1 (]: On model.customer360.stg_sf__contacts: Close
[0m19:45:14.646930 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fd74f301-6783-44d6-9756-521af174ed2c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd13253ea90>]}
[0m19:45:14.647684 [info ] [Thread-1 (]: 1 of 4 OK created sql table model public.stg_sf__contacts ...................... [[32mSELECT 10[0m in 0.29s]
[0m19:45:14.648481 [debug] [Thread-1 (]: Finished running node model.customer360.stg_sf__contacts
[0m19:45:14.649452 [debug] [Thread-3 (]: Began running node model.customer360.contacts_joined_with_transactions
[0m19:45:14.650054 [info ] [Thread-3 (]: 3 of 4 START sql view model public.contacts_joined_with_transactions ........... [RUN]
[0m19:45:14.651038 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.customer360.contacts_joined_with_transactions'
[0m19:45:14.652306 [debug] [Thread-3 (]: Began compiling node model.customer360.contacts_joined_with_transactions
[0m19:45:14.656458 [debug] [Thread-3 (]: Writing injected SQL for node "model.customer360.contacts_joined_with_transactions"
[0m19:45:14.657214 [debug] [Thread-3 (]: Timing info for model.customer360.contacts_joined_with_transactions (compile): 19:45:14.652580 => 19:45:14.656924
[0m19:45:14.657698 [debug] [Thread-3 (]: Began executing node model.customer360.contacts_joined_with_transactions
[0m19:45:14.683596 [debug] [Thread-3 (]: Writing runtime sql for node "model.customer360.contacts_joined_with_transactions"
[0m19:45:14.684391 [debug] [Thread-3 (]: Using postgres connection "model.customer360.contacts_joined_with_transactions"
[0m19:45:14.684875 [debug] [Thread-3 (]: On model.customer360.contacts_joined_with_transactions: BEGIN
[0m19:45:14.685374 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m19:45:14.690136 [debug] [Thread-3 (]: SQL status: BEGIN in 0.0 seconds
[0m19:45:14.690657 [debug] [Thread-3 (]: Using postgres connection "model.customer360.contacts_joined_with_transactions"
[0m19:45:14.691164 [debug] [Thread-3 (]: On model.customer360.contacts_joined_with_transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.contacts_joined_with_transactions"} */

  create view "dbt"."public"."contacts_joined_with_transactions__dbt_tmp"
    
    
  as (
    SELECT 
    contacts.*,
    transactions.id as transaction_id,
    transactions.transaction_date,
    transactions.amount,
    transactions.item_count,
    transactions.category
FROM "dbt"."public"."stg_web__transactions" as transactions
LEFT JOIN "dbt"."public"."stg_sf__contacts" as contacts ON contacts.id = transactions.contact_id
  );
[0m19:45:14.693862 [debug] [Thread-3 (]: SQL status: CREATE VIEW in 0.0 seconds
[0m19:45:14.697916 [debug] [Thread-3 (]: Using postgres connection "model.customer360.contacts_joined_with_transactions"
[0m19:45:14.698434 [debug] [Thread-3 (]: On model.customer360.contacts_joined_with_transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.contacts_joined_with_transactions"} */
alter table "dbt"."public"."contacts_joined_with_transactions__dbt_tmp" rename to "contacts_joined_with_transactions"
[0m19:45:14.699437 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m19:45:14.703862 [debug] [Thread-3 (]: On model.customer360.contacts_joined_with_transactions: COMMIT
[0m19:45:14.704362 [debug] [Thread-3 (]: Using postgres connection "model.customer360.contacts_joined_with_transactions"
[0m19:45:14.704834 [debug] [Thread-3 (]: On model.customer360.contacts_joined_with_transactions: COMMIT
[0m19:45:14.706895 [debug] [Thread-3 (]: SQL status: COMMIT in 0.0 seconds
[0m19:45:14.710330 [debug] [Thread-3 (]: Applying DROP to: "dbt"."public"."contacts_joined_with_transactions__dbt_backup"
[0m19:45:14.714693 [debug] [Thread-3 (]: Using postgres connection "model.customer360.contacts_joined_with_transactions"
[0m19:45:14.715235 [debug] [Thread-3 (]: On model.customer360.contacts_joined_with_transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.contacts_joined_with_transactions"} */
drop view if exists "dbt"."public"."contacts_joined_with_transactions__dbt_backup" cascade
[0m19:45:14.716155 [debug] [Thread-3 (]: SQL status: DROP VIEW in 0.0 seconds
[0m19:45:14.718140 [debug] [Thread-3 (]: Timing info for model.customer360.contacts_joined_with_transactions (execute): 19:45:14.657978 => 19:45:14.717832
[0m19:45:14.718847 [debug] [Thread-3 (]: On model.customer360.contacts_joined_with_transactions: Close
[0m19:45:14.719859 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fd74f301-6783-44d6-9756-521af174ed2c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd1323e2310>]}
[0m19:45:14.722854 [info ] [Thread-3 (]: 3 of 4 OK created sql view model public.contacts_joined_with_transactions ...... [[32mCREATE VIEW[0m in 0.07s]
[0m19:45:14.723713 [debug] [Thread-3 (]: Finished running node model.customer360.contacts_joined_with_transactions
[0m19:45:14.724667 [debug] [Thread-1 (]: Began running node model.customer360.customers
[0m19:45:14.725222 [info ] [Thread-1 (]: 4 of 4 START sql table model public.customers .................................. [RUN]
[0m19:45:14.726137 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.customer360.stg_sf__contacts, now model.customer360.customers)
[0m19:45:14.726682 [debug] [Thread-1 (]: Began compiling node model.customer360.customers
[0m19:45:14.731871 [debug] [Thread-1 (]: Writing injected SQL for node "model.customer360.customers"
[0m19:45:14.732747 [debug] [Thread-1 (]: Timing info for model.customer360.customers (compile): 19:45:14.726976 => 19:45:14.732409
[0m19:45:14.733236 [debug] [Thread-1 (]: Began executing node model.customer360.customers
[0m19:45:14.740066 [debug] [Thread-1 (]: Writing runtime sql for node "model.customer360.customers"
[0m19:45:14.740814 [debug] [Thread-1 (]: Using postgres connection "model.customer360.customers"
[0m19:45:14.741521 [debug] [Thread-1 (]: On model.customer360.customers: BEGIN
[0m19:45:14.742029 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:45:14.746769 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m19:45:14.747344 [debug] [Thread-1 (]: Using postgres connection "model.customer360.customers"
[0m19:45:14.747884 [debug] [Thread-1 (]: On model.customer360.customers: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.customers"} */

  
    

  create  table "dbt"."public"."customers__dbt_tmp"
  
  
    as
  
  (
    SELECT
    id,
    gender,
    
    date_part('year', age(current_date, birth_date))
 AS age,
    sum(amount) as total_expense,
    date(min(transaction_date)) as first_purchase_date,
    date(max(transaction_date)) as last_purchase_date,
    sum(case when category = 'Apps & Games' then amount else 0 end) as apps_games_amount,
    sum(case when category = 'Beauty' then amount else 0 end)   as beauty_amount,
    sum(case when category = 'Books' then amount else 0 end)   as books_amount,
    sum(case when category = 'Clothing, Shoes & Accessories' then amount else 0 end)   as clothing_shoes_accessories_amount,
    sum(case when category = 'Movies & TV' then amount else 0 end)   as movies_tv_amount,
    sum(case when category = 'Sports, Fitness & Outdoors' then amount else 0 end)   as sports_fitness_outdoors_amount
FROM  "dbt"."public"."contacts_joined_with_transactions"
GROUP BY
    1,2,3
  );
  
[0m19:45:14.755615 [debug] [Thread-1 (]: SQL status: SELECT 9 in 0.0 seconds
[0m19:45:14.760045 [debug] [Thread-1 (]: Using postgres connection "model.customer360.customers"
[0m19:45:14.760595 [debug] [Thread-1 (]: On model.customer360.customers: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.customers"} */
alter table "dbt"."public"."customers" rename to "customers__dbt_backup"
[0m19:45:14.761553 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m19:45:14.765609 [debug] [Thread-1 (]: Using postgres connection "model.customer360.customers"
[0m19:45:14.766122 [debug] [Thread-1 (]: On model.customer360.customers: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.customers"} */
alter table "dbt"."public"."customers__dbt_tmp" rename to "customers"
[0m19:45:14.767069 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m19:45:14.770341 [debug] [Thread-1 (]: On model.customer360.customers: COMMIT
[0m19:45:14.770871 [debug] [Thread-1 (]: Using postgres connection "model.customer360.customers"
[0m19:45:14.771373 [debug] [Thread-1 (]: On model.customer360.customers: COMMIT
[0m19:45:14.773431 [debug] [Thread-1 (]: SQL status: COMMIT in 0.0 seconds
[0m19:45:14.777079 [debug] [Thread-1 (]: Applying DROP to: "dbt"."public"."customers__dbt_backup"
[0m19:45:14.778358 [debug] [Thread-1 (]: Using postgres connection "model.customer360.customers"
[0m19:45:14.778884 [debug] [Thread-1 (]: On model.customer360.customers: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.customers"} */
drop table if exists "dbt"."public"."customers__dbt_backup" cascade
[0m19:45:14.782380 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.0 seconds
[0m19:45:14.784550 [debug] [Thread-1 (]: Timing info for model.customer360.customers (execute): 19:45:14.733530 => 19:45:14.784248
[0m19:45:14.785066 [debug] [Thread-1 (]: On model.customer360.customers: Close
[0m19:45:14.786119 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fd74f301-6783-44d6-9756-521af174ed2c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd13253e450>]}
[0m19:45:14.786867 [info ] [Thread-1 (]: 4 of 4 OK created sql table model public.customers ............................. [[32mSELECT 9[0m in 0.06s]
[0m19:45:14.790137 [debug] [Thread-1 (]: Finished running node model.customer360.customers
[0m19:45:14.791955 [debug] [MainThread]: Using postgres connection "master"
[0m19:45:14.792428 [debug] [MainThread]: On master: BEGIN
[0m19:45:14.792816 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m19:45:14.797692 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m19:45:14.798151 [debug] [MainThread]: On master: COMMIT
[0m19:45:14.798553 [debug] [MainThread]: Using postgres connection "master"
[0m19:45:14.798939 [debug] [MainThread]: On master: COMMIT
[0m19:45:14.799481 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m19:45:14.799878 [debug] [MainThread]: On master: Close
[0m19:45:14.800731 [debug] [MainThread]: Connection 'master' was properly closed.
[0m19:45:14.801090 [debug] [MainThread]: Connection 'model.customer360.customers' was properly closed.
[0m19:45:14.801477 [debug] [MainThread]: Connection 'model.customer360.stg_web__transactions' was properly closed.
[0m19:45:14.801841 [debug] [MainThread]: Connection 'model.customer360.contacts_joined_with_transactions' was properly closed.
[0m19:45:14.802280 [info ] [MainThread]: 
[0m19:45:14.802753 [info ] [MainThread]: Finished running 3 table models, 1 view model in 0 hours 0 minutes and 0.68 seconds (0.68s).
[0m19:45:14.804171 [debug] [MainThread]: Command end result
[0m19:45:14.815461 [info ] [MainThread]: 
[0m19:45:14.816006 [info ] [MainThread]: [32mCompleted successfully[0m
[0m19:45:14.816472 [info ] [MainThread]: 
[0m19:45:14.816916 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 TOTAL=4
[0m19:45:14.817878 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 1.4534057, "process_user_time": 2.873137, "process_kernel_time": 0.103208, "process_mem_max_rss": "105408", "process_out_blocks": "2640", "process_in_blocks": "0"}
[0m19:45:14.818940 [debug] [MainThread]: Command `dbt run` succeeded at 19:45:14.818770 after 1.45 seconds
[0m19:45:14.819426 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd135995290>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd138642a90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd1387bcdd0>]}
[0m19:45:14.819898 [debug] [MainThread]: Flushing usage events
[0m19:45:48.630210 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fde6cb98c10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fde6cb98910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fde6cbc5bd0>]}


============================== 19:45:48.633810 | 85e9e249-7dca-48c1-99d3-5b218895346c ==============================
[0m19:45:48.633810 [info ] [MainThread]: Running with dbt=1.7.8
[0m19:45:48.634694 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/root/option1-customer360/integration_tests', 'debug': 'False', 'version_check': 'True', 'log_path': '/root/option1-customer360/integration_tests/logs', 'warn_error': 'None', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'invocation_command': 'dbt build', 'send_anonymous_usage_stats': 'True'}
[0m19:45:49.095811 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '85e9e249-7dca-48c1-99d3-5b218895346c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fde6cbb8790>]}
[0m19:45:49.271379 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '85e9e249-7dca-48c1-99d3-5b218895346c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fde6aff1a90>]}
[0m19:45:49.272367 [info ] [MainThread]: Registered adapter: postgres=1.7.8
[0m19:45:49.292835 [debug] [MainThread]: checksum: 67f0013ca5f0bd43af9a0873dd50792fde83ef69de63b71cacd0b4ac656c52e5, vars: {}, profile: , target: , version: 1.7.8
[0m19:45:49.328039 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m19:45:49.328580 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m19:45:49.337910 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '85e9e249-7dca-48c1-99d3-5b218895346c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fde6cbd0e90>]}
[0m19:45:49.351728 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '85e9e249-7dca-48c1-99d3-5b218895346c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fde6afcdc50>]}
[0m19:45:49.352431 [info ] [MainThread]: Found 2 seeds, 4 models, 9 tests, 2 sources, 0 exposures, 0 metrics, 403 macros, 0 groups, 0 semantic models
[0m19:45:49.355427 [info ] [MainThread]: 
[0m19:45:49.356497 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m19:45:49.358233 [debug] [ThreadPool]: Acquiring new postgres connection 'list_dbt'
[0m19:45:49.373370 [debug] [ThreadPool]: Using postgres connection "list_dbt"
[0m19:45:49.373930 [debug] [ThreadPool]: On list_dbt: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "connection_name": "list_dbt"} */

    select distinct nspname from pg_namespace
  
[0m19:45:49.374366 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:45:49.383453 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.0 seconds
[0m19:45:49.385336 [debug] [ThreadPool]: On list_dbt: Close
[0m19:45:49.395772 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dbt, now list_dbt_public)
[0m19:45:49.404719 [debug] [ThreadPool]: Using postgres connection "list_dbt_public"
[0m19:45:49.405247 [debug] [ThreadPool]: On list_dbt_public: BEGIN
[0m19:45:49.406591 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:45:49.413447 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m19:45:49.413994 [debug] [ThreadPool]: Using postgres connection "list_dbt_public"
[0m19:45:49.414468 [debug] [ThreadPool]: On list_dbt_public: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "connection_name": "list_dbt_public"} */
select
      'dbt' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'dbt' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'dbt' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m19:45:49.419234 [debug] [ThreadPool]: SQL status: SELECT 6 in 0.0 seconds
[0m19:45:49.421203 [debug] [ThreadPool]: On list_dbt_public: ROLLBACK
[0m19:45:49.421940 [debug] [ThreadPool]: On list_dbt_public: Close
[0m19:45:49.432689 [debug] [MainThread]: Using postgres connection "master"
[0m19:45:49.433197 [debug] [MainThread]: On master: BEGIN
[0m19:45:49.433679 [debug] [MainThread]: Opening a new connection, currently in state init
[0m19:45:49.439332 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m19:45:49.439817 [debug] [MainThread]: Using postgres connection "master"
[0m19:45:49.440437 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m19:45:49.456011 [debug] [MainThread]: SQL status: SELECT 2 in 0.0 seconds
[0m19:45:49.458459 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '85e9e249-7dca-48c1-99d3-5b218895346c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fde6cb73610>]}
[0m19:45:49.459077 [debug] [MainThread]: On master: ROLLBACK
[0m19:45:49.460112 [debug] [MainThread]: Using postgres connection "master"
[0m19:45:49.460518 [debug] [MainThread]: On master: BEGIN
[0m19:45:49.461462 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m19:45:49.461927 [debug] [MainThread]: On master: COMMIT
[0m19:45:49.462322 [debug] [MainThread]: Using postgres connection "master"
[0m19:45:49.462787 [debug] [MainThread]: On master: COMMIT
[0m19:45:49.463353 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m19:45:49.463832 [debug] [MainThread]: On master: Close
[0m19:45:49.464774 [info ] [MainThread]: Concurrency: 3 threads (target='local')
[0m19:45:49.465201 [info ] [MainThread]: 
[0m19:45:49.470740 [debug] [Thread-1 (]: Began running node seed.integration_tests.contacts
[0m19:45:49.471463 [info ] [Thread-1 (]: 1 of 15 START seed file public.contacts ........................................ [RUN]
[0m19:45:49.472514 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dbt_public, now seed.integration_tests.contacts)
[0m19:45:49.472964 [debug] [Thread-1 (]: Began compiling node seed.integration_tests.contacts
[0m19:45:49.473649 [debug] [Thread-1 (]: Timing info for seed.integration_tests.contacts (compile): 19:45:49.473249 => 19:45:49.473252
[0m19:45:49.474087 [debug] [Thread-1 (]: Began executing node seed.integration_tests.contacts
[0m19:45:49.482573 [debug] [Thread-2 (]: Began running node seed.integration_tests.transactions
[0m19:45:49.483257 [info ] [Thread-2 (]: 2 of 15 START seed file public.transactions .................................... [RUN]
[0m19:45:49.484345 [debug] [Thread-2 (]: Acquiring new postgres connection 'seed.integration_tests.transactions'
[0m19:45:49.484815 [debug] [Thread-2 (]: Began compiling node seed.integration_tests.transactions
[0m19:45:49.485479 [debug] [Thread-2 (]: Timing info for seed.integration_tests.transactions (compile): 19:45:49.485189 => 19:45:49.485192
[0m19:45:49.485876 [debug] [Thread-2 (]: Began executing node seed.integration_tests.transactions
[0m19:45:49.493057 [debug] [Thread-3 (]: Began running node test.customer360.macro_test1
[0m19:45:49.493642 [info ] [Thread-3 (]: 3 of 15 START test macro_test1 ................................................. [RUN]
[0m19:45:49.494707 [debug] [Thread-3 (]: Acquiring new postgres connection 'test.customer360.macro_test1'
[0m19:45:49.495256 [debug] [Thread-3 (]: Began compiling node test.customer360.macro_test1
[0m19:45:49.538873 [debug] [Thread-3 (]: Writing injected SQL for node "test.customer360.macro_test1"
[0m19:45:49.539870 [debug] [Thread-3 (]: Timing info for test.customer360.macro_test1 (compile): 19:45:49.495680 => 19:45:49.539477
[0m19:45:49.540407 [debug] [Thread-3 (]: Began executing node test.customer360.macro_test1
[0m19:45:49.584259 [debug] [Thread-1 (]: Using postgres connection "seed.integration_tests.contacts"
[0m19:45:49.584898 [debug] [Thread-1 (]: On seed.integration_tests.contacts: BEGIN
[0m19:45:49.585368 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:45:49.601116 [debug] [Thread-2 (]: Using postgres connection "seed.integration_tests.transactions"
[0m19:45:49.601772 [debug] [Thread-2 (]: On seed.integration_tests.transactions: BEGIN
[0m19:45:49.602409 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m19:45:49.606983 [debug] [Thread-3 (]: Writing runtime sql for node "test.customer360.macro_test1"
[0m19:45:49.607773 [debug] [Thread-3 (]: Using postgres connection "test.customer360.macro_test1"
[0m19:45:49.608352 [debug] [Thread-3 (]: On test.customer360.macro_test1: BEGIN
[0m19:45:49.608808 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m19:45:49.615763 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m19:45:49.616496 [debug] [Thread-1 (]: Using postgres connection "seed.integration_tests.contacts"
[0m19:45:49.617048 [debug] [Thread-1 (]: On seed.integration_tests.contacts: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "seed.integration_tests.contacts"} */
truncate table "dbt"."public"."contacts"
[0m19:45:49.617586 [debug] [Thread-3 (]: SQL status: BEGIN in 0.0 seconds
[0m19:45:49.618126 [debug] [Thread-3 (]: Using postgres connection "test.customer360.macro_test1"
[0m19:45:49.618611 [debug] [Thread-3 (]: On test.customer360.macro_test1: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.macro_test1"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      with marco_result as (
    select 
    date_part('year', age(current_date, '2023-02-12'))
 as expect_result
)
select
    1
from marco_result
where expect_result <> 1
      
    ) dbt_internal_test
[0m19:45:49.621723 [debug] [Thread-3 (]: SQL status: SELECT 1 in 0.0 seconds
[0m19:45:49.624649 [debug] [Thread-3 (]: Timing info for test.customer360.macro_test1 (execute): 19:45:49.540777 => 19:45:49.624326
[0m19:45:49.625263 [debug] [Thread-3 (]: On test.customer360.macro_test1: ROLLBACK
[0m19:45:49.626237 [debug] [Thread-3 (]: On test.customer360.macro_test1: Close
[0m19:45:49.629400 [info ] [Thread-3 (]: 3 of 15 PASS macro_test1 ....................................................... [[32mPASS[0m in 0.14s]
[0m19:45:49.627804 [debug] [Thread-2 (]: SQL status: BEGIN in 0.0 seconds
[0m19:45:49.631107 [debug] [Thread-2 (]: Using postgres connection "seed.integration_tests.transactions"
[0m19:45:49.631688 [debug] [Thread-2 (]: On seed.integration_tests.transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "seed.integration_tests.transactions"} */
truncate table "dbt"."public"."transactions"
[0m19:45:49.630459 [debug] [Thread-3 (]: Finished running node test.customer360.macro_test1
[0m19:45:49.632337 [debug] [Thread-3 (]: Began running node test.customer360.macro_test2
[0m19:45:49.632856 [info ] [Thread-3 (]: 4 of 15 START test macro_test2 ................................................. [RUN]
[0m19:45:49.633809 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.customer360.macro_test1, now test.customer360.macro_test2)
[0m19:45:49.634341 [debug] [Thread-3 (]: Began compiling node test.customer360.macro_test2
[0m19:45:49.642442 [debug] [Thread-3 (]: Writing injected SQL for node "test.customer360.macro_test2"
[0m19:45:49.643328 [debug] [Thread-3 (]: Timing info for test.customer360.macro_test2 (compile): 19:45:49.634725 => 19:45:49.642949
[0m19:45:49.645142 [debug] [Thread-3 (]: Began executing node test.customer360.macro_test2
[0m19:45:49.643905 [debug] [Thread-1 (]: SQL status: TRUNCATE TABLE in 0.0 seconds
[0m19:45:49.648761 [debug] [Thread-3 (]: Writing runtime sql for node "test.customer360.macro_test2"
[0m19:45:49.665513 [debug] [Thread-2 (]: SQL status: TRUNCATE TABLE in 0.0 seconds
[0m19:45:49.673782 [debug] [Thread-3 (]: Using postgres connection "test.customer360.macro_test2"
[0m19:45:49.674351 [debug] [Thread-3 (]: On test.customer360.macro_test2: BEGIN
[0m19:45:49.674944 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m19:45:49.693944 [debug] [Thread-3 (]: SQL status: BEGIN in 0.0 seconds
[0m19:45:49.694678 [debug] [Thread-3 (]: Using postgres connection "test.customer360.macro_test2"
[0m19:45:49.695311 [debug] [Thread-3 (]: On test.customer360.macro_test2: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.macro_test2"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      with marco_result as (
    select 
        to_timestamp('2023-02-27 21:00:00','YYYY-MM-DD HH24:MI:SS.MS') :: timestamp at TIME zone 'UTC'
     as expect_result
)
select
    1
from marco_result
where cast(pg_typeof(expect_result) as text) not like '%timestamp%'
      
    ) dbt_internal_test
[0m19:45:49.720735 [debug] [Thread-3 (]: SQL status: SELECT 1 in 0.0 seconds
[0m19:45:49.723112 [debug] [Thread-3 (]: Timing info for test.customer360.macro_test2 (execute): 19:45:49.645546 => 19:45:49.722744
[0m19:45:49.723726 [debug] [Thread-3 (]: On test.customer360.macro_test2: ROLLBACK
[0m19:45:49.740994 [debug] [Thread-3 (]: On test.customer360.macro_test2: Close
[0m19:45:49.742374 [info ] [Thread-3 (]: 4 of 15 PASS macro_test2 ....................................................... [[32mPASS[0m in 0.11s]
[0m19:45:49.743284 [debug] [Thread-3 (]: Finished running node test.customer360.macro_test2
[0m19:45:49.744026 [debug] [Thread-3 (]: Began running node test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247
[0m19:45:49.747077 [info ] [Thread-3 (]: 5 of 15 START test source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors  [RUN]
[0m19:45:49.748129 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.customer360.macro_test2, now test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247)
[0m19:45:49.748775 [debug] [Thread-3 (]: Began compiling node test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247
[0m19:45:49.808190 [debug] [Thread-3 (]: Writing injected SQL for node "test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247"
[0m19:45:49.819411 [debug] [Thread-1 (]: Using postgres connection "seed.integration_tests.contacts"
[0m19:45:49.819965 [debug] [Thread-1 (]: On seed.integration_tests.contacts: 
          insert into "dbt"."public"."contacts" ("id", "username", "name", "gender", "address", "mail", "birthdate", "_loaded_at_utc") values
          (%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s)
      ...
[0m19:45:49.820609 [debug] [Thread-3 (]: Timing info for test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247 (compile): 19:45:49.749112 => 19:45:49.820378
[0m19:45:49.826465 [debug] [Thread-1 (]: SQL status: INSERT 0 10 in 0.0 seconds
[0m19:45:49.842370 [debug] [Thread-3 (]: Began executing node test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247
[0m19:45:49.873179 [debug] [Thread-3 (]: Writing runtime sql for node "test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247"
[0m19:45:49.873955 [debug] [Thread-3 (]: Using postgres connection "test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247"
[0m19:45:49.874474 [debug] [Thread-3 (]: On test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247: BEGIN
[0m19:45:49.874938 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m19:45:49.869271 [debug] [Thread-1 (]: Writing runtime SQL for node "seed.integration_tests.contacts"
[0m19:45:49.897026 [debug] [Thread-3 (]: SQL status: BEGIN in 0.0 seconds
[0m19:45:49.907792 [debug] [Thread-3 (]: Using postgres connection "test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247"
[0m19:45:49.913405 [debug] [Thread-3 (]: On test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

with all_values as (

    select
        category as value_field,
        count(*) as n_records

    from "dbt"."public"."transactions"
    group by category

)

select *
from all_values
where value_field not in (
    'Apps & Games','Beauty','Books','Clothing, Shoes & Accessories','Movies & TV','Sports, Fitness & Outdoors'
)



      
    ) dbt_internal_test
[0m19:45:49.928953 [debug] [Thread-1 (]: On seed.integration_tests.contacts: COMMIT
[0m19:45:49.934587 [debug] [Thread-1 (]: Using postgres connection "seed.integration_tests.contacts"
[0m19:45:49.934889 [debug] [Thread-1 (]: On seed.integration_tests.contacts: COMMIT
[0m19:45:49.942683 [debug] [Thread-1 (]: SQL status: COMMIT in 0.0 seconds
[0m19:45:50.002178 [debug] [Thread-1 (]: Timing info for seed.integration_tests.contacts (execute): 19:45:49.474541 => 19:45:50.001949
[0m19:45:50.012911 [debug] [Thread-1 (]: On seed.integration_tests.contacts: Close
[0m19:45:50.018771 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '85e9e249-7dca-48c1-99d3-5b218895346c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fde6ca15890>]}
[0m19:45:50.029600 [info ] [Thread-1 (]: 1 of 15 OK loaded seed file public.contacts .................................... [[32mINSERT 10[0m in 0.55s]
[0m19:45:50.040493 [debug] [Thread-1 (]: Finished running node seed.integration_tests.contacts
[0m19:45:50.041058 [debug] [Thread-1 (]: Began running node test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d
[0m19:45:50.044501 [debug] [Thread-2 (]: Using postgres connection "seed.integration_tests.transactions"
[0m19:45:50.045074 [info ] [Thread-1 (]: 6 of 15 START test source_not_null_salesforce_contacts_id ...................... [RUN]
[0m19:45:50.045564 [debug] [Thread-2 (]: On seed.integration_tests.transactions: 
          insert into "dbt"."public"."transactions" ("contact_id", "id", "transaction_date", "amount", "item_count", "category", "_loaded_at_utc") values
          (%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%...
[0m19:45:50.046277 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly seed.integration_tests.contacts, now test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d)
[0m19:45:50.047557 [debug] [Thread-1 (]: Began compiling node test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d
[0m19:45:50.055172 [debug] [Thread-1 (]: Writing injected SQL for node "test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d"
[0m19:45:50.055928 [debug] [Thread-1 (]: Timing info for test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d (compile): 19:45:50.047845 => 19:45:50.055673
[0m19:45:50.056246 [debug] [Thread-1 (]: Began executing node test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d
[0m19:45:50.058576 [debug] [Thread-1 (]: Writing runtime sql for node "test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d"
[0m19:45:50.058964 [debug] [Thread-2 (]: SQL status: INSERT 0 100 in 0.0 seconds
[0m19:45:50.059541 [debug] [Thread-1 (]: Using postgres connection "test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d"
[0m19:45:50.060392 [debug] [Thread-2 (]: Writing runtime SQL for node "seed.integration_tests.transactions"
[0m19:45:50.060764 [debug] [Thread-1 (]: On test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d: BEGIN
[0m19:45:50.061232 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:45:50.063540 [debug] [Thread-2 (]: On seed.integration_tests.transactions: COMMIT
[0m19:45:50.063875 [debug] [Thread-2 (]: Using postgres connection "seed.integration_tests.transactions"
[0m19:45:50.064347 [debug] [Thread-2 (]: On seed.integration_tests.transactions: COMMIT
[0m19:45:50.068854 [debug] [Thread-2 (]: SQL status: COMMIT in 0.0 seconds
[0m19:45:50.069388 [debug] [Thread-3 (]: SQL status: SELECT 1 in 0.0 seconds
[0m19:45:50.069770 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m19:45:50.070749 [debug] [Thread-2 (]: Timing info for seed.integration_tests.transactions (execute): 19:45:49.486219 => 19:45:50.070559
[0m19:45:50.072378 [debug] [Thread-3 (]: Timing info for test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247 (execute): 19:45:49.870087 => 19:45:50.072150
[0m19:45:50.072751 [debug] [Thread-1 (]: Using postgres connection "test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d"
[0m19:45:50.073225 [debug] [Thread-2 (]: On seed.integration_tests.transactions: Close
[0m19:45:50.073633 [debug] [Thread-3 (]: On test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247: ROLLBACK
[0m19:45:50.074109 [debug] [Thread-1 (]: On test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select id
from "dbt"."public"."contacts"
where id is null



      
    ) dbt_internal_test
[0m19:45:50.074843 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '85e9e249-7dca-48c1-99d3-5b218895346c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fde6b184750>]}
[0m19:45:50.077040 [info ] [Thread-2 (]: 2 of 15 OK loaded seed file public.transactions ................................ [[32mINSERT 100[0m in 0.59s]
[0m19:45:50.077760 [debug] [Thread-2 (]: Finished running node seed.integration_tests.transactions
[0m19:45:50.078333 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.0 seconds
[0m19:45:50.078657 [debug] [Thread-3 (]: On test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247: Close
[0m19:45:50.079254 [debug] [Thread-2 (]: Began running node test.customer360.source_not_null_web_transactions_id.88a47bf7e5
[0m19:45:50.082309 [info ] [Thread-2 (]: 7 of 15 START test source_not_null_web_transactions_id ......................... [RUN]
[0m19:45:50.083200 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly seed.integration_tests.transactions, now test.customer360.source_not_null_web_transactions_id.88a47bf7e5)
[0m19:45:50.083747 [debug] [Thread-2 (]: Began compiling node test.customer360.source_not_null_web_transactions_id.88a47bf7e5
[0m19:45:50.081698 [info ] [Thread-3 (]: 5 of 15 PASS source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors  [[32mPASS[0m in 0.33s]
[0m19:45:50.080884 [debug] [Thread-1 (]: Timing info for test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d (execute): 19:45:50.056549 => 19:45:50.080608
[0m19:45:50.088202 [debug] [Thread-2 (]: Writing injected SQL for node "test.customer360.source_not_null_web_transactions_id.88a47bf7e5"
[0m19:45:50.088855 [debug] [Thread-3 (]: Finished running node test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247
[0m19:45:50.089910 [debug] [Thread-3 (]: Began running node test.customer360.source_unique_salesforce_contacts_id.01cadaaf43
[0m19:45:50.090406 [info ] [Thread-3 (]: 8 of 15 START test source_unique_salesforce_contacts_id ........................ [RUN]
[0m19:45:50.089251 [debug] [Thread-1 (]: On test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d: ROLLBACK
[0m19:45:50.090955 [debug] [Thread-2 (]: Timing info for test.customer360.source_not_null_web_transactions_id.88a47bf7e5 (compile): 19:45:50.083967 => 19:45:50.090743
[0m19:45:50.091831 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247, now test.customer360.source_unique_salesforce_contacts_id.01cadaaf43)
[0m19:45:50.092793 [debug] [Thread-3 (]: Began compiling node test.customer360.source_unique_salesforce_contacts_id.01cadaaf43
[0m19:45:50.092270 [debug] [Thread-2 (]: Began executing node test.customer360.source_not_null_web_transactions_id.88a47bf7e5
[0m19:45:50.098609 [debug] [Thread-1 (]: On test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d: Close
[0m19:45:50.100013 [debug] [Thread-3 (]: Writing injected SQL for node "test.customer360.source_unique_salesforce_contacts_id.01cadaaf43"
[0m19:45:50.102838 [debug] [Thread-3 (]: Timing info for test.customer360.source_unique_salesforce_contacts_id.01cadaaf43 (compile): 19:45:50.092995 => 19:45:50.102563
[0m19:45:50.103366 [debug] [Thread-3 (]: Began executing node test.customer360.source_unique_salesforce_contacts_id.01cadaaf43
[0m19:45:50.102068 [debug] [Thread-2 (]: Writing runtime sql for node "test.customer360.source_not_null_web_transactions_id.88a47bf7e5"
[0m19:45:50.105876 [debug] [Thread-3 (]: Writing runtime sql for node "test.customer360.source_unique_salesforce_contacts_id.01cadaaf43"
[0m19:45:50.106651 [info ] [Thread-1 (]: 6 of 15 PASS source_not_null_salesforce_contacts_id ............................ [[32mPASS[0m in 0.06s]
[0m19:45:50.107475 [debug] [Thread-1 (]: Finished running node test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d
[0m19:45:50.107942 [debug] [Thread-1 (]: Began running node test.customer360.source_unique_web_transactions_id.ba28079761
[0m19:45:50.108443 [debug] [Thread-2 (]: Using postgres connection "test.customer360.source_not_null_web_transactions_id.88a47bf7e5"
[0m19:45:50.108867 [info ] [Thread-1 (]: 9 of 15 START test source_unique_web_transactions_id ........................... [RUN]
[0m19:45:50.109433 [debug] [Thread-2 (]: On test.customer360.source_not_null_web_transactions_id.88a47bf7e5: BEGIN
[0m19:45:50.109804 [debug] [Thread-3 (]: Using postgres connection "test.customer360.source_unique_salesforce_contacts_id.01cadaaf43"
[0m19:45:50.110597 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d, now test.customer360.source_unique_web_transactions_id.ba28079761)
[0m19:45:50.110969 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m19:45:50.111500 [debug] [Thread-3 (]: On test.customer360.source_unique_salesforce_contacts_id.01cadaaf43: BEGIN
[0m19:45:50.112499 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m19:45:50.111875 [debug] [Thread-1 (]: Began compiling node test.customer360.source_unique_web_transactions_id.ba28079761
[0m19:45:50.118023 [debug] [Thread-1 (]: Writing injected SQL for node "test.customer360.source_unique_web_transactions_id.ba28079761"
[0m19:45:50.118778 [debug] [Thread-1 (]: Timing info for test.customer360.source_unique_web_transactions_id.ba28079761 (compile): 19:45:50.113323 => 19:45:50.118511
[0m19:45:50.119376 [debug] [Thread-1 (]: Began executing node test.customer360.source_unique_web_transactions_id.ba28079761
[0m19:45:50.121563 [debug] [Thread-1 (]: Writing runtime sql for node "test.customer360.source_unique_web_transactions_id.ba28079761"
[0m19:45:50.122165 [debug] [Thread-1 (]: Using postgres connection "test.customer360.source_unique_web_transactions_id.ba28079761"
[0m19:45:50.122533 [debug] [Thread-1 (]: On test.customer360.source_unique_web_transactions_id.ba28079761: BEGIN
[0m19:45:50.122905 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:45:50.125613 [debug] [Thread-3 (]: SQL status: BEGIN in 0.0 seconds
[0m19:45:50.126180 [debug] [Thread-3 (]: Using postgres connection "test.customer360.source_unique_salesforce_contacts_id.01cadaaf43"
[0m19:45:50.126721 [debug] [Thread-3 (]: On test.customer360.source_unique_salesforce_contacts_id.01cadaaf43: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.source_unique_salesforce_contacts_id.01cadaaf43"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

select
    id as unique_field,
    count(*) as n_records

from "dbt"."public"."contacts"
where id is not null
group by id
having count(*) > 1



      
    ) dbt_internal_test
[0m19:45:50.127849 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m19:45:50.128371 [debug] [Thread-1 (]: Using postgres connection "test.customer360.source_unique_web_transactions_id.ba28079761"
[0m19:45:50.129142 [debug] [Thread-1 (]: On test.customer360.source_unique_web_transactions_id.ba28079761: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.source_unique_web_transactions_id.ba28079761"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

select
    id as unique_field,
    count(*) as n_records

from "dbt"."public"."transactions"
where id is not null
group by id
having count(*) > 1



      
    ) dbt_internal_test
[0m19:45:50.129770 [debug] [Thread-2 (]: SQL status: BEGIN in 0.0 seconds
[0m19:45:50.130285 [debug] [Thread-2 (]: Using postgres connection "test.customer360.source_not_null_web_transactions_id.88a47bf7e5"
[0m19:45:50.130878 [debug] [Thread-2 (]: On test.customer360.source_not_null_web_transactions_id.88a47bf7e5: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.source_not_null_web_transactions_id.88a47bf7e5"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select id
from "dbt"."public"."transactions"
where id is null



      
    ) dbt_internal_test
[0m19:45:50.131367 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.0 seconds
[0m19:45:50.133252 [debug] [Thread-1 (]: Timing info for test.customer360.source_unique_web_transactions_id.ba28079761 (execute): 19:45:50.119586 => 19:45:50.132932
[0m19:45:50.133729 [debug] [Thread-2 (]: SQL status: SELECT 1 in 0.0 seconds
[0m19:45:50.134024 [debug] [Thread-3 (]: SQL status: SELECT 1 in 0.0 seconds
[0m19:45:50.134369 [debug] [Thread-1 (]: On test.customer360.source_unique_web_transactions_id.ba28079761: ROLLBACK
[0m19:45:50.135776 [debug] [Thread-2 (]: Timing info for test.customer360.source_not_null_web_transactions_id.88a47bf7e5 (execute): 19:45:50.100275 => 19:45:50.135576
[0m19:45:50.137067 [debug] [Thread-3 (]: Timing info for test.customer360.source_unique_salesforce_contacts_id.01cadaaf43 (execute): 19:45:50.103639 => 19:45:50.136870
[0m19:45:50.137984 [debug] [Thread-3 (]: On test.customer360.source_unique_salesforce_contacts_id.01cadaaf43: ROLLBACK
[0m19:45:50.137572 [debug] [Thread-2 (]: On test.customer360.source_not_null_web_transactions_id.88a47bf7e5: ROLLBACK
[0m19:45:50.138459 [debug] [Thread-1 (]: On test.customer360.source_unique_web_transactions_id.ba28079761: Close
[0m19:45:50.139603 [info ] [Thread-1 (]: 9 of 15 PASS source_unique_web_transactions_id ................................. [[32mPASS[0m in 0.03s]
[0m19:45:50.140274 [debug] [Thread-1 (]: Finished running node test.customer360.source_unique_web_transactions_id.ba28079761
[0m19:45:50.140923 [debug] [Thread-1 (]: Began running node test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344
[0m19:45:50.141594 [info ] [Thread-1 (]: 10 of 15 START test source_relationships_web_transactions_contact_id__id__ref_contacts_  [RUN]
[0m19:45:50.141979 [debug] [Thread-3 (]: On test.customer360.source_unique_salesforce_contacts_id.01cadaaf43: Close
[0m19:45:50.144681 [info ] [Thread-3 (]: 8 of 15 PASS source_unique_salesforce_contacts_id .............................. [[32mPASS[0m in 0.05s]
[0m19:45:50.145674 [debug] [Thread-3 (]: Finished running node test.customer360.source_unique_salesforce_contacts_id.01cadaaf43
[0m19:45:50.142449 [debug] [Thread-2 (]: On test.customer360.source_not_null_web_transactions_id.88a47bf7e5: Close
[0m19:45:50.147581 [info ] [Thread-2 (]: 7 of 15 PASS source_not_null_web_transactions_id ............................... [[32mPASS[0m in 0.06s]
[0m19:45:50.148367 [debug] [Thread-2 (]: Finished running node test.customer360.source_not_null_web_transactions_id.88a47bf7e5
[0m19:45:50.143169 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.customer360.source_unique_web_transactions_id.ba28079761, now test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344)
[0m19:45:50.149701 [debug] [Thread-1 (]: Began compiling node test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344
[0m19:45:50.149189 [debug] [Thread-3 (]: Began running node model.customer360.stg_sf__contacts
[0m19:45:50.164350 [debug] [Thread-2 (]: Began running node model.customer360.stg_web__transactions
[0m19:45:50.165382 [debug] [Thread-1 (]: Writing injected SQL for node "test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344"
[0m19:45:50.166206 [debug] [Thread-1 (]: Timing info for test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344 (compile): 19:45:50.149989 => 19:45:50.165902
[0m19:45:50.167478 [debug] [Thread-1 (]: Began executing node test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344
[0m19:45:50.163832 [info ] [Thread-3 (]: 11 of 15 START sql table model public.stg_sf__contacts ......................... [RUN]
[0m19:45:50.173478 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.customer360.source_unique_salesforce_contacts_id.01cadaaf43, now model.customer360.stg_sf__contacts)
[0m19:45:50.174043 [debug] [Thread-3 (]: Began compiling node model.customer360.stg_sf__contacts
[0m19:45:50.164994 [info ] [Thread-2 (]: 12 of 15 START sql table model public.stg_web__transactions .................... [RUN]
[0m19:45:50.179628 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.customer360.source_not_null_web_transactions_id.88a47bf7e5, now model.customer360.stg_web__transactions)
[0m19:45:50.180120 [debug] [Thread-2 (]: Began compiling node model.customer360.stg_web__transactions
[0m19:45:50.184402 [debug] [Thread-2 (]: Writing injected SQL for node "model.customer360.stg_web__transactions"
[0m19:45:50.185555 [debug] [Thread-2 (]: Timing info for model.customer360.stg_web__transactions (compile): 19:45:50.180525 => 19:45:50.184874
[0m19:45:50.171326 [debug] [Thread-1 (]: Writing runtime sql for node "test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344"
[0m19:45:50.186914 [debug] [Thread-1 (]: Using postgres connection "test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344"
[0m19:45:50.187542 [debug] [Thread-1 (]: On test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344: BEGIN
[0m19:45:50.188004 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:45:50.178668 [debug] [Thread-3 (]: Writing injected SQL for node "model.customer360.stg_sf__contacts"
[0m19:45:50.189641 [debug] [Thread-3 (]: Timing info for model.customer360.stg_sf__contacts (compile): 19:45:50.174399 => 19:45:50.189314
[0m19:45:50.190213 [debug] [Thread-3 (]: Began executing node model.customer360.stg_sf__contacts
[0m19:45:50.186061 [debug] [Thread-2 (]: Began executing node model.customer360.stg_web__transactions
[0m19:45:50.229626 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m19:45:50.230373 [debug] [Thread-1 (]: Using postgres connection "test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344"
[0m19:45:50.230920 [debug] [Thread-1 (]: On test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

with child as (
    select contact_id as from_field
    from "dbt"."public"."transactions"
    where contact_id is not null
),

parent as (
    select id as to_field
    from "dbt"."public"."contacts"
)

select
    from_field

from child
left join parent
    on child.from_field = parent.to_field

where parent.to_field is null



      
    ) dbt_internal_test
[0m19:45:50.247407 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.0 seconds
[0m19:45:50.249981 [debug] [Thread-1 (]: Timing info for test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344 (execute): 19:45:50.167868 => 19:45:50.249536
[0m19:45:50.250534 [debug] [Thread-1 (]: On test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344: ROLLBACK
[0m19:45:50.265783 [debug] [Thread-1 (]: On test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344: Close
[0m19:45:50.267030 [info ] [Thread-1 (]: 10 of 15 PASS source_relationships_web_transactions_contact_id__id__ref_contacts_  [[32mPASS[0m in 0.12s]
[0m19:45:50.267941 [debug] [Thread-1 (]: Finished running node test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344
[0m19:45:50.307866 [debug] [Thread-2 (]: Writing runtime sql for node "model.customer360.stg_web__transactions"
[0m19:45:50.308788 [debug] [Thread-2 (]: Using postgres connection "model.customer360.stg_web__transactions"
[0m19:45:50.309449 [debug] [Thread-2 (]: On model.customer360.stg_web__transactions: BEGIN
[0m19:45:50.309918 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m19:45:50.311621 [debug] [Thread-3 (]: Writing runtime sql for node "model.customer360.stg_sf__contacts"
[0m19:45:50.312411 [debug] [Thread-3 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m19:45:50.312886 [debug] [Thread-3 (]: On model.customer360.stg_sf__contacts: BEGIN
[0m19:45:50.314218 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m19:45:50.323227 [debug] [Thread-2 (]: SQL status: BEGIN in 0.0 seconds
[0m19:45:50.323859 [debug] [Thread-2 (]: Using postgres connection "model.customer360.stg_web__transactions"
[0m19:45:50.324570 [debug] [Thread-2 (]: On model.customer360.stg_web__transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_web__transactions"} */

  
    

  create  table "dbt"."public"."stg_web__transactions__dbt_tmp"
  
  
    as
  
  (
    with source as (
    select * from "dbt"."public"."transactions"
),

renamed as (
    select
        id,
        contact_id,
        
        to_timestamp(transaction_date,'YYYY-MM-DD HH24:MI:SS.MS') :: timestamp at TIME zone 'UTC'
     as transaction_date,
        amount,
        item_count,
        category, 
        _loaded_at_utc
    from source    
),

clean_older as (
    select * from renamed 
--    where transaction_date >= (current_date - 1)  过滤超过1天的数据
--    where transaction_date >= (to_date('2023-04-12','yyyy-MM-dd') - 1)  --测试用,假设跑数日期为2023-04-12
--    and transaction_date < to_date('2023-04-12','yyyy-MM-dd')
)

select * from clean_older
  );
  
[0m19:45:50.329989 [debug] [Thread-3 (]: SQL status: BEGIN in 0.0 seconds
[0m19:45:50.330692 [debug] [Thread-3 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m19:45:50.331418 [debug] [Thread-3 (]: On model.customer360.stg_sf__contacts: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_sf__contacts"} */

  
    

  create  table "dbt"."public"."stg_sf__contacts__dbt_tmp"
  
  
    as
  
  (
    with source as (
    select * from "dbt"."public"."contacts"
),

renamed as (
    select
        id,
        username as user_name,
        name,
        gender,
        address, 
        mail as email_address,
        birthdate as birth_date,
        _loaded_at_utc
    from source     
)

select * from renamed
  );
  
[0m19:45:50.343981 [debug] [Thread-2 (]: SQL status: SELECT 100 in 0.0 seconds
[0m19:45:50.361854 [debug] [Thread-3 (]: SQL status: SELECT 10 in 0.0 seconds
[0m19:45:50.371571 [debug] [Thread-3 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m19:45:50.372223 [debug] [Thread-3 (]: On model.customer360.stg_sf__contacts: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_sf__contacts"} */
alter table "dbt"."public"."stg_sf__contacts" rename to "stg_sf__contacts__dbt_backup"
[0m19:45:50.373593 [debug] [Thread-2 (]: Using postgres connection "model.customer360.stg_web__transactions"
[0m19:45:50.374157 [debug] [Thread-2 (]: On model.customer360.stg_web__transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_web__transactions"} */
alter table "dbt"."public"."stg_web__transactions" rename to "stg_web__transactions__dbt_backup"
[0m19:45:50.378483 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m19:45:50.383586 [debug] [Thread-2 (]: Using postgres connection "model.customer360.stg_web__transactions"
[0m19:45:50.384183 [debug] [Thread-2 (]: On model.customer360.stg_web__transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_web__transactions"} */
alter table "dbt"."public"."stg_web__transactions__dbt_tmp" rename to "stg_web__transactions"
[0m19:45:50.384865 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m19:45:50.389684 [debug] [Thread-3 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m19:45:50.390243 [debug] [Thread-3 (]: On model.customer360.stg_sf__contacts: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_sf__contacts"} */
alter table "dbt"."public"."stg_sf__contacts__dbt_tmp" rename to "stg_sf__contacts"
[0m19:45:50.393000 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m19:45:50.417446 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m19:45:50.427895 [debug] [Thread-2 (]: On model.customer360.stg_web__transactions: COMMIT
[0m19:45:50.428592 [debug] [Thread-2 (]: Using postgres connection "model.customer360.stg_web__transactions"
[0m19:45:50.429080 [debug] [Thread-2 (]: On model.customer360.stg_web__transactions: COMMIT
[0m19:45:50.434871 [debug] [Thread-3 (]: On model.customer360.stg_sf__contacts: COMMIT
[0m19:45:50.444743 [debug] [Thread-3 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m19:45:50.445413 [debug] [Thread-3 (]: On model.customer360.stg_sf__contacts: COMMIT
[0m19:45:50.453729 [debug] [Thread-2 (]: SQL status: COMMIT in 0.0 seconds
[0m19:45:50.462978 [debug] [Thread-2 (]: Applying DROP to: "dbt"."public"."stg_web__transactions__dbt_backup"
[0m19:45:50.478627 [debug] [Thread-3 (]: SQL status: COMMIT in 0.0 seconds
[0m19:45:50.482617 [debug] [Thread-3 (]: Applying DROP to: "dbt"."public"."stg_sf__contacts__dbt_backup"
[0m19:45:50.489862 [debug] [Thread-3 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m19:45:50.490479 [debug] [Thread-3 (]: On model.customer360.stg_sf__contacts: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_sf__contacts"} */
drop table if exists "dbt"."public"."stg_sf__contacts__dbt_backup" cascade
[0m19:45:50.493740 [debug] [Thread-2 (]: Using postgres connection "model.customer360.stg_web__transactions"
[0m19:45:50.494329 [debug] [Thread-2 (]: On model.customer360.stg_web__transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_web__transactions"} */
drop table if exists "dbt"."public"."stg_web__transactions__dbt_backup" cascade
[0m19:45:50.504047 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.0 seconds
[0m19:45:50.506323 [debug] [Thread-3 (]: Timing info for model.customer360.stg_sf__contacts (execute): 19:45:50.190564 => 19:45:50.505981
[0m19:45:50.506897 [debug] [Thread-3 (]: On model.customer360.stg_sf__contacts: Close
[0m19:45:50.507939 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '85e9e249-7dca-48c1-99d3-5b218895346c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fde6b087cd0>]}
[0m19:45:50.514781 [info ] [Thread-3 (]: 11 of 15 OK created sql table model public.stg_sf__contacts .................... [[32mSELECT 10[0m in 0.33s]
[0m19:45:50.515736 [debug] [Thread-3 (]: Finished running node model.customer360.stg_sf__contacts
[0m19:45:50.516329 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.0 seconds
[0m19:45:50.518493 [debug] [Thread-2 (]: Timing info for model.customer360.stg_web__transactions (execute): 19:45:50.200435 => 19:45:50.518126
[0m19:45:50.519009 [debug] [Thread-2 (]: On model.customer360.stg_web__transactions: Close
[0m19:45:50.520029 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '85e9e249-7dca-48c1-99d3-5b218895346c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fde6adfb650>]}
[0m19:45:50.520841 [info ] [Thread-2 (]: 12 of 15 OK created sql table model public.stg_web__transactions ............... [[32mSELECT 100[0m in 0.34s]
[0m19:45:50.521664 [debug] [Thread-2 (]: Finished running node model.customer360.stg_web__transactions
[0m19:45:50.523635 [debug] [Thread-1 (]: Began running node model.customer360.contacts_joined_with_transactions
[0m19:45:50.524369 [info ] [Thread-1 (]: 13 of 15 START sql view model public.contacts_joined_with_transactions ......... [RUN]
[0m19:45:50.525345 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344, now model.customer360.contacts_joined_with_transactions)
[0m19:45:50.525782 [debug] [Thread-1 (]: Began compiling node model.customer360.contacts_joined_with_transactions
[0m19:45:50.530485 [debug] [Thread-1 (]: Writing injected SQL for node "model.customer360.contacts_joined_with_transactions"
[0m19:45:50.531431 [debug] [Thread-1 (]: Timing info for model.customer360.contacts_joined_with_transactions (compile): 19:45:50.526172 => 19:45:50.531056
[0m19:45:50.532076 [debug] [Thread-1 (]: Began executing node model.customer360.contacts_joined_with_transactions
[0m19:45:50.602972 [debug] [Thread-1 (]: Writing runtime sql for node "model.customer360.contacts_joined_with_transactions"
[0m19:45:50.603930 [debug] [Thread-1 (]: Using postgres connection "model.customer360.contacts_joined_with_transactions"
[0m19:45:50.604566 [debug] [Thread-1 (]: On model.customer360.contacts_joined_with_transactions: BEGIN
[0m19:45:50.605074 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:45:50.634597 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m19:45:50.635196 [debug] [Thread-1 (]: Using postgres connection "model.customer360.contacts_joined_with_transactions"
[0m19:45:50.635767 [debug] [Thread-1 (]: On model.customer360.contacts_joined_with_transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.contacts_joined_with_transactions"} */

  create view "dbt"."public"."contacts_joined_with_transactions__dbt_tmp"
    
    
  as (
    SELECT 
    contacts.*,
    transactions.id as transaction_id,
    transactions.transaction_date,
    transactions.amount,
    transactions.item_count,
    transactions.category
FROM "dbt"."public"."stg_web__transactions" as transactions
LEFT JOIN "dbt"."public"."stg_sf__contacts" as contacts ON contacts.id = transactions.contact_id
  );
[0m19:45:50.638736 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.0 seconds
[0m19:45:50.643270 [debug] [Thread-1 (]: Using postgres connection "model.customer360.contacts_joined_with_transactions"
[0m19:45:50.644911 [debug] [Thread-1 (]: On model.customer360.contacts_joined_with_transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.contacts_joined_with_transactions"} */
alter table "dbt"."public"."contacts_joined_with_transactions__dbt_tmp" rename to "contacts_joined_with_transactions"
[0m19:45:50.646122 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m19:45:50.648516 [debug] [Thread-1 (]: On model.customer360.contacts_joined_with_transactions: COMMIT
[0m19:45:50.649000 [debug] [Thread-1 (]: Using postgres connection "model.customer360.contacts_joined_with_transactions"
[0m19:45:50.649552 [debug] [Thread-1 (]: On model.customer360.contacts_joined_with_transactions: COMMIT
[0m19:45:50.651672 [debug] [Thread-1 (]: SQL status: COMMIT in 0.0 seconds
[0m19:45:50.655418 [debug] [Thread-1 (]: Applying DROP to: "dbt"."public"."contacts_joined_with_transactions__dbt_backup"
[0m19:45:50.661793 [debug] [Thread-1 (]: Using postgres connection "model.customer360.contacts_joined_with_transactions"
[0m19:45:50.662429 [debug] [Thread-1 (]: On model.customer360.contacts_joined_with_transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.contacts_joined_with_transactions"} */
drop view if exists "dbt"."public"."contacts_joined_with_transactions__dbt_backup" cascade
[0m19:45:50.666062 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.0 seconds
[0m19:45:50.668278 [debug] [Thread-1 (]: Timing info for model.customer360.contacts_joined_with_transactions (execute): 19:45:50.532447 => 19:45:50.667959
[0m19:45:50.668849 [debug] [Thread-1 (]: On model.customer360.contacts_joined_with_transactions: Close
[0m19:45:50.674053 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '85e9e249-7dca-48c1-99d3-5b218895346c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fde6b174c50>]}
[0m19:45:50.674953 [info ] [Thread-1 (]: 13 of 15 OK created sql view model public.contacts_joined_with_transactions .... [[32mCREATE VIEW[0m in 0.15s]
[0m19:45:50.677873 [debug] [Thread-1 (]: Finished running node model.customer360.contacts_joined_with_transactions
[0m19:45:50.678867 [debug] [Thread-2 (]: Began running node test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311
[0m19:45:50.679446 [info ] [Thread-2 (]: 14 of 15 START test not_null_contacts_joined_with_transactions_id .............. [RUN]
[0m19:45:50.680341 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.customer360.stg_web__transactions, now test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311)
[0m19:45:50.680876 [debug] [Thread-2 (]: Began compiling node test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311
[0m19:45:50.691333 [debug] [Thread-2 (]: Writing injected SQL for node "test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311"
[0m19:45:50.692235 [debug] [Thread-2 (]: Timing info for test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311 (compile): 19:45:50.681184 => 19:45:50.691878
[0m19:45:50.692732 [debug] [Thread-2 (]: Began executing node test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311
[0m19:45:50.700268 [debug] [Thread-2 (]: Writing runtime sql for node "test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311"
[0m19:45:50.701211 [debug] [Thread-2 (]: Using postgres connection "test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311"
[0m19:45:50.701697 [debug] [Thread-2 (]: On test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311: BEGIN
[0m19:45:50.702218 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m19:45:50.762121 [debug] [Thread-2 (]: SQL status: BEGIN in 0.0 seconds
[0m19:45:50.762727 [debug] [Thread-2 (]: Using postgres connection "test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311"
[0m19:45:50.763319 [debug] [Thread-2 (]: On test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select id
from "dbt"."public"."contacts_joined_with_transactions"
where id is null



      
    ) dbt_internal_test
[0m19:45:50.769373 [debug] [Thread-2 (]: SQL status: SELECT 1 in 0.0 seconds
[0m19:45:50.771823 [debug] [Thread-2 (]: Timing info for test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311 (execute): 19:45:50.693019 => 19:45:50.771503
[0m19:45:50.772415 [debug] [Thread-2 (]: On test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311: ROLLBACK
[0m19:45:50.777778 [debug] [Thread-2 (]: On test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311: Close
[0m19:45:50.778923 [info ] [Thread-2 (]: 14 of 15 PASS not_null_contacts_joined_with_transactions_id .................... [[32mPASS[0m in 0.10s]
[0m19:45:50.781846 [debug] [Thread-2 (]: Finished running node test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311
[0m19:45:50.782927 [debug] [Thread-1 (]: Began running node model.customer360.customers
[0m19:45:50.783537 [info ] [Thread-1 (]: 15 of 15 START sql table model public.customers ................................ [RUN]
[0m19:45:50.784419 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.customer360.contacts_joined_with_transactions, now model.customer360.customers)
[0m19:45:50.784900 [debug] [Thread-1 (]: Began compiling node model.customer360.customers
[0m19:45:50.788895 [debug] [Thread-1 (]: Writing injected SQL for node "model.customer360.customers"
[0m19:45:50.789645 [debug] [Thread-1 (]: Timing info for model.customer360.customers (compile): 19:45:50.785187 => 19:45:50.789355
[0m19:45:50.790136 [debug] [Thread-1 (]: Began executing node model.customer360.customers
[0m19:45:50.804711 [debug] [Thread-1 (]: Writing runtime sql for node "model.customer360.customers"
[0m19:45:50.805474 [debug] [Thread-1 (]: Using postgres connection "model.customer360.customers"
[0m19:45:50.805956 [debug] [Thread-1 (]: On model.customer360.customers: BEGIN
[0m19:45:50.806403 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:45:50.840453 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m19:45:50.841081 [debug] [Thread-1 (]: Using postgres connection "model.customer360.customers"
[0m19:45:50.841674 [debug] [Thread-1 (]: On model.customer360.customers: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.customers"} */

  
    

  create  table "dbt"."public"."customers__dbt_tmp"
  
  
    as
  
  (
    SELECT
    id,
    gender,
    
    date_part('year', age(current_date, birth_date))
 AS age,
    sum(amount) as total_expense,
    date(min(transaction_date)) as first_purchase_date,
    date(max(transaction_date)) as last_purchase_date,
    sum(case when category = 'Apps & Games' then amount else 0 end) as apps_games_amount,
    sum(case when category = 'Beauty' then amount else 0 end)   as beauty_amount,
    sum(case when category = 'Books' then amount else 0 end)   as books_amount,
    sum(case when category = 'Clothing, Shoes & Accessories' then amount else 0 end)   as clothing_shoes_accessories_amount,
    sum(case when category = 'Movies & TV' then amount else 0 end)   as movies_tv_amount,
    sum(case when category = 'Sports, Fitness & Outdoors' then amount else 0 end)   as sports_fitness_outdoors_amount
FROM  "dbt"."public"."contacts_joined_with_transactions"
GROUP BY
    1,2,3
  );
  
[0m19:45:50.852351 [debug] [Thread-1 (]: SQL status: SELECT 9 in 0.0 seconds
[0m19:45:50.857159 [debug] [Thread-1 (]: Using postgres connection "model.customer360.customers"
[0m19:45:50.857727 [debug] [Thread-1 (]: On model.customer360.customers: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.customers"} */
alter table "dbt"."public"."customers" rename to "customers__dbt_backup"
[0m19:45:50.858827 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m19:45:50.862647 [debug] [Thread-1 (]: Using postgres connection "model.customer360.customers"
[0m19:45:50.863115 [debug] [Thread-1 (]: On model.customer360.customers: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.customers"} */
alter table "dbt"."public"."customers__dbt_tmp" rename to "customers"
[0m19:45:50.864339 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m19:45:50.867731 [debug] [Thread-1 (]: On model.customer360.customers: COMMIT
[0m19:45:50.868234 [debug] [Thread-1 (]: Using postgres connection "model.customer360.customers"
[0m19:45:50.868753 [debug] [Thread-1 (]: On model.customer360.customers: COMMIT
[0m19:45:50.870602 [debug] [Thread-1 (]: SQL status: COMMIT in 0.0 seconds
[0m19:45:50.873188 [debug] [Thread-1 (]: Applying DROP to: "dbt"."public"."customers__dbt_backup"
[0m19:45:50.874086 [debug] [Thread-1 (]: Using postgres connection "model.customer360.customers"
[0m19:45:50.874430 [debug] [Thread-1 (]: On model.customer360.customers: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.customers"} */
drop table if exists "dbt"."public"."customers__dbt_backup" cascade
[0m19:45:50.877109 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.0 seconds
[0m19:45:50.879153 [debug] [Thread-1 (]: Timing info for model.customer360.customers (execute): 19:45:50.794535 => 19:45:50.878869
[0m19:45:50.879627 [debug] [Thread-1 (]: On model.customer360.customers: Close
[0m19:45:50.883275 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '85e9e249-7dca-48c1-99d3-5b218895346c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fde6b1775d0>]}
[0m19:45:50.883873 [info ] [Thread-1 (]: 15 of 15 OK created sql table model public.customers ........................... [[32mSELECT 9[0m in 0.10s]
[0m19:45:50.884405 [debug] [Thread-1 (]: Finished running node model.customer360.customers
[0m19:45:50.888345 [debug] [MainThread]: Using postgres connection "master"
[0m19:45:50.888651 [debug] [MainThread]: On master: BEGIN
[0m19:45:50.888903 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m19:45:50.910642 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m19:45:50.911179 [debug] [MainThread]: On master: COMMIT
[0m19:45:50.911605 [debug] [MainThread]: Using postgres connection "master"
[0m19:45:50.912011 [debug] [MainThread]: On master: COMMIT
[0m19:45:50.919539 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m19:45:50.920007 [debug] [MainThread]: On master: Close
[0m19:45:50.920897 [debug] [MainThread]: Connection 'master' was properly closed.
[0m19:45:50.921276 [debug] [MainThread]: Connection 'model.customer360.customers' was properly closed.
[0m19:45:50.921668 [debug] [MainThread]: Connection 'test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311' was properly closed.
[0m19:45:50.922045 [debug] [MainThread]: Connection 'model.customer360.stg_sf__contacts' was properly closed.
[0m19:45:50.922644 [info ] [MainThread]: 
[0m19:45:50.923084 [info ] [MainThread]: Finished running 9 tests, 2 seeds, 3 table models, 1 view model in 0 hours 0 minutes and 1.57 seconds (1.57s).
[0m19:45:50.926782 [debug] [MainThread]: Command end result
[0m19:45:50.944857 [info ] [MainThread]: 
[0m19:45:50.949524 [info ] [MainThread]: [32mCompleted successfully[0m
[0m19:45:50.950011 [info ] [MainThread]: 
[0m19:45:50.950480 [info ] [MainThread]: Done. PASS=15 WARN=0 ERROR=0 SKIP=0 TOTAL=15
[0m19:45:50.951460 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 2.4349422, "process_user_time": 3.650053, "process_kernel_time": 0.141749, "process_mem_max_rss": "105196", "process_out_blocks": "2096", "process_in_blocks": "0"}
[0m19:45:50.952090 [debug] [MainThread]: Command `dbt build` succeeded at 19:45:50.951927 after 2.44 seconds
[0m19:45:50.959640 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fde70fe2a50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fde70fe2a90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fde7115cd90>]}
[0m19:45:50.960150 [debug] [MainThread]: Flushing usage events
[0m20:08:53.274736 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6ea869de50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6ea866a110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6ea80fba90>]}


============================== 20:08:53.278102 | 2cccc93f-5e7a-4823-b0c2-8ccb774e69a6 ==============================
[0m20:08:53.278102 [info ] [MainThread]: Running with dbt=1.7.8
[0m20:08:53.278810 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/root/option1-customer360/integration_tests', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/root/option1-customer360/integration_tests/logs', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'log_format': 'default', 'target_path': 'None', 'invocation_command': 'dbt build', 'send_anonymous_usage_stats': 'True'}
[0m20:08:53.496362 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '2cccc93f-5e7a-4823-b0c2-8ccb774e69a6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6ea66652d0>]}
[0m20:08:53.638589 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '2cccc93f-5e7a-4823-b0c2-8ccb774e69a6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6ea7ffcbd0>]}
[0m20:08:53.639497 [info ] [MainThread]: Registered adapter: postgres=1.7.8
[0m20:08:53.684127 [debug] [MainThread]: checksum: 67f0013ca5f0bd43af9a0873dd50792fde83ef69de63b71cacd0b4ac656c52e5, vars: {}, profile: , target: , version: 1.7.8
[0m20:08:53.757195 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 1 files added, 0 files changed.
[0m20:08:53.757927 [debug] [MainThread]: Partial parsing: added file: customer360://tests/custormers_test.sql
[0m20:08:53.916487 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '2cccc93f-5e7a-4823-b0c2-8ccb774e69a6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6ea6378f90>]}
[0m20:08:54.012662 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '2cccc93f-5e7a-4823-b0c2-8ccb774e69a6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6ea7fe4d50>]}
[0m20:08:54.013380 [info ] [MainThread]: Found 2 seeds, 4 models, 10 tests, 2 sources, 0 exposures, 0 metrics, 403 macros, 0 groups, 0 semantic models
[0m20:08:54.016340 [info ] [MainThread]: 
[0m20:08:54.017467 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m20:08:54.019168 [debug] [ThreadPool]: Acquiring new postgres connection 'list_dbt'
[0m20:08:54.034074 [debug] [ThreadPool]: Using postgres connection "list_dbt"
[0m20:08:54.034649 [debug] [ThreadPool]: On list_dbt: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "connection_name": "list_dbt"} */

    select distinct nspname from pg_namespace
  
[0m20:08:54.035102 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:08:54.041632 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.0 seconds
[0m20:08:54.043464 [debug] [ThreadPool]: On list_dbt: Close
[0m20:08:54.047511 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dbt, now list_dbt_public)
[0m20:08:54.056107 [debug] [ThreadPool]: Using postgres connection "list_dbt_public"
[0m20:08:54.056681 [debug] [ThreadPool]: On list_dbt_public: BEGIN
[0m20:08:54.057093 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:08:54.083052 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m20:08:54.083620 [debug] [ThreadPool]: Using postgres connection "list_dbt_public"
[0m20:08:54.084142 [debug] [ThreadPool]: On list_dbt_public: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "connection_name": "list_dbt_public"} */
select
      'dbt' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'dbt' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'dbt' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m20:08:54.091267 [debug] [ThreadPool]: SQL status: SELECT 6 in 0.0 seconds
[0m20:08:54.093196 [debug] [ThreadPool]: On list_dbt_public: ROLLBACK
[0m20:08:54.098722 [debug] [ThreadPool]: On list_dbt_public: Close
[0m20:08:54.109042 [debug] [MainThread]: Using postgres connection "master"
[0m20:08:54.109753 [debug] [MainThread]: On master: BEGIN
[0m20:08:54.110158 [debug] [MainThread]: Opening a new connection, currently in state init
[0m20:08:54.155958 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m20:08:54.156515 [debug] [MainThread]: Using postgres connection "master"
[0m20:08:54.157080 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m20:08:54.177276 [debug] [MainThread]: SQL status: SELECT 2 in 0.0 seconds
[0m20:08:54.179721 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2cccc93f-5e7a-4823-b0c2-8ccb774e69a6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6ea800bfd0>]}
[0m20:08:54.180316 [debug] [MainThread]: On master: ROLLBACK
[0m20:08:54.181221 [debug] [MainThread]: Using postgres connection "master"
[0m20:08:54.181708 [debug] [MainThread]: On master: BEGIN
[0m20:08:54.186158 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m20:08:54.186676 [debug] [MainThread]: On master: COMMIT
[0m20:08:54.187071 [debug] [MainThread]: Using postgres connection "master"
[0m20:08:54.187549 [debug] [MainThread]: On master: COMMIT
[0m20:08:54.189928 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m20:08:54.190416 [debug] [MainThread]: On master: Close
[0m20:08:54.191392 [info ] [MainThread]: Concurrency: 3 threads (target='local')
[0m20:08:54.191817 [info ] [MainThread]: 
[0m20:08:54.265712 [debug] [Thread-1 (]: Began running node seed.integration_tests.contacts
[0m20:08:54.266516 [info ] [Thread-1 (]: 1 of 16 START seed file public.contacts ........................................ [RUN]
[0m20:08:54.267535 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dbt_public, now seed.integration_tests.contacts)
[0m20:08:54.268076 [debug] [Thread-1 (]: Began compiling node seed.integration_tests.contacts
[0m20:08:54.268877 [debug] [Thread-1 (]: Timing info for seed.integration_tests.contacts (compile): 20:08:54.268607 => 20:08:54.268610
[0m20:08:54.269449 [debug] [Thread-1 (]: Began executing node seed.integration_tests.contacts
[0m20:08:54.294803 [debug] [Thread-2 (]: Began running node seed.integration_tests.transactions
[0m20:08:54.295570 [info ] [Thread-2 (]: 2 of 16 START seed file public.transactions .................................... [RUN]
[0m20:08:54.296977 [debug] [Thread-2 (]: Acquiring new postgres connection 'seed.integration_tests.transactions'
[0m20:08:54.297667 [debug] [Thread-2 (]: Began compiling node seed.integration_tests.transactions
[0m20:08:54.298337 [debug] [Thread-2 (]: Timing info for seed.integration_tests.transactions (compile): 20:08:54.298022 => 20:08:54.298025
[0m20:08:54.298866 [debug] [Thread-2 (]: Began executing node seed.integration_tests.transactions
[0m20:08:54.316695 [debug] [Thread-3 (]: Began running node test.customer360.macro_test1
[0m20:08:54.317359 [info ] [Thread-3 (]: 3 of 16 START test macro_test1 ................................................. [RUN]
[0m20:08:54.318433 [debug] [Thread-3 (]: Acquiring new postgres connection 'test.customer360.macro_test1'
[0m20:08:54.318872 [debug] [Thread-3 (]: Began compiling node test.customer360.macro_test1
[0m20:08:54.377557 [debug] [Thread-3 (]: Writing injected SQL for node "test.customer360.macro_test1"
[0m20:08:54.378431 [debug] [Thread-3 (]: Timing info for test.customer360.macro_test1 (compile): 20:08:54.319142 => 20:08:54.378117
[0m20:08:54.378881 [debug] [Thread-3 (]: Began executing node test.customer360.macro_test1
[0m20:08:54.394554 [debug] [Thread-1 (]: Using postgres connection "seed.integration_tests.contacts"
[0m20:08:54.395106 [debug] [Thread-1 (]: On seed.integration_tests.contacts: BEGIN
[0m20:08:54.395560 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:08:54.408352 [debug] [Thread-2 (]: Using postgres connection "seed.integration_tests.transactions"
[0m20:08:54.408920 [debug] [Thread-2 (]: On seed.integration_tests.transactions: BEGIN
[0m20:08:54.409415 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m20:08:54.420120 [debug] [Thread-3 (]: Writing runtime sql for node "test.customer360.macro_test1"
[0m20:08:54.421785 [debug] [Thread-3 (]: Using postgres connection "test.customer360.macro_test1"
[0m20:08:54.422273 [debug] [Thread-3 (]: On test.customer360.macro_test1: BEGIN
[0m20:08:54.422764 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m20:08:54.434735 [debug] [Thread-2 (]: SQL status: BEGIN in 0.0 seconds
[0m20:08:54.435402 [debug] [Thread-2 (]: Using postgres connection "seed.integration_tests.transactions"
[0m20:08:54.435926 [debug] [Thread-2 (]: On seed.integration_tests.transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "seed.integration_tests.transactions"} */
truncate table "dbt"."public"."transactions"
[0m20:08:54.438468 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m20:08:54.438945 [debug] [Thread-1 (]: Using postgres connection "seed.integration_tests.contacts"
[0m20:08:54.439449 [debug] [Thread-1 (]: On seed.integration_tests.contacts: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "seed.integration_tests.contacts"} */
truncate table "dbt"."public"."contacts"
[0m20:08:54.449812 [debug] [Thread-3 (]: SQL status: BEGIN in 0.0 seconds
[0m20:08:54.450398 [debug] [Thread-3 (]: Using postgres connection "test.customer360.macro_test1"
[0m20:08:54.450912 [debug] [Thread-3 (]: On test.customer360.macro_test1: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.macro_test1"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      with marco_result as (
    select 
    date_part('year', age(current_date, '2023-02-12'))
 as expect_result
)
select
    1
from marco_result
where expect_result <> 1
      
    ) dbt_internal_test
[0m20:08:54.455845 [debug] [Thread-3 (]: SQL status: SELECT 1 in 0.0 seconds
[0m20:08:54.458587 [debug] [Thread-3 (]: Timing info for test.customer360.macro_test1 (execute): 20:08:54.379138 => 20:08:54.458222
[0m20:08:54.459116 [debug] [Thread-3 (]: On test.customer360.macro_test1: ROLLBACK
[0m20:08:54.464788 [debug] [Thread-1 (]: SQL status: TRUNCATE TABLE in 0.0 seconds
[0m20:08:54.481585 [debug] [Thread-2 (]: SQL status: TRUNCATE TABLE in 0.0 seconds
[0m20:08:54.496847 [debug] [Thread-3 (]: On test.customer360.macro_test1: Close
[0m20:08:54.498049 [info ] [Thread-3 (]: 3 of 16 PASS macro_test1 ....................................................... [[32mPASS[0m in 0.18s]
[0m20:08:54.498854 [debug] [Thread-3 (]: Finished running node test.customer360.macro_test1
[0m20:08:54.501195 [debug] [Thread-3 (]: Began running node test.customer360.macro_test2
[0m20:08:54.501754 [info ] [Thread-3 (]: 4 of 16 START test macro_test2 ................................................. [RUN]
[0m20:08:54.502638 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.customer360.macro_test1, now test.customer360.macro_test2)
[0m20:08:54.503141 [debug] [Thread-3 (]: Began compiling node test.customer360.macro_test2
[0m20:08:54.562781 [debug] [Thread-3 (]: Writing injected SQL for node "test.customer360.macro_test2"
[0m20:08:54.563677 [debug] [Thread-3 (]: Timing info for test.customer360.macro_test2 (compile): 20:08:54.503466 => 20:08:54.563364
[0m20:08:54.564171 [debug] [Thread-3 (]: Began executing node test.customer360.macro_test2
[0m20:08:54.567738 [debug] [Thread-3 (]: Writing runtime sql for node "test.customer360.macro_test2"
[0m20:08:54.568438 [debug] [Thread-3 (]: Using postgres connection "test.customer360.macro_test2"
[0m20:08:54.568917 [debug] [Thread-3 (]: On test.customer360.macro_test2: BEGIN
[0m20:08:54.569391 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m20:08:54.631508 [debug] [Thread-1 (]: Using postgres connection "seed.integration_tests.contacts"
[0m20:08:54.632116 [debug] [Thread-1 (]: On seed.integration_tests.contacts: 
          insert into "dbt"."public"."contacts" ("id", "username", "name", "gender", "address", "mail", "birthdate", "_loaded_at_utc") values
          (%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s)
      ...
[0m20:08:54.632877 [debug] [Thread-3 (]: SQL status: BEGIN in 0.0 seconds
[0m20:08:54.633372 [debug] [Thread-3 (]: Using postgres connection "test.customer360.macro_test2"
[0m20:08:54.633986 [debug] [Thread-3 (]: On test.customer360.macro_test2: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.macro_test2"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      with marco_result as (
    select 
        to_timestamp('2023-02-27 21:00:00','YYYY-MM-DD HH24:MI:SS.MS') :: timestamp at TIME zone 'UTC'
     as expect_result
)
select
    1
from marco_result
where cast(pg_typeof(expect_result) as text) not like '%timestamp%'
      
    ) dbt_internal_test
[0m20:08:54.663684 [debug] [Thread-3 (]: SQL status: SELECT 1 in 0.0 seconds
[0m20:08:54.665883 [debug] [Thread-3 (]: Timing info for test.customer360.macro_test2 (execute): 20:08:54.564497 => 20:08:54.665563
[0m20:08:54.666401 [debug] [Thread-3 (]: On test.customer360.macro_test2: ROLLBACK
[0m20:08:54.666957 [debug] [Thread-1 (]: SQL status: INSERT 0 10 in 0.0 seconds
[0m20:08:54.675126 [debug] [Thread-1 (]: Writing runtime SQL for node "seed.integration_tests.contacts"
[0m20:08:54.704273 [debug] [Thread-3 (]: On test.customer360.macro_test2: Close
[0m20:08:54.705642 [info ] [Thread-3 (]: 4 of 16 PASS macro_test2 ....................................................... [[32mPASS[0m in 0.20s]
[0m20:08:54.706550 [debug] [Thread-3 (]: Finished running node test.customer360.macro_test2
[0m20:08:54.707108 [debug] [Thread-3 (]: Began running node test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247
[0m20:08:54.707766 [info ] [Thread-3 (]: 5 of 16 START test source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors  [RUN]
[0m20:08:54.708694 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.customer360.macro_test2, now test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247)
[0m20:08:54.709273 [debug] [Thread-3 (]: Began compiling node test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247
[0m20:08:54.746845 [debug] [Thread-3 (]: Writing injected SQL for node "test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247"
[0m20:08:54.747862 [debug] [Thread-3 (]: Timing info for test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247 (compile): 20:08:54.709916 => 20:08:54.747527
[0m20:08:54.748486 [debug] [Thread-3 (]: Began executing node test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247
[0m20:08:54.751979 [debug] [Thread-3 (]: Writing runtime sql for node "test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247"
[0m20:08:54.752750 [debug] [Thread-3 (]: Using postgres connection "test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247"
[0m20:08:54.753363 [debug] [Thread-3 (]: On test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247: BEGIN
[0m20:08:54.753878 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m20:08:54.755432 [debug] [Thread-1 (]: On seed.integration_tests.contacts: COMMIT
[0m20:08:54.755912 [debug] [Thread-1 (]: Using postgres connection "seed.integration_tests.contacts"
[0m20:08:54.757200 [debug] [Thread-1 (]: On seed.integration_tests.contacts: COMMIT
[0m20:08:54.773621 [debug] [Thread-1 (]: SQL status: COMMIT in 0.0 seconds
[0m20:08:54.775222 [debug] [Thread-1 (]: Timing info for seed.integration_tests.contacts (execute): 20:08:54.269762 => 20:08:54.774908
[0m20:08:54.775775 [debug] [Thread-1 (]: On seed.integration_tests.contacts: Close
[0m20:08:54.776737 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2cccc93f-5e7a-4823-b0c2-8ccb774e69a6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6ea61ec490>]}
[0m20:08:54.779588 [info ] [Thread-1 (]: 1 of 16 OK loaded seed file public.contacts .................................... [[32mINSERT 10[0m in 0.51s]
[0m20:08:54.780468 [debug] [Thread-1 (]: Finished running node seed.integration_tests.contacts
[0m20:08:54.781103 [debug] [Thread-1 (]: Began running node test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d
[0m20:08:54.781655 [info ] [Thread-1 (]: 6 of 16 START test source_not_null_salesforce_contacts_id ...................... [RUN]
[0m20:08:54.782569 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly seed.integration_tests.contacts, now test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d)
[0m20:08:54.783099 [debug] [Thread-1 (]: Began compiling node test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d
[0m20:08:54.805952 [debug] [Thread-1 (]: Writing injected SQL for node "test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d"
[0m20:08:54.806906 [debug] [Thread-1 (]: Timing info for test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d (compile): 20:08:54.783652 => 20:08:54.806599
[0m20:08:54.807445 [debug] [Thread-1 (]: Began executing node test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d
[0m20:08:54.811191 [debug] [Thread-1 (]: Writing runtime sql for node "test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d"
[0m20:08:54.811881 [debug] [Thread-1 (]: Using postgres connection "test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d"
[0m20:08:54.812671 [debug] [Thread-1 (]: On test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d: BEGIN
[0m20:08:54.813177 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:08:54.814387 [debug] [Thread-3 (]: SQL status: BEGIN in 0.0 seconds
[0m20:08:54.814940 [debug] [Thread-3 (]: Using postgres connection "test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247"
[0m20:08:54.815542 [debug] [Thread-3 (]: On test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

with all_values as (

    select
        category as value_field,
        count(*) as n_records

    from "dbt"."public"."transactions"
    group by category

)

select *
from all_values
where value_field not in (
    'Apps & Games','Beauty','Books','Clothing, Shoes & Accessories','Movies & TV','Sports, Fitness & Outdoors'
)



      
    ) dbt_internal_test
[0m20:08:54.878604 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m20:08:54.879238 [debug] [Thread-1 (]: Using postgres connection "test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d"
[0m20:08:54.879738 [debug] [Thread-1 (]: On test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select id
from "dbt"."public"."contacts"
where id is null



      
    ) dbt_internal_test
[0m20:08:54.889752 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.0 seconds
[0m20:08:54.896283 [debug] [Thread-1 (]: Timing info for test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d (execute): 20:08:54.807800 => 20:08:54.896061
[0m20:08:54.902148 [debug] [Thread-1 (]: On test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d: ROLLBACK
[0m20:08:54.903013 [debug] [Thread-1 (]: On test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d: Close
[0m20:08:54.904048 [info ] [Thread-1 (]: 6 of 16 PASS source_not_null_salesforce_contacts_id ............................ [[32mPASS[0m in 0.12s]
[0m20:08:54.904873 [debug] [Thread-1 (]: Finished running node test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d
[0m20:08:54.905449 [debug] [Thread-1 (]: Began running node test.customer360.source_not_null_web_transactions_id.88a47bf7e5
[0m20:08:54.905992 [info ] [Thread-1 (]: 7 of 16 START test source_not_null_web_transactions_id ......................... [RUN]
[0m20:08:54.909442 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d, now test.customer360.source_not_null_web_transactions_id.88a47bf7e5)
[0m20:08:54.910016 [debug] [Thread-1 (]: Began compiling node test.customer360.source_not_null_web_transactions_id.88a47bf7e5
[0m20:08:54.916596 [debug] [Thread-1 (]: Writing injected SQL for node "test.customer360.source_not_null_web_transactions_id.88a47bf7e5"
[0m20:08:54.917478 [debug] [Thread-1 (]: Timing info for test.customer360.source_not_null_web_transactions_id.88a47bf7e5 (compile): 20:08:54.910351 => 20:08:54.917084
[0m20:08:54.917987 [debug] [Thread-1 (]: Began executing node test.customer360.source_not_null_web_transactions_id.88a47bf7e5
[0m20:08:54.921623 [debug] [Thread-1 (]: Writing runtime sql for node "test.customer360.source_not_null_web_transactions_id.88a47bf7e5"
[0m20:08:54.922339 [debug] [Thread-1 (]: Using postgres connection "test.customer360.source_not_null_web_transactions_id.88a47bf7e5"
[0m20:08:54.922803 [debug] [Thread-1 (]: On test.customer360.source_not_null_web_transactions_id.88a47bf7e5: BEGIN
[0m20:08:54.923273 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:08:54.980609 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m20:08:54.981271 [debug] [Thread-1 (]: Using postgres connection "test.customer360.source_not_null_web_transactions_id.88a47bf7e5"
[0m20:08:54.981850 [debug] [Thread-1 (]: On test.customer360.source_not_null_web_transactions_id.88a47bf7e5: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.source_not_null_web_transactions_id.88a47bf7e5"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select id
from "dbt"."public"."transactions"
where id is null



      
    ) dbt_internal_test
[0m20:08:55.033063 [debug] [Thread-2 (]: Using postgres connection "seed.integration_tests.transactions"
[0m20:08:55.033721 [debug] [Thread-2 (]: On seed.integration_tests.transactions: 
          insert into "dbt"."public"."transactions" ("contact_id", "id", "transaction_date", "amount", "item_count", "category", "_loaded_at_utc") values
          (%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%...
[0m20:08:55.037733 [debug] [Thread-2 (]: SQL status: INSERT 0 100 in 0.0 seconds
[0m20:08:55.039088 [debug] [Thread-2 (]: Writing runtime SQL for node "seed.integration_tests.transactions"
[0m20:08:55.042592 [debug] [Thread-2 (]: On seed.integration_tests.transactions: COMMIT
[0m20:08:55.043086 [debug] [Thread-2 (]: Using postgres connection "seed.integration_tests.transactions"
[0m20:08:55.043565 [debug] [Thread-2 (]: On seed.integration_tests.transactions: COMMIT
[0m20:08:55.048171 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.0 seconds
[0m20:08:55.051172 [debug] [Thread-1 (]: Timing info for test.customer360.source_not_null_web_transactions_id.88a47bf7e5 (execute): 20:08:54.918345 => 20:08:55.050830
[0m20:08:55.051771 [debug] [Thread-1 (]: On test.customer360.source_not_null_web_transactions_id.88a47bf7e5: ROLLBACK
[0m20:08:55.052396 [debug] [Thread-3 (]: SQL status: SELECT 1 in 0.0 seconds
[0m20:08:55.054161 [debug] [Thread-3 (]: Timing info for test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247 (execute): 20:08:54.748804 => 20:08:55.053831
[0m20:08:55.054978 [debug] [Thread-3 (]: On test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247: ROLLBACK
[0m20:08:55.055793 [debug] [Thread-2 (]: SQL status: COMMIT in 0.0 seconds
[0m20:08:55.057094 [debug] [Thread-2 (]: Timing info for seed.integration_tests.transactions (execute): 20:08:54.299195 => 20:08:55.056807
[0m20:08:55.057652 [debug] [Thread-2 (]: On seed.integration_tests.transactions: Close
[0m20:08:55.060774 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2cccc93f-5e7a-4823-b0c2-8ccb774e69a6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6ea6445350>]}
[0m20:08:55.061529 [info ] [Thread-2 (]: 2 of 16 OK loaded seed file public.transactions ................................ [[32mINSERT 100[0m in 0.76s]
[0m20:08:55.062372 [debug] [Thread-2 (]: Finished running node seed.integration_tests.transactions
[0m20:08:55.062992 [debug] [Thread-2 (]: Began running node test.customer360.source_unique_salesforce_contacts_id.01cadaaf43
[0m20:08:55.063668 [info ] [Thread-2 (]: 8 of 16 START test source_unique_salesforce_contacts_id ........................ [RUN]
[0m20:08:55.064605 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly seed.integration_tests.transactions, now test.customer360.source_unique_salesforce_contacts_id.01cadaaf43)
[0m20:08:55.065165 [debug] [Thread-2 (]: Began compiling node test.customer360.source_unique_salesforce_contacts_id.01cadaaf43
[0m20:08:55.074943 [debug] [Thread-2 (]: Writing injected SQL for node "test.customer360.source_unique_salesforce_contacts_id.01cadaaf43"
[0m20:08:55.075928 [debug] [Thread-2 (]: Timing info for test.customer360.source_unique_salesforce_contacts_id.01cadaaf43 (compile): 20:08:55.065496 => 20:08:55.075614
[0m20:08:55.076505 [debug] [Thread-2 (]: Began executing node test.customer360.source_unique_salesforce_contacts_id.01cadaaf43
[0m20:08:55.079752 [debug] [Thread-2 (]: Writing runtime sql for node "test.customer360.source_unique_salesforce_contacts_id.01cadaaf43"
[0m20:08:55.080884 [debug] [Thread-2 (]: Using postgres connection "test.customer360.source_unique_salesforce_contacts_id.01cadaaf43"
[0m20:08:55.081425 [debug] [Thread-2 (]: On test.customer360.source_unique_salesforce_contacts_id.01cadaaf43: BEGIN
[0m20:08:55.081913 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m20:08:55.083343 [debug] [Thread-1 (]: On test.customer360.source_not_null_web_transactions_id.88a47bf7e5: Close
[0m20:08:55.084460 [info ] [Thread-1 (]: 7 of 16 PASS source_not_null_web_transactions_id ............................... [[32mPASS[0m in 0.18s]
[0m20:08:55.085270 [debug] [Thread-1 (]: Finished running node test.customer360.source_not_null_web_transactions_id.88a47bf7e5
[0m20:08:55.088254 [debug] [Thread-1 (]: Began running node test.customer360.source_unique_web_transactions_id.ba28079761
[0m20:08:55.088836 [info ] [Thread-1 (]: 9 of 16 START test source_unique_web_transactions_id ........................... [RUN]
[0m20:08:55.089758 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.customer360.source_not_null_web_transactions_id.88a47bf7e5, now test.customer360.source_unique_web_transactions_id.ba28079761)
[0m20:08:55.090280 [debug] [Thread-1 (]: Began compiling node test.customer360.source_unique_web_transactions_id.ba28079761
[0m20:08:55.096928 [debug] [Thread-1 (]: Writing injected SQL for node "test.customer360.source_unique_web_transactions_id.ba28079761"
[0m20:08:55.097811 [debug] [Thread-1 (]: Timing info for test.customer360.source_unique_web_transactions_id.ba28079761 (compile): 20:08:55.090619 => 20:08:55.097456
[0m20:08:55.098364 [debug] [Thread-1 (]: Began executing node test.customer360.source_unique_web_transactions_id.ba28079761
[0m20:08:55.102826 [debug] [Thread-1 (]: Writing runtime sql for node "test.customer360.source_unique_web_transactions_id.ba28079761"
[0m20:08:55.103533 [debug] [Thread-1 (]: Using postgres connection "test.customer360.source_unique_web_transactions_id.ba28079761"
[0m20:08:55.104079 [debug] [Thread-1 (]: On test.customer360.source_unique_web_transactions_id.ba28079761: BEGIN
[0m20:08:55.104584 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:08:55.105858 [debug] [Thread-3 (]: On test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247: Close
[0m20:08:55.110008 [info ] [Thread-3 (]: 5 of 16 PASS source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors  [[32mPASS[0m in 0.40s]
[0m20:08:55.110901 [debug] [Thread-3 (]: Finished running node test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247
[0m20:08:55.111514 [debug] [Thread-3 (]: Began running node test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344
[0m20:08:55.112074 [info ] [Thread-3 (]: 10 of 16 START test source_relationships_web_transactions_contact_id__id__ref_contacts_  [RUN]
[0m20:08:55.112964 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247, now test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344)
[0m20:08:55.113635 [debug] [Thread-3 (]: Began compiling node test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344
[0m20:08:55.125859 [debug] [Thread-3 (]: Writing injected SQL for node "test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344"
[0m20:08:55.126812 [debug] [Thread-3 (]: Timing info for test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344 (compile): 20:08:55.113982 => 20:08:55.126492
[0m20:08:55.127380 [debug] [Thread-3 (]: Began executing node test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344
[0m20:08:55.131118 [debug] [Thread-3 (]: Writing runtime sql for node "test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344"
[0m20:08:55.131923 [debug] [Thread-3 (]: Using postgres connection "test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344"
[0m20:08:55.132513 [debug] [Thread-3 (]: On test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344: BEGIN
[0m20:08:55.133006 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m20:08:55.135481 [debug] [Thread-2 (]: SQL status: BEGIN in 0.0 seconds
[0m20:08:55.136005 [debug] [Thread-2 (]: Using postgres connection "test.customer360.source_unique_salesforce_contacts_id.01cadaaf43"
[0m20:08:55.136594 [debug] [Thread-2 (]: On test.customer360.source_unique_salesforce_contacts_id.01cadaaf43: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.source_unique_salesforce_contacts_id.01cadaaf43"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

select
    id as unique_field,
    count(*) as n_records

from "dbt"."public"."contacts"
where id is not null
group by id
having count(*) > 1



      
    ) dbt_internal_test
[0m20:08:55.139197 [debug] [Thread-2 (]: SQL status: SELECT 1 in 0.0 seconds
[0m20:08:55.141279 [debug] [Thread-2 (]: Timing info for test.customer360.source_unique_salesforce_contacts_id.01cadaaf43 (execute): 20:08:55.076816 => 20:08:55.140949
[0m20:08:55.141852 [debug] [Thread-2 (]: On test.customer360.source_unique_salesforce_contacts_id.01cadaaf43: ROLLBACK
[0m20:08:55.143282 [debug] [Thread-2 (]: On test.customer360.source_unique_salesforce_contacts_id.01cadaaf43: Close
[0m20:08:55.144455 [info ] [Thread-2 (]: 8 of 16 PASS source_unique_salesforce_contacts_id .............................. [[32mPASS[0m in 0.08s]
[0m20:08:55.145287 [debug] [Thread-2 (]: Finished running node test.customer360.source_unique_salesforce_contacts_id.01cadaaf43
[0m20:08:55.149533 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m20:08:55.150087 [debug] [Thread-1 (]: Using postgres connection "test.customer360.source_unique_web_transactions_id.ba28079761"
[0m20:08:55.150661 [debug] [Thread-1 (]: On test.customer360.source_unique_web_transactions_id.ba28079761: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.source_unique_web_transactions_id.ba28079761"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

select
    id as unique_field,
    count(*) as n_records

from "dbt"."public"."transactions"
where id is not null
group by id
having count(*) > 1



      
    ) dbt_internal_test
[0m20:08:55.151853 [debug] [Thread-3 (]: SQL status: BEGIN in 0.0 seconds
[0m20:08:55.152432 [debug] [Thread-3 (]: Using postgres connection "test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344"
[0m20:08:55.152997 [debug] [Thread-3 (]: On test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

with child as (
    select contact_id as from_field
    from "dbt"."public"."transactions"
    where contact_id is not null
),

parent as (
    select id as to_field
    from "dbt"."public"."contacts"
)

select
    from_field

from child
left join parent
    on child.from_field = parent.to_field

where parent.to_field is null



      
    ) dbt_internal_test
[0m20:08:55.157835 [debug] [Thread-2 (]: Began running node model.customer360.stg_sf__contacts
[0m20:08:55.161418 [info ] [Thread-2 (]: 11 of 16 START sql table model public.stg_sf__contacts ......................... [RUN]
[0m20:08:55.162463 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.customer360.source_unique_salesforce_contacts_id.01cadaaf43, now model.customer360.stg_sf__contacts)
[0m20:08:55.162967 [debug] [Thread-2 (]: Began compiling node model.customer360.stg_sf__contacts
[0m20:08:55.158398 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.0 seconds
[0m20:08:55.169510 [debug] [Thread-1 (]: Timing info for test.customer360.source_unique_web_transactions_id.ba28079761 (execute): 20:08:55.098709 => 20:08:55.169152
[0m20:08:55.169988 [debug] [Thread-1 (]: On test.customer360.source_unique_web_transactions_id.ba28079761: ROLLBACK
[0m20:08:55.158899 [debug] [Thread-3 (]: SQL status: SELECT 1 in 0.0 seconds
[0m20:08:55.172064 [debug] [Thread-3 (]: Timing info for test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344 (execute): 20:08:55.127688 => 20:08:55.171732
[0m20:08:55.172631 [debug] [Thread-3 (]: On test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344: ROLLBACK
[0m20:08:55.167483 [debug] [Thread-2 (]: Writing injected SQL for node "model.customer360.stg_sf__contacts"
[0m20:08:55.173526 [debug] [Thread-2 (]: Timing info for model.customer360.stg_sf__contacts (compile): 20:08:55.163339 => 20:08:55.173170
[0m20:08:55.174008 [debug] [Thread-2 (]: Began executing node model.customer360.stg_sf__contacts
[0m20:08:55.186624 [debug] [Thread-1 (]: On test.customer360.source_unique_web_transactions_id.ba28079761: Close
[0m20:08:55.187901 [info ] [Thread-1 (]: 9 of 16 PASS source_unique_web_transactions_id ................................. [[32mPASS[0m in 0.10s]
[0m20:08:55.188668 [debug] [Thread-1 (]: Finished running node test.customer360.source_unique_web_transactions_id.ba28079761
[0m20:08:55.189221 [debug] [Thread-3 (]: On test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344: Close
[0m20:08:55.190202 [info ] [Thread-3 (]: 10 of 16 PASS source_relationships_web_transactions_contact_id__id__ref_contacts_  [[32mPASS[0m in 0.08s]
[0m20:08:55.190972 [debug] [Thread-3 (]: Finished running node test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344
[0m20:08:55.193657 [debug] [Thread-1 (]: Began running node model.customer360.stg_web__transactions
[0m20:08:55.201565 [info ] [Thread-1 (]: 12 of 16 START sql table model public.stg_web__transactions .................... [RUN]
[0m20:08:55.202336 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.customer360.source_unique_web_transactions_id.ba28079761, now model.customer360.stg_web__transactions)
[0m20:08:55.207946 [debug] [Thread-1 (]: Began compiling node model.customer360.stg_web__transactions
[0m20:08:55.220933 [debug] [Thread-1 (]: Writing injected SQL for node "model.customer360.stg_web__transactions"
[0m20:08:55.229268 [debug] [Thread-2 (]: Writing runtime sql for node "model.customer360.stg_sf__contacts"
[0m20:08:55.229861 [debug] [Thread-2 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m20:08:55.230375 [debug] [Thread-1 (]: Timing info for model.customer360.stg_web__transactions (compile): 20:08:55.218489 => 20:08:55.230092
[0m20:08:55.230808 [debug] [Thread-2 (]: On model.customer360.stg_sf__contacts: BEGIN
[0m20:08:55.231204 [debug] [Thread-1 (]: Began executing node model.customer360.stg_web__transactions
[0m20:08:55.231584 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m20:08:55.235652 [debug] [Thread-1 (]: Writing runtime sql for node "model.customer360.stg_web__transactions"
[0m20:08:55.238575 [debug] [Thread-1 (]: Using postgres connection "model.customer360.stg_web__transactions"
[0m20:08:55.239067 [debug] [Thread-1 (]: On model.customer360.stg_web__transactions: BEGIN
[0m20:08:55.239528 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:08:55.241726 [debug] [Thread-2 (]: SQL status: BEGIN in 0.0 seconds
[0m20:08:55.242253 [debug] [Thread-2 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m20:08:55.242765 [debug] [Thread-2 (]: On model.customer360.stg_sf__contacts: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_sf__contacts"} */

  
    

  create  table "dbt"."public"."stg_sf__contacts__dbt_tmp"
  
  
    as
  
  (
    with source as (
    select * from "dbt"."public"."contacts"
),

renamed as (
    select
        id,
        username as user_name,
        name,
        gender,
        address, 
        mail as email_address,
        birthdate as birth_date,
        _loaded_at_utc
    from source     
)

select * from renamed
  );
  
[0m20:08:55.249245 [debug] [Thread-2 (]: SQL status: SELECT 10 in 0.0 seconds
[0m20:08:55.262527 [debug] [Thread-2 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m20:08:55.263107 [debug] [Thread-2 (]: On model.customer360.stg_sf__contacts: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_sf__contacts"} */
alter table "dbt"."public"."stg_sf__contacts" rename to "stg_sf__contacts__dbt_backup"
[0m20:08:55.268046 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m20:08:55.272542 [debug] [Thread-2 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m20:08:55.273101 [debug] [Thread-2 (]: On model.customer360.stg_sf__contacts: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_sf__contacts"} */
alter table "dbt"."public"."stg_sf__contacts__dbt_tmp" rename to "stg_sf__contacts"
[0m20:08:55.274336 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m20:08:55.284814 [debug] [Thread-2 (]: On model.customer360.stg_sf__contacts: COMMIT
[0m20:08:55.285466 [debug] [Thread-2 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m20:08:55.286001 [debug] [Thread-2 (]: On model.customer360.stg_sf__contacts: COMMIT
[0m20:08:55.288551 [debug] [Thread-2 (]: SQL status: COMMIT in 0.0 seconds
[0m20:08:55.297779 [debug] [Thread-2 (]: Applying DROP to: "dbt"."public"."stg_sf__contacts__dbt_backup"
[0m20:08:55.304956 [debug] [Thread-2 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m20:08:55.305714 [debug] [Thread-2 (]: On model.customer360.stg_sf__contacts: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_sf__contacts"} */
drop table if exists "dbt"."public"."stg_sf__contacts__dbt_backup" cascade
[0m20:08:55.308468 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m20:08:55.308838 [debug] [Thread-1 (]: Using postgres connection "model.customer360.stg_web__transactions"
[0m20:08:55.309348 [debug] [Thread-1 (]: On model.customer360.stg_web__transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_web__transactions"} */

  
    

  create  table "dbt"."public"."stg_web__transactions__dbt_tmp"
  
  
    as
  
  (
    with source as (
    select * from "dbt"."public"."transactions"
),

renamed as (
    select
        id,
        contact_id,
        
        to_timestamp(transaction_date,'YYYY-MM-DD HH24:MI:SS.MS') :: timestamp at TIME zone 'UTC'
     as transaction_date,
        amount,
        item_count,
        category, 
        _loaded_at_utc
    from source    
),

clean_older as (
    select * from renamed 
--    where transaction_date >= (current_date - 1)  过滤超过1天的数据
--    where transaction_date >= (to_date('2023-04-12','yyyy-MM-dd') - 1)  --测试用,假设跑数日期为2023-04-12
--    and transaction_date < to_date('2023-04-12','yyyy-MM-dd')
)

select * from clean_older
  );
  
[0m20:08:55.309889 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.0 seconds
[0m20:08:55.311979 [debug] [Thread-2 (]: Timing info for model.customer360.stg_sf__contacts (execute): 20:08:55.174338 => 20:08:55.311687
[0m20:08:55.312558 [debug] [Thread-2 (]: On model.customer360.stg_sf__contacts: Close
[0m20:08:55.313575 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2cccc93f-5e7a-4823-b0c2-8ccb774e69a6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6ea4748c10>]}
[0m20:08:55.314287 [info ] [Thread-2 (]: 11 of 16 OK created sql table model public.stg_sf__contacts .................... [[32mSELECT 10[0m in 0.15s]
[0m20:08:55.315086 [debug] [Thread-2 (]: Finished running node model.customer360.stg_sf__contacts
[0m20:08:55.324732 [debug] [Thread-1 (]: SQL status: SELECT 100 in 0.0 seconds
[0m20:08:55.329205 [debug] [Thread-1 (]: Using postgres connection "model.customer360.stg_web__transactions"
[0m20:08:55.329800 [debug] [Thread-1 (]: On model.customer360.stg_web__transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_web__transactions"} */
alter table "dbt"."public"."stg_web__transactions" rename to "stg_web__transactions__dbt_backup"
[0m20:08:55.330735 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m20:08:55.335171 [debug] [Thread-1 (]: Using postgres connection "model.customer360.stg_web__transactions"
[0m20:08:55.335729 [debug] [Thread-1 (]: On model.customer360.stg_web__transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_web__transactions"} */
alter table "dbt"."public"."stg_web__transactions__dbt_tmp" rename to "stg_web__transactions"
[0m20:08:55.336998 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m20:08:55.340095 [debug] [Thread-1 (]: On model.customer360.stg_web__transactions: COMMIT
[0m20:08:55.340615 [debug] [Thread-1 (]: Using postgres connection "model.customer360.stg_web__transactions"
[0m20:08:55.341158 [debug] [Thread-1 (]: On model.customer360.stg_web__transactions: COMMIT
[0m20:08:55.343420 [debug] [Thread-1 (]: SQL status: COMMIT in 0.0 seconds
[0m20:08:55.347248 [debug] [Thread-1 (]: Applying DROP to: "dbt"."public"."stg_web__transactions__dbt_backup"
[0m20:08:55.348632 [debug] [Thread-1 (]: Using postgres connection "model.customer360.stg_web__transactions"
[0m20:08:55.349138 [debug] [Thread-1 (]: On model.customer360.stg_web__transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_web__transactions"} */
drop table if exists "dbt"."public"."stg_web__transactions__dbt_backup" cascade
[0m20:08:55.352669 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.0 seconds
[0m20:08:55.354758 [debug] [Thread-1 (]: Timing info for model.customer360.stg_web__transactions (execute): 20:08:55.231829 => 20:08:55.354456
[0m20:08:55.355302 [debug] [Thread-1 (]: On model.customer360.stg_web__transactions: Close
[0m20:08:55.356405 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2cccc93f-5e7a-4823-b0c2-8ccb774e69a6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6ea46fdad0>]}
[0m20:08:55.357156 [info ] [Thread-1 (]: 12 of 16 OK created sql table model public.stg_web__transactions ............... [[32mSELECT 100[0m in 0.15s]
[0m20:08:55.360400 [debug] [Thread-1 (]: Finished running node model.customer360.stg_web__transactions
[0m20:08:55.361538 [debug] [Thread-3 (]: Began running node model.customer360.contacts_joined_with_transactions
[0m20:08:55.362145 [info ] [Thread-3 (]: 13 of 16 START sql view model public.contacts_joined_with_transactions ......... [RUN]
[0m20:08:55.363117 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344, now model.customer360.contacts_joined_with_transactions)
[0m20:08:55.363700 [debug] [Thread-3 (]: Began compiling node model.customer360.contacts_joined_with_transactions
[0m20:08:55.368215 [debug] [Thread-3 (]: Writing injected SQL for node "model.customer360.contacts_joined_with_transactions"
[0m20:08:55.369155 [debug] [Thread-3 (]: Timing info for model.customer360.contacts_joined_with_transactions (compile): 20:08:55.363997 => 20:08:55.368827
[0m20:08:55.370022 [debug] [Thread-3 (]: Began executing node model.customer360.contacts_joined_with_transactions
[0m20:08:55.395934 [debug] [Thread-3 (]: Writing runtime sql for node "model.customer360.contacts_joined_with_transactions"
[0m20:08:55.396811 [debug] [Thread-3 (]: Using postgres connection "model.customer360.contacts_joined_with_transactions"
[0m20:08:55.397343 [debug] [Thread-3 (]: On model.customer360.contacts_joined_with_transactions: BEGIN
[0m20:08:55.397823 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m20:08:55.402786 [debug] [Thread-3 (]: SQL status: BEGIN in 0.0 seconds
[0m20:08:55.403330 [debug] [Thread-3 (]: Using postgres connection "model.customer360.contacts_joined_with_transactions"
[0m20:08:55.403827 [debug] [Thread-3 (]: On model.customer360.contacts_joined_with_transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.contacts_joined_with_transactions"} */

  create view "dbt"."public"."contacts_joined_with_transactions__dbt_tmp"
    
    
  as (
    SELECT 
    contacts.*,
    transactions.id as transaction_id,
    transactions.transaction_date,
    transactions.amount,
    transactions.item_count,
    transactions.category
FROM "dbt"."public"."stg_web__transactions" as transactions
LEFT JOIN "dbt"."public"."stg_sf__contacts" as contacts ON contacts.id = transactions.contact_id
  );
[0m20:08:55.406797 [debug] [Thread-3 (]: SQL status: CREATE VIEW in 0.0 seconds
[0m20:08:55.411254 [debug] [Thread-3 (]: Using postgres connection "model.customer360.contacts_joined_with_transactions"
[0m20:08:55.411842 [debug] [Thread-3 (]: On model.customer360.contacts_joined_with_transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.contacts_joined_with_transactions"} */
alter table "dbt"."public"."contacts_joined_with_transactions__dbt_tmp" rename to "contacts_joined_with_transactions"
[0m20:08:55.413254 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m20:08:55.415734 [debug] [Thread-3 (]: On model.customer360.contacts_joined_with_transactions: COMMIT
[0m20:08:55.416280 [debug] [Thread-3 (]: Using postgres connection "model.customer360.contacts_joined_with_transactions"
[0m20:08:55.416778 [debug] [Thread-3 (]: On model.customer360.contacts_joined_with_transactions: COMMIT
[0m20:08:55.418970 [debug] [Thread-3 (]: SQL status: COMMIT in 0.0 seconds
[0m20:08:55.422784 [debug] [Thread-3 (]: Applying DROP to: "dbt"."public"."contacts_joined_with_transactions__dbt_backup"
[0m20:08:55.427542 [debug] [Thread-3 (]: Using postgres connection "model.customer360.contacts_joined_with_transactions"
[0m20:08:55.428183 [debug] [Thread-3 (]: On model.customer360.contacts_joined_with_transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.contacts_joined_with_transactions"} */
drop view if exists "dbt"."public"."contacts_joined_with_transactions__dbt_backup" cascade
[0m20:08:55.429270 [debug] [Thread-3 (]: SQL status: DROP VIEW in 0.0 seconds
[0m20:08:55.431502 [debug] [Thread-3 (]: Timing info for model.customer360.contacts_joined_with_transactions (execute): 20:08:55.370348 => 20:08:55.431170
[0m20:08:55.432105 [debug] [Thread-3 (]: On model.customer360.contacts_joined_with_transactions: Close
[0m20:08:55.433167 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2cccc93f-5e7a-4823-b0c2-8ccb774e69a6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6ea6420290>]}
[0m20:08:55.433939 [info ] [Thread-3 (]: 13 of 16 OK created sql view model public.contacts_joined_with_transactions .... [[32mCREATE VIEW[0m in 0.07s]
[0m20:08:55.437057 [debug] [Thread-3 (]: Finished running node model.customer360.contacts_joined_with_transactions
[0m20:08:55.438057 [debug] [Thread-1 (]: Began running node test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311
[0m20:08:55.438661 [info ] [Thread-1 (]: 14 of 16 START test not_null_contacts_joined_with_transactions_id .............. [RUN]
[0m20:08:55.439638 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.customer360.stg_web__transactions, now test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311)
[0m20:08:55.440139 [debug] [Thread-1 (]: Began compiling node test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311
[0m20:08:55.448823 [debug] [Thread-1 (]: Writing injected SQL for node "test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311"
[0m20:08:55.449747 [debug] [Thread-1 (]: Timing info for test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311 (compile): 20:08:55.440673 => 20:08:55.449374
[0m20:08:55.450246 [debug] [Thread-1 (]: Began executing node test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311
[0m20:08:55.453453 [debug] [Thread-1 (]: Writing runtime sql for node "test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311"
[0m20:08:55.454171 [debug] [Thread-1 (]: Using postgres connection "test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311"
[0m20:08:55.456391 [debug] [Thread-1 (]: On test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311: BEGIN
[0m20:08:55.456921 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:08:55.462599 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m20:08:55.463249 [debug] [Thread-1 (]: Using postgres connection "test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311"
[0m20:08:55.463878 [debug] [Thread-1 (]: On test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select id
from "dbt"."public"."contacts_joined_with_transactions"
where id is null



      
    ) dbt_internal_test
[0m20:08:55.466464 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.0 seconds
[0m20:08:55.468832 [debug] [Thread-1 (]: Timing info for test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311 (execute): 20:08:55.450651 => 20:08:55.468509
[0m20:08:55.469424 [debug] [Thread-1 (]: On test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311: ROLLBACK
[0m20:08:55.470202 [debug] [Thread-1 (]: On test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311: Close
[0m20:08:55.471350 [info ] [Thread-1 (]: 14 of 16 PASS not_null_contacts_joined_with_transactions_id .................... [[32mPASS[0m in 0.03s]
[0m20:08:55.472206 [debug] [Thread-1 (]: Finished running node test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311
[0m20:08:55.473158 [debug] [Thread-3 (]: Began running node model.customer360.customers
[0m20:08:55.473773 [info ] [Thread-3 (]: 15 of 16 START sql table model public.customers ................................ [RUN]
[0m20:08:55.476852 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.customer360.contacts_joined_with_transactions, now model.customer360.customers)
[0m20:08:55.477554 [debug] [Thread-3 (]: Began compiling node model.customer360.customers
[0m20:08:55.482416 [debug] [Thread-3 (]: Writing injected SQL for node "model.customer360.customers"
[0m20:08:55.483190 [debug] [Thread-3 (]: Timing info for model.customer360.customers (compile): 20:08:55.477859 => 20:08:55.482894
[0m20:08:55.483728 [debug] [Thread-3 (]: Began executing node model.customer360.customers
[0m20:08:55.490326 [debug] [Thread-3 (]: Writing runtime sql for node "model.customer360.customers"
[0m20:08:55.491078 [debug] [Thread-3 (]: Using postgres connection "model.customer360.customers"
[0m20:08:55.491656 [debug] [Thread-3 (]: On model.customer360.customers: BEGIN
[0m20:08:55.492146 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m20:08:55.527838 [debug] [Thread-3 (]: SQL status: BEGIN in 0.0 seconds
[0m20:08:55.528494 [debug] [Thread-3 (]: Using postgres connection "model.customer360.customers"
[0m20:08:55.529019 [debug] [Thread-3 (]: On model.customer360.customers: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.customers"} */

  
    

  create  table "dbt"."public"."customers__dbt_tmp"
  
  
    as
  
  (
    SELECT
    id,
    gender,
    
    date_part('year', age(current_date, birth_date))
 AS age,
    sum(amount) as total_expense,
    date(min(transaction_date)) as first_purchase_date,
    date(max(transaction_date)) as last_purchase_date,
    sum(case when category = 'Apps & Games' then amount else 0 end) as apps_games_amount,
    sum(case when category = 'Beauty' then amount else 0 end)   as beauty_amount,
    sum(case when category = 'Books' then amount else 0 end)   as books_amount,
    sum(case when category = 'Clothing, Shoes & Accessories' then amount else 0 end)   as clothing_shoes_accessories_amount,
    sum(case when category = 'Movies & TV' then amount else 0 end)   as movies_tv_amount,
    sum(case when category = 'Sports, Fitness & Outdoors' then amount else 0 end)   as sports_fitness_outdoors_amount
FROM  "dbt"."public"."contacts_joined_with_transactions"
GROUP BY
    1,2,3
  );
  
[0m20:08:55.538556 [debug] [Thread-3 (]: SQL status: SELECT 9 in 0.0 seconds
[0m20:08:55.542866 [debug] [Thread-3 (]: Using postgres connection "model.customer360.customers"
[0m20:08:55.543448 [debug] [Thread-3 (]: On model.customer360.customers: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.customers"} */
alter table "dbt"."public"."customers" rename to "customers__dbt_backup"
[0m20:08:55.545722 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m20:08:55.549564 [debug] [Thread-3 (]: Using postgres connection "model.customer360.customers"
[0m20:08:55.550062 [debug] [Thread-3 (]: On model.customer360.customers: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.customers"} */
alter table "dbt"."public"."customers__dbt_tmp" rename to "customers"
[0m20:08:55.551013 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m20:08:55.554184 [debug] [Thread-3 (]: On model.customer360.customers: COMMIT
[0m20:08:55.554706 [debug] [Thread-3 (]: Using postgres connection "model.customer360.customers"
[0m20:08:55.555186 [debug] [Thread-3 (]: On model.customer360.customers: COMMIT
[0m20:08:55.557243 [debug] [Thread-3 (]: SQL status: COMMIT in 0.0 seconds
[0m20:08:55.560861 [debug] [Thread-3 (]: Applying DROP to: "dbt"."public"."customers__dbt_backup"
[0m20:08:55.562077 [debug] [Thread-3 (]: Using postgres connection "model.customer360.customers"
[0m20:08:55.562648 [debug] [Thread-3 (]: On model.customer360.customers: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.customers"} */
drop table if exists "dbt"."public"."customers__dbt_backup" cascade
[0m20:08:55.565590 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.0 seconds
[0m20:08:55.567569 [debug] [Thread-3 (]: Timing info for model.customer360.customers (execute): 20:08:55.484030 => 20:08:55.567252
[0m20:08:55.568068 [debug] [Thread-3 (]: On model.customer360.customers: Close
[0m20:08:55.569067 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2cccc93f-5e7a-4823-b0c2-8ccb774e69a6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6ea627a190>]}
[0m20:08:55.569835 [info ] [Thread-3 (]: 15 of 16 OK created sql table model public.customers ........................... [[32mSELECT 9[0m in 0.09s]
[0m20:08:55.573015 [debug] [Thread-3 (]: Finished running node model.customer360.customers
[0m20:08:55.573968 [debug] [Thread-1 (]: Began running node test.customer360.custormers_test
[0m20:08:55.574539 [info ] [Thread-1 (]: 16 of 16 START test custormers_test ............................................ [RUN]
[0m20:08:55.575529 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311, now test.customer360.custormers_test)
[0m20:08:55.576040 [debug] [Thread-1 (]: Began compiling node test.customer360.custormers_test
[0m20:08:55.580469 [debug] [Thread-1 (]: Writing injected SQL for node "test.customer360.custormers_test"
[0m20:08:55.581281 [debug] [Thread-1 (]: Timing info for test.customer360.custormers_test (compile): 20:08:55.576385 => 20:08:55.580968
[0m20:08:55.582071 [debug] [Thread-1 (]: Began executing node test.customer360.custormers_test
[0m20:08:55.585679 [debug] [Thread-1 (]: Writing runtime sql for node "test.customer360.custormers_test"
[0m20:08:55.586351 [debug] [Thread-1 (]: Using postgres connection "test.customer360.custormers_test"
[0m20:08:55.587024 [debug] [Thread-1 (]: On test.customer360.custormers_test: BEGIN
[0m20:08:55.587514 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:08:55.595075 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m20:08:55.595652 [debug] [Thread-1 (]: Using postgres connection "test.customer360.custormers_test"
[0m20:08:55.596410 [debug] [Thread-1 (]: On test.customer360.custormers_test: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.custormers_test"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      select
    1
from
(
    SELECT
        sum(total_expense) as total_expense,
        date(min(first_purchase_date)) as first_purchase_date,
        date(max(last_purchase_date)) as last_purchase_date,
        sum(apps_games_amount) as apps_games_amount,
        sum(beauty_amount)   as beauty_amount,
        sum(books_amount)   as books_amount,
        sum(clothing_shoes_accessories_amount)   as clothing_shoes_accessories_amount,
        sum(movies_tv_amount)   as movies_tv_amount,
        sum(sports_fitness_outdoors_amount)   as sports_fitness_outdoors_amount
    FROM  "dbt"."public"."customers"
) t1
join (
    SELECT
        sum(amount) as total_expense,
        date(min(transaction_date)) as first_purchase_date,
        date(max(transaction_date)) as last_purchase_date,
        sum(case when category = 'Apps & Games' then amount else 0 end) as apps_games_amount,
        sum(case when category = 'Beauty' then amount else 0 end)   as beauty_amount,
        sum(case when category = 'Books' then amount else 0 end)   as books_amount,
        sum(case when category = 'Clothing, Shoes & Accessories' then amount else 0 end)   as clothing_shoes_accessories_amount,
        sum(case when category = 'Movies & TV' then amount else 0 end)   as movies_tv_amount,
        sum(case when category = 'Sports, Fitness & Outdoors' then amount else 0 end)   as sports_fitness_outdoors_amount
    FROM  "dbt"."public"."contacts_joined_with_transactions"
) t2
on 1 = 1
where (
     nullif(cast(t1.total_expense as decimal(15,1))                   ,0)  <> nullif(cast(t2.total_expense                      as decimal(15,1)) ,0)
  or nullif(t1.first_purchase_date               ,'9999-12-31')       <> nullif(t2.first_purchase_date               ,'9999-12-31')
  or nullif(t1.last_purchase_date               ,'9999-12-31')        <> nullif(t2.last_purchase_date               ,'9999-12-31')
  or nullif(cast(t1.apps_games_amount                 as decimal(15,1)),0) <> nullif(cast(t2.apps_games_amount                 as decimal(15,1)) ,0)
  or nullif(cast(t1.beauty_amount                     as decimal(15,1)),0) <> nullif(cast(t2.beauty_amount                     as decimal(15,1)) ,0)
  or nullif(cast(t1.books_amount                      as decimal(15,1)),0) <> nullif(cast(t2.books_amount                      as decimal(15,1)) ,0)
  or nullif(cast(t1.clothing_shoes_accessories_amount as decimal(15,1)),0) <> nullif(cast(t2.clothing_shoes_accessories_amount as decimal(15,1)) ,0)
  or nullif(cast(t1.movies_tv_amount                  as decimal(15,1)),0) <> nullif(cast(t2.movies_tv_amount                  as decimal(15,1)) ,0)
  or nullif(cast(t1.sports_fitness_outdoors_amount    as decimal(15,1)),0) <> nullif(cast(t2.sports_fitness_outdoors_amount    as decimal(15,1)) ,0)
)
      
    ) dbt_internal_test
[0m20:08:55.600601 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.0 seconds
[0m20:08:55.602886 [debug] [Thread-1 (]: Timing info for test.customer360.custormers_test (execute): 20:08:55.582401 => 20:08:55.602575
[0m20:08:55.603449 [debug] [Thread-1 (]: On test.customer360.custormers_test: ROLLBACK
[0m20:08:55.604140 [debug] [Thread-1 (]: On test.customer360.custormers_test: Close
[0m20:08:55.605251 [info ] [Thread-1 (]: 16 of 16 PASS custormers_test .................................................. [[32mPASS[0m in 0.03s]
[0m20:08:55.606028 [debug] [Thread-1 (]: Finished running node test.customer360.custormers_test
[0m20:08:55.609944 [debug] [MainThread]: Using postgres connection "master"
[0m20:08:55.610462 [debug] [MainThread]: On master: BEGIN
[0m20:08:55.610844 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m20:08:55.615713 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m20:08:55.616203 [debug] [MainThread]: On master: COMMIT
[0m20:08:55.616683 [debug] [MainThread]: Using postgres connection "master"
[0m20:08:55.617092 [debug] [MainThread]: On master: COMMIT
[0m20:08:55.617833 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m20:08:55.618762 [debug] [MainThread]: On master: Close
[0m20:08:55.619684 [debug] [MainThread]: Connection 'master' was properly closed.
[0m20:08:55.620049 [debug] [MainThread]: Connection 'test.customer360.custormers_test' was properly closed.
[0m20:08:55.620441 [debug] [MainThread]: Connection 'model.customer360.stg_sf__contacts' was properly closed.
[0m20:08:55.620837 [debug] [MainThread]: Connection 'model.customer360.customers' was properly closed.
[0m20:08:55.621378 [info ] [MainThread]: 
[0m20:08:55.621864 [info ] [MainThread]: Finished running 10 tests, 2 seeds, 3 table models, 1 view model in 0 hours 0 minutes and 1.60 seconds (1.60s).
[0m20:08:55.627904 [debug] [MainThread]: Command end result
[0m20:08:55.638572 [info ] [MainThread]: 
[0m20:08:55.639132 [info ] [MainThread]: [32mCompleted successfully[0m
[0m20:08:55.639582 [info ] [MainThread]: 
[0m20:08:55.640014 [info ] [MainThread]: Done. PASS=16 WARN=0 ERROR=0 SKIP=0 TOTAL=16
[0m20:08:55.640949 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 2.419691, "process_user_time": 3.897587, "process_kernel_time": 0.123546, "process_mem_max_rss": "114820", "process_out_blocks": "2976", "process_in_blocks": "0"}
[0m20:08:55.641620 [debug] [MainThread]: Command `dbt build` succeeded at 20:08:55.641458 after 2.42 seconds
[0m20:08:55.642072 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6eacafbd50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6ea6665990>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6ea869c950>]}
[0m20:08:55.642558 [debug] [MainThread]: Flushing usage events
[0m20:42:39.086007 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbd019d0450>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbd01ceec90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbd01ce7b50>]}


============================== 20:42:39.088496 | 2c93006c-3cb5-4a3e-a286-a43d4dc2a3f9 ==============================
[0m20:42:39.088496 [info ] [MainThread]: Running with dbt=1.7.8
[0m20:42:39.088973 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/root/option1-customer360/integration_tests/logs', 'profiles_dir': '/root/option1-customer360/integration_tests', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'invocation_command': 'dbt build', 'log_format': 'default', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m20:42:39.321492 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '2c93006c-3cb5-4a3e-a286-a43d4dc2a3f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbd01923890>]}
[0m20:42:39.466197 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '2c93006c-3cb5-4a3e-a286-a43d4dc2a3f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbcfff7add0>]}
[0m20:42:39.472474 [info ] [MainThread]: Registered adapter: postgres=1.7.8
[0m20:42:39.512124 [debug] [MainThread]: checksum: 67f0013ca5f0bd43af9a0873dd50792fde83ef69de63b71cacd0b4ac656c52e5, vars: {}, profile: , target: , version: 1.7.8
[0m20:42:39.576796 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 1 files added, 0 files changed.
[0m20:42:39.577562 [debug] [MainThread]: Partial parsing: added file: customer360://models/marts/marketing/sales_month_report.sql
[0m20:42:39.919099 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '2c93006c-3cb5-4a3e-a286-a43d4dc2a3f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbcffe980d0>]}
[0m20:42:40.084875 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '2c93006c-3cb5-4a3e-a286-a43d4dc2a3f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbd018cdcd0>]}
[0m20:42:40.085555 [info ] [MainThread]: Found 2 seeds, 5 models, 10 tests, 2 sources, 0 exposures, 0 metrics, 403 macros, 0 groups, 0 semantic models
[0m20:42:40.088441 [info ] [MainThread]: 
[0m20:42:40.089403 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m20:42:40.090996 [debug] [ThreadPool]: Acquiring new postgres connection 'list_dbt'
[0m20:42:40.104843 [debug] [ThreadPool]: Using postgres connection "list_dbt"
[0m20:42:40.105371 [debug] [ThreadPool]: On list_dbt: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "connection_name": "list_dbt"} */

    select distinct nspname from pg_namespace
  
[0m20:42:40.105793 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:42:40.111866 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.0 seconds
[0m20:42:40.113605 [debug] [ThreadPool]: On list_dbt: Close
[0m20:42:40.117473 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dbt, now list_dbt_public)
[0m20:42:40.125365 [debug] [ThreadPool]: Using postgres connection "list_dbt_public"
[0m20:42:40.125861 [debug] [ThreadPool]: On list_dbt_public: BEGIN
[0m20:42:40.126256 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:42:40.130524 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m20:42:40.130958 [debug] [ThreadPool]: Using postgres connection "list_dbt_public"
[0m20:42:40.131418 [debug] [ThreadPool]: On list_dbt_public: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "connection_name": "list_dbt_public"} */
select
      'dbt' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'dbt' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'dbt' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m20:42:40.135271 [debug] [ThreadPool]: SQL status: SELECT 6 in 0.0 seconds
[0m20:42:40.137046 [debug] [ThreadPool]: On list_dbt_public: ROLLBACK
[0m20:42:40.137690 [debug] [ThreadPool]: On list_dbt_public: Close
[0m20:42:40.147272 [debug] [MainThread]: Using postgres connection "master"
[0m20:42:40.147808 [debug] [MainThread]: On master: BEGIN
[0m20:42:40.148200 [debug] [MainThread]: Opening a new connection, currently in state init
[0m20:42:40.152698 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m20:42:40.153151 [debug] [MainThread]: Using postgres connection "master"
[0m20:42:40.153744 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m20:42:40.168949 [debug] [MainThread]: SQL status: SELECT 2 in 0.0 seconds
[0m20:42:40.171386 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2c93006c-3cb5-4a3e-a286-a43d4dc2a3f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbcfff54890>]}
[0m20:42:40.171952 [debug] [MainThread]: On master: ROLLBACK
[0m20:42:40.172633 [debug] [MainThread]: Using postgres connection "master"
[0m20:42:40.173037 [debug] [MainThread]: On master: BEGIN
[0m20:42:40.173977 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m20:42:40.174402 [debug] [MainThread]: On master: COMMIT
[0m20:42:40.174810 [debug] [MainThread]: Using postgres connection "master"
[0m20:42:40.175205 [debug] [MainThread]: On master: COMMIT
[0m20:42:40.175829 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m20:42:40.176247 [debug] [MainThread]: On master: Close
[0m20:42:40.177149 [info ] [MainThread]: Concurrency: 3 threads (target='local')
[0m20:42:40.177615 [info ] [MainThread]: 
[0m20:42:40.182942 [debug] [Thread-1 (]: Began running node seed.integration_tests.contacts
[0m20:42:40.183608 [info ] [Thread-1 (]: 1 of 17 START seed file public.contacts ........................................ [RUN]
[0m20:42:40.184600 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dbt_public, now seed.integration_tests.contacts)
[0m20:42:40.185096 [debug] [Thread-1 (]: Began compiling node seed.integration_tests.contacts
[0m20:42:40.185867 [debug] [Thread-1 (]: Timing info for seed.integration_tests.contacts (compile): 20:42:40.185555 => 20:42:40.185558
[0m20:42:40.186394 [debug] [Thread-1 (]: Began executing node seed.integration_tests.contacts
[0m20:42:40.196658 [debug] [Thread-2 (]: Began running node seed.integration_tests.transactions
[0m20:42:40.197354 [info ] [Thread-2 (]: 2 of 17 START seed file public.transactions .................................... [RUN]
[0m20:42:40.198379 [debug] [Thread-2 (]: Acquiring new postgres connection 'seed.integration_tests.transactions'
[0m20:42:40.198852 [debug] [Thread-2 (]: Began compiling node seed.integration_tests.transactions
[0m20:42:40.199455 [debug] [Thread-2 (]: Timing info for seed.integration_tests.transactions (compile): 20:42:40.199148 => 20:42:40.199151
[0m20:42:40.199941 [debug] [Thread-2 (]: Began executing node seed.integration_tests.transactions
[0m20:42:40.221888 [debug] [Thread-3 (]: Began running node test.customer360.macro_test1
[0m20:42:40.222555 [info ] [Thread-3 (]: 3 of 17 START test macro_test1 ................................................. [RUN]
[0m20:42:40.223589 [debug] [Thread-3 (]: Acquiring new postgres connection 'test.customer360.macro_test1'
[0m20:42:40.224078 [debug] [Thread-3 (]: Began compiling node test.customer360.macro_test1
[0m20:42:40.275600 [debug] [Thread-3 (]: Writing injected SQL for node "test.customer360.macro_test1"
[0m20:42:40.276502 [debug] [Thread-3 (]: Timing info for test.customer360.macro_test1 (compile): 20:42:40.224608 => 20:42:40.276177
[0m20:42:40.276998 [debug] [Thread-3 (]: Began executing node test.customer360.macro_test1
[0m20:42:40.305733 [debug] [Thread-2 (]: Using postgres connection "seed.integration_tests.transactions"
[0m20:42:40.306324 [debug] [Thread-2 (]: On seed.integration_tests.transactions: BEGIN
[0m20:42:40.306768 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m20:42:40.314360 [debug] [Thread-1 (]: Using postgres connection "seed.integration_tests.contacts"
[0m20:42:40.314937 [debug] [Thread-1 (]: On seed.integration_tests.contacts: BEGIN
[0m20:42:40.315383 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:42:40.325062 [debug] [Thread-3 (]: Writing runtime sql for node "test.customer360.macro_test1"
[0m20:42:40.325868 [debug] [Thread-3 (]: Using postgres connection "test.customer360.macro_test1"
[0m20:42:40.326530 [debug] [Thread-3 (]: On test.customer360.macro_test1: BEGIN
[0m20:42:40.326976 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m20:42:40.333147 [debug] [Thread-3 (]: SQL status: BEGIN in 0.0 seconds
[0m20:42:40.333734 [debug] [Thread-3 (]: Using postgres connection "test.customer360.macro_test1"
[0m20:42:40.334227 [debug] [Thread-3 (]: On test.customer360.macro_test1: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.macro_test1"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      with marco_result as (
    select 
    date_part('year', age(current_date, '2023-02-12'))
 as expect_result
)
select
    1
from marco_result
where expect_result <> 1
      
    ) dbt_internal_test
[0m20:42:40.336095 [debug] [Thread-3 (]: SQL status: SELECT 1 in 0.0 seconds
[0m20:42:40.338666 [debug] [Thread-3 (]: Timing info for test.customer360.macro_test1 (execute): 20:42:40.277323 => 20:42:40.338330
[0m20:42:40.339142 [debug] [Thread-3 (]: On test.customer360.macro_test1: ROLLBACK
[0m20:42:40.339812 [debug] [Thread-3 (]: On test.customer360.macro_test1: Close
[0m20:42:40.340838 [info ] [Thread-3 (]: 3 of 17 PASS macro_test1 ....................................................... [[32mPASS[0m in 0.12s]
[0m20:42:40.341748 [debug] [Thread-3 (]: Finished running node test.customer360.macro_test1
[0m20:42:40.344393 [debug] [Thread-3 (]: Began running node test.customer360.macro_test2
[0m20:42:40.344903 [info ] [Thread-3 (]: 4 of 17 START test macro_test2 ................................................. [RUN]
[0m20:42:40.345721 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.customer360.macro_test1, now test.customer360.macro_test2)
[0m20:42:40.346288 [debug] [Thread-3 (]: Began compiling node test.customer360.macro_test2
[0m20:42:40.350220 [debug] [Thread-3 (]: Writing injected SQL for node "test.customer360.macro_test2"
[0m20:42:40.350623 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m20:42:40.351425 [debug] [Thread-1 (]: Using postgres connection "seed.integration_tests.contacts"
[0m20:42:40.351787 [debug] [Thread-1 (]: On seed.integration_tests.contacts: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "seed.integration_tests.contacts"} */
truncate table "dbt"."public"."contacts"
[0m20:42:40.350960 [debug] [Thread-2 (]: SQL status: BEGIN in 0.0 seconds
[0m20:42:40.352954 [debug] [Thread-2 (]: Using postgres connection "seed.integration_tests.transactions"
[0m20:42:40.352470 [debug] [Thread-3 (]: Timing info for test.customer360.macro_test2 (compile): 20:42:40.346529 => 20:42:40.352127
[0m20:42:40.353443 [debug] [Thread-2 (]: On seed.integration_tests.transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "seed.integration_tests.transactions"} */
truncate table "dbt"."public"."transactions"
[0m20:42:40.353890 [debug] [Thread-3 (]: Began executing node test.customer360.macro_test2
[0m20:42:40.358449 [debug] [Thread-3 (]: Writing runtime sql for node "test.customer360.macro_test2"
[0m20:42:40.358986 [debug] [Thread-3 (]: Using postgres connection "test.customer360.macro_test2"
[0m20:42:40.359342 [debug] [Thread-3 (]: On test.customer360.macro_test2: BEGIN
[0m20:42:40.359776 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m20:42:40.360695 [debug] [Thread-1 (]: SQL status: TRUNCATE TABLE in 0.0 seconds
[0m20:42:40.373972 [debug] [Thread-2 (]: SQL status: TRUNCATE TABLE in 0.0 seconds
[0m20:42:40.385209 [debug] [Thread-3 (]: SQL status: BEGIN in 0.0 seconds
[0m20:42:40.385713 [debug] [Thread-3 (]: Using postgres connection "test.customer360.macro_test2"
[0m20:42:40.386211 [debug] [Thread-3 (]: On test.customer360.macro_test2: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.macro_test2"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      with marco_result as (
    select 
        to_timestamp('2023-02-27 21:00:00','YYYY-MM-DD HH24:MI:SS.MS') :: timestamp at TIME zone 'UTC'
     as expect_result
)
select
    1
from marco_result
where cast(pg_typeof(expect_result) as text) not like '%timestamp%'
      
    ) dbt_internal_test
[0m20:42:40.400255 [debug] [Thread-3 (]: SQL status: SELECT 1 in 0.0 seconds
[0m20:42:40.402378 [debug] [Thread-3 (]: Timing info for test.customer360.macro_test2 (execute): 20:42:40.356058 => 20:42:40.402023
[0m20:42:40.402907 [debug] [Thread-3 (]: On test.customer360.macro_test2: ROLLBACK
[0m20:42:40.428607 [debug] [Thread-3 (]: On test.customer360.macro_test2: Close
[0m20:42:40.429796 [info ] [Thread-3 (]: 4 of 17 PASS macro_test2 ....................................................... [[32mPASS[0m in 0.08s]
[0m20:42:40.430560 [debug] [Thread-3 (]: Finished running node test.customer360.macro_test2
[0m20:42:40.431109 [debug] [Thread-3 (]: Began running node test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247
[0m20:42:40.431922 [info ] [Thread-3 (]: 5 of 17 START test source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors  [RUN]
[0m20:42:40.432843 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.customer360.macro_test2, now test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247)
[0m20:42:40.433404 [debug] [Thread-3 (]: Began compiling node test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247
[0m20:42:40.468748 [debug] [Thread-1 (]: Using postgres connection "seed.integration_tests.contacts"
[0m20:42:40.469435 [debug] [Thread-1 (]: On seed.integration_tests.contacts: 
          insert into "dbt"."public"."contacts" ("id", "username", "name", "gender", "address", "mail", "birthdate", "_loaded_at_utc") values
          (%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s)
      ...
[0m20:42:40.479370 [debug] [Thread-3 (]: Writing injected SQL for node "test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247"
[0m20:42:40.480305 [debug] [Thread-3 (]: Timing info for test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247 (compile): 20:42:40.433767 => 20:42:40.479941
[0m20:42:40.480900 [debug] [Thread-3 (]: Began executing node test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247
[0m20:42:40.484770 [debug] [Thread-3 (]: Writing runtime sql for node "test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247"
[0m20:42:40.485536 [debug] [Thread-3 (]: Using postgres connection "test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247"
[0m20:42:40.486109 [debug] [Thread-3 (]: On test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247: BEGIN
[0m20:42:40.486736 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m20:42:40.497617 [debug] [Thread-1 (]: SQL status: INSERT 0 10 in 0.0 seconds
[0m20:42:40.506034 [debug] [Thread-1 (]: Writing runtime SQL for node "seed.integration_tests.contacts"
[0m20:42:40.529668 [debug] [Thread-3 (]: SQL status: BEGIN in 0.0 seconds
[0m20:42:40.530277 [debug] [Thread-3 (]: Using postgres connection "test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247"
[0m20:42:40.530888 [debug] [Thread-3 (]: On test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

with all_values as (

    select
        category as value_field,
        count(*) as n_records

    from "dbt"."public"."transactions"
    group by category

)

select *
from all_values
where value_field not in (
    'Apps & Games','Beauty','Books','Clothing, Shoes & Accessories','Movies & TV','Sports, Fitness & Outdoors'
)



      
    ) dbt_internal_test
[0m20:42:40.544262 [debug] [Thread-1 (]: On seed.integration_tests.contacts: COMMIT
[0m20:42:40.545096 [debug] [Thread-1 (]: Using postgres connection "seed.integration_tests.contacts"
[0m20:42:40.545621 [debug] [Thread-1 (]: On seed.integration_tests.contacts: COMMIT
[0m20:42:40.563645 [debug] [Thread-1 (]: SQL status: COMMIT in 0.0 seconds
[0m20:42:40.565052 [debug] [Thread-1 (]: Timing info for seed.integration_tests.contacts (execute): 20:42:40.186699 => 20:42:40.564730
[0m20:42:40.565618 [debug] [Thread-1 (]: On seed.integration_tests.contacts: Close
[0m20:42:40.566646 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2c93006c-3cb5-4a3e-a286-a43d4dc2a3f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbd01920310>]}
[0m20:42:40.567339 [info ] [Thread-1 (]: 1 of 17 OK loaded seed file public.contacts .................................... [[32mINSERT 10[0m in 0.38s]
[0m20:42:40.568211 [debug] [Thread-1 (]: Finished running node seed.integration_tests.contacts
[0m20:42:40.570796 [debug] [Thread-1 (]: Began running node test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d
[0m20:42:40.571367 [info ] [Thread-1 (]: 6 of 17 START test source_not_null_salesforce_contacts_id ...................... [RUN]
[0m20:42:40.572283 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly seed.integration_tests.contacts, now test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d)
[0m20:42:40.572859 [debug] [Thread-1 (]: Began compiling node test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d
[0m20:42:40.594849 [debug] [Thread-1 (]: Writing injected SQL for node "test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d"
[0m20:42:40.595822 [debug] [Thread-1 (]: Timing info for test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d (compile): 20:42:40.573185 => 20:42:40.595507
[0m20:42:40.596397 [debug] [Thread-1 (]: Began executing node test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d
[0m20:42:40.600075 [debug] [Thread-1 (]: Writing runtime sql for node "test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d"
[0m20:42:40.600863 [debug] [Thread-1 (]: Using postgres connection "test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d"
[0m20:42:40.601412 [debug] [Thread-1 (]: On test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d: BEGIN
[0m20:42:40.601885 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:42:40.638843 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m20:42:40.639519 [debug] [Thread-1 (]: Using postgres connection "test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d"
[0m20:42:40.640012 [debug] [Thread-1 (]: On test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select id
from "dbt"."public"."contacts"
where id is null



      
    ) dbt_internal_test
[0m20:42:40.653648 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.0 seconds
[0m20:42:40.656063 [debug] [Thread-1 (]: Timing info for test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d (execute): 20:42:40.596719 => 20:42:40.655730
[0m20:42:40.656669 [debug] [Thread-1 (]: On test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d: ROLLBACK
[0m20:42:40.665645 [debug] [Thread-1 (]: On test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d: Close
[0m20:42:40.666910 [info ] [Thread-1 (]: 6 of 17 PASS source_not_null_salesforce_contacts_id ............................ [[32mPASS[0m in 0.09s]
[0m20:42:40.667637 [debug] [Thread-1 (]: Finished running node test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d
[0m20:42:40.668226 [debug] [Thread-1 (]: Began running node test.customer360.source_not_null_web_transactions_id.88a47bf7e5
[0m20:42:40.668809 [info ] [Thread-1 (]: 7 of 17 START test source_not_null_web_transactions_id ......................... [RUN]
[0m20:42:40.669818 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d, now test.customer360.source_not_null_web_transactions_id.88a47bf7e5)
[0m20:42:40.670335 [debug] [Thread-1 (]: Began compiling node test.customer360.source_not_null_web_transactions_id.88a47bf7e5
[0m20:42:40.676815 [debug] [Thread-1 (]: Writing injected SQL for node "test.customer360.source_not_null_web_transactions_id.88a47bf7e5"
[0m20:42:40.678059 [debug] [Thread-1 (]: Timing info for test.customer360.source_not_null_web_transactions_id.88a47bf7e5 (compile): 20:42:40.670614 => 20:42:40.677723
[0m20:42:40.678665 [debug] [Thread-1 (]: Began executing node test.customer360.source_not_null_web_transactions_id.88a47bf7e5
[0m20:42:40.682100 [debug] [Thread-1 (]: Writing runtime sql for node "test.customer360.source_not_null_web_transactions_id.88a47bf7e5"
[0m20:42:40.682861 [debug] [Thread-1 (]: Using postgres connection "test.customer360.source_not_null_web_transactions_id.88a47bf7e5"
[0m20:42:40.683361 [debug] [Thread-1 (]: On test.customer360.source_not_null_web_transactions_id.88a47bf7e5: BEGIN
[0m20:42:40.683787 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:42:40.726621 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m20:42:40.727211 [debug] [Thread-1 (]: Using postgres connection "test.customer360.source_not_null_web_transactions_id.88a47bf7e5"
[0m20:42:40.727750 [debug] [Thread-1 (]: On test.customer360.source_not_null_web_transactions_id.88a47bf7e5: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.source_not_null_web_transactions_id.88a47bf7e5"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select id
from "dbt"."public"."transactions"
where id is null



      
    ) dbt_internal_test
[0m20:42:40.814698 [debug] [Thread-2 (]: Using postgres connection "seed.integration_tests.transactions"
[0m20:42:40.815352 [debug] [Thread-2 (]: On seed.integration_tests.transactions: 
          insert into "dbt"."public"."transactions" ("contact_id", "id", "transaction_date", "amount", "item_count", "category", "_loaded_at_utc") values
          (%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%...
[0m20:42:40.819255 [debug] [Thread-2 (]: SQL status: INSERT 0 100 in 0.0 seconds
[0m20:42:40.820413 [debug] [Thread-2 (]: Writing runtime SQL for node "seed.integration_tests.transactions"
[0m20:42:40.822882 [debug] [Thread-2 (]: On seed.integration_tests.transactions: COMMIT
[0m20:42:40.823605 [debug] [Thread-2 (]: Using postgres connection "seed.integration_tests.transactions"
[0m20:42:40.824085 [debug] [Thread-2 (]: On seed.integration_tests.transactions: COMMIT
[0m20:42:40.833605 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.0 seconds
[0m20:42:40.835629 [debug] [Thread-1 (]: Timing info for test.customer360.source_not_null_web_transactions_id.88a47bf7e5 (execute): 20:42:40.678956 => 20:42:40.835316
[0m20:42:40.836144 [debug] [Thread-1 (]: On test.customer360.source_not_null_web_transactions_id.88a47bf7e5: ROLLBACK
[0m20:42:40.836693 [debug] [Thread-2 (]: SQL status: COMMIT in 0.0 seconds
[0m20:42:40.837926 [debug] [Thread-2 (]: Timing info for seed.integration_tests.transactions (execute): 20:42:40.200248 => 20:42:40.837643
[0m20:42:40.838669 [debug] [Thread-2 (]: On seed.integration_tests.transactions: Close
[0m20:42:40.839642 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2c93006c-3cb5-4a3e-a286-a43d4dc2a3f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbcffd10f10>]}
[0m20:42:40.840327 [info ] [Thread-2 (]: 2 of 17 OK loaded seed file public.transactions ................................ [[32mINSERT 100[0m in 0.64s]
[0m20:42:40.841083 [debug] [Thread-2 (]: Finished running node seed.integration_tests.transactions
[0m20:42:40.841731 [debug] [Thread-2 (]: Began running node test.customer360.source_unique_salesforce_contacts_id.01cadaaf43
[0m20:42:40.842257 [info ] [Thread-2 (]: 8 of 17 START test source_unique_salesforce_contacts_id ........................ [RUN]
[0m20:42:40.845251 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly seed.integration_tests.transactions, now test.customer360.source_unique_salesforce_contacts_id.01cadaaf43)
[0m20:42:40.845789 [debug] [Thread-2 (]: Began compiling node test.customer360.source_unique_salesforce_contacts_id.01cadaaf43
[0m20:42:40.858750 [debug] [Thread-3 (]: SQL status: SELECT 1 in 0.0 seconds
[0m20:42:40.860781 [debug] [Thread-3 (]: Timing info for test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247 (execute): 20:42:40.481244 => 20:42:40.860446
[0m20:42:40.861357 [debug] [Thread-3 (]: On test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247: ROLLBACK
[0m20:42:40.861906 [debug] [Thread-1 (]: On test.customer360.source_not_null_web_transactions_id.88a47bf7e5: Close
[0m20:42:40.862967 [info ] [Thread-1 (]: 7 of 17 PASS source_not_null_web_transactions_id ............................... [[32mPASS[0m in 0.19s]
[0m20:42:40.863744 [debug] [Thread-1 (]: Finished running node test.customer360.source_not_null_web_transactions_id.88a47bf7e5
[0m20:42:40.864312 [debug] [Thread-1 (]: Began running node test.customer360.source_unique_web_transactions_id.ba28079761
[0m20:42:40.864814 [info ] [Thread-1 (]: 9 of 17 START test source_unique_web_transactions_id ........................... [RUN]
[0m20:42:40.867983 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.customer360.source_not_null_web_transactions_id.88a47bf7e5, now test.customer360.source_unique_web_transactions_id.ba28079761)
[0m20:42:40.868526 [debug] [Thread-1 (]: Began compiling node test.customer360.source_unique_web_transactions_id.ba28079761
[0m20:42:40.879487 [debug] [Thread-1 (]: Writing injected SQL for node "test.customer360.source_unique_web_transactions_id.ba28079761"
[0m20:42:40.880350 [debug] [Thread-1 (]: Timing info for test.customer360.source_unique_web_transactions_id.ba28079761 (compile): 20:42:40.868833 => 20:42:40.880038
[0m20:42:40.880821 [debug] [Thread-1 (]: Began executing node test.customer360.source_unique_web_transactions_id.ba28079761
[0m20:42:40.898117 [debug] [Thread-3 (]: On test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247: Close
[0m20:42:40.899322 [info ] [Thread-3 (]: 5 of 17 PASS source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors  [[32mPASS[0m in 0.47s]
[0m20:42:40.900058 [debug] [Thread-3 (]: Finished running node test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247
[0m20:42:40.900608 [debug] [Thread-3 (]: Began running node test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344
[0m20:42:40.901111 [info ] [Thread-3 (]: 10 of 17 START test source_relationships_web_transactions_contact_id__id__ref_contacts_  [RUN]
[0m20:42:40.904050 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247, now test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344)
[0m20:42:40.904661 [debug] [Thread-3 (]: Began compiling node test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344
[0m20:42:40.927897 [debug] [Thread-2 (]: Writing injected SQL for node "test.customer360.source_unique_salesforce_contacts_id.01cadaaf43"
[0m20:42:40.928774 [debug] [Thread-2 (]: Timing info for test.customer360.source_unique_salesforce_contacts_id.01cadaaf43 (compile): 20:42:40.846087 => 20:42:40.928467
[0m20:42:40.929285 [debug] [Thread-2 (]: Began executing node test.customer360.source_unique_salesforce_contacts_id.01cadaaf43
[0m20:42:40.932422 [debug] [Thread-2 (]: Writing runtime sql for node "test.customer360.source_unique_salesforce_contacts_id.01cadaaf43"
[0m20:42:40.933010 [debug] [Thread-2 (]: Using postgres connection "test.customer360.source_unique_salesforce_contacts_id.01cadaaf43"
[0m20:42:40.938543 [debug] [Thread-2 (]: On test.customer360.source_unique_salesforce_contacts_id.01cadaaf43: BEGIN
[0m20:42:40.939003 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m20:42:40.884096 [debug] [Thread-1 (]: Writing runtime sql for node "test.customer360.source_unique_web_transactions_id.ba28079761"
[0m20:42:40.940346 [debug] [Thread-1 (]: Using postgres connection "test.customer360.source_unique_web_transactions_id.ba28079761"
[0m20:42:40.940782 [debug] [Thread-1 (]: On test.customer360.source_unique_web_transactions_id.ba28079761: BEGIN
[0m20:42:40.941188 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:42:40.943234 [debug] [Thread-3 (]: Writing injected SQL for node "test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344"
[0m20:42:40.943947 [debug] [Thread-3 (]: Timing info for test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344 (compile): 20:42:40.904960 => 20:42:40.943651
[0m20:42:40.945404 [debug] [Thread-3 (]: Began executing node test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344
[0m20:42:40.948499 [debug] [Thread-3 (]: Writing runtime sql for node "test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344"
[0m20:42:40.949092 [debug] [Thread-3 (]: Using postgres connection "test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344"
[0m20:42:40.949567 [debug] [Thread-3 (]: On test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344: BEGIN
[0m20:42:40.949979 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m20:42:40.996672 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m20:42:40.997283 [debug] [Thread-1 (]: Using postgres connection "test.customer360.source_unique_web_transactions_id.ba28079761"
[0m20:42:40.997813 [debug] [Thread-1 (]: On test.customer360.source_unique_web_transactions_id.ba28079761: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.source_unique_web_transactions_id.ba28079761"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

select
    id as unique_field,
    count(*) as n_records

from "dbt"."public"."transactions"
where id is not null
group by id
having count(*) > 1



      
    ) dbt_internal_test
[0m20:42:41.016032 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.0 seconds
[0m20:42:41.018146 [debug] [Thread-1 (]: Timing info for test.customer360.source_unique_web_transactions_id.ba28079761 (execute): 20:42:40.881114 => 20:42:41.017824
[0m20:42:41.018679 [debug] [Thread-1 (]: On test.customer360.source_unique_web_transactions_id.ba28079761: ROLLBACK
[0m20:42:41.019338 [debug] [Thread-2 (]: SQL status: BEGIN in 0.0 seconds
[0m20:42:41.019806 [debug] [Thread-2 (]: Using postgres connection "test.customer360.source_unique_salesforce_contacts_id.01cadaaf43"
[0m20:42:41.020279 [debug] [Thread-2 (]: On test.customer360.source_unique_salesforce_contacts_id.01cadaaf43: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.source_unique_salesforce_contacts_id.01cadaaf43"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

select
    id as unique_field,
    count(*) as n_records

from "dbt"."public"."contacts"
where id is not null
group by id
having count(*) > 1



      
    ) dbt_internal_test
[0m20:42:41.024094 [debug] [Thread-2 (]: SQL status: SELECT 1 in 0.0 seconds
[0m20:42:41.025950 [debug] [Thread-2 (]: Timing info for test.customer360.source_unique_salesforce_contacts_id.01cadaaf43 (execute): 20:42:40.929605 => 20:42:41.025668
[0m20:42:41.026460 [debug] [Thread-2 (]: On test.customer360.source_unique_salesforce_contacts_id.01cadaaf43: ROLLBACK
[0m20:42:41.027016 [debug] [Thread-1 (]: On test.customer360.source_unique_web_transactions_id.ba28079761: Close
[0m20:42:41.028111 [info ] [Thread-1 (]: 9 of 17 PASS source_unique_web_transactions_id ................................. [[32mPASS[0m in 0.16s]
[0m20:42:41.028908 [debug] [Thread-1 (]: Finished running node test.customer360.source_unique_web_transactions_id.ba28079761
[0m20:42:41.035113 [debug] [Thread-2 (]: On test.customer360.source_unique_salesforce_contacts_id.01cadaaf43: Close
[0m20:42:41.036272 [info ] [Thread-2 (]: 8 of 17 PASS source_unique_salesforce_contacts_id .............................. [[32mPASS[0m in 0.19s]
[0m20:42:41.037040 [debug] [Thread-2 (]: Finished running node test.customer360.source_unique_salesforce_contacts_id.01cadaaf43
[0m20:42:41.037630 [debug] [Thread-2 (]: Began running node model.customer360.stg_web__transactions
[0m20:42:41.038233 [info ] [Thread-2 (]: 11 of 17 START sql table model public.stg_web__transactions .................... [RUN]
[0m20:42:41.045597 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.customer360.source_unique_salesforce_contacts_id.01cadaaf43, now model.customer360.stg_web__transactions)
[0m20:42:41.046094 [debug] [Thread-2 (]: Began compiling node model.customer360.stg_web__transactions
[0m20:42:41.059265 [debug] [Thread-3 (]: SQL status: BEGIN in 0.0 seconds
[0m20:42:41.059901 [debug] [Thread-3 (]: Using postgres connection "test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344"
[0m20:42:41.060508 [debug] [Thread-3 (]: On test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

with child as (
    select contact_id as from_field
    from "dbt"."public"."transactions"
    where contact_id is not null
),

parent as (
    select id as to_field
    from "dbt"."public"."contacts"
)

select
    from_field

from child
left join parent
    on child.from_field = parent.to_field

where parent.to_field is null



      
    ) dbt_internal_test
[0m20:42:41.061289 [debug] [Thread-1 (]: Began running node model.customer360.stg_sf__contacts
[0m20:42:41.061878 [info ] [Thread-1 (]: 12 of 17 START sql table model public.stg_sf__contacts ......................... [RUN]
[0m20:42:41.062779 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.customer360.source_unique_web_transactions_id.ba28079761, now model.customer360.stg_sf__contacts)
[0m20:42:41.063237 [debug] [Thread-1 (]: Began compiling node model.customer360.stg_sf__contacts
[0m20:42:41.068571 [debug] [Thread-1 (]: Writing injected SQL for node "model.customer360.stg_sf__contacts"
[0m20:42:41.069398 [debug] [Thread-1 (]: Timing info for model.customer360.stg_sf__contacts (compile): 20:42:41.063549 => 20:42:41.069080
[0m20:42:41.069891 [debug] [Thread-1 (]: Began executing node model.customer360.stg_sf__contacts
[0m20:42:41.088136 [debug] [Thread-3 (]: SQL status: SELECT 1 in 0.0 seconds
[0m20:42:41.103831 [debug] [Thread-3 (]: Timing info for test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344 (execute): 20:42:40.945706 => 20:42:41.103430
[0m20:42:41.104427 [debug] [Thread-3 (]: On test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344: ROLLBACK
[0m20:42:41.089439 [debug] [Thread-2 (]: Writing injected SQL for node "model.customer360.stg_web__transactions"
[0m20:42:41.105258 [debug] [Thread-2 (]: Timing info for model.customer360.stg_web__transactions (compile): 20:42:41.046377 => 20:42:41.104964
[0m20:42:41.106330 [debug] [Thread-2 (]: Began executing node model.customer360.stg_web__transactions
[0m20:42:41.116783 [debug] [Thread-3 (]: On test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344: Close
[0m20:42:41.118002 [info ] [Thread-3 (]: 10 of 17 PASS source_relationships_web_transactions_contact_id__id__ref_contacts_  [[32mPASS[0m in 0.21s]
[0m20:42:41.118745 [debug] [Thread-3 (]: Finished running node test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344
[0m20:42:41.173391 [debug] [Thread-1 (]: Writing runtime sql for node "model.customer360.stg_sf__contacts"
[0m20:42:41.174169 [debug] [Thread-1 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m20:42:41.175919 [debug] [Thread-1 (]: On model.customer360.stg_sf__contacts: BEGIN
[0m20:42:41.176406 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:42:41.175137 [debug] [Thread-2 (]: Writing runtime sql for node "model.customer360.stg_web__transactions"
[0m20:42:41.177972 [debug] [Thread-2 (]: Using postgres connection "model.customer360.stg_web__transactions"
[0m20:42:41.178496 [debug] [Thread-2 (]: On model.customer360.stg_web__transactions: BEGIN
[0m20:42:41.178960 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m20:42:41.188318 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m20:42:41.188914 [debug] [Thread-1 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m20:42:41.189465 [debug] [Thread-1 (]: On model.customer360.stg_sf__contacts: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_sf__contacts"} */

  
    

  create  table "dbt"."public"."stg_sf__contacts__dbt_tmp"
  
  
    as
  
  (
    with source as (
    select * from "dbt"."public"."contacts"
),

renamed as (
    select
        id,
        username as user_name,
        name,
        gender,
        address, 
        mail as email_address,
        birthdate as birth_date,
        _loaded_at_utc
    from source     
)

select * from renamed
  );
  
[0m20:42:41.195874 [debug] [Thread-1 (]: SQL status: SELECT 10 in 0.0 seconds
[0m20:42:41.205098 [debug] [Thread-1 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m20:42:41.205699 [debug] [Thread-1 (]: On model.customer360.stg_sf__contacts: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_sf__contacts"} */
alter table "dbt"."public"."stg_sf__contacts" rename to "stg_sf__contacts__dbt_backup"
[0m20:42:41.206268 [debug] [Thread-2 (]: SQL status: BEGIN in 0.0 seconds
[0m20:42:41.206769 [debug] [Thread-2 (]: Using postgres connection "model.customer360.stg_web__transactions"
[0m20:42:41.207818 [debug] [Thread-2 (]: On model.customer360.stg_web__transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_web__transactions"} */

  
    

  create  table "dbt"."public"."stg_web__transactions__dbt_tmp"
  
  
    as
  
  (
    with source as (
    select * from "dbt"."public"."transactions"
),

renamed as (
    select
        id,
        contact_id,
        
        to_timestamp(transaction_date,'YYYY-MM-DD HH24:MI:SS.MS') :: timestamp at TIME zone 'UTC'
     as transaction_date,
        amount,
        item_count,
        category, 
        _loaded_at_utc
    from source    
),

clean_older as (
    select * from renamed 
--    where transaction_date >= (current_date - 1)  过滤超过1天的数据
--    where transaction_date >= (to_date('2023-04-12','yyyy-MM-dd') - 1)  --测试用,假设跑数日期为2023-04-12
--    and transaction_date < to_date('2023-04-12','yyyy-MM-dd')
)

select * from clean_older
  );
  
[0m20:42:41.208491 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m20:42:41.218593 [debug] [Thread-1 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m20:42:41.221933 [debug] [Thread-1 (]: On model.customer360.stg_sf__contacts: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_sf__contacts"} */
alter table "dbt"."public"."stg_sf__contacts__dbt_tmp" rename to "stg_sf__contacts"
[0m20:42:41.228793 [debug] [Thread-2 (]: SQL status: SELECT 100 in 0.0 seconds
[0m20:42:41.229322 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m20:42:41.243234 [debug] [Thread-1 (]: On model.customer360.stg_sf__contacts: COMMIT
[0m20:42:41.243790 [debug] [Thread-1 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m20:42:41.233712 [debug] [Thread-2 (]: Using postgres connection "model.customer360.stg_web__transactions"
[0m20:42:41.253938 [debug] [Thread-2 (]: On model.customer360.stg_web__transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_web__transactions"} */
alter table "dbt"."public"."stg_web__transactions" rename to "stg_web__transactions__dbt_backup"
[0m20:42:41.244272 [debug] [Thread-1 (]: On model.customer360.stg_sf__contacts: COMMIT
[0m20:42:41.259240 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m20:42:41.261661 [debug] [Thread-1 (]: SQL status: COMMIT in 0.0 seconds
[0m20:42:41.266100 [debug] [Thread-2 (]: Using postgres connection "model.customer360.stg_web__transactions"
[0m20:42:41.279708 [debug] [Thread-2 (]: On model.customer360.stg_web__transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_web__transactions"} */
alter table "dbt"."public"."stg_web__transactions__dbt_tmp" rename to "stg_web__transactions"
[0m20:42:41.280339 [debug] [Thread-1 (]: Applying DROP to: "dbt"."public"."stg_sf__contacts__dbt_backup"
[0m20:42:41.289877 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m20:42:41.293312 [debug] [Thread-2 (]: On model.customer360.stg_web__transactions: COMMIT
[0m20:42:41.293859 [debug] [Thread-2 (]: Using postgres connection "model.customer360.stg_web__transactions"
[0m20:42:41.294326 [debug] [Thread-2 (]: On model.customer360.stg_web__transactions: COMMIT
[0m20:42:41.299716 [debug] [Thread-1 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m20:42:41.300329 [debug] [Thread-1 (]: On model.customer360.stg_sf__contacts: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_sf__contacts"} */
drop table if exists "dbt"."public"."stg_sf__contacts__dbt_backup" cascade
[0m20:42:41.300889 [debug] [Thread-2 (]: SQL status: COMMIT in 0.0 seconds
[0m20:42:41.311491 [debug] [Thread-2 (]: Applying DROP to: "dbt"."public"."stg_web__transactions__dbt_backup"
[0m20:42:41.312688 [debug] [Thread-2 (]: Using postgres connection "model.customer360.stg_web__transactions"
[0m20:42:41.313179 [debug] [Thread-2 (]: On model.customer360.stg_web__transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_web__transactions"} */
drop table if exists "dbt"."public"."stg_web__transactions__dbt_backup" cascade
[0m20:42:41.316637 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.0 seconds
[0m20:42:41.318854 [debug] [Thread-1 (]: Timing info for model.customer360.stg_sf__contacts (execute): 20:42:41.070207 => 20:42:41.318551
[0m20:42:41.319496 [debug] [Thread-1 (]: On model.customer360.stg_sf__contacts: Close
[0m20:42:41.322568 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2c93006c-3cb5-4a3e-a286-a43d4dc2a3f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbcff6e9ad0>]}
[0m20:42:41.323334 [info ] [Thread-1 (]: 12 of 17 OK created sql table model public.stg_sf__contacts .................... [[32mSELECT 10[0m in 0.26s]
[0m20:42:41.324046 [debug] [Thread-1 (]: Finished running node model.customer360.stg_sf__contacts
[0m20:42:41.325342 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.0 seconds
[0m20:42:41.327499 [debug] [Thread-2 (]: Timing info for model.customer360.stg_web__transactions (execute): 20:42:41.106619 => 20:42:41.327187
[0m20:42:41.328012 [debug] [Thread-2 (]: On model.customer360.stg_web__transactions: Close
[0m20:42:41.329029 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2c93006c-3cb5-4a3e-a286-a43d4dc2a3f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbcff5db5d0>]}
[0m20:42:41.329798 [info ] [Thread-2 (]: 11 of 17 OK created sql table model public.stg_web__transactions ............... [[32mSELECT 100[0m in 0.28s]
[0m20:42:41.330704 [debug] [Thread-2 (]: Finished running node model.customer360.stg_web__transactions
[0m20:42:41.335786 [debug] [Thread-3 (]: Began running node model.customer360.contacts_joined_with_transactions
[0m20:42:41.336468 [info ] [Thread-3 (]: 13 of 17 START sql view model public.contacts_joined_with_transactions ......... [RUN]
[0m20:42:41.337388 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344, now model.customer360.contacts_joined_with_transactions)
[0m20:42:41.337872 [debug] [Thread-3 (]: Began compiling node model.customer360.contacts_joined_with_transactions
[0m20:42:41.341694 [debug] [Thread-3 (]: Writing injected SQL for node "model.customer360.contacts_joined_with_transactions"
[0m20:42:41.342496 [debug] [Thread-3 (]: Timing info for model.customer360.contacts_joined_with_transactions (compile): 20:42:41.338160 => 20:42:41.342180
[0m20:42:41.343007 [debug] [Thread-3 (]: Began executing node model.customer360.contacts_joined_with_transactions
[0m20:42:41.351849 [debug] [Thread-1 (]: Began running node model.customer360.sales_month_report
[0m20:42:41.352431 [info ] [Thread-1 (]: 14 of 17 START sql table model public.sales_month_report ....................... [RUN]
[0m20:42:41.353418 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.customer360.stg_sf__contacts, now model.customer360.sales_month_report)
[0m20:42:41.353950 [debug] [Thread-1 (]: Began compiling node model.customer360.sales_month_report
[0m20:42:41.360731 [debug] [Thread-1 (]: Writing injected SQL for node "model.customer360.sales_month_report"
[0m20:42:41.361580 [debug] [Thread-1 (]: Timing info for model.customer360.sales_month_report (compile): 20:42:41.354267 => 20:42:41.361213
[0m20:42:41.362119 [debug] [Thread-1 (]: Began executing node model.customer360.sales_month_report
[0m20:42:41.368602 [debug] [Thread-1 (]: Writing runtime sql for node "model.customer360.sales_month_report"
[0m20:42:41.369343 [debug] [Thread-1 (]: Using postgres connection "model.customer360.sales_month_report"
[0m20:42:41.369796 [debug] [Thread-1 (]: On model.customer360.sales_month_report: BEGIN
[0m20:42:41.376810 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:42:41.406524 [debug] [Thread-3 (]: Writing runtime sql for node "model.customer360.contacts_joined_with_transactions"
[0m20:42:41.407349 [debug] [Thread-3 (]: Using postgres connection "model.customer360.contacts_joined_with_transactions"
[0m20:42:41.407839 [debug] [Thread-3 (]: On model.customer360.contacts_joined_with_transactions: BEGIN
[0m20:42:41.408360 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m20:42:41.424459 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m20:42:41.425056 [debug] [Thread-1 (]: Using postgres connection "model.customer360.sales_month_report"
[0m20:42:41.425679 [debug] [Thread-1 (]: On model.customer360.sales_month_report: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.sales_month_report"} */

  
    

  create  table "dbt"."public"."sales_month_report__dbt_tmp"
  
  
    as
  
  (
    SELECT
     count(id)                                  as total_count
    ,cast(count(id) / 31 as decimal(24,2))      as day_avg_count
    ,sum(case when category = 'Apps & Games'                    then 1 else 0 end)   as apps_games_count
    ,sum(case when category = 'Beauty'                          then 1 else 0 end)   as beauty_count
    ,sum(case when category = 'Books'                           then 1 else 0 end)   as books_count
    ,sum(case when category = 'Clothing, Shoes & Accessories'   then 1 else 0 end)   as clothing_shoes_accessories_count
    ,sum(case when category = 'Movies & TV'                     then 1 else 0 end)   as movies_tv_count
    ,sum(case when category = 'Sports, Fitness & Outdoors'      then 1 else 0 end)   as sports_fitness_outdoors_count

    ,sum(amount) as total_expense
    ,cast(sum(amount) / 31 as decimal(24,4))    as day_avg_count
    ,sum(case when category = 'Apps & Games'                    then amount else 0 end)   as apps_games_amount
    ,sum(case when category = 'Beauty'                          then amount else 0 end)   as beauty_amount
    ,sum(case when category = 'Books'                           then amount else 0 end)   as books_amount
    ,sum(case when category = 'Clothing, Shoes & Accessories'   then amount else 0 end)   as clothing_shoes_accessories_amount
    ,sum(case when category = 'Movies & TV'                     then amount else 0 end)   as movies_tv_amount
    ,sum(case when category = 'Sports, Fitness & Outdoors'      then amount else 0 end)   as sports_fitness_outdoors_amount
FROM  "dbt"."public"."stg_web__transactions"
where transaction_date between '2023-05-01' and '2023-05-31'  -- 样例，实际脚本可改成传参
;
  );
  
[0m20:42:41.437251 [debug] [Thread-1 (]: Postgres adapter: Postgres error: syntax error at or near ";"
LINE 32: ;
         ^

[0m20:42:41.437855 [debug] [Thread-1 (]: On model.customer360.sales_month_report: ROLLBACK
[0m20:42:41.442983 [debug] [Thread-3 (]: SQL status: BEGIN in 0.0 seconds
[0m20:42:41.443527 [debug] [Thread-3 (]: Using postgres connection "model.customer360.contacts_joined_with_transactions"
[0m20:42:41.443983 [debug] [Thread-3 (]: On model.customer360.contacts_joined_with_transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.contacts_joined_with_transactions"} */

  create view "dbt"."public"."contacts_joined_with_transactions__dbt_tmp"
    
    
  as (
    SELECT 
    contacts.*,
    transactions.id as transaction_id,
    transactions.transaction_date,
    transactions.amount,
    transactions.item_count,
    transactions.category
FROM "dbt"."public"."stg_web__transactions" as transactions
LEFT JOIN "dbt"."public"."stg_sf__contacts" as contacts ON contacts.id = transactions.contact_id
  );
[0m20:42:41.450094 [debug] [Thread-1 (]: Timing info for model.customer360.sales_month_report (execute): 20:42:41.362463 => 20:42:41.449723
[0m20:42:41.450625 [debug] [Thread-1 (]: On model.customer360.sales_month_report: Close
[0m20:42:41.455392 [debug] [Thread-1 (]: Database Error in model sales_month_report (models/marts/marketing/sales_month_report.sql)
  syntax error at or near ";"
  LINE 32: ;
           ^
  compiled Code at target/run/customer360/models/marts/marketing/sales_month_report.sql
[0m20:42:41.455973 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2c93006c-3cb5-4a3e-a286-a43d4dc2a3f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbcffec9450>]}
[0m20:42:41.461829 [error] [Thread-1 (]: 14 of 17 ERROR creating sql table model public.sales_month_report .............. [[31mERROR[0m in 0.10s]
[0m20:42:41.462711 [debug] [Thread-1 (]: Finished running node model.customer360.sales_month_report
[0m20:42:41.463317 [debug] [Thread-3 (]: SQL status: CREATE VIEW in 0.0 seconds
[0m20:42:41.468204 [debug] [Thread-3 (]: Using postgres connection "model.customer360.contacts_joined_with_transactions"
[0m20:42:41.468765 [debug] [Thread-3 (]: On model.customer360.contacts_joined_with_transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.contacts_joined_with_transactions"} */
alter table "dbt"."public"."contacts_joined_with_transactions__dbt_tmp" rename to "contacts_joined_with_transactions"
[0m20:42:41.471037 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m20:42:41.473312 [debug] [Thread-3 (]: On model.customer360.contacts_joined_with_transactions: COMMIT
[0m20:42:41.473824 [debug] [Thread-3 (]: Using postgres connection "model.customer360.contacts_joined_with_transactions"
[0m20:42:41.474338 [debug] [Thread-3 (]: On model.customer360.contacts_joined_with_transactions: COMMIT
[0m20:42:41.481745 [debug] [Thread-3 (]: SQL status: COMMIT in 0.0 seconds
[0m20:42:41.485719 [debug] [Thread-3 (]: Applying DROP to: "dbt"."public"."contacts_joined_with_transactions__dbt_backup"
[0m20:42:41.496944 [debug] [Thread-3 (]: Using postgres connection "model.customer360.contacts_joined_with_transactions"
[0m20:42:41.497539 [debug] [Thread-3 (]: On model.customer360.contacts_joined_with_transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.contacts_joined_with_transactions"} */
drop view if exists "dbt"."public"."contacts_joined_with_transactions__dbt_backup" cascade
[0m20:42:41.498829 [debug] [Thread-3 (]: SQL status: DROP VIEW in 0.0 seconds
[0m20:42:41.500775 [debug] [Thread-3 (]: Timing info for model.customer360.contacts_joined_with_transactions (execute): 20:42:41.343317 => 20:42:41.500460
[0m20:42:41.501289 [debug] [Thread-3 (]: On model.customer360.contacts_joined_with_transactions: Close
[0m20:42:41.502240 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2c93006c-3cb5-4a3e-a286-a43d4dc2a3f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbcffd0b810>]}
[0m20:42:41.504903 [info ] [Thread-3 (]: 13 of 17 OK created sql view model public.contacts_joined_with_transactions .... [[32mCREATE VIEW[0m in 0.17s]
[0m20:42:41.505680 [debug] [Thread-3 (]: Finished running node model.customer360.contacts_joined_with_transactions
[0m20:42:41.507030 [debug] [Thread-2 (]: Began running node test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311
[0m20:42:41.507604 [info ] [Thread-2 (]: 15 of 17 START test not_null_contacts_joined_with_transactions_id .............. [RUN]
[0m20:42:41.508540 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.customer360.stg_web__transactions, now test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311)
[0m20:42:41.509032 [debug] [Thread-2 (]: Began compiling node test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311
[0m20:42:41.520519 [debug] [Thread-2 (]: Writing injected SQL for node "test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311"
[0m20:42:41.521471 [debug] [Thread-2 (]: Timing info for test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311 (compile): 20:42:41.509420 => 20:42:41.521110
[0m20:42:41.521966 [debug] [Thread-2 (]: Began executing node test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311
[0m20:42:41.528644 [debug] [Thread-2 (]: Writing runtime sql for node "test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311"
[0m20:42:41.529607 [debug] [Thread-2 (]: Using postgres connection "test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311"
[0m20:42:41.532650 [debug] [Thread-2 (]: On test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311: BEGIN
[0m20:42:41.533221 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m20:42:41.566746 [debug] [Thread-2 (]: SQL status: BEGIN in 0.0 seconds
[0m20:42:41.567386 [debug] [Thread-2 (]: Using postgres connection "test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311"
[0m20:42:41.567952 [debug] [Thread-2 (]: On test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select id
from "dbt"."public"."contacts_joined_with_transactions"
where id is null



      
    ) dbt_internal_test
[0m20:42:41.576627 [debug] [Thread-2 (]: SQL status: SELECT 1 in 0.0 seconds
[0m20:42:41.578411 [debug] [Thread-2 (]: Timing info for test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311 (execute): 20:42:41.522310 => 20:42:41.578097
[0m20:42:41.578760 [debug] [Thread-2 (]: On test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311: ROLLBACK
[0m20:42:41.581530 [debug] [Thread-2 (]: On test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311: Close
[0m20:42:41.582696 [info ] [Thread-2 (]: 15 of 17 PASS not_null_contacts_joined_with_transactions_id .................... [[32mPASS[0m in 0.07s]
[0m20:42:41.585631 [debug] [Thread-2 (]: Finished running node test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311
[0m20:42:41.590995 [debug] [Thread-3 (]: Began running node model.customer360.customers
[0m20:42:41.591902 [info ] [Thread-3 (]: 16 of 17 START sql table model public.customers ................................ [RUN]
[0m20:42:41.592928 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.customer360.contacts_joined_with_transactions, now model.customer360.customers)
[0m20:42:41.593597 [debug] [Thread-3 (]: Began compiling node model.customer360.customers
[0m20:42:41.597957 [debug] [Thread-3 (]: Writing injected SQL for node "model.customer360.customers"
[0m20:42:41.598843 [debug] [Thread-3 (]: Timing info for model.customer360.customers (compile): 20:42:41.593905 => 20:42:41.598560
[0m20:42:41.599369 [debug] [Thread-3 (]: Began executing node model.customer360.customers
[0m20:42:41.614024 [debug] [Thread-3 (]: Writing runtime sql for node "model.customer360.customers"
[0m20:42:41.614872 [debug] [Thread-3 (]: Using postgres connection "model.customer360.customers"
[0m20:42:41.615378 [debug] [Thread-3 (]: On model.customer360.customers: BEGIN
[0m20:42:41.615853 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m20:42:41.624335 [debug] [Thread-3 (]: SQL status: BEGIN in 0.0 seconds
[0m20:42:41.624938 [debug] [Thread-3 (]: Using postgres connection "model.customer360.customers"
[0m20:42:41.625520 [debug] [Thread-3 (]: On model.customer360.customers: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.customers"} */

  
    

  create  table "dbt"."public"."customers__dbt_tmp"
  
  
    as
  
  (
    SELECT
    id,
    gender,
    
    date_part('year', age(current_date, birth_date))
 AS age,
    sum(amount) as total_expense,
    date(min(transaction_date)) as first_purchase_date,
    date(max(transaction_date)) as last_purchase_date,
    sum(case when category = 'Apps & Games' then amount else 0 end) as apps_games_amount,
    sum(case when category = 'Beauty' then amount else 0 end)   as beauty_amount,
    sum(case when category = 'Books' then amount else 0 end)   as books_amount,
    sum(case when category = 'Clothing, Shoes & Accessories' then amount else 0 end)   as clothing_shoes_accessories_amount,
    sum(case when category = 'Movies & TV' then amount else 0 end)   as movies_tv_amount,
    sum(case when category = 'Sports, Fitness & Outdoors' then amount else 0 end)   as sports_fitness_outdoors_amount
FROM  "dbt"."public"."contacts_joined_with_transactions"
GROUP BY
    1,2,3
  );
  
[0m20:42:41.635621 [debug] [Thread-3 (]: SQL status: SELECT 9 in 0.0 seconds
[0m20:42:41.640470 [debug] [Thread-3 (]: Using postgres connection "model.customer360.customers"
[0m20:42:41.640990 [debug] [Thread-3 (]: On model.customer360.customers: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.customers"} */
alter table "dbt"."public"."customers" rename to "customers__dbt_backup"
[0m20:42:41.641996 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m20:42:41.646039 [debug] [Thread-3 (]: Using postgres connection "model.customer360.customers"
[0m20:42:41.646616 [debug] [Thread-3 (]: On model.customer360.customers: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.customers"} */
alter table "dbt"."public"."customers__dbt_tmp" rename to "customers"
[0m20:42:41.647429 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m20:42:41.650591 [debug] [Thread-3 (]: On model.customer360.customers: COMMIT
[0m20:42:41.651091 [debug] [Thread-3 (]: Using postgres connection "model.customer360.customers"
[0m20:42:41.651651 [debug] [Thread-3 (]: On model.customer360.customers: COMMIT
[0m20:42:41.653475 [debug] [Thread-3 (]: SQL status: COMMIT in 0.0 seconds
[0m20:42:41.657305 [debug] [Thread-3 (]: Applying DROP to: "dbt"."public"."customers__dbt_backup"
[0m20:42:41.658521 [debug] [Thread-3 (]: Using postgres connection "model.customer360.customers"
[0m20:42:41.659077 [debug] [Thread-3 (]: On model.customer360.customers: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.customers"} */
drop table if exists "dbt"."public"."customers__dbt_backup" cascade
[0m20:42:41.661952 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.0 seconds
[0m20:42:41.664010 [debug] [Thread-3 (]: Timing info for model.customer360.customers (execute): 20:42:41.599710 => 20:42:41.663658
[0m20:42:41.664545 [debug] [Thread-3 (]: On model.customer360.customers: Close
[0m20:42:41.665545 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2c93006c-3cb5-4a3e-a286-a43d4dc2a3f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbcff791dd0>]}
[0m20:42:41.666304 [info ] [Thread-3 (]: 16 of 17 OK created sql table model public.customers ........................... [[32mSELECT 9[0m in 0.07s]
[0m20:42:41.669383 [debug] [Thread-3 (]: Finished running node model.customer360.customers
[0m20:42:41.670924 [debug] [Thread-2 (]: Began running node test.customer360.custormers_test
[0m20:42:41.671503 [info ] [Thread-2 (]: 17 of 17 START test custormers_test ............................................ [RUN]
[0m20:42:41.672411 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311, now test.customer360.custormers_test)
[0m20:42:41.672917 [debug] [Thread-2 (]: Began compiling node test.customer360.custormers_test
[0m20:42:41.677639 [debug] [Thread-2 (]: Writing injected SQL for node "test.customer360.custormers_test"
[0m20:42:41.678940 [debug] [Thread-2 (]: Timing info for test.customer360.custormers_test (compile): 20:42:41.673284 => 20:42:41.678120
[0m20:42:41.679508 [debug] [Thread-2 (]: Began executing node test.customer360.custormers_test
[0m20:42:41.685230 [debug] [Thread-2 (]: Writing runtime sql for node "test.customer360.custormers_test"
[0m20:42:41.686198 [debug] [Thread-2 (]: Using postgres connection "test.customer360.custormers_test"
[0m20:42:41.686890 [debug] [Thread-2 (]: On test.customer360.custormers_test: BEGIN
[0m20:42:41.687413 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m20:42:41.692154 [debug] [Thread-2 (]: SQL status: BEGIN in 0.0 seconds
[0m20:42:41.692739 [debug] [Thread-2 (]: Using postgres connection "test.customer360.custormers_test"
[0m20:42:41.693473 [debug] [Thread-2 (]: On test.customer360.custormers_test: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.custormers_test"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      select
    1
from
(
    SELECT
        sum(total_expense) as total_expense,
        date(min(first_purchase_date)) as first_purchase_date,
        date(max(last_purchase_date)) as last_purchase_date,
        sum(apps_games_amount) as apps_games_amount,
        sum(beauty_amount)   as beauty_amount,
        sum(books_amount)   as books_amount,
        sum(clothing_shoes_accessories_amount)   as clothing_shoes_accessories_amount,
        sum(movies_tv_amount)   as movies_tv_amount,
        sum(sports_fitness_outdoors_amount)   as sports_fitness_outdoors_amount
    FROM  "dbt"."public"."customers"
) t1
join (
    SELECT
        sum(amount) as total_expense,
        date(min(transaction_date)) as first_purchase_date,
        date(max(transaction_date)) as last_purchase_date,
        sum(case when category = 'Apps & Games' then amount else 0 end) as apps_games_amount,
        sum(case when category = 'Beauty' then amount else 0 end)   as beauty_amount,
        sum(case when category = 'Books' then amount else 0 end)   as books_amount,
        sum(case when category = 'Clothing, Shoes & Accessories' then amount else 0 end)   as clothing_shoes_accessories_amount,
        sum(case when category = 'Movies & TV' then amount else 0 end)   as movies_tv_amount,
        sum(case when category = 'Sports, Fitness & Outdoors' then amount else 0 end)   as sports_fitness_outdoors_amount
    FROM  "dbt"."public"."contacts_joined_with_transactions"
) t2
on 1 = 1
where (
     nullif(cast(t1.total_expense as decimal(15,1))                   ,0)  <> nullif(cast(t2.total_expense                      as decimal(15,1)) ,0)
  or nullif(t1.first_purchase_date               ,'9999-12-31')       <> nullif(t2.first_purchase_date               ,'9999-12-31')
  or nullif(t1.last_purchase_date               ,'9999-12-31')        <> nullif(t2.last_purchase_date               ,'9999-12-31')
  or nullif(cast(t1.apps_games_amount                 as decimal(15,1)),0) <> nullif(cast(t2.apps_games_amount                 as decimal(15,1)) ,0)
  or nullif(cast(t1.beauty_amount                     as decimal(15,1)),0) <> nullif(cast(t2.beauty_amount                     as decimal(15,1)) ,0)
  or nullif(cast(t1.books_amount                      as decimal(15,1)),0) <> nullif(cast(t2.books_amount                      as decimal(15,1)) ,0)
  or nullif(cast(t1.clothing_shoes_accessories_amount as decimal(15,1)),0) <> nullif(cast(t2.clothing_shoes_accessories_amount as decimal(15,1)) ,0)
  or nullif(cast(t1.movies_tv_amount                  as decimal(15,1)),0) <> nullif(cast(t2.movies_tv_amount                  as decimal(15,1)) ,0)
  or nullif(cast(t1.sports_fitness_outdoors_amount    as decimal(15,1)),0) <> nullif(cast(t2.sports_fitness_outdoors_amount    as decimal(15,1)) ,0)
)
      
    ) dbt_internal_test
[0m20:42:41.697602 [debug] [Thread-2 (]: SQL status: SELECT 1 in 0.0 seconds
[0m20:42:41.699618 [debug] [Thread-2 (]: Timing info for test.customer360.custormers_test (execute): 20:42:41.679819 => 20:42:41.699312
[0m20:42:41.700167 [debug] [Thread-2 (]: On test.customer360.custormers_test: ROLLBACK
[0m20:42:41.701652 [debug] [Thread-2 (]: On test.customer360.custormers_test: Close
[0m20:42:41.702788 [info ] [Thread-2 (]: 17 of 17 PASS custormers_test .................................................. [[32mPASS[0m in 0.03s]
[0m20:42:41.703629 [debug] [Thread-2 (]: Finished running node test.customer360.custormers_test
[0m20:42:41.707534 [debug] [MainThread]: Using postgres connection "master"
[0m20:42:41.708041 [debug] [MainThread]: On master: BEGIN
[0m20:42:41.708477 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m20:42:41.713002 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m20:42:41.713561 [debug] [MainThread]: On master: COMMIT
[0m20:42:41.713972 [debug] [MainThread]: Using postgres connection "master"
[0m20:42:41.714457 [debug] [MainThread]: On master: COMMIT
[0m20:42:41.715176 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m20:42:41.715631 [debug] [MainThread]: On master: Close
[0m20:42:41.716752 [debug] [MainThread]: Connection 'master' was properly closed.
[0m20:42:41.717213 [debug] [MainThread]: Connection 'model.customer360.sales_month_report' was properly closed.
[0m20:42:41.717615 [debug] [MainThread]: Connection 'test.customer360.custormers_test' was properly closed.
[0m20:42:41.717987 [debug] [MainThread]: Connection 'model.customer360.customers' was properly closed.
[0m20:42:41.718581 [info ] [MainThread]: 
[0m20:42:41.719129 [info ] [MainThread]: Finished running 10 tests, 2 seeds, 4 table models, 1 view model in 0 hours 0 minutes and 1.63 seconds (1.63s).
[0m20:42:41.725203 [debug] [MainThread]: Command end result
[0m20:42:41.737425 [info ] [MainThread]: 
[0m20:42:41.738022 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m20:42:41.738451 [info ] [MainThread]: 
[0m20:42:41.738904 [error] [MainThread]:   Database Error in model sales_month_report (models/marts/marketing/sales_month_report.sql)
  syntax error at or near ";"
  LINE 32: ;
           ^
  compiled Code at target/run/customer360/models/marts/marketing/sales_month_report.sql
[0m20:42:41.739371 [info ] [MainThread]: 
[0m20:42:41.739852 [info ] [MainThread]: Done. PASS=16 WARN=0 ERROR=1 SKIP=0 TOTAL=17
[0m20:42:41.740976 [debug] [MainThread]: Resource report: {"command_name": "build", "command_wall_clock_time": 2.690993, "process_user_time": 3.800927, "process_kernel_time": 0.121912, "process_mem_max_rss": "115832", "process_out_blocks": "3040", "command_success": false, "process_in_blocks": "0"}
[0m20:42:41.741627 [debug] [MainThread]: Command `dbt build` failed at 20:42:41.741467 after 2.69 seconds
[0m20:42:41.742182 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbd01c6d790>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbd01cee090>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbd01f92ed0>]}
[0m20:42:41.742675 [debug] [MainThread]: Flushing usage events
[0m20:43:03.448808 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f713c6f2a50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f713c3c0590>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f713c6f2f90>]}


============================== 20:43:03.452246 | b73f2b99-97a3-4226-ad5b-c6f0b5b21c8b ==============================
[0m20:43:03.452246 [info ] [MainThread]: Running with dbt=1.7.8
[0m20:43:03.452959 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/root/option1-customer360/integration_tests/logs', 'profiles_dir': '/root/option1-customer360/integration_tests', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt build', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m20:43:03.676353 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b73f2b99-97a3-4226-ad5b-c6f0b5b21c8b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f713c280090>]}
[0m20:43:03.844442 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'b73f2b99-97a3-4226-ad5b-c6f0b5b21c8b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f713c282650>]}
[0m20:43:03.845351 [info ] [MainThread]: Registered adapter: postgres=1.7.8
[0m20:43:03.885023 [debug] [MainThread]: checksum: 67f0013ca5f0bd43af9a0873dd50792fde83ef69de63b71cacd0b4ac656c52e5, vars: {}, profile: , target: , version: 1.7.8
[0m20:43:03.957194 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m20:43:03.958080 [debug] [MainThread]: Partial parsing: updated file: customer360://models/marts/marketing/sales_month_report.sql
[0m20:43:04.193214 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b73f2b99-97a3-4226-ad5b-c6f0b5b21c8b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f713a5207d0>]}
[0m20:43:04.322175 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b73f2b99-97a3-4226-ad5b-c6f0b5b21c8b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f713cf4d9d0>]}
[0m20:43:04.322864 [info ] [MainThread]: Found 2 seeds, 5 models, 10 tests, 2 sources, 0 exposures, 0 metrics, 403 macros, 0 groups, 0 semantic models
[0m20:43:04.326595 [info ] [MainThread]: 
[0m20:43:04.327762 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m20:43:04.329669 [debug] [ThreadPool]: Acquiring new postgres connection 'list_dbt'
[0m20:43:04.344288 [debug] [ThreadPool]: Using postgres connection "list_dbt"
[0m20:43:04.344860 [debug] [ThreadPool]: On list_dbt: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "connection_name": "list_dbt"} */

    select distinct nspname from pg_namespace
  
[0m20:43:04.345265 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:43:04.352162 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.0 seconds
[0m20:43:04.353956 [debug] [ThreadPool]: On list_dbt: Close
[0m20:43:04.358226 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dbt, now list_dbt_public)
[0m20:43:04.366466 [debug] [ThreadPool]: Using postgres connection "list_dbt_public"
[0m20:43:04.366924 [debug] [ThreadPool]: On list_dbt_public: BEGIN
[0m20:43:04.367402 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:43:04.372103 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m20:43:04.372638 [debug] [ThreadPool]: Using postgres connection "list_dbt_public"
[0m20:43:04.373273 [debug] [ThreadPool]: On list_dbt_public: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "connection_name": "list_dbt_public"} */
select
      'dbt' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'dbt' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'dbt' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m20:43:04.377425 [debug] [ThreadPool]: SQL status: SELECT 6 in 0.0 seconds
[0m20:43:04.379281 [debug] [ThreadPool]: On list_dbt_public: ROLLBACK
[0m20:43:04.379997 [debug] [ThreadPool]: On list_dbt_public: Close
[0m20:43:04.390422 [debug] [MainThread]: Using postgres connection "master"
[0m20:43:04.390943 [debug] [MainThread]: On master: BEGIN
[0m20:43:04.391543 [debug] [MainThread]: Opening a new connection, currently in state init
[0m20:43:04.396334 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m20:43:04.396795 [debug] [MainThread]: Using postgres connection "master"
[0m20:43:04.397457 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m20:43:04.412831 [debug] [MainThread]: SQL status: SELECT 2 in 0.0 seconds
[0m20:43:04.415247 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b73f2b99-97a3-4226-ad5b-c6f0b5b21c8b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f713a5a2310>]}
[0m20:43:04.415868 [debug] [MainThread]: On master: ROLLBACK
[0m20:43:04.416608 [debug] [MainThread]: Using postgres connection "master"
[0m20:43:04.417024 [debug] [MainThread]: On master: BEGIN
[0m20:43:04.417964 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m20:43:04.418445 [debug] [MainThread]: On master: COMMIT
[0m20:43:04.418859 [debug] [MainThread]: Using postgres connection "master"
[0m20:43:04.419280 [debug] [MainThread]: On master: COMMIT
[0m20:43:04.420111 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m20:43:04.420593 [debug] [MainThread]: On master: Close
[0m20:43:04.421563 [info ] [MainThread]: Concurrency: 3 threads (target='local')
[0m20:43:04.422015 [info ] [MainThread]: 
[0m20:43:04.424803 [debug] [Thread-1 (]: Began running node seed.integration_tests.contacts
[0m20:43:04.425455 [info ] [Thread-1 (]: 1 of 17 START seed file public.contacts ........................................ [RUN]
[0m20:43:04.428625 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dbt_public, now seed.integration_tests.contacts)
[0m20:43:04.429152 [debug] [Thread-1 (]: Began compiling node seed.integration_tests.contacts
[0m20:43:04.429844 [debug] [Thread-1 (]: Timing info for seed.integration_tests.contacts (compile): 20:43:04.429484 => 20:43:04.429487
[0m20:43:04.430388 [debug] [Thread-1 (]: Began executing node seed.integration_tests.contacts
[0m20:43:04.439613 [debug] [Thread-2 (]: Began running node seed.integration_tests.transactions
[0m20:43:04.440327 [info ] [Thread-2 (]: 2 of 17 START seed file public.transactions .................................... [RUN]
[0m20:43:04.441418 [debug] [Thread-2 (]: Acquiring new postgres connection 'seed.integration_tests.transactions'
[0m20:43:04.441947 [debug] [Thread-2 (]: Began compiling node seed.integration_tests.transactions
[0m20:43:04.442582 [debug] [Thread-2 (]: Timing info for seed.integration_tests.transactions (compile): 20:43:04.442275 => 20:43:04.442278
[0m20:43:04.443101 [debug] [Thread-2 (]: Began executing node seed.integration_tests.transactions
[0m20:43:04.462637 [debug] [Thread-3 (]: Began running node test.customer360.macro_test1
[0m20:43:04.463306 [info ] [Thread-3 (]: 3 of 17 START test macro_test1 ................................................. [RUN]
[0m20:43:04.464472 [debug] [Thread-3 (]: Acquiring new postgres connection 'test.customer360.macro_test1'
[0m20:43:04.464951 [debug] [Thread-3 (]: Began compiling node test.customer360.macro_test1
[0m20:43:04.493949 [debug] [Thread-3 (]: Writing injected SQL for node "test.customer360.macro_test1"
[0m20:43:04.508210 [debug] [Thread-2 (]: Using postgres connection "seed.integration_tests.transactions"
[0m20:43:04.511982 [debug] [Thread-2 (]: On seed.integration_tests.transactions: BEGIN
[0m20:43:04.511512 [debug] [Thread-1 (]: Using postgres connection "seed.integration_tests.contacts"
[0m20:43:04.512766 [debug] [Thread-1 (]: On seed.integration_tests.contacts: BEGIN
[0m20:43:04.513100 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:43:04.514340 [debug] [Thread-3 (]: Timing info for test.customer360.macro_test1 (compile): 20:43:04.465248 => 20:43:04.514059
[0m20:43:04.514797 [debug] [Thread-3 (]: Began executing node test.customer360.macro_test1
[0m20:43:04.512375 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m20:43:04.530971 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m20:43:04.531748 [debug] [Thread-1 (]: Using postgres connection "seed.integration_tests.contacts"
[0m20:43:04.532226 [debug] [Thread-1 (]: On seed.integration_tests.contacts: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "seed.integration_tests.contacts"} */
truncate table "dbt"."public"."contacts"
[0m20:43:04.530725 [debug] [Thread-3 (]: Writing runtime sql for node "test.customer360.macro_test1"
[0m20:43:04.532956 [debug] [Thread-3 (]: Using postgres connection "test.customer360.macro_test1"
[0m20:43:04.533419 [debug] [Thread-3 (]: On test.customer360.macro_test1: BEGIN
[0m20:43:04.533883 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m20:43:04.537001 [debug] [Thread-2 (]: SQL status: BEGIN in 0.0 seconds
[0m20:43:04.537408 [debug] [Thread-2 (]: Using postgres connection "seed.integration_tests.transactions"
[0m20:43:04.537930 [debug] [Thread-2 (]: On seed.integration_tests.transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "seed.integration_tests.transactions"} */
truncate table "dbt"."public"."transactions"
[0m20:43:04.538397 [debug] [Thread-1 (]: SQL status: TRUNCATE TABLE in 0.0 seconds
[0m20:43:04.545021 [debug] [Thread-3 (]: SQL status: BEGIN in 0.0 seconds
[0m20:43:04.555776 [debug] [Thread-2 (]: SQL status: TRUNCATE TABLE in 0.0 seconds
[0m20:43:04.556124 [debug] [Thread-3 (]: Using postgres connection "test.customer360.macro_test1"
[0m20:43:04.576646 [debug] [Thread-1 (]: Using postgres connection "seed.integration_tests.contacts"
[0m20:43:04.607473 [debug] [Thread-1 (]: On seed.integration_tests.contacts: 
          insert into "dbt"."public"."contacts" ("id", "username", "name", "gender", "address", "mail", "birthdate", "_loaded_at_utc") values
          (%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s)
      ...
[0m20:43:04.592107 [debug] [Thread-3 (]: On test.customer360.macro_test1: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.macro_test1"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      with marco_result as (
    select 
    date_part('year', age(current_date, '2023-02-12'))
 as expect_result
)
select
    1
from marco_result
where expect_result <> 1
      
    ) dbt_internal_test
[0m20:43:04.618265 [debug] [Thread-1 (]: SQL status: INSERT 0 10 in 0.0 seconds
[0m20:43:04.637796 [debug] [Thread-3 (]: SQL status: SELECT 1 in 0.0 seconds
[0m20:43:04.645627 [debug] [Thread-3 (]: Timing info for test.customer360.macro_test1 (execute): 20:43:04.515023 => 20:43:04.645253
[0m20:43:04.646190 [debug] [Thread-3 (]: On test.customer360.macro_test1: ROLLBACK
[0m20:43:04.655531 [debug] [Thread-3 (]: On test.customer360.macro_test1: Close
[0m20:43:04.656696 [info ] [Thread-3 (]: 3 of 17 PASS macro_test1 ....................................................... [[32mPASS[0m in 0.19s]
[0m20:43:04.657578 [debug] [Thread-3 (]: Finished running node test.customer360.macro_test1
[0m20:43:04.658144 [debug] [Thread-3 (]: Began running node test.customer360.macro_test2
[0m20:43:04.658605 [info ] [Thread-3 (]: 4 of 17 START test macro_test2 ................................................. [RUN]
[0m20:43:04.659456 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.customer360.macro_test1, now test.customer360.macro_test2)
[0m20:43:04.659951 [debug] [Thread-3 (]: Began compiling node test.customer360.macro_test2
[0m20:43:04.683897 [debug] [Thread-1 (]: Writing runtime SQL for node "seed.integration_tests.contacts"
[0m20:43:04.666071 [debug] [Thread-3 (]: Writing injected SQL for node "test.customer360.macro_test2"
[0m20:43:04.705089 [debug] [Thread-3 (]: Timing info for test.customer360.macro_test2 (compile): 20:43:04.660368 => 20:43:04.704716
[0m20:43:04.705687 [debug] [Thread-3 (]: Began executing node test.customer360.macro_test2
[0m20:43:04.709729 [debug] [Thread-3 (]: Writing runtime sql for node "test.customer360.macro_test2"
[0m20:43:04.710474 [debug] [Thread-3 (]: Using postgres connection "test.customer360.macro_test2"
[0m20:43:04.710958 [debug] [Thread-3 (]: On test.customer360.macro_test2: BEGIN
[0m20:43:04.711497 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m20:43:04.749191 [debug] [Thread-1 (]: On seed.integration_tests.contacts: COMMIT
[0m20:43:04.749990 [debug] [Thread-1 (]: Using postgres connection "seed.integration_tests.contacts"
[0m20:43:04.750550 [debug] [Thread-1 (]: On seed.integration_tests.contacts: COMMIT
[0m20:43:04.770638 [debug] [Thread-1 (]: SQL status: COMMIT in 0.0 seconds
[0m20:43:04.772078 [debug] [Thread-1 (]: Timing info for seed.integration_tests.contacts (execute): 20:43:04.430748 => 20:43:04.771765
[0m20:43:04.792705 [debug] [Thread-1 (]: On seed.integration_tests.contacts: Close
[0m20:43:04.793841 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b73f2b99-97a3-4226-ad5b-c6f0b5b21c8b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f713a474ed0>]}
[0m20:43:04.794507 [info ] [Thread-1 (]: 1 of 17 OK loaded seed file public.contacts .................................... [[32mINSERT 10[0m in 0.37s]
[0m20:43:04.798565 [debug] [Thread-1 (]: Finished running node seed.integration_tests.contacts
[0m20:43:04.799218 [debug] [Thread-1 (]: Began running node test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247
[0m20:43:04.799816 [info ] [Thread-1 (]: 5 of 17 START test source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors  [RUN]
[0m20:43:04.800761 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly seed.integration_tests.contacts, now test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247)
[0m20:43:04.801284 [debug] [Thread-1 (]: Began compiling node test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247
[0m20:43:04.833930 [debug] [Thread-3 (]: SQL status: BEGIN in 0.0 seconds
[0m20:43:04.834543 [debug] [Thread-3 (]: Using postgres connection "test.customer360.macro_test2"
[0m20:43:04.835057 [debug] [Thread-3 (]: On test.customer360.macro_test2: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.macro_test2"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      with marco_result as (
    select 
        to_timestamp('2023-02-27 21:00:00','YYYY-MM-DD HH24:MI:SS.MS') :: timestamp at TIME zone 'UTC'
     as expect_result
)
select
    1
from marco_result
where cast(pg_typeof(expect_result) as text) not like '%timestamp%'
      
    ) dbt_internal_test
[0m20:43:04.852992 [debug] [Thread-3 (]: SQL status: SELECT 1 in 0.0 seconds
[0m20:43:04.854991 [debug] [Thread-3 (]: Timing info for test.customer360.macro_test2 (execute): 20:43:04.705999 => 20:43:04.854670
[0m20:43:04.855522 [debug] [Thread-3 (]: On test.customer360.macro_test2: ROLLBACK
[0m20:43:04.856351 [debug] [Thread-1 (]: Writing injected SQL for node "test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247"
[0m20:43:04.857124 [debug] [Thread-1 (]: Timing info for test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247 (compile): 20:43:04.801766 => 20:43:04.856852
[0m20:43:04.858189 [debug] [Thread-1 (]: Began executing node test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247
[0m20:43:04.868132 [debug] [Thread-3 (]: On test.customer360.macro_test2: Close
[0m20:43:04.869328 [info ] [Thread-3 (]: 4 of 17 PASS macro_test2 ....................................................... [[32mPASS[0m in 0.21s]
[0m20:43:04.870109 [debug] [Thread-3 (]: Finished running node test.customer360.macro_test2
[0m20:43:04.870912 [debug] [Thread-3 (]: Began running node test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d
[0m20:43:04.871441 [info ] [Thread-3 (]: 6 of 17 START test source_not_null_salesforce_contacts_id ...................... [RUN]
[0m20:43:04.872225 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.customer360.macro_test2, now test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d)
[0m20:43:04.872677 [debug] [Thread-3 (]: Began compiling node test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d
[0m20:43:04.909635 [debug] [Thread-1 (]: Writing runtime sql for node "test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247"
[0m20:43:04.910564 [debug] [Thread-1 (]: Using postgres connection "test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247"
[0m20:43:04.911115 [debug] [Thread-1 (]: On test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247: BEGIN
[0m20:43:04.911640 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:43:04.918601 [debug] [Thread-3 (]: Writing injected SQL for node "test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d"
[0m20:43:04.919486 [debug] [Thread-3 (]: Timing info for test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d (compile): 20:43:04.873120 => 20:43:04.919151
[0m20:43:04.920150 [debug] [Thread-3 (]: Began executing node test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d
[0m20:43:04.924638 [debug] [Thread-3 (]: Writing runtime sql for node "test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d"
[0m20:43:04.925313 [debug] [Thread-3 (]: Using postgres connection "test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d"
[0m20:43:04.925997 [debug] [Thread-3 (]: On test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d: BEGIN
[0m20:43:04.926851 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m20:43:04.974726 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m20:43:04.975356 [debug] [Thread-1 (]: Using postgres connection "test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247"
[0m20:43:04.975907 [debug] [Thread-1 (]: On test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

with all_values as (

    select
        category as value_field,
        count(*) as n_records

    from "dbt"."public"."transactions"
    group by category

)

select *
from all_values
where value_field not in (
    'Apps & Games','Beauty','Books','Clothing, Shoes & Accessories','Movies & TV','Sports, Fitness & Outdoors'
)



      
    ) dbt_internal_test
[0m20:43:05.017687 [debug] [Thread-3 (]: SQL status: BEGIN in 0.0 seconds
[0m20:43:05.018289 [debug] [Thread-3 (]: Using postgres connection "test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d"
[0m20:43:05.018853 [debug] [Thread-3 (]: On test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select id
from "dbt"."public"."contacts"
where id is null



      
    ) dbt_internal_test
[0m20:43:05.045171 [debug] [Thread-3 (]: SQL status: SELECT 1 in 0.0 seconds
[0m20:43:05.047290 [debug] [Thread-3 (]: Timing info for test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d (execute): 20:43:04.921834 => 20:43:05.046964
[0m20:43:05.047838 [debug] [Thread-3 (]: On test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d: ROLLBACK
[0m20:43:05.053505 [debug] [Thread-2 (]: Using postgres connection "seed.integration_tests.transactions"
[0m20:43:05.054037 [debug] [Thread-2 (]: On seed.integration_tests.transactions: 
          insert into "dbt"."public"."transactions" ("contact_id", "id", "transaction_date", "amount", "item_count", "category", "_loaded_at_utc") values
          (%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%...
[0m20:43:05.055667 [debug] [Thread-3 (]: On test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d: Close
[0m20:43:05.058830 [info ] [Thread-3 (]: 6 of 17 PASS source_not_null_salesforce_contacts_id ............................ [[32mPASS[0m in 0.19s]
[0m20:43:05.059636 [debug] [Thread-3 (]: Finished running node test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d
[0m20:43:05.060198 [debug] [Thread-3 (]: Began running node test.customer360.source_not_null_web_transactions_id.88a47bf7e5
[0m20:43:05.060829 [info ] [Thread-3 (]: 7 of 17 START test source_not_null_web_transactions_id ......................... [RUN]
[0m20:43:05.061985 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d, now test.customer360.source_not_null_web_transactions_id.88a47bf7e5)
[0m20:43:05.062514 [debug] [Thread-3 (]: Began compiling node test.customer360.source_not_null_web_transactions_id.88a47bf7e5
[0m20:43:05.069037 [debug] [Thread-3 (]: Writing injected SQL for node "test.customer360.source_not_null_web_transactions_id.88a47bf7e5"
[0m20:43:05.069870 [debug] [Thread-3 (]: Timing info for test.customer360.source_not_null_web_transactions_id.88a47bf7e5 (compile): 20:43:05.062822 => 20:43:05.069562
[0m20:43:05.070403 [debug] [Thread-3 (]: Began executing node test.customer360.source_not_null_web_transactions_id.88a47bf7e5
[0m20:43:05.081730 [debug] [Thread-2 (]: SQL status: INSERT 0 100 in 0.0 seconds
[0m20:43:05.082915 [debug] [Thread-2 (]: Writing runtime SQL for node "seed.integration_tests.transactions"
[0m20:43:05.085386 [debug] [Thread-2 (]: On seed.integration_tests.transactions: COMMIT
[0m20:43:05.085849 [debug] [Thread-2 (]: Using postgres connection "seed.integration_tests.transactions"
[0m20:43:05.086345 [debug] [Thread-2 (]: On seed.integration_tests.transactions: COMMIT
[0m20:43:05.086946 [debug] [Thread-3 (]: Writing runtime sql for node "test.customer360.source_not_null_web_transactions_id.88a47bf7e5"
[0m20:43:05.087846 [debug] [Thread-3 (]: Using postgres connection "test.customer360.source_not_null_web_transactions_id.88a47bf7e5"
[0m20:43:05.088343 [debug] [Thread-3 (]: On test.customer360.source_not_null_web_transactions_id.88a47bf7e5: BEGIN
[0m20:43:05.088828 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m20:43:05.094966 [debug] [Thread-2 (]: SQL status: COMMIT in 0.0 seconds
[0m20:43:05.096321 [debug] [Thread-2 (]: Timing info for seed.integration_tests.transactions (execute): 20:43:04.443449 => 20:43:05.096006
[0m20:43:05.096812 [debug] [Thread-2 (]: On seed.integration_tests.transactions: Close
[0m20:43:05.099598 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b73f2b99-97a3-4226-ad5b-c6f0b5b21c8b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f713a420090>]}
[0m20:43:05.100312 [info ] [Thread-2 (]: 2 of 17 OK loaded seed file public.transactions ................................ [[32mINSERT 100[0m in 0.66s]
[0m20:43:05.101051 [debug] [Thread-2 (]: Finished running node seed.integration_tests.transactions
[0m20:43:05.101638 [debug] [Thread-2 (]: Began running node test.customer360.source_unique_salesforce_contacts_id.01cadaaf43
[0m20:43:05.102142 [info ] [Thread-2 (]: 8 of 17 START test source_unique_salesforce_contacts_id ........................ [RUN]
[0m20:43:05.106195 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly seed.integration_tests.transactions, now test.customer360.source_unique_salesforce_contacts_id.01cadaaf43)
[0m20:43:05.106734 [debug] [Thread-2 (]: Began compiling node test.customer360.source_unique_salesforce_contacts_id.01cadaaf43
[0m20:43:05.119712 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.0 seconds
[0m20:43:05.121768 [debug] [Thread-1 (]: Timing info for test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247 (execute): 20:43:04.858536 => 20:43:05.121441
[0m20:43:05.122283 [debug] [Thread-1 (]: On test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247: ROLLBACK
[0m20:43:05.128630 [debug] [Thread-2 (]: Writing injected SQL for node "test.customer360.source_unique_salesforce_contacts_id.01cadaaf43"
[0m20:43:05.129446 [debug] [Thread-2 (]: Timing info for test.customer360.source_unique_salesforce_contacts_id.01cadaaf43 (compile): 20:43:05.107012 => 20:43:05.129144
[0m20:43:05.129936 [debug] [Thread-2 (]: Began executing node test.customer360.source_unique_salesforce_contacts_id.01cadaaf43
[0m20:43:05.139624 [debug] [Thread-2 (]: Writing runtime sql for node "test.customer360.source_unique_salesforce_contacts_id.01cadaaf43"
[0m20:43:05.140474 [debug] [Thread-2 (]: Using postgres connection "test.customer360.source_unique_salesforce_contacts_id.01cadaaf43"
[0m20:43:05.140958 [debug] [Thread-2 (]: On test.customer360.source_unique_salesforce_contacts_id.01cadaaf43: BEGIN
[0m20:43:05.141414 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m20:43:05.142592 [debug] [Thread-1 (]: On test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247: Close
[0m20:43:05.143722 [info ] [Thread-1 (]: 5 of 17 PASS source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors  [[32mPASS[0m in 0.34s]
[0m20:43:05.144527 [debug] [Thread-1 (]: Finished running node test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247
[0m20:43:05.145092 [debug] [Thread-1 (]: Began running node test.customer360.source_unique_web_transactions_id.ba28079761
[0m20:43:05.145785 [info ] [Thread-1 (]: 9 of 17 START test source_unique_web_transactions_id ........................... [RUN]
[0m20:43:05.146582 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247, now test.customer360.source_unique_web_transactions_id.ba28079761)
[0m20:43:05.147024 [debug] [Thread-1 (]: Began compiling node test.customer360.source_unique_web_transactions_id.ba28079761
[0m20:43:05.162527 [debug] [Thread-3 (]: SQL status: BEGIN in 0.0 seconds
[0m20:43:05.163115 [debug] [Thread-3 (]: Using postgres connection "test.customer360.source_not_null_web_transactions_id.88a47bf7e5"
[0m20:43:05.163645 [debug] [Thread-3 (]: On test.customer360.source_not_null_web_transactions_id.88a47bf7e5: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.source_not_null_web_transactions_id.88a47bf7e5"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select id
from "dbt"."public"."transactions"
where id is null



      
    ) dbt_internal_test
[0m20:43:05.153046 [debug] [Thread-1 (]: Writing injected SQL for node "test.customer360.source_unique_web_transactions_id.ba28079761"
[0m20:43:05.164662 [debug] [Thread-1 (]: Timing info for test.customer360.source_unique_web_transactions_id.ba28079761 (compile): 20:43:05.147275 => 20:43:05.164395
[0m20:43:05.165089 [debug] [Thread-1 (]: Began executing node test.customer360.source_unique_web_transactions_id.ba28079761
[0m20:43:05.168280 [debug] [Thread-1 (]: Writing runtime sql for node "test.customer360.source_unique_web_transactions_id.ba28079761"
[0m20:43:05.175370 [debug] [Thread-1 (]: Using postgres connection "test.customer360.source_unique_web_transactions_id.ba28079761"
[0m20:43:05.175836 [debug] [Thread-1 (]: On test.customer360.source_unique_web_transactions_id.ba28079761: BEGIN
[0m20:43:05.176308 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:43:05.177433 [debug] [Thread-3 (]: SQL status: SELECT 1 in 0.0 seconds
[0m20:43:05.179223 [debug] [Thread-3 (]: Timing info for test.customer360.source_not_null_web_transactions_id.88a47bf7e5 (execute): 20:43:05.070705 => 20:43:05.178947
[0m20:43:05.180930 [debug] [Thread-3 (]: On test.customer360.source_not_null_web_transactions_id.88a47bf7e5: ROLLBACK
[0m20:43:05.187853 [debug] [Thread-3 (]: On test.customer360.source_not_null_web_transactions_id.88a47bf7e5: Close
[0m20:43:05.189054 [info ] [Thread-3 (]: 7 of 17 PASS source_not_null_web_transactions_id ............................... [[32mPASS[0m in 0.13s]
[0m20:43:05.189872 [debug] [Thread-3 (]: Finished running node test.customer360.source_not_null_web_transactions_id.88a47bf7e5
[0m20:43:05.190753 [debug] [Thread-3 (]: Began running node test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344
[0m20:43:05.191283 [info ] [Thread-3 (]: 10 of 17 START test source_relationships_web_transactions_contact_id__id__ref_contacts_  [RUN]
[0m20:43:05.192098 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.customer360.source_not_null_web_transactions_id.88a47bf7e5, now test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344)
[0m20:43:05.192558 [debug] [Thread-3 (]: Began compiling node test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344
[0m20:43:05.201723 [debug] [Thread-2 (]: SQL status: BEGIN in 0.0 seconds
[0m20:43:05.202345 [debug] [Thread-2 (]: Using postgres connection "test.customer360.source_unique_salesforce_contacts_id.01cadaaf43"
[0m20:43:05.202827 [debug] [Thread-2 (]: On test.customer360.source_unique_salesforce_contacts_id.01cadaaf43: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.source_unique_salesforce_contacts_id.01cadaaf43"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

select
    id as unique_field,
    count(*) as n_records

from "dbt"."public"."contacts"
where id is not null
group by id
having count(*) > 1



      
    ) dbt_internal_test
[0m20:43:05.217161 [debug] [Thread-2 (]: SQL status: SELECT 1 in 0.0 seconds
[0m20:43:05.219264 [debug] [Thread-2 (]: Timing info for test.customer360.source_unique_salesforce_contacts_id.01cadaaf43 (execute): 20:43:05.130220 => 20:43:05.218943
[0m20:43:05.219809 [debug] [Thread-2 (]: On test.customer360.source_unique_salesforce_contacts_id.01cadaaf43: ROLLBACK
[0m20:43:05.220364 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m20:43:05.220873 [debug] [Thread-1 (]: Using postgres connection "test.customer360.source_unique_web_transactions_id.ba28079761"
[0m20:43:05.221411 [debug] [Thread-1 (]: On test.customer360.source_unique_web_transactions_id.ba28079761: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.source_unique_web_transactions_id.ba28079761"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

select
    id as unique_field,
    count(*) as n_records

from "dbt"."public"."transactions"
where id is not null
group by id
having count(*) > 1



      
    ) dbt_internal_test
[0m20:43:05.223999 [debug] [Thread-3 (]: Writing injected SQL for node "test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344"
[0m20:43:05.224985 [debug] [Thread-3 (]: Timing info for test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344 (compile): 20:43:05.192825 => 20:43:05.224677
[0m20:43:05.225486 [debug] [Thread-3 (]: Began executing node test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344
[0m20:43:05.232277 [debug] [Thread-3 (]: Writing runtime sql for node "test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344"
[0m20:43:05.233118 [debug] [Thread-3 (]: Using postgres connection "test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344"
[0m20:43:05.233606 [debug] [Thread-3 (]: On test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344: BEGIN
[0m20:43:05.234074 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m20:43:05.237468 [debug] [Thread-2 (]: On test.customer360.source_unique_salesforce_contacts_id.01cadaaf43: Close
[0m20:43:05.238614 [info ] [Thread-2 (]: 8 of 17 PASS source_unique_salesforce_contacts_id .............................. [[32mPASS[0m in 0.13s]
[0m20:43:05.239817 [debug] [Thread-2 (]: Finished running node test.customer360.source_unique_salesforce_contacts_id.01cadaaf43
[0m20:43:05.240579 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.0 seconds
[0m20:43:05.242906 [debug] [Thread-1 (]: Timing info for test.customer360.source_unique_web_transactions_id.ba28079761 (execute): 20:43:05.165393 => 20:43:05.242037
[0m20:43:05.243454 [debug] [Thread-1 (]: On test.customer360.source_unique_web_transactions_id.ba28079761: ROLLBACK
[0m20:43:05.244004 [debug] [Thread-2 (]: Began running node model.customer360.stg_sf__contacts
[0m20:43:05.244591 [info ] [Thread-2 (]: 11 of 17 START sql table model public.stg_sf__contacts ......................... [RUN]
[0m20:43:05.246162 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.customer360.source_unique_salesforce_contacts_id.01cadaaf43, now model.customer360.stg_sf__contacts)
[0m20:43:05.246670 [debug] [Thread-2 (]: Began compiling node model.customer360.stg_sf__contacts
[0m20:43:05.250736 [debug] [Thread-2 (]: Writing injected SQL for node "model.customer360.stg_sf__contacts"
[0m20:43:05.251561 [debug] [Thread-2 (]: Timing info for model.customer360.stg_sf__contacts (compile): 20:43:05.246963 => 20:43:05.251244
[0m20:43:05.252036 [debug] [Thread-2 (]: Began executing node model.customer360.stg_sf__contacts
[0m20:43:05.270672 [debug] [Thread-1 (]: On test.customer360.source_unique_web_transactions_id.ba28079761: Close
[0m20:43:05.271906 [info ] [Thread-1 (]: 9 of 17 PASS source_unique_web_transactions_id ................................. [[32mPASS[0m in 0.13s]
[0m20:43:05.272710 [debug] [Thread-1 (]: Finished running node test.customer360.source_unique_web_transactions_id.ba28079761
[0m20:43:05.273485 [debug] [Thread-1 (]: Began running node model.customer360.stg_web__transactions
[0m20:43:05.274056 [info ] [Thread-1 (]: 12 of 17 START sql table model public.stg_web__transactions .................... [RUN]
[0m20:43:05.274867 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.customer360.source_unique_web_transactions_id.ba28079761, now model.customer360.stg_web__transactions)
[0m20:43:05.275795 [debug] [Thread-1 (]: Began compiling node model.customer360.stg_web__transactions
[0m20:43:05.280488 [debug] [Thread-1 (]: Writing injected SQL for node "model.customer360.stg_web__transactions"
[0m20:43:05.281243 [debug] [Thread-1 (]: Timing info for model.customer360.stg_web__transactions (compile): 20:43:05.276116 => 20:43:05.280953
[0m20:43:05.284859 [debug] [Thread-1 (]: Began executing node model.customer360.stg_web__transactions
[0m20:43:05.294612 [debug] [Thread-3 (]: SQL status: BEGIN in 0.0 seconds
[0m20:43:05.295348 [debug] [Thread-3 (]: Using postgres connection "test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344"
[0m20:43:05.295866 [debug] [Thread-3 (]: On test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

with child as (
    select contact_id as from_field
    from "dbt"."public"."transactions"
    where contact_id is not null
),

parent as (
    select id as to_field
    from "dbt"."public"."contacts"
)

select
    from_field

from child
left join parent
    on child.from_field = parent.to_field

where parent.to_field is null



      
    ) dbt_internal_test
[0m20:43:05.306616 [debug] [Thread-3 (]: SQL status: SELECT 1 in 0.0 seconds
[0m20:43:05.308624 [debug] [Thread-3 (]: Timing info for test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344 (execute): 20:43:05.225792 => 20:43:05.308285
[0m20:43:05.309152 [debug] [Thread-3 (]: On test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344: ROLLBACK
[0m20:43:05.359071 [debug] [Thread-3 (]: On test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344: Close
[0m20:43:05.360281 [info ] [Thread-3 (]: 10 of 17 PASS source_relationships_web_transactions_contact_id__id__ref_contacts_  [[32mPASS[0m in 0.17s]
[0m20:43:05.361089 [debug] [Thread-3 (]: Finished running node test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344
[0m20:43:05.365915 [debug] [Thread-2 (]: Writing runtime sql for node "model.customer360.stg_sf__contacts"
[0m20:43:05.367885 [debug] [Thread-2 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m20:43:05.368414 [debug] [Thread-2 (]: On model.customer360.stg_sf__contacts: BEGIN
[0m20:43:05.368913 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m20:43:05.366401 [debug] [Thread-1 (]: Writing runtime sql for node "model.customer360.stg_web__transactions"
[0m20:43:05.370758 [debug] [Thread-1 (]: Using postgres connection "model.customer360.stg_web__transactions"
[0m20:43:05.371266 [debug] [Thread-1 (]: On model.customer360.stg_web__transactions: BEGIN
[0m20:43:05.371754 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:43:05.383394 [debug] [Thread-2 (]: SQL status: BEGIN in 0.0 seconds
[0m20:43:05.383969 [debug] [Thread-2 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m20:43:05.384491 [debug] [Thread-2 (]: On model.customer360.stg_sf__contacts: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_sf__contacts"} */

  
    

  create  table "dbt"."public"."stg_sf__contacts__dbt_tmp"
  
  
    as
  
  (
    with source as (
    select * from "dbt"."public"."contacts"
),

renamed as (
    select
        id,
        username as user_name,
        name,
        gender,
        address, 
        mail as email_address,
        birthdate as birth_date,
        _loaded_at_utc
    from source     
)

select * from renamed
  );
  
[0m20:43:05.404434 [debug] [Thread-2 (]: SQL status: SELECT 10 in 0.0 seconds
[0m20:43:05.413017 [debug] [Thread-2 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m20:43:05.413607 [debug] [Thread-2 (]: On model.customer360.stg_sf__contacts: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_sf__contacts"} */
alter table "dbt"."public"."stg_sf__contacts" rename to "stg_sf__contacts__dbt_backup"
[0m20:43:05.414177 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m20:43:05.414658 [debug] [Thread-1 (]: Using postgres connection "model.customer360.stg_web__transactions"
[0m20:43:05.415173 [debug] [Thread-1 (]: On model.customer360.stg_web__transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_web__transactions"} */

  
    

  create  table "dbt"."public"."stg_web__transactions__dbt_tmp"
  
  
    as
  
  (
    with source as (
    select * from "dbt"."public"."transactions"
),

renamed as (
    select
        id,
        contact_id,
        
        to_timestamp(transaction_date,'YYYY-MM-DD HH24:MI:SS.MS') :: timestamp at TIME zone 'UTC'
     as transaction_date,
        amount,
        item_count,
        category, 
        _loaded_at_utc
    from source    
),

clean_older as (
    select * from renamed 
--    where transaction_date >= (current_date - 1)  过滤超过1天的数据
--    where transaction_date >= (to_date('2023-04-12','yyyy-MM-dd') - 1)  --测试用,假设跑数日期为2023-04-12
--    and transaction_date < to_date('2023-04-12','yyyy-MM-dd')
)

select * from clean_older
  );
  
[0m20:43:05.422663 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m20:43:05.432064 [debug] [Thread-2 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m20:43:05.432639 [debug] [Thread-2 (]: On model.customer360.stg_sf__contacts: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_sf__contacts"} */
alter table "dbt"."public"."stg_sf__contacts__dbt_tmp" rename to "stg_sf__contacts"
[0m20:43:05.437004 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m20:43:05.448638 [debug] [Thread-1 (]: SQL status: SELECT 100 in 0.0 seconds
[0m20:43:05.453105 [debug] [Thread-1 (]: Using postgres connection "model.customer360.stg_web__transactions"
[0m20:43:05.453641 [debug] [Thread-1 (]: On model.customer360.stg_web__transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_web__transactions"} */
alter table "dbt"."public"."stg_web__transactions" rename to "stg_web__transactions__dbt_backup"
[0m20:43:05.458750 [debug] [Thread-2 (]: On model.customer360.stg_sf__contacts: COMMIT
[0m20:43:05.459315 [debug] [Thread-2 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m20:43:05.459799 [debug] [Thread-2 (]: On model.customer360.stg_sf__contacts: COMMIT
[0m20:43:05.461350 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m20:43:05.465661 [debug] [Thread-1 (]: Using postgres connection "model.customer360.stg_web__transactions"
[0m20:43:05.466354 [debug] [Thread-1 (]: On model.customer360.stg_web__transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_web__transactions"} */
alter table "dbt"."public"."stg_web__transactions__dbt_tmp" rename to "stg_web__transactions"
[0m20:43:05.471589 [debug] [Thread-2 (]: SQL status: COMMIT in 0.0 seconds
[0m20:43:05.487639 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m20:43:05.490883 [debug] [Thread-1 (]: On model.customer360.stg_web__transactions: COMMIT
[0m20:43:05.491399 [debug] [Thread-1 (]: Using postgres connection "model.customer360.stg_web__transactions"
[0m20:43:05.491855 [debug] [Thread-1 (]: On model.customer360.stg_web__transactions: COMMIT
[0m20:43:05.496447 [debug] [Thread-2 (]: Applying DROP to: "dbt"."public"."stg_sf__contacts__dbt_backup"
[0m20:43:05.503379 [debug] [Thread-2 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m20:43:05.503906 [debug] [Thread-2 (]: On model.customer360.stg_sf__contacts: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_sf__contacts"} */
drop table if exists "dbt"."public"."stg_sf__contacts__dbt_backup" cascade
[0m20:43:05.504460 [debug] [Thread-1 (]: SQL status: COMMIT in 0.0 seconds
[0m20:43:05.507926 [debug] [Thread-1 (]: Applying DROP to: "dbt"."public"."stg_web__transactions__dbt_backup"
[0m20:43:05.510565 [debug] [Thread-1 (]: Using postgres connection "model.customer360.stg_web__transactions"
[0m20:43:05.511046 [debug] [Thread-1 (]: On model.customer360.stg_web__transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_web__transactions"} */
drop table if exists "dbt"."public"."stg_web__transactions__dbt_backup" cascade
[0m20:43:05.516925 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.0 seconds
[0m20:43:05.518962 [debug] [Thread-2 (]: Timing info for model.customer360.stg_sf__contacts (execute): 20:43:05.253389 => 20:43:05.518657
[0m20:43:05.519486 [debug] [Thread-2 (]: On model.customer360.stg_sf__contacts: Close
[0m20:43:05.525598 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b73f2b99-97a3-4226-ad5b-c6f0b5b21c8b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7139d33250>]}
[0m20:43:05.526447 [info ] [Thread-2 (]: 11 of 17 OK created sql table model public.stg_sf__contacts .................... [[32mSELECT 10[0m in 0.28s]
[0m20:43:05.527224 [debug] [Thread-2 (]: Finished running node model.customer360.stg_sf__contacts
[0m20:43:05.527791 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.0 seconds
[0m20:43:05.529974 [debug] [Thread-1 (]: Timing info for model.customer360.stg_web__transactions (execute): 20:43:05.285160 => 20:43:05.529672
[0m20:43:05.530504 [debug] [Thread-1 (]: On model.customer360.stg_web__transactions: Close
[0m20:43:05.531688 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b73f2b99-97a3-4226-ad5b-c6f0b5b21c8b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f713a3d5650>]}
[0m20:43:05.532405 [info ] [Thread-1 (]: 12 of 17 OK created sql table model public.stg_web__transactions ............... [[32mSELECT 100[0m in 0.26s]
[0m20:43:05.533159 [debug] [Thread-1 (]: Finished running node model.customer360.stg_web__transactions
[0m20:43:05.534015 [debug] [Thread-3 (]: Began running node model.customer360.contacts_joined_with_transactions
[0m20:43:05.534614 [info ] [Thread-3 (]: 13 of 17 START sql view model public.contacts_joined_with_transactions ......... [RUN]
[0m20:43:05.535395 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344, now model.customer360.contacts_joined_with_transactions)
[0m20:43:05.535834 [debug] [Thread-3 (]: Began compiling node model.customer360.contacts_joined_with_transactions
[0m20:43:05.539794 [debug] [Thread-3 (]: Writing injected SQL for node "model.customer360.contacts_joined_with_transactions"
[0m20:43:05.540580 [debug] [Thread-3 (]: Timing info for model.customer360.contacts_joined_with_transactions (compile): 20:43:05.536092 => 20:43:05.540256
[0m20:43:05.541075 [debug] [Thread-3 (]: Began executing node model.customer360.contacts_joined_with_transactions
[0m20:43:05.550843 [debug] [Thread-2 (]: Began running node model.customer360.sales_month_report
[0m20:43:05.551545 [info ] [Thread-2 (]: 14 of 17 START sql table model public.sales_month_report ....................... [RUN]
[0m20:43:05.552455 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.customer360.stg_sf__contacts, now model.customer360.sales_month_report)
[0m20:43:05.552936 [debug] [Thread-2 (]: Began compiling node model.customer360.sales_month_report
[0m20:43:05.556995 [debug] [Thread-2 (]: Writing injected SQL for node "model.customer360.sales_month_report"
[0m20:43:05.557777 [debug] [Thread-2 (]: Timing info for model.customer360.sales_month_report (compile): 20:43:05.553239 => 20:43:05.557474
[0m20:43:05.558306 [debug] [Thread-2 (]: Began executing node model.customer360.sales_month_report
[0m20:43:05.589476 [debug] [Thread-2 (]: Writing runtime sql for node "model.customer360.sales_month_report"
[0m20:43:05.590400 [debug] [Thread-2 (]: Using postgres connection "model.customer360.sales_month_report"
[0m20:43:05.590906 [debug] [Thread-2 (]: On model.customer360.sales_month_report: BEGIN
[0m20:43:05.591384 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m20:43:05.604656 [debug] [Thread-3 (]: Writing runtime sql for node "model.customer360.contacts_joined_with_transactions"
[0m20:43:05.605585 [debug] [Thread-3 (]: Using postgres connection "model.customer360.contacts_joined_with_transactions"
[0m20:43:05.606115 [debug] [Thread-3 (]: On model.customer360.contacts_joined_with_transactions: BEGIN
[0m20:43:05.606613 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m20:43:05.612814 [debug] [Thread-2 (]: SQL status: BEGIN in 0.0 seconds
[0m20:43:05.613435 [debug] [Thread-2 (]: Using postgres connection "model.customer360.sales_month_report"
[0m20:43:05.614108 [debug] [Thread-2 (]: On model.customer360.sales_month_report: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.sales_month_report"} */

  
    

  create  table "dbt"."public"."sales_month_report__dbt_tmp"
  
  
    as
  
  (
    SELECT
     count(id)                                  as total_count
    ,cast(count(id) / 31 as decimal(24,2))      as day_avg_count
    ,sum(case when category = 'Apps & Games'                    then 1 else 0 end)   as apps_games_count
    ,sum(case when category = 'Beauty'                          then 1 else 0 end)   as beauty_count
    ,sum(case when category = 'Books'                           then 1 else 0 end)   as books_count
    ,sum(case when category = 'Clothing, Shoes & Accessories'   then 1 else 0 end)   as clothing_shoes_accessories_count
    ,sum(case when category = 'Movies & TV'                     then 1 else 0 end)   as movies_tv_count
    ,sum(case when category = 'Sports, Fitness & Outdoors'      then 1 else 0 end)   as sports_fitness_outdoors_count

    ,sum(amount) as total_expense
    ,cast(sum(amount) / 31 as decimal(24,4))    as day_avg_count
    ,sum(case when category = 'Apps & Games'                    then amount else 0 end)   as apps_games_amount
    ,sum(case when category = 'Beauty'                          then amount else 0 end)   as beauty_amount
    ,sum(case when category = 'Books'                           then amount else 0 end)   as books_amount
    ,sum(case when category = 'Clothing, Shoes & Accessories'   then amount else 0 end)   as clothing_shoes_accessories_amount
    ,sum(case when category = 'Movies & TV'                     then amount else 0 end)   as movies_tv_amount
    ,sum(case when category = 'Sports, Fitness & Outdoors'      then amount else 0 end)   as sports_fitness_outdoors_amount
FROM  "dbt"."public"."stg_web__transactions"
where transaction_date between '2023-05-01' and '2023-05-31'  -- 样例，实际脚本可改成传参
  );
  
[0m20:43:05.616855 [debug] [Thread-2 (]: Postgres adapter: Postgres error: column "day_avg_count" specified more than once

[0m20:43:05.617457 [debug] [Thread-2 (]: On model.customer360.sales_month_report: ROLLBACK
[0m20:43:05.618530 [debug] [Thread-2 (]: Timing info for model.customer360.sales_month_report (execute): 20:43:05.558611 => 20:43:05.618212
[0m20:43:05.619006 [debug] [Thread-2 (]: On model.customer360.sales_month_report: Close
[0m20:43:05.628589 [debug] [Thread-2 (]: Database Error in model sales_month_report (models/marts/marketing/sales_month_report.sql)
  column "day_avg_count" specified more than once
  compiled Code at target/run/customer360/models/marts/marketing/sales_month_report.sql
[0m20:43:05.629281 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b73f2b99-97a3-4226-ad5b-c6f0b5b21c8b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7139ebab50>]}
[0m20:43:05.630136 [error] [Thread-2 (]: 14 of 17 ERROR creating sql table model public.sales_month_report .............. [[31mERROR[0m in 0.08s]
[0m20:43:05.635160 [debug] [Thread-2 (]: Finished running node model.customer360.sales_month_report
[0m20:43:05.635803 [debug] [Thread-3 (]: SQL status: BEGIN in 0.0 seconds
[0m20:43:05.636308 [debug] [Thread-3 (]: Using postgres connection "model.customer360.contacts_joined_with_transactions"
[0m20:43:05.636878 [debug] [Thread-3 (]: On model.customer360.contacts_joined_with_transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.contacts_joined_with_transactions"} */

  create view "dbt"."public"."contacts_joined_with_transactions__dbt_tmp"
    
    
  as (
    SELECT 
    contacts.*,
    transactions.id as transaction_id,
    transactions.transaction_date,
    transactions.amount,
    transactions.item_count,
    transactions.category
FROM "dbt"."public"."stg_web__transactions" as transactions
LEFT JOIN "dbt"."public"."stg_sf__contacts" as contacts ON contacts.id = transactions.contact_id
  );
[0m20:43:05.643084 [debug] [Thread-3 (]: SQL status: CREATE VIEW in 0.0 seconds
[0m20:43:05.647476 [debug] [Thread-3 (]: Using postgres connection "model.customer360.contacts_joined_with_transactions"
[0m20:43:05.648026 [debug] [Thread-3 (]: On model.customer360.contacts_joined_with_transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.contacts_joined_with_transactions"} */
alter table "dbt"."public"."contacts_joined_with_transactions__dbt_tmp" rename to "contacts_joined_with_transactions"
[0m20:43:05.651413 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m20:43:05.657468 [debug] [Thread-3 (]: On model.customer360.contacts_joined_with_transactions: COMMIT
[0m20:43:05.658009 [debug] [Thread-3 (]: Using postgres connection "model.customer360.contacts_joined_with_transactions"
[0m20:43:05.658600 [debug] [Thread-3 (]: On model.customer360.contacts_joined_with_transactions: COMMIT
[0m20:43:05.663669 [debug] [Thread-3 (]: SQL status: COMMIT in 0.0 seconds
[0m20:43:05.667522 [debug] [Thread-3 (]: Applying DROP to: "dbt"."public"."contacts_joined_with_transactions__dbt_backup"
[0m20:43:05.676271 [debug] [Thread-3 (]: Using postgres connection "model.customer360.contacts_joined_with_transactions"
[0m20:43:05.676919 [debug] [Thread-3 (]: On model.customer360.contacts_joined_with_transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.contacts_joined_with_transactions"} */
drop view if exists "dbt"."public"."contacts_joined_with_transactions__dbt_backup" cascade
[0m20:43:05.680970 [debug] [Thread-3 (]: SQL status: DROP VIEW in 0.0 seconds
[0m20:43:05.683226 [debug] [Thread-3 (]: Timing info for model.customer360.contacts_joined_with_transactions (execute): 20:43:05.541390 => 20:43:05.682890
[0m20:43:05.683817 [debug] [Thread-3 (]: On model.customer360.contacts_joined_with_transactions: Close
[0m20:43:05.689945 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b73f2b99-97a3-4226-ad5b-c6f0b5b21c8b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f713a4374d0>]}
[0m20:43:05.690835 [info ] [Thread-3 (]: 13 of 17 OK created sql view model public.contacts_joined_with_transactions .... [[32mCREATE VIEW[0m in 0.15s]
[0m20:43:05.691644 [debug] [Thread-3 (]: Finished running node model.customer360.contacts_joined_with_transactions
[0m20:43:05.692858 [debug] [Thread-1 (]: Began running node test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311
[0m20:43:05.693389 [info ] [Thread-1 (]: 15 of 17 START test not_null_contacts_joined_with_transactions_id .............. [RUN]
[0m20:43:05.694240 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.customer360.stg_web__transactions, now test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311)
[0m20:43:05.694759 [debug] [Thread-1 (]: Began compiling node test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311
[0m20:43:05.700499 [debug] [Thread-1 (]: Writing injected SQL for node "test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311"
[0m20:43:05.705520 [debug] [Thread-1 (]: Timing info for test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311 (compile): 20:43:05.695063 => 20:43:05.701125
[0m20:43:05.706096 [debug] [Thread-1 (]: Began executing node test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311
[0m20:43:05.709489 [debug] [Thread-1 (]: Writing runtime sql for node "test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311"
[0m20:43:05.710179 [debug] [Thread-1 (]: Using postgres connection "test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311"
[0m20:43:05.718807 [debug] [Thread-1 (]: On test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311: BEGIN
[0m20:43:05.719320 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:43:05.756094 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m20:43:05.756723 [debug] [Thread-1 (]: Using postgres connection "test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311"
[0m20:43:05.757249 [debug] [Thread-1 (]: On test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select id
from "dbt"."public"."contacts_joined_with_transactions"
where id is null



      
    ) dbt_internal_test
[0m20:43:05.763198 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.0 seconds
[0m20:43:05.765968 [debug] [Thread-1 (]: Timing info for test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311 (execute): 20:43:05.706439 => 20:43:05.765633
[0m20:43:05.766517 [debug] [Thread-1 (]: On test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311: ROLLBACK
[0m20:43:05.772776 [debug] [Thread-1 (]: On test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311: Close
[0m20:43:05.773938 [info ] [Thread-1 (]: 15 of 17 PASS not_null_contacts_joined_with_transactions_id .................... [[32mPASS[0m in 0.08s]
[0m20:43:05.776708 [debug] [Thread-1 (]: Finished running node test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311
[0m20:43:05.780572 [debug] [Thread-3 (]: Began running node model.customer360.customers
[0m20:43:05.781262 [info ] [Thread-3 (]: 16 of 17 START sql table model public.customers ................................ [RUN]
[0m20:43:05.782277 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.customer360.contacts_joined_with_transactions, now model.customer360.customers)
[0m20:43:05.782803 [debug] [Thread-3 (]: Began compiling node model.customer360.customers
[0m20:43:05.787219 [debug] [Thread-3 (]: Writing injected SQL for node "model.customer360.customers"
[0m20:43:05.788076 [debug] [Thread-3 (]: Timing info for model.customer360.customers (compile): 20:43:05.783195 => 20:43:05.787720
[0m20:43:05.788573 [debug] [Thread-3 (]: Began executing node model.customer360.customers
[0m20:43:05.803836 [debug] [Thread-3 (]: Writing runtime sql for node "model.customer360.customers"
[0m20:43:05.804729 [debug] [Thread-3 (]: Using postgres connection "model.customer360.customers"
[0m20:43:05.805217 [debug] [Thread-3 (]: On model.customer360.customers: BEGIN
[0m20:43:05.809998 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m20:43:05.826953 [debug] [Thread-3 (]: SQL status: BEGIN in 0.0 seconds
[0m20:43:05.827546 [debug] [Thread-3 (]: Using postgres connection "model.customer360.customers"
[0m20:43:05.828058 [debug] [Thread-3 (]: On model.customer360.customers: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.customers"} */

  
    

  create  table "dbt"."public"."customers__dbt_tmp"
  
  
    as
  
  (
    SELECT
    id,
    gender,
    
    date_part('year', age(current_date, birth_date))
 AS age,
    sum(amount) as total_expense,
    date(min(transaction_date)) as first_purchase_date,
    date(max(transaction_date)) as last_purchase_date,
    sum(case when category = 'Apps & Games' then amount else 0 end) as apps_games_amount,
    sum(case when category = 'Beauty' then amount else 0 end)   as beauty_amount,
    sum(case when category = 'Books' then amount else 0 end)   as books_amount,
    sum(case when category = 'Clothing, Shoes & Accessories' then amount else 0 end)   as clothing_shoes_accessories_amount,
    sum(case when category = 'Movies & TV' then amount else 0 end)   as movies_tv_amount,
    sum(case when category = 'Sports, Fitness & Outdoors' then amount else 0 end)   as sports_fitness_outdoors_amount
FROM  "dbt"."public"."contacts_joined_with_transactions"
GROUP BY
    1,2,3
  );
  
[0m20:43:05.838082 [debug] [Thread-3 (]: SQL status: SELECT 9 in 0.0 seconds
[0m20:43:05.841176 [debug] [Thread-3 (]: Using postgres connection "model.customer360.customers"
[0m20:43:05.841682 [debug] [Thread-3 (]: On model.customer360.customers: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.customers"} */
alter table "dbt"."public"."customers" rename to "customers__dbt_backup"
[0m20:43:05.842421 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m20:43:05.845805 [debug] [Thread-3 (]: Using postgres connection "model.customer360.customers"
[0m20:43:05.846134 [debug] [Thread-3 (]: On model.customer360.customers: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.customers"} */
alter table "dbt"."public"."customers__dbt_tmp" rename to "customers"
[0m20:43:05.846803 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m20:43:05.849151 [debug] [Thread-3 (]: On model.customer360.customers: COMMIT
[0m20:43:05.849516 [debug] [Thread-3 (]: Using postgres connection "model.customer360.customers"
[0m20:43:05.849819 [debug] [Thread-3 (]: On model.customer360.customers: COMMIT
[0m20:43:05.851375 [debug] [Thread-3 (]: SQL status: COMMIT in 0.0 seconds
[0m20:43:05.853585 [debug] [Thread-3 (]: Applying DROP to: "dbt"."public"."customers__dbt_backup"
[0m20:43:05.854361 [debug] [Thread-3 (]: Using postgres connection "model.customer360.customers"
[0m20:43:05.854685 [debug] [Thread-3 (]: On model.customer360.customers: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.customers"} */
drop table if exists "dbt"."public"."customers__dbt_backup" cascade
[0m20:43:05.856960 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.0 seconds
[0m20:43:05.858341 [debug] [Thread-3 (]: Timing info for model.customer360.customers (execute): 20:43:05.788865 => 20:43:05.858133
[0m20:43:05.858709 [debug] [Thread-3 (]: On model.customer360.customers: Close
[0m20:43:05.859543 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b73f2b99-97a3-4226-ad5b-c6f0b5b21c8b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7139ed2f10>]}
[0m20:43:05.860209 [info ] [Thread-3 (]: 16 of 17 OK created sql table model public.customers ........................... [[32mSELECT 9[0m in 0.08s]
[0m20:43:05.860970 [debug] [Thread-3 (]: Finished running node model.customer360.customers
[0m20:43:05.861700 [debug] [Thread-1 (]: Began running node test.customer360.custormers_test
[0m20:43:05.862102 [info ] [Thread-1 (]: 17 of 17 START test custormers_test ............................................ [RUN]
[0m20:43:05.862734 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311, now test.customer360.custormers_test)
[0m20:43:05.863056 [debug] [Thread-1 (]: Began compiling node test.customer360.custormers_test
[0m20:43:05.865817 [debug] [Thread-1 (]: Writing injected SQL for node "test.customer360.custormers_test"
[0m20:43:05.866589 [debug] [Thread-1 (]: Timing info for test.customer360.custormers_test (compile): 20:43:05.863251 => 20:43:05.866332
[0m20:43:05.866914 [debug] [Thread-1 (]: Began executing node test.customer360.custormers_test
[0m20:43:05.868992 [debug] [Thread-1 (]: Writing runtime sql for node "test.customer360.custormers_test"
[0m20:43:05.869476 [debug] [Thread-1 (]: Using postgres connection "test.customer360.custormers_test"
[0m20:43:05.869807 [debug] [Thread-1 (]: On test.customer360.custormers_test: BEGIN
[0m20:43:05.870133 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:43:05.873512 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m20:43:05.873863 [debug] [Thread-1 (]: Using postgres connection "test.customer360.custormers_test"
[0m20:43:05.874282 [debug] [Thread-1 (]: On test.customer360.custormers_test: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.custormers_test"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      select
    1
from
(
    SELECT
        sum(total_expense) as total_expense,
        date(min(first_purchase_date)) as first_purchase_date,
        date(max(last_purchase_date)) as last_purchase_date,
        sum(apps_games_amount) as apps_games_amount,
        sum(beauty_amount)   as beauty_amount,
        sum(books_amount)   as books_amount,
        sum(clothing_shoes_accessories_amount)   as clothing_shoes_accessories_amount,
        sum(movies_tv_amount)   as movies_tv_amount,
        sum(sports_fitness_outdoors_amount)   as sports_fitness_outdoors_amount
    FROM  "dbt"."public"."customers"
) t1
join (
    SELECT
        sum(amount) as total_expense,
        date(min(transaction_date)) as first_purchase_date,
        date(max(transaction_date)) as last_purchase_date,
        sum(case when category = 'Apps & Games' then amount else 0 end) as apps_games_amount,
        sum(case when category = 'Beauty' then amount else 0 end)   as beauty_amount,
        sum(case when category = 'Books' then amount else 0 end)   as books_amount,
        sum(case when category = 'Clothing, Shoes & Accessories' then amount else 0 end)   as clothing_shoes_accessories_amount,
        sum(case when category = 'Movies & TV' then amount else 0 end)   as movies_tv_amount,
        sum(case when category = 'Sports, Fitness & Outdoors' then amount else 0 end)   as sports_fitness_outdoors_amount
    FROM  "dbt"."public"."contacts_joined_with_transactions"
) t2
on 1 = 1
where (
     nullif(cast(t1.total_expense as decimal(15,1))                   ,0)  <> nullif(cast(t2.total_expense                      as decimal(15,1)) ,0)
  or nullif(t1.first_purchase_date               ,'9999-12-31')       <> nullif(t2.first_purchase_date               ,'9999-12-31')
  or nullif(t1.last_purchase_date               ,'9999-12-31')        <> nullif(t2.last_purchase_date               ,'9999-12-31')
  or nullif(cast(t1.apps_games_amount                 as decimal(15,1)),0) <> nullif(cast(t2.apps_games_amount                 as decimal(15,1)) ,0)
  or nullif(cast(t1.beauty_amount                     as decimal(15,1)),0) <> nullif(cast(t2.beauty_amount                     as decimal(15,1)) ,0)
  or nullif(cast(t1.books_amount                      as decimal(15,1)),0) <> nullif(cast(t2.books_amount                      as decimal(15,1)) ,0)
  or nullif(cast(t1.clothing_shoes_accessories_amount as decimal(15,1)),0) <> nullif(cast(t2.clothing_shoes_accessories_amount as decimal(15,1)) ,0)
  or nullif(cast(t1.movies_tv_amount                  as decimal(15,1)),0) <> nullif(cast(t2.movies_tv_amount                  as decimal(15,1)) ,0)
  or nullif(cast(t1.sports_fitness_outdoors_amount    as decimal(15,1)),0) <> nullif(cast(t2.sports_fitness_outdoors_amount    as decimal(15,1)) ,0)
)
      
    ) dbt_internal_test
[0m20:43:05.877093 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.0 seconds
[0m20:43:05.879997 [debug] [Thread-1 (]: Timing info for test.customer360.custormers_test (execute): 20:43:05.867117 => 20:43:05.879778
[0m20:43:05.880353 [debug] [Thread-1 (]: On test.customer360.custormers_test: ROLLBACK
[0m20:43:05.880873 [debug] [Thread-1 (]: On test.customer360.custormers_test: Close
[0m20:43:05.881753 [info ] [Thread-1 (]: 17 of 17 PASS custormers_test .................................................. [[32mPASS[0m in 0.02s]
[0m20:43:05.882437 [debug] [Thread-1 (]: Finished running node test.customer360.custormers_test
[0m20:43:05.883873 [debug] [MainThread]: Using postgres connection "master"
[0m20:43:05.884163 [debug] [MainThread]: On master: BEGIN
[0m20:43:05.884449 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m20:43:05.887539 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m20:43:05.887835 [debug] [MainThread]: On master: COMMIT
[0m20:43:05.888112 [debug] [MainThread]: Using postgres connection "master"
[0m20:43:05.888435 [debug] [MainThread]: On master: COMMIT
[0m20:43:05.888981 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m20:43:05.889262 [debug] [MainThread]: On master: Close
[0m20:43:05.889886 [debug] [MainThread]: Connection 'master' was properly closed.
[0m20:43:05.890154 [debug] [MainThread]: Connection 'test.customer360.custormers_test' was properly closed.
[0m20:43:05.890451 [debug] [MainThread]: Connection 'model.customer360.sales_month_report' was properly closed.
[0m20:43:05.890717 [debug] [MainThread]: Connection 'model.customer360.customers' was properly closed.
[0m20:43:05.891069 [info ] [MainThread]: 
[0m20:43:05.891389 [info ] [MainThread]: Finished running 10 tests, 2 seeds, 4 table models, 1 view model in 0 hours 0 minutes and 1.56 seconds (1.56s).
[0m20:43:05.894954 [debug] [MainThread]: Command end result
[0m20:43:05.902537 [info ] [MainThread]: 
[0m20:43:05.902919 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m20:43:05.903222 [info ] [MainThread]: 
[0m20:43:05.903579 [error] [MainThread]:   Database Error in model sales_month_report (models/marts/marketing/sales_month_report.sql)
  column "day_avg_count" specified more than once
  compiled Code at target/run/customer360/models/marts/marketing/sales_month_report.sql
[0m20:43:05.903875 [info ] [MainThread]: 
[0m20:43:05.904386 [info ] [MainThread]: Done. PASS=16 WARN=0 ERROR=1 SKIP=0 TOTAL=17
[0m20:43:05.905101 [debug] [MainThread]: Resource report: {"command_name": "build", "command_wall_clock_time": 2.5137885, "process_user_time": 3.832106, "process_kernel_time": 0.125514, "process_mem_max_rss": "115812", "process_out_blocks": "3032", "command_success": false, "process_in_blocks": "0"}
[0m20:43:05.905610 [debug] [MainThread]: Command `dbt build` failed at 20:43:05.905485 after 2.51 seconds
[0m20:43:05.905974 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f713bf5a6d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f713c105a10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f713c38bc90>]}
[0m20:43:05.906356 [debug] [MainThread]: Flushing usage events
[0m20:49:30.868594 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f44f8dadd10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f44f8c2b9d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f44f8e05c90>]}


============================== 20:49:30.873515 | 8246aa2d-13bb-4dc1-bbec-ead3eb1749a8 ==============================
[0m20:49:30.873515 [info ] [MainThread]: Running with dbt=1.7.8
[0m20:49:30.874317 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'profiles_dir': '/root/option1-customer360/integration_tests', 'log_path': '/root/option1-customer360/integration_tests/logs', 'debug': 'False', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'invocation_command': 'dbt build', 'log_format': 'default', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m20:49:31.098852 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '8246aa2d-13bb-4dc1-bbec-ead3eb1749a8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f44f8d99c90>]}
[0m20:49:31.266749 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '8246aa2d-13bb-4dc1-bbec-ead3eb1749a8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f44f8e07e10>]}
[0m20:49:31.267716 [info ] [MainThread]: Registered adapter: postgres=1.7.8
[0m20:49:31.287870 [debug] [MainThread]: checksum: 67f0013ca5f0bd43af9a0873dd50792fde83ef69de63b71cacd0b4ac656c52e5, vars: {}, profile: , target: , version: 1.7.8
[0m20:49:31.322834 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m20:49:31.323765 [debug] [MainThread]: Partial parsing: updated file: customer360://models/marts/marketing/sales_month_report.sql
[0m20:49:31.541030 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '8246aa2d-13bb-4dc1-bbec-ead3eb1749a8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f44f6a71990>]}
[0m20:49:31.632917 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '8246aa2d-13bb-4dc1-bbec-ead3eb1749a8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f44f6e55190>]}
[0m20:49:31.634052 [info ] [MainThread]: Found 2 seeds, 5 models, 10 tests, 2 sources, 0 exposures, 0 metrics, 403 macros, 0 groups, 0 semantic models
[0m20:49:31.637033 [info ] [MainThread]: 
[0m20:49:31.638039 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m20:49:31.639925 [debug] [ThreadPool]: Acquiring new postgres connection 'list_dbt'
[0m20:49:31.653566 [debug] [ThreadPool]: Using postgres connection "list_dbt"
[0m20:49:31.654098 [debug] [ThreadPool]: On list_dbt: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "connection_name": "list_dbt"} */

    select distinct nspname from pg_namespace
  
[0m20:49:31.654638 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:49:31.660651 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.0 seconds
[0m20:49:31.662372 [debug] [ThreadPool]: On list_dbt: Close
[0m20:49:31.666600 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dbt, now list_dbt_public)
[0m20:49:31.674513 [debug] [ThreadPool]: Using postgres connection "list_dbt_public"
[0m20:49:31.674967 [debug] [ThreadPool]: On list_dbt_public: BEGIN
[0m20:49:31.675378 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:49:31.683167 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m20:49:31.683676 [debug] [ThreadPool]: Using postgres connection "list_dbt_public"
[0m20:49:31.684103 [debug] [ThreadPool]: On list_dbt_public: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "connection_name": "list_dbt_public"} */
select
      'dbt' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'dbt' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'dbt' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m20:49:31.688026 [debug] [ThreadPool]: SQL status: SELECT 6 in 0.0 seconds
[0m20:49:31.689786 [debug] [ThreadPool]: On list_dbt_public: ROLLBACK
[0m20:49:31.690417 [debug] [ThreadPool]: On list_dbt_public: Close
[0m20:49:31.700197 [debug] [MainThread]: Using postgres connection "master"
[0m20:49:31.700713 [debug] [MainThread]: On master: BEGIN
[0m20:49:31.701106 [debug] [MainThread]: Opening a new connection, currently in state init
[0m20:49:31.705543 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m20:49:31.705984 [debug] [MainThread]: Using postgres connection "master"
[0m20:49:31.706554 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m20:49:31.720789 [debug] [MainThread]: SQL status: SELECT 2 in 0.0 seconds
[0m20:49:31.723154 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8246aa2d-13bb-4dc1-bbec-ead3eb1749a8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f44f6d777d0>]}
[0m20:49:31.723749 [debug] [MainThread]: On master: ROLLBACK
[0m20:49:31.724417 [debug] [MainThread]: Using postgres connection "master"
[0m20:49:31.724815 [debug] [MainThread]: On master: BEGIN
[0m20:49:31.725642 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m20:49:31.726044 [debug] [MainThread]: On master: COMMIT
[0m20:49:31.726434 [debug] [MainThread]: Using postgres connection "master"
[0m20:49:31.726809 [debug] [MainThread]: On master: COMMIT
[0m20:49:31.727632 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m20:49:31.728066 [debug] [MainThread]: On master: Close
[0m20:49:31.729091 [info ] [MainThread]: Concurrency: 3 threads (target='local')
[0m20:49:31.729574 [info ] [MainThread]: 
[0m20:49:31.758118 [debug] [Thread-1 (]: Began running node seed.integration_tests.contacts
[0m20:49:31.758837 [info ] [Thread-1 (]: 1 of 17 START seed file public.contacts ........................................ [RUN]
[0m20:49:31.759829 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dbt_public, now seed.integration_tests.contacts)
[0m20:49:31.760353 [debug] [Thread-1 (]: Began compiling node seed.integration_tests.contacts
[0m20:49:31.760948 [debug] [Thread-1 (]: Timing info for seed.integration_tests.contacts (compile): 20:49:31.760659 => 20:49:31.760663
[0m20:49:31.761476 [debug] [Thread-1 (]: Began executing node seed.integration_tests.contacts
[0m20:49:31.783034 [debug] [Thread-2 (]: Began running node seed.integration_tests.transactions
[0m20:49:31.783761 [info ] [Thread-2 (]: 2 of 17 START seed file public.transactions .................................... [RUN]
[0m20:49:31.784825 [debug] [Thread-2 (]: Acquiring new postgres connection 'seed.integration_tests.transactions'
[0m20:49:31.785275 [debug] [Thread-2 (]: Began compiling node seed.integration_tests.transactions
[0m20:49:31.785840 [debug] [Thread-2 (]: Timing info for seed.integration_tests.transactions (compile): 20:49:31.785571 => 20:49:31.785574
[0m20:49:31.786282 [debug] [Thread-2 (]: Began executing node seed.integration_tests.transactions
[0m20:49:31.849711 [debug] [Thread-3 (]: Began running node test.customer360.macro_test1
[0m20:49:31.850376 [info ] [Thread-3 (]: 3 of 17 START test macro_test1 ................................................. [RUN]
[0m20:49:31.851429 [debug] [Thread-3 (]: Acquiring new postgres connection 'test.customer360.macro_test1'
[0m20:49:31.851900 [debug] [Thread-3 (]: Began compiling node test.customer360.macro_test1
[0m20:49:31.862107 [debug] [Thread-3 (]: Writing injected SQL for node "test.customer360.macro_test1"
[0m20:49:31.862954 [debug] [Thread-3 (]: Timing info for test.customer360.macro_test1 (compile): 20:49:31.852217 => 20:49:31.862631
[0m20:49:31.863578 [debug] [Thread-3 (]: Began executing node test.customer360.macro_test1
[0m20:49:31.956122 [debug] [Thread-2 (]: Using postgres connection "seed.integration_tests.transactions"
[0m20:49:31.956732 [debug] [Thread-2 (]: On seed.integration_tests.transactions: BEGIN
[0m20:49:31.957213 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m20:49:31.943130 [debug] [Thread-3 (]: Writing runtime sql for node "test.customer360.macro_test1"
[0m20:49:31.959399 [debug] [Thread-3 (]: Using postgres connection "test.customer360.macro_test1"
[0m20:49:31.959881 [debug] [Thread-3 (]: On test.customer360.macro_test1: BEGIN
[0m20:49:31.960367 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m20:49:31.962539 [debug] [Thread-1 (]: Using postgres connection "seed.integration_tests.contacts"
[0m20:49:31.963086 [debug] [Thread-1 (]: On seed.integration_tests.contacts: BEGIN
[0m20:49:31.964662 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:49:31.970189 [debug] [Thread-3 (]: SQL status: BEGIN in 0.0 seconds
[0m20:49:31.970745 [debug] [Thread-3 (]: Using postgres connection "test.customer360.macro_test1"
[0m20:49:31.971261 [debug] [Thread-3 (]: On test.customer360.macro_test1: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.macro_test1"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      with marco_result as (
    select 
    date_part('year', age(current_date, '2023-02-12'))
 as expect_result
)
select
    1
from marco_result
where expect_result <> 1
      
    ) dbt_internal_test
[0m20:49:31.973251 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m20:49:31.973754 [debug] [Thread-1 (]: Using postgres connection "seed.integration_tests.contacts"
[0m20:49:31.974244 [debug] [Thread-1 (]: On seed.integration_tests.contacts: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "seed.integration_tests.contacts"} */
truncate table "dbt"."public"."contacts"
[0m20:49:31.974837 [debug] [Thread-3 (]: SQL status: SELECT 1 in 0.0 seconds
[0m20:49:31.977474 [debug] [Thread-3 (]: Timing info for test.customer360.macro_test1 (execute): 20:49:31.863904 => 20:49:31.977121
[0m20:49:31.977986 [debug] [Thread-3 (]: On test.customer360.macro_test1: ROLLBACK
[0m20:49:31.980060 [debug] [Thread-3 (]: On test.customer360.macro_test1: Close
[0m20:49:31.981148 [info ] [Thread-3 (]: 3 of 17 PASS macro_test1 ....................................................... [[32mPASS[0m in 0.13s]
[0m20:49:31.981910 [debug] [Thread-3 (]: Finished running node test.customer360.macro_test1
[0m20:49:31.984368 [debug] [Thread-3 (]: Began running node test.customer360.macro_test2
[0m20:49:31.986498 [info ] [Thread-3 (]: 4 of 17 START test macro_test2 ................................................. [RUN]
[0m20:49:31.987449 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.customer360.macro_test1, now test.customer360.macro_test2)
[0m20:49:31.987922 [debug] [Thread-3 (]: Began compiling node test.customer360.macro_test2
[0m20:49:31.985608 [debug] [Thread-2 (]: SQL status: BEGIN in 0.0 seconds
[0m20:49:31.995176 [debug] [Thread-2 (]: Using postgres connection "seed.integration_tests.transactions"
[0m20:49:31.995676 [debug] [Thread-2 (]: On seed.integration_tests.transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "seed.integration_tests.transactions"} */
truncate table "dbt"."public"."transactions"
[0m20:49:31.994595 [debug] [Thread-1 (]: SQL status: TRUNCATE TABLE in 0.0 seconds
[0m20:49:31.994210 [debug] [Thread-3 (]: Writing injected SQL for node "test.customer360.macro_test2"
[0m20:49:32.011175 [debug] [Thread-3 (]: Timing info for test.customer360.macro_test2 (compile): 20:49:31.988209 => 20:49:32.010843
[0m20:49:32.011780 [debug] [Thread-3 (]: Began executing node test.customer360.macro_test2
[0m20:49:32.015157 [debug] [Thread-3 (]: Writing runtime sql for node "test.customer360.macro_test2"
[0m20:49:32.015847 [debug] [Thread-3 (]: Using postgres connection "test.customer360.macro_test2"
[0m20:49:32.016327 [debug] [Thread-3 (]: On test.customer360.macro_test2: BEGIN
[0m20:49:32.016799 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m20:49:32.017877 [debug] [Thread-2 (]: SQL status: TRUNCATE TABLE in 0.0 seconds
[0m20:49:32.080631 [debug] [Thread-3 (]: SQL status: BEGIN in 0.0 seconds
[0m20:49:32.081207 [debug] [Thread-3 (]: Using postgres connection "test.customer360.macro_test2"
[0m20:49:32.081730 [debug] [Thread-3 (]: On test.customer360.macro_test2: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.macro_test2"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      with marco_result as (
    select 
        to_timestamp('2023-02-27 21:00:00','YYYY-MM-DD HH24:MI:SS.MS') :: timestamp at TIME zone 'UTC'
     as expect_result
)
select
    1
from marco_result
where cast(pg_typeof(expect_result) as text) not like '%timestamp%'
      
    ) dbt_internal_test
[0m20:49:32.094666 [debug] [Thread-3 (]: SQL status: SELECT 1 in 0.0 seconds
[0m20:49:32.096688 [debug] [Thread-3 (]: Timing info for test.customer360.macro_test2 (execute): 20:49:32.012080 => 20:49:32.096365
[0m20:49:32.097180 [debug] [Thread-3 (]: On test.customer360.macro_test2: ROLLBACK
[0m20:49:32.100438 [debug] [Thread-1 (]: Using postgres connection "seed.integration_tests.contacts"
[0m20:49:32.100973 [debug] [Thread-1 (]: On seed.integration_tests.contacts: 
          insert into "dbt"."public"."contacts" ("id", "username", "name", "gender", "address", "mail", "birthdate", "_loaded_at_utc") values
          (%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s)
      ...
[0m20:49:32.114575 [debug] [Thread-3 (]: On test.customer360.macro_test2: Close
[0m20:49:32.115716 [info ] [Thread-3 (]: 4 of 17 PASS macro_test2 ....................................................... [[32mPASS[0m in 0.13s]
[0m20:49:32.116502 [debug] [Thread-3 (]: Finished running node test.customer360.macro_test2
[0m20:49:32.117091 [debug] [Thread-3 (]: Began running node test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247
[0m20:49:32.117646 [info ] [Thread-3 (]: 5 of 17 START test source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors  [RUN]
[0m20:49:32.118765 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.customer360.macro_test2, now test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247)
[0m20:49:32.119658 [debug] [Thread-3 (]: Began compiling node test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247
[0m20:49:32.134755 [debug] [Thread-1 (]: SQL status: INSERT 0 10 in 0.0 seconds
[0m20:49:32.142336 [debug] [Thread-1 (]: Writing runtime SQL for node "seed.integration_tests.contacts"
[0m20:49:32.170113 [debug] [Thread-1 (]: On seed.integration_tests.contacts: COMMIT
[0m20:49:32.178846 [debug] [Thread-3 (]: Writing injected SQL for node "test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247"
[0m20:49:32.190986 [debug] [Thread-1 (]: Using postgres connection "seed.integration_tests.contacts"
[0m20:49:32.216731 [debug] [Thread-1 (]: On seed.integration_tests.contacts: COMMIT
[0m20:49:32.222439 [debug] [Thread-1 (]: SQL status: COMMIT in 0.0 seconds
[0m20:49:32.228987 [debug] [Thread-1 (]: Timing info for seed.integration_tests.contacts (execute): 20:49:31.761771 => 20:49:32.228790
[0m20:49:32.228008 [debug] [Thread-3 (]: Timing info for test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247 (compile): 20:49:32.119979 => 20:49:32.227763
[0m20:49:32.234495 [debug] [Thread-1 (]: On seed.integration_tests.contacts: Close
[0m20:49:32.255072 [debug] [Thread-3 (]: Began executing node test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247
[0m20:49:32.288150 [debug] [Thread-3 (]: Writing runtime sql for node "test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247"
[0m20:49:32.288912 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8246aa2d-13bb-4dc1-bbec-ead3eb1749a8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f44f6d30e90>]}
[0m20:49:32.298999 [info ] [Thread-1 (]: 1 of 17 OK loaded seed file public.contacts .................................... [[32mINSERT 10[0m in 0.53s]
[0m20:49:32.299595 [debug] [Thread-1 (]: Finished running node seed.integration_tests.contacts
[0m20:49:32.300144 [debug] [Thread-3 (]: Using postgres connection "test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247"
[0m20:49:32.300600 [debug] [Thread-1 (]: Began running node test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d
[0m20:49:32.309822 [info ] [Thread-1 (]: 6 of 17 START test source_not_null_salesforce_contacts_id ...................... [RUN]
[0m20:49:32.310712 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly seed.integration_tests.contacts, now test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d)
[0m20:49:32.311100 [debug] [Thread-1 (]: Began compiling node test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d
[0m20:49:32.309284 [debug] [Thread-2 (]: Using postgres connection "seed.integration_tests.transactions"
[0m20:49:32.318225 [debug] [Thread-2 (]: On seed.integration_tests.transactions: 
          insert into "dbt"."public"."transactions" ("contact_id", "id", "transaction_date", "amount", "item_count", "category", "_loaded_at_utc") values
          (%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%...
[0m20:49:32.306244 [debug] [Thread-3 (]: On test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247: BEGIN
[0m20:49:32.319803 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m20:49:32.317682 [debug] [Thread-1 (]: Writing injected SQL for node "test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d"
[0m20:49:32.323586 [debug] [Thread-1 (]: Timing info for test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d (compile): 20:49:32.311322 => 20:49:32.323220
[0m20:49:32.324105 [debug] [Thread-1 (]: Began executing node test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d
[0m20:49:32.328798 [debug] [Thread-1 (]: Writing runtime sql for node "test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d"
[0m20:49:32.329502 [debug] [Thread-1 (]: Using postgres connection "test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d"
[0m20:49:32.329989 [debug] [Thread-1 (]: On test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d: BEGIN
[0m20:49:32.330435 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:49:32.331473 [debug] [Thread-2 (]: SQL status: INSERT 0 100 in 0.0 seconds
[0m20:49:32.332500 [debug] [Thread-2 (]: Writing runtime SQL for node "seed.integration_tests.transactions"
[0m20:49:32.335571 [debug] [Thread-2 (]: On seed.integration_tests.transactions: COMMIT
[0m20:49:32.336060 [debug] [Thread-2 (]: Using postgres connection "seed.integration_tests.transactions"
[0m20:49:32.336588 [debug] [Thread-2 (]: On seed.integration_tests.transactions: COMMIT
[0m20:49:32.346679 [debug] [Thread-2 (]: SQL status: COMMIT in 0.0 seconds
[0m20:49:32.348082 [debug] [Thread-2 (]: Timing info for seed.integration_tests.transactions (execute): 20:49:31.786632 => 20:49:32.347776
[0m20:49:32.348603 [debug] [Thread-2 (]: On seed.integration_tests.transactions: Close
[0m20:49:32.349648 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8246aa2d-13bb-4dc1-bbec-ead3eb1749a8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f44f6ac0750>]}
[0m20:49:32.350276 [info ] [Thread-2 (]: 2 of 17 OK loaded seed file public.transactions ................................ [[32mINSERT 100[0m in 0.57s]
[0m20:49:32.350945 [debug] [Thread-2 (]: Finished running node seed.integration_tests.transactions
[0m20:49:32.351469 [debug] [Thread-2 (]: Began running node test.customer360.source_not_null_web_transactions_id.88a47bf7e5
[0m20:49:32.351940 [info ] [Thread-2 (]: 7 of 17 START test source_not_null_web_transactions_id ......................... [RUN]
[0m20:49:32.353001 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly seed.integration_tests.transactions, now test.customer360.source_not_null_web_transactions_id.88a47bf7e5)
[0m20:49:32.353561 [debug] [Thread-2 (]: Began compiling node test.customer360.source_not_null_web_transactions_id.88a47bf7e5
[0m20:49:32.365943 [debug] [Thread-3 (]: SQL status: BEGIN in 0.0 seconds
[0m20:49:32.366574 [debug] [Thread-3 (]: Using postgres connection "test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247"
[0m20:49:32.367163 [debug] [Thread-3 (]: On test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

with all_values as (

    select
        category as value_field,
        count(*) as n_records

    from "dbt"."public"."transactions"
    group by category

)

select *
from all_values
where value_field not in (
    'Apps & Games','Beauty','Books','Clothing, Shoes & Accessories','Movies & TV','Sports, Fitness & Outdoors'
)



      
    ) dbt_internal_test
[0m20:49:32.370507 [debug] [Thread-2 (]: Writing injected SQL for node "test.customer360.source_not_null_web_transactions_id.88a47bf7e5"
[0m20:49:32.371288 [debug] [Thread-2 (]: Timing info for test.customer360.source_not_null_web_transactions_id.88a47bf7e5 (compile): 20:49:32.353867 => 20:49:32.370975
[0m20:49:32.371831 [debug] [Thread-2 (]: Began executing node test.customer360.source_not_null_web_transactions_id.88a47bf7e5
[0m20:49:32.378366 [debug] [Thread-2 (]: Writing runtime sql for node "test.customer360.source_not_null_web_transactions_id.88a47bf7e5"
[0m20:49:32.379119 [debug] [Thread-2 (]: Using postgres connection "test.customer360.source_not_null_web_transactions_id.88a47bf7e5"
[0m20:49:32.379638 [debug] [Thread-2 (]: On test.customer360.source_not_null_web_transactions_id.88a47bf7e5: BEGIN
[0m20:49:32.380111 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m20:49:32.381234 [debug] [Thread-3 (]: SQL status: SELECT 1 in 0.0 seconds
[0m20:49:32.383400 [debug] [Thread-3 (]: Timing info for test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247 (execute): 20:49:32.286073 => 20:49:32.383050
[0m20:49:32.383946 [debug] [Thread-3 (]: On test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247: ROLLBACK
[0m20:49:32.385796 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m20:49:32.386314 [debug] [Thread-1 (]: Using postgres connection "test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d"
[0m20:49:32.386819 [debug] [Thread-1 (]: On test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select id
from "dbt"."public"."contacts"
where id is null



      
    ) dbt_internal_test
[0m20:49:32.390676 [debug] [Thread-3 (]: On test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247: Close
[0m20:49:32.391818 [info ] [Thread-3 (]: 5 of 17 PASS source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors  [[32mPASS[0m in 0.27s]
[0m20:49:32.392634 [debug] [Thread-3 (]: Finished running node test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247
[0m20:49:32.393193 [debug] [Thread-3 (]: Began running node test.customer360.source_unique_salesforce_contacts_id.01cadaaf43
[0m20:49:32.393733 [info ] [Thread-3 (]: 8 of 17 START test source_unique_salesforce_contacts_id ........................ [RUN]
[0m20:49:32.394725 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247, now test.customer360.source_unique_salesforce_contacts_id.01cadaaf43)
[0m20:49:32.395207 [debug] [Thread-3 (]: Began compiling node test.customer360.source_unique_salesforce_contacts_id.01cadaaf43
[0m20:49:32.408893 [debug] [Thread-3 (]: Writing injected SQL for node "test.customer360.source_unique_salesforce_contacts_id.01cadaaf43"
[0m20:49:32.412799 [debug] [Thread-3 (]: Timing info for test.customer360.source_unique_salesforce_contacts_id.01cadaaf43 (compile): 20:49:32.395537 => 20:49:32.412473
[0m20:49:32.413348 [debug] [Thread-3 (]: Began executing node test.customer360.source_unique_salesforce_contacts_id.01cadaaf43
[0m20:49:32.416651 [debug] [Thread-3 (]: Writing runtime sql for node "test.customer360.source_unique_salesforce_contacts_id.01cadaaf43"
[0m20:49:32.426783 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.0 seconds
[0m20:49:32.428799 [debug] [Thread-1 (]: Timing info for test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d (execute): 20:49:32.325048 => 20:49:32.428486
[0m20:49:32.429319 [debug] [Thread-1 (]: On test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d: ROLLBACK
[0m20:49:32.429713 [debug] [Thread-3 (]: Using postgres connection "test.customer360.source_unique_salesforce_contacts_id.01cadaaf43"
[0m20:49:32.430220 [debug] [Thread-3 (]: On test.customer360.source_unique_salesforce_contacts_id.01cadaaf43: BEGIN
[0m20:49:32.430714 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m20:49:32.438530 [debug] [Thread-1 (]: On test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d: Close
[0m20:49:32.439721 [info ] [Thread-1 (]: 6 of 17 PASS source_not_null_salesforce_contacts_id ............................ [[32mPASS[0m in 0.13s]
[0m20:49:32.440532 [debug] [Thread-1 (]: Finished running node test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d
[0m20:49:32.441106 [debug] [Thread-1 (]: Began running node test.customer360.source_unique_web_transactions_id.ba28079761
[0m20:49:32.441775 [info ] [Thread-1 (]: 9 of 17 START test source_unique_web_transactions_id ........................... [RUN]
[0m20:49:32.442609 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d, now test.customer360.source_unique_web_transactions_id.ba28079761)
[0m20:49:32.443059 [debug] [Thread-1 (]: Began compiling node test.customer360.source_unique_web_transactions_id.ba28079761
[0m20:49:32.454720 [debug] [Thread-2 (]: SQL status: BEGIN in 0.0 seconds
[0m20:49:32.455313 [debug] [Thread-2 (]: Using postgres connection "test.customer360.source_not_null_web_transactions_id.88a47bf7e5"
[0m20:49:32.455819 [debug] [Thread-2 (]: On test.customer360.source_not_null_web_transactions_id.88a47bf7e5: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.source_not_null_web_transactions_id.88a47bf7e5"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select id
from "dbt"."public"."transactions"
where id is null



      
    ) dbt_internal_test
[0m20:49:32.457711 [debug] [Thread-1 (]: Writing injected SQL for node "test.customer360.source_unique_web_transactions_id.ba28079761"
[0m20:49:32.458492 [debug] [Thread-1 (]: Timing info for test.customer360.source_unique_web_transactions_id.ba28079761 (compile): 20:49:32.443342 => 20:49:32.458168
[0m20:49:32.459011 [debug] [Thread-1 (]: Began executing node test.customer360.source_unique_web_transactions_id.ba28079761
[0m20:49:32.466710 [debug] [Thread-1 (]: Writing runtime sql for node "test.customer360.source_unique_web_transactions_id.ba28079761"
[0m20:49:32.467459 [debug] [Thread-1 (]: Using postgres connection "test.customer360.source_unique_web_transactions_id.ba28079761"
[0m20:49:32.467970 [debug] [Thread-1 (]: On test.customer360.source_unique_web_transactions_id.ba28079761: BEGIN
[0m20:49:32.468472 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:49:32.470046 [debug] [Thread-3 (]: SQL status: BEGIN in 0.0 seconds
[0m20:49:32.470544 [debug] [Thread-3 (]: Using postgres connection "test.customer360.source_unique_salesforce_contacts_id.01cadaaf43"
[0m20:49:32.470992 [debug] [Thread-3 (]: On test.customer360.source_unique_salesforce_contacts_id.01cadaaf43: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.source_unique_salesforce_contacts_id.01cadaaf43"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

select
    id as unique_field,
    count(*) as n_records

from "dbt"."public"."contacts"
where id is not null
group by id
having count(*) > 1



      
    ) dbt_internal_test
[0m20:49:32.471549 [debug] [Thread-2 (]: SQL status: SELECT 1 in 0.0 seconds
[0m20:49:32.473393 [debug] [Thread-2 (]: Timing info for test.customer360.source_not_null_web_transactions_id.88a47bf7e5 (execute): 20:49:32.372150 => 20:49:32.473076
[0m20:49:32.473866 [debug] [Thread-2 (]: On test.customer360.source_not_null_web_transactions_id.88a47bf7e5: ROLLBACK
[0m20:49:32.477168 [debug] [Thread-3 (]: SQL status: SELECT 1 in 0.0 seconds
[0m20:49:32.479151 [debug] [Thread-3 (]: Timing info for test.customer360.source_unique_salesforce_contacts_id.01cadaaf43 (execute): 20:49:32.413637 => 20:49:32.478820
[0m20:49:32.479659 [debug] [Thread-3 (]: On test.customer360.source_unique_salesforce_contacts_id.01cadaaf43: ROLLBACK
[0m20:49:32.482855 [debug] [Thread-2 (]: On test.customer360.source_not_null_web_transactions_id.88a47bf7e5: Close
[0m20:49:32.484050 [info ] [Thread-2 (]: 7 of 17 PASS source_not_null_web_transactions_id ............................... [[32mPASS[0m in 0.13s]
[0m20:49:32.484807 [debug] [Thread-2 (]: Finished running node test.customer360.source_not_null_web_transactions_id.88a47bf7e5
[0m20:49:32.485387 [debug] [Thread-2 (]: Began running node test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344
[0m20:49:32.485896 [info ] [Thread-2 (]: 10 of 17 START test source_relationships_web_transactions_contact_id__id__ref_contacts_  [RUN]
[0m20:49:32.486948 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.customer360.source_not_null_web_transactions_id.88a47bf7e5, now test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344)
[0m20:49:32.487475 [debug] [Thread-2 (]: Began compiling node test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344
[0m20:49:32.501201 [debug] [Thread-3 (]: On test.customer360.source_unique_salesforce_contacts_id.01cadaaf43: Close
[0m20:49:32.502434 [info ] [Thread-3 (]: 8 of 17 PASS source_unique_salesforce_contacts_id .............................. [[32mPASS[0m in 0.11s]
[0m20:49:32.503162 [debug] [Thread-3 (]: Finished running node test.customer360.source_unique_salesforce_contacts_id.01cadaaf43
[0m20:49:32.503855 [debug] [Thread-3 (]: Began running node model.customer360.stg_sf__contacts
[0m20:49:32.504455 [info ] [Thread-3 (]: 11 of 17 START sql table model public.stg_sf__contacts ......................... [RUN]
[0m20:49:32.505276 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.customer360.source_unique_salesforce_contacts_id.01cadaaf43, now model.customer360.stg_sf__contacts)
[0m20:49:32.505778 [debug] [Thread-3 (]: Began compiling node model.customer360.stg_sf__contacts
[0m20:49:32.511511 [debug] [Thread-3 (]: Writing injected SQL for node "model.customer360.stg_sf__contacts"
[0m20:49:32.512613 [debug] [Thread-3 (]: Timing info for model.customer360.stg_sf__contacts (compile): 20:49:32.506071 => 20:49:32.511996
[0m20:49:32.513142 [debug] [Thread-3 (]: Began executing node model.customer360.stg_sf__contacts
[0m20:49:32.531982 [debug] [Thread-2 (]: Writing injected SQL for node "test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344"
[0m20:49:32.532897 [debug] [Thread-2 (]: Timing info for test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344 (compile): 20:49:32.487761 => 20:49:32.532565
[0m20:49:32.533444 [debug] [Thread-2 (]: Began executing node test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344
[0m20:49:32.537075 [debug] [Thread-2 (]: Writing runtime sql for node "test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344"
[0m20:49:32.537778 [debug] [Thread-2 (]: Using postgres connection "test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344"
[0m20:49:32.538285 [debug] [Thread-2 (]: On test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344: BEGIN
[0m20:49:32.538805 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m20:49:32.559594 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m20:49:32.560184 [debug] [Thread-1 (]: Using postgres connection "test.customer360.source_unique_web_transactions_id.ba28079761"
[0m20:49:32.560737 [debug] [Thread-1 (]: On test.customer360.source_unique_web_transactions_id.ba28079761: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.source_unique_web_transactions_id.ba28079761"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

select
    id as unique_field,
    count(*) as n_records

from "dbt"."public"."transactions"
where id is not null
group by id
having count(*) > 1



      
    ) dbt_internal_test
[0m20:49:32.588942 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.0 seconds
[0m20:49:32.591009 [debug] [Thread-1 (]: Timing info for test.customer360.source_unique_web_transactions_id.ba28079761 (execute): 20:49:32.463638 => 20:49:32.590679
[0m20:49:32.591547 [debug] [Thread-1 (]: On test.customer360.source_unique_web_transactions_id.ba28079761: ROLLBACK
[0m20:49:32.614654 [debug] [Thread-1 (]: On test.customer360.source_unique_web_transactions_id.ba28079761: Close
[0m20:49:32.615905 [info ] [Thread-1 (]: 9 of 17 PASS source_unique_web_transactions_id ................................. [[32mPASS[0m in 0.17s]
[0m20:49:32.616694 [debug] [Thread-1 (]: Finished running node test.customer360.source_unique_web_transactions_id.ba28079761
[0m20:49:32.617261 [debug] [Thread-2 (]: SQL status: BEGIN in 0.0 seconds
[0m20:49:32.617803 [debug] [Thread-2 (]: Using postgres connection "test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344"
[0m20:49:32.618373 [debug] [Thread-2 (]: On test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

with child as (
    select contact_id as from_field
    from "dbt"."public"."transactions"
    where contact_id is not null
),

parent as (
    select id as to_field
    from "dbt"."public"."contacts"
)

select
    from_field

from child
left join parent
    on child.from_field = parent.to_field

where parent.to_field is null



      
    ) dbt_internal_test
[0m20:49:32.619281 [debug] [Thread-1 (]: Began running node model.customer360.stg_web__transactions
[0m20:49:32.619910 [info ] [Thread-1 (]: 12 of 17 START sql table model public.stg_web__transactions .................... [RUN]
[0m20:49:32.620791 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.customer360.source_unique_web_transactions_id.ba28079761, now model.customer360.stg_web__transactions)
[0m20:49:32.621312 [debug] [Thread-1 (]: Began compiling node model.customer360.stg_web__transactions
[0m20:49:32.625658 [debug] [Thread-1 (]: Writing injected SQL for node "model.customer360.stg_web__transactions"
[0m20:49:32.626461 [debug] [Thread-1 (]: Timing info for model.customer360.stg_web__transactions (compile): 20:49:32.621625 => 20:49:32.626152
[0m20:49:32.626970 [debug] [Thread-1 (]: Began executing node model.customer360.stg_web__transactions
[0m20:49:32.652262 [debug] [Thread-2 (]: SQL status: SELECT 1 in 0.0 seconds
[0m20:49:32.653941 [debug] [Thread-2 (]: Timing info for test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344 (execute): 20:49:32.533760 => 20:49:32.653702
[0m20:49:32.654389 [debug] [Thread-2 (]: On test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344: ROLLBACK
[0m20:49:32.666428 [debug] [Thread-2 (]: On test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344: Close
[0m20:49:32.667582 [info ] [Thread-2 (]: 10 of 17 PASS source_relationships_web_transactions_contact_id__id__ref_contacts_  [[32mPASS[0m in 0.18s]
[0m20:49:32.668289 [debug] [Thread-2 (]: Finished running node test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344
[0m20:49:32.674609 [debug] [Thread-1 (]: Writing runtime sql for node "model.customer360.stg_web__transactions"
[0m20:49:32.675282 [debug] [Thread-1 (]: Using postgres connection "model.customer360.stg_web__transactions"
[0m20:49:32.675782 [debug] [Thread-1 (]: On model.customer360.stg_web__transactions: BEGIN
[0m20:49:32.676235 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:49:32.677539 [debug] [Thread-3 (]: Writing runtime sql for node "model.customer360.stg_sf__contacts"
[0m20:49:32.678156 [debug] [Thread-3 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m20:49:32.678631 [debug] [Thread-3 (]: On model.customer360.stg_sf__contacts: BEGIN
[0m20:49:32.679094 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m20:49:32.683431 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m20:49:32.684006 [debug] [Thread-1 (]: Using postgres connection "model.customer360.stg_web__transactions"
[0m20:49:32.684627 [debug] [Thread-1 (]: On model.customer360.stg_web__transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_web__transactions"} */

  
    

  create  table "dbt"."public"."stg_web__transactions__dbt_tmp"
  
  
    as
  
  (
    with source as (
    select * from "dbt"."public"."transactions"
),

renamed as (
    select
        id,
        contact_id,
        
        to_timestamp(transaction_date,'YYYY-MM-DD HH24:MI:SS.MS') :: timestamp at TIME zone 'UTC'
     as transaction_date,
        amount,
        item_count,
        category, 
        _loaded_at_utc
    from source    
),

clean_older as (
    select * from renamed 
--    where transaction_date >= (current_date - 1)  过滤超过1天的数据
--    where transaction_date >= (to_date('2023-04-12','yyyy-MM-dd') - 1)  --测试用,假设跑数日期为2023-04-12
--    and transaction_date < to_date('2023-04-12','yyyy-MM-dd')
)

select * from clean_older
  );
  
[0m20:49:32.688489 [debug] [Thread-3 (]: SQL status: BEGIN in 0.0 seconds
[0m20:49:32.689029 [debug] [Thread-3 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m20:49:32.689577 [debug] [Thread-3 (]: On model.customer360.stg_sf__contacts: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_sf__contacts"} */

  
    

  create  table "dbt"."public"."stg_sf__contacts__dbt_tmp"
  
  
    as
  
  (
    with source as (
    select * from "dbt"."public"."contacts"
),

renamed as (
    select
        id,
        username as user_name,
        name,
        gender,
        address, 
        mail as email_address,
        birthdate as birth_date,
        _loaded_at_utc
    from source     
)

select * from renamed
  );
  
[0m20:49:32.695601 [debug] [Thread-3 (]: SQL status: SELECT 10 in 0.0 seconds
[0m20:49:32.705280 [debug] [Thread-3 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m20:49:32.705840 [debug] [Thread-3 (]: On model.customer360.stg_sf__contacts: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_sf__contacts"} */
alter table "dbt"."public"."stg_sf__contacts" rename to "stg_sf__contacts__dbt_backup"
[0m20:49:32.706943 [debug] [Thread-1 (]: SQL status: SELECT 100 in 0.0 seconds
[0m20:49:32.711392 [debug] [Thread-1 (]: Using postgres connection "model.customer360.stg_web__transactions"
[0m20:49:32.711926 [debug] [Thread-1 (]: On model.customer360.stg_web__transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_web__transactions"} */
alter table "dbt"."public"."stg_web__transactions" rename to "stg_web__transactions__dbt_backup"
[0m20:49:32.712548 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m20:49:32.716681 [debug] [Thread-3 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m20:49:32.717195 [debug] [Thread-3 (]: On model.customer360.stg_sf__contacts: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_sf__contacts"} */
alter table "dbt"."public"."stg_sf__contacts__dbt_tmp" rename to "stg_sf__contacts"
[0m20:49:32.718508 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m20:49:32.722890 [debug] [Thread-1 (]: Using postgres connection "model.customer360.stg_web__transactions"
[0m20:49:32.723527 [debug] [Thread-1 (]: On model.customer360.stg_web__transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_web__transactions"} */
alter table "dbt"."public"."stg_web__transactions__dbt_tmp" rename to "stg_web__transactions"
[0m20:49:32.724745 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m20:49:32.734698 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m20:49:32.738877 [debug] [Thread-3 (]: On model.customer360.stg_sf__contacts: COMMIT
[0m20:49:32.739420 [debug] [Thread-3 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m20:49:32.739944 [debug] [Thread-3 (]: On model.customer360.stg_sf__contacts: COMMIT
[0m20:49:32.741776 [debug] [Thread-1 (]: On model.customer360.stg_web__transactions: COMMIT
[0m20:49:32.742337 [debug] [Thread-1 (]: Using postgres connection "model.customer360.stg_web__transactions"
[0m20:49:32.742825 [debug] [Thread-1 (]: On model.customer360.stg_web__transactions: COMMIT
[0m20:49:32.743696 [debug] [Thread-3 (]: SQL status: COMMIT in 0.0 seconds
[0m20:49:32.753071 [debug] [Thread-3 (]: Applying DROP to: "dbt"."public"."stg_sf__contacts__dbt_backup"
[0m20:49:32.760350 [debug] [Thread-3 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m20:49:32.760914 [debug] [Thread-3 (]: On model.customer360.stg_sf__contacts: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_sf__contacts"} */
drop table if exists "dbt"."public"."stg_sf__contacts__dbt_backup" cascade
[0m20:49:32.761579 [debug] [Thread-1 (]: SQL status: COMMIT in 0.0 seconds
[0m20:49:32.767105 [debug] [Thread-1 (]: Applying DROP to: "dbt"."public"."stg_web__transactions__dbt_backup"
[0m20:49:32.768382 [debug] [Thread-1 (]: Using postgres connection "model.customer360.stg_web__transactions"
[0m20:49:32.768935 [debug] [Thread-1 (]: On model.customer360.stg_web__transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_web__transactions"} */
drop table if exists "dbt"."public"."stg_web__transactions__dbt_backup" cascade
[0m20:49:32.770562 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.0 seconds
[0m20:49:32.772625 [debug] [Thread-3 (]: Timing info for model.customer360.stg_sf__contacts (execute): 20:49:32.513459 => 20:49:32.772245
[0m20:49:32.773149 [debug] [Thread-3 (]: On model.customer360.stg_sf__contacts: Close
[0m20:49:32.774185 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8246aa2d-13bb-4dc1-bbec-ead3eb1749a8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f44f6cb6410>]}
[0m20:49:32.776535 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.0 seconds
[0m20:49:32.778684 [debug] [Thread-1 (]: Timing info for model.customer360.stg_web__transactions (execute): 20:49:32.627273 => 20:49:32.778177
[0m20:49:32.779254 [debug] [Thread-1 (]: On model.customer360.stg_web__transactions: Close
[0m20:49:32.780232 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8246aa2d-13bb-4dc1-bbec-ead3eb1749a8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f44f65d8a10>]}
[0m20:49:32.774980 [info ] [Thread-3 (]: 11 of 17 OK created sql table model public.stg_sf__contacts .................... [[32mSELECT 10[0m in 0.27s]
[0m20:49:32.781857 [debug] [Thread-3 (]: Finished running node model.customer360.stg_sf__contacts
[0m20:49:32.781006 [info ] [Thread-1 (]: 12 of 17 OK created sql table model public.stg_web__transactions ............... [[32mSELECT 100[0m in 0.16s]
[0m20:49:32.782771 [debug] [Thread-1 (]: Finished running node model.customer360.stg_web__transactions
[0m20:49:32.786052 [debug] [Thread-2 (]: Began running node model.customer360.contacts_joined_with_transactions
[0m20:49:32.786692 [info ] [Thread-2 (]: 13 of 17 START sql view model public.contacts_joined_with_transactions ......... [RUN]
[0m20:49:32.787649 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344, now model.customer360.contacts_joined_with_transactions)
[0m20:49:32.788237 [debug] [Thread-2 (]: Began compiling node model.customer360.contacts_joined_with_transactions
[0m20:49:32.793082 [debug] [Thread-2 (]: Writing injected SQL for node "model.customer360.contacts_joined_with_transactions"
[0m20:49:32.793904 [debug] [Thread-2 (]: Timing info for model.customer360.contacts_joined_with_transactions (compile): 20:49:32.788652 => 20:49:32.793606
[0m20:49:32.794841 [debug] [Thread-2 (]: Began executing node model.customer360.contacts_joined_with_transactions
[0m20:49:32.804668 [debug] [Thread-3 (]: Began running node model.customer360.sales_month_report
[0m20:49:32.805465 [info ] [Thread-3 (]: 14 of 17 START sql table model public.sales_month_report ....................... [RUN]
[0m20:49:32.806584 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.customer360.stg_sf__contacts, now model.customer360.sales_month_report)
[0m20:49:32.807078 [debug] [Thread-3 (]: Began compiling node model.customer360.sales_month_report
[0m20:49:32.811395 [debug] [Thread-3 (]: Writing injected SQL for node "model.customer360.sales_month_report"
[0m20:49:32.812245 [debug] [Thread-3 (]: Timing info for model.customer360.sales_month_report (compile): 20:49:32.807441 => 20:49:32.811943
[0m20:49:32.812785 [debug] [Thread-3 (]: Began executing node model.customer360.sales_month_report
[0m20:49:32.821525 [debug] [Thread-3 (]: Writing runtime sql for node "model.customer360.sales_month_report"
[0m20:49:32.822509 [debug] [Thread-3 (]: Using postgres connection "model.customer360.sales_month_report"
[0m20:49:32.823018 [debug] [Thread-3 (]: On model.customer360.sales_month_report: BEGIN
[0m20:49:32.823468 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m20:49:32.837313 [debug] [Thread-2 (]: Writing runtime sql for node "model.customer360.contacts_joined_with_transactions"
[0m20:49:32.837945 [debug] [Thread-3 (]: SQL status: BEGIN in 0.0 seconds
[0m20:49:32.838337 [debug] [Thread-3 (]: Using postgres connection "model.customer360.sales_month_report"
[0m20:49:32.838802 [debug] [Thread-3 (]: On model.customer360.sales_month_report: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.sales_month_report"} */

  
    

  create  table "dbt"."public"."sales_month_report__dbt_tmp"
  
  
    as
  
  (
    SELECT
     count(id)                                  as total_count
    ,cast(count(id) / 31 as decimal(24,2))      as day_avg_count
    ,sum(case when category = 'Apps & Games'                    then 1 else 0 end)   as apps_games_count
    ,sum(case when category = 'Beauty'                          then 1 else 0 end)   as beauty_count
    ,sum(case when category = 'Books'                           then 1 else 0 end)   as books_count
    ,sum(case when category = 'Clothing, Shoes & Accessories'   then 1 else 0 end)   as clothing_shoes_accessories_count
    ,sum(case when category = 'Movies & TV'                     then 1 else 0 end)   as movies_tv_count
    ,sum(case when category = 'Sports, Fitness & Outdoors'      then 1 else 0 end)   as sports_fitness_outdoors_count

    ,sum(amount) as total_expense
    ,cast(sum(amount) / 31 as decimal(24,4))    as day_avg_amount
    ,sum(case when category = 'Apps & Games'                    then amount else 0 end)   as apps_games_amount
    ,sum(case when category = 'Beauty'                          then amount else 0 end)   as beauty_amount
    ,sum(case when category = 'Books'                           then amount else 0 end)   as books_amount
    ,sum(case when category = 'Clothing, Shoes & Accessories'   then amount else 0 end)   as clothing_shoes_accessories_amount
    ,sum(case when category = 'Movies & TV'                     then amount else 0 end)   as movies_tv_amount
    ,sum(case when category = 'Sports, Fitness & Outdoors'      then amount else 0 end)   as sports_fitness_outdoors_amount
FROM  "dbt"."public"."stg_web__transactions"
where transaction_date between '2023-05-01' and '2023-05-31'  -- 样例，实际脚本可改成传参
  );
  
[0m20:49:32.839500 [debug] [Thread-2 (]: Using postgres connection "model.customer360.contacts_joined_with_transactions"
[0m20:49:32.839986 [debug] [Thread-2 (]: On model.customer360.contacts_joined_with_transactions: BEGIN
[0m20:49:32.840537 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m20:49:32.844954 [debug] [Thread-3 (]: SQL status: SELECT 1 in 0.0 seconds
[0m20:49:32.848992 [debug] [Thread-3 (]: Using postgres connection "model.customer360.sales_month_report"
[0m20:49:32.849415 [debug] [Thread-3 (]: On model.customer360.sales_month_report: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.sales_month_report"} */
alter table "dbt"."public"."sales_month_report__dbt_tmp" rename to "sales_month_report"
[0m20:49:32.850822 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m20:49:32.853543 [debug] [Thread-3 (]: On model.customer360.sales_month_report: COMMIT
[0m20:49:32.854005 [debug] [Thread-3 (]: Using postgres connection "model.customer360.sales_month_report"
[0m20:49:32.854875 [debug] [Thread-3 (]: On model.customer360.sales_month_report: COMMIT
[0m20:49:32.856499 [debug] [Thread-3 (]: SQL status: COMMIT in 0.0 seconds
[0m20:49:32.860134 [debug] [Thread-3 (]: Applying DROP to: "dbt"."public"."sales_month_report__dbt_backup"
[0m20:49:32.861657 [debug] [Thread-3 (]: Using postgres connection "model.customer360.sales_month_report"
[0m20:49:32.862176 [debug] [Thread-3 (]: On model.customer360.sales_month_report: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.sales_month_report"} */
drop table if exists "dbt"."public"."sales_month_report__dbt_backup" cascade
[0m20:49:32.863091 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.0 seconds
[0m20:49:32.865163 [debug] [Thread-3 (]: Timing info for model.customer360.sales_month_report (execute): 20:49:32.813080 => 20:49:32.864772
[0m20:49:32.865738 [debug] [Thread-3 (]: On model.customer360.sales_month_report: Close
[0m20:49:32.866755 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8246aa2d-13bb-4dc1-bbec-ead3eb1749a8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f44f6a87dd0>]}
[0m20:49:32.869739 [info ] [Thread-3 (]: 14 of 17 OK created sql table model public.sales_month_report .................. [[32mSELECT 1[0m in 0.06s]
[0m20:49:32.870580 [debug] [Thread-3 (]: Finished running node model.customer360.sales_month_report
[0m20:49:32.871193 [debug] [Thread-2 (]: SQL status: BEGIN in 0.0 seconds
[0m20:49:32.871752 [debug] [Thread-2 (]: Using postgres connection "model.customer360.contacts_joined_with_transactions"
[0m20:49:32.872327 [debug] [Thread-2 (]: On model.customer360.contacts_joined_with_transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.contacts_joined_with_transactions"} */

  create view "dbt"."public"."contacts_joined_with_transactions__dbt_tmp"
    
    
  as (
    SELECT 
    contacts.*,
    transactions.id as transaction_id,
    transactions.transaction_date,
    transactions.amount,
    transactions.item_count,
    transactions.category
FROM "dbt"."public"."stg_web__transactions" as transactions
LEFT JOIN "dbt"."public"."stg_sf__contacts" as contacts ON contacts.id = transactions.contact_id
  );
[0m20:49:32.875943 [debug] [Thread-2 (]: SQL status: CREATE VIEW in 0.0 seconds
[0m20:49:32.880548 [debug] [Thread-2 (]: Using postgres connection "model.customer360.contacts_joined_with_transactions"
[0m20:49:32.881128 [debug] [Thread-2 (]: On model.customer360.contacts_joined_with_transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.contacts_joined_with_transactions"} */
alter table "dbt"."public"."contacts_joined_with_transactions__dbt_tmp" rename to "contacts_joined_with_transactions"
[0m20:49:32.882204 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m20:49:32.884718 [debug] [Thread-2 (]: On model.customer360.contacts_joined_with_transactions: COMMIT
[0m20:49:32.885269 [debug] [Thread-2 (]: Using postgres connection "model.customer360.contacts_joined_with_transactions"
[0m20:49:32.885775 [debug] [Thread-2 (]: On model.customer360.contacts_joined_with_transactions: COMMIT
[0m20:49:32.887464 [debug] [Thread-2 (]: SQL status: COMMIT in 0.0 seconds
[0m20:49:32.891204 [debug] [Thread-2 (]: Applying DROP to: "dbt"."public"."contacts_joined_with_transactions__dbt_backup"
[0m20:49:32.895481 [debug] [Thread-2 (]: Using postgres connection "model.customer360.contacts_joined_with_transactions"
[0m20:49:32.896014 [debug] [Thread-2 (]: On model.customer360.contacts_joined_with_transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.contacts_joined_with_transactions"} */
drop view if exists "dbt"."public"."contacts_joined_with_transactions__dbt_backup" cascade
[0m20:49:32.896998 [debug] [Thread-2 (]: SQL status: DROP VIEW in 0.0 seconds
[0m20:49:32.898957 [debug] [Thread-2 (]: Timing info for model.customer360.contacts_joined_with_transactions (execute): 20:49:32.795195 => 20:49:32.898648
[0m20:49:32.899543 [debug] [Thread-2 (]: On model.customer360.contacts_joined_with_transactions: Close
[0m20:49:32.900704 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8246aa2d-13bb-4dc1-bbec-ead3eb1749a8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f44f6c3c110>]}
[0m20:49:32.903507 [info ] [Thread-2 (]: 13 of 17 OK created sql view model public.contacts_joined_with_transactions .... [[32mCREATE VIEW[0m in 0.11s]
[0m20:49:32.904351 [debug] [Thread-2 (]: Finished running node model.customer360.contacts_joined_with_transactions
[0m20:49:32.905334 [debug] [Thread-1 (]: Began running node test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311
[0m20:49:32.905907 [info ] [Thread-1 (]: 15 of 17 START test not_null_contacts_joined_with_transactions_id .............. [RUN]
[0m20:49:32.906867 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.customer360.stg_web__transactions, now test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311)
[0m20:49:32.907642 [debug] [Thread-1 (]: Began compiling node test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311
[0m20:49:32.914130 [debug] [Thread-1 (]: Writing injected SQL for node "test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311"
[0m20:49:32.915000 [debug] [Thread-1 (]: Timing info for test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311 (compile): 20:49:32.907965 => 20:49:32.914646
[0m20:49:32.915536 [debug] [Thread-1 (]: Began executing node test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311
[0m20:49:32.919201 [debug] [Thread-1 (]: Writing runtime sql for node "test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311"
[0m20:49:32.919919 [debug] [Thread-1 (]: Using postgres connection "test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311"
[0m20:49:32.920440 [debug] [Thread-1 (]: On test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311: BEGIN
[0m20:49:32.920963 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:49:32.926219 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m20:49:32.926811 [debug] [Thread-1 (]: Using postgres connection "test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311"
[0m20:49:32.927428 [debug] [Thread-1 (]: On test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select id
from "dbt"."public"."contacts_joined_with_transactions"
where id is null



      
    ) dbt_internal_test
[0m20:49:32.929683 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.0 seconds
[0m20:49:32.931934 [debug] [Thread-1 (]: Timing info for test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311 (execute): 20:49:32.916050 => 20:49:32.931631
[0m20:49:32.932525 [debug] [Thread-1 (]: On test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311: ROLLBACK
[0m20:49:32.933256 [debug] [Thread-1 (]: On test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311: Close
[0m20:49:32.934446 [info ] [Thread-1 (]: 15 of 17 PASS not_null_contacts_joined_with_transactions_id .................... [[32mPASS[0m in 0.03s]
[0m20:49:32.935278 [debug] [Thread-1 (]: Finished running node test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311
[0m20:49:32.936216 [debug] [Thread-2 (]: Began running node model.customer360.customers
[0m20:49:32.936843 [info ] [Thread-2 (]: 16 of 17 START sql table model public.customers ................................ [RUN]
[0m20:49:32.937752 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.customer360.contacts_joined_with_transactions, now model.customer360.customers)
[0m20:49:32.938290 [debug] [Thread-2 (]: Began compiling node model.customer360.customers
[0m20:49:32.944803 [debug] [Thread-2 (]: Writing injected SQL for node "model.customer360.customers"
[0m20:49:32.945633 [debug] [Thread-2 (]: Timing info for model.customer360.customers (compile): 20:49:32.940722 => 20:49:32.945288
[0m20:49:32.946143 [debug] [Thread-2 (]: Began executing node model.customer360.customers
[0m20:49:32.952794 [debug] [Thread-2 (]: Writing runtime sql for node "model.customer360.customers"
[0m20:49:32.954034 [debug] [Thread-2 (]: Using postgres connection "model.customer360.customers"
[0m20:49:32.954592 [debug] [Thread-2 (]: On model.customer360.customers: BEGIN
[0m20:49:32.955050 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m20:49:32.959946 [debug] [Thread-2 (]: SQL status: BEGIN in 0.0 seconds
[0m20:49:32.960550 [debug] [Thread-2 (]: Using postgres connection "model.customer360.customers"
[0m20:49:32.961184 [debug] [Thread-2 (]: On model.customer360.customers: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.customers"} */

  
    

  create  table "dbt"."public"."customers__dbt_tmp"
  
  
    as
  
  (
    SELECT
    id,
    gender,
    
    date_part('year', age(current_date, birth_date))
 AS age,
    sum(amount) as total_expense,
    date(min(transaction_date)) as first_purchase_date,
    date(max(transaction_date)) as last_purchase_date,
    sum(case when category = 'Apps & Games' then amount else 0 end) as apps_games_amount,
    sum(case when category = 'Beauty' then amount else 0 end)   as beauty_amount,
    sum(case when category = 'Books' then amount else 0 end)   as books_amount,
    sum(case when category = 'Clothing, Shoes & Accessories' then amount else 0 end)   as clothing_shoes_accessories_amount,
    sum(case when category = 'Movies & TV' then amount else 0 end)   as movies_tv_amount,
    sum(case when category = 'Sports, Fitness & Outdoors' then amount else 0 end)   as sports_fitness_outdoors_amount
FROM  "dbt"."public"."contacts_joined_with_transactions"
GROUP BY
    1,2,3
  );
  
[0m20:49:32.973450 [debug] [Thread-2 (]: SQL status: SELECT 9 in 0.0 seconds
[0m20:49:32.978648 [debug] [Thread-2 (]: Using postgres connection "model.customer360.customers"
[0m20:49:32.979223 [debug] [Thread-2 (]: On model.customer360.customers: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.customers"} */
alter table "dbt"."public"."customers" rename to "customers__dbt_backup"
[0m20:49:32.980237 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m20:49:32.984876 [debug] [Thread-2 (]: Using postgres connection "model.customer360.customers"
[0m20:49:32.985444 [debug] [Thread-2 (]: On model.customer360.customers: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.customers"} */
alter table "dbt"."public"."customers__dbt_tmp" rename to "customers"
[0m20:49:32.988572 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m20:49:32.991625 [debug] [Thread-2 (]: On model.customer360.customers: COMMIT
[0m20:49:32.992097 [debug] [Thread-2 (]: Using postgres connection "model.customer360.customers"
[0m20:49:32.992649 [debug] [Thread-2 (]: On model.customer360.customers: COMMIT
[0m20:49:32.994481 [debug] [Thread-2 (]: SQL status: COMMIT in 0.0 seconds
[0m20:49:32.998185 [debug] [Thread-2 (]: Applying DROP to: "dbt"."public"."customers__dbt_backup"
[0m20:49:32.999418 [debug] [Thread-2 (]: Using postgres connection "model.customer360.customers"
[0m20:49:32.999963 [debug] [Thread-2 (]: On model.customer360.customers: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.customers"} */
drop table if exists "dbt"."public"."customers__dbt_backup" cascade
[0m20:49:33.002869 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.0 seconds
[0m20:49:33.004838 [debug] [Thread-2 (]: Timing info for model.customer360.customers (execute): 20:49:32.946486 => 20:49:33.004497
[0m20:49:33.005379 [debug] [Thread-2 (]: On model.customer360.customers: Close
[0m20:49:33.006396 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8246aa2d-13bb-4dc1-bbec-ead3eb1749a8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f44f65e88d0>]}
[0m20:49:33.007164 [info ] [Thread-2 (]: 16 of 17 OK created sql table model public.customers ........................... [[32mSELECT 9[0m in 0.07s]
[0m20:49:33.010234 [debug] [Thread-2 (]: Finished running node model.customer360.customers
[0m20:49:33.011954 [debug] [Thread-1 (]: Began running node test.customer360.custormers_test
[0m20:49:33.012499 [info ] [Thread-1 (]: 17 of 17 START test custormers_test ............................................ [RUN]
[0m20:49:33.013519 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311, now test.customer360.custormers_test)
[0m20:49:33.014061 [debug] [Thread-1 (]: Began compiling node test.customer360.custormers_test
[0m20:49:33.020833 [debug] [Thread-1 (]: Writing injected SQL for node "test.customer360.custormers_test"
[0m20:49:33.021733 [debug] [Thread-1 (]: Timing info for test.customer360.custormers_test (compile): 20:49:33.014418 => 20:49:33.021450
[0m20:49:33.022290 [debug] [Thread-1 (]: Began executing node test.customer360.custormers_test
[0m20:49:33.028350 [debug] [Thread-1 (]: Writing runtime sql for node "test.customer360.custormers_test"
[0m20:49:33.029050 [debug] [Thread-1 (]: Using postgres connection "test.customer360.custormers_test"
[0m20:49:33.029612 [debug] [Thread-1 (]: On test.customer360.custormers_test: BEGIN
[0m20:49:33.030081 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:49:33.035805 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m20:49:33.036423 [debug] [Thread-1 (]: Using postgres connection "test.customer360.custormers_test"
[0m20:49:33.037105 [debug] [Thread-1 (]: On test.customer360.custormers_test: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.custormers_test"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      select
    1
from
(
    SELECT
        sum(total_expense) as total_expense,
        date(min(first_purchase_date)) as first_purchase_date,
        date(max(last_purchase_date)) as last_purchase_date,
        sum(apps_games_amount) as apps_games_amount,
        sum(beauty_amount)   as beauty_amount,
        sum(books_amount)   as books_amount,
        sum(clothing_shoes_accessories_amount)   as clothing_shoes_accessories_amount,
        sum(movies_tv_amount)   as movies_tv_amount,
        sum(sports_fitness_outdoors_amount)   as sports_fitness_outdoors_amount
    FROM  "dbt"."public"."customers"
) t1
join (
    SELECT
        sum(amount) as total_expense,
        date(min(transaction_date)) as first_purchase_date,
        date(max(transaction_date)) as last_purchase_date,
        sum(case when category = 'Apps & Games' then amount else 0 end) as apps_games_amount,
        sum(case when category = 'Beauty' then amount else 0 end)   as beauty_amount,
        sum(case when category = 'Books' then amount else 0 end)   as books_amount,
        sum(case when category = 'Clothing, Shoes & Accessories' then amount else 0 end)   as clothing_shoes_accessories_amount,
        sum(case when category = 'Movies & TV' then amount else 0 end)   as movies_tv_amount,
        sum(case when category = 'Sports, Fitness & Outdoors' then amount else 0 end)   as sports_fitness_outdoors_amount
    FROM  "dbt"."public"."contacts_joined_with_transactions"
) t2
on 1 = 1
where (
     nullif(cast(t1.total_expense as decimal(15,1))                   ,0)  <> nullif(cast(t2.total_expense                      as decimal(15,1)) ,0)
  or nullif(t1.first_purchase_date               ,'9999-12-31')       <> nullif(t2.first_purchase_date               ,'9999-12-31')
  or nullif(t1.last_purchase_date               ,'9999-12-31')        <> nullif(t2.last_purchase_date               ,'9999-12-31')
  or nullif(cast(t1.apps_games_amount                 as decimal(15,1)),0) <> nullif(cast(t2.apps_games_amount                 as decimal(15,1)) ,0)
  or nullif(cast(t1.beauty_amount                     as decimal(15,1)),0) <> nullif(cast(t2.beauty_amount                     as decimal(15,1)) ,0)
  or nullif(cast(t1.books_amount                      as decimal(15,1)),0) <> nullif(cast(t2.books_amount                      as decimal(15,1)) ,0)
  or nullif(cast(t1.clothing_shoes_accessories_amount as decimal(15,1)),0) <> nullif(cast(t2.clothing_shoes_accessories_amount as decimal(15,1)) ,0)
  or nullif(cast(t1.movies_tv_amount                  as decimal(15,1)),0) <> nullif(cast(t2.movies_tv_amount                  as decimal(15,1)) ,0)
  or nullif(cast(t1.sports_fitness_outdoors_amount    as decimal(15,1)),0) <> nullif(cast(t2.sports_fitness_outdoors_amount    as decimal(15,1)) ,0)
)
      
    ) dbt_internal_test
[0m20:49:33.041430 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.0 seconds
[0m20:49:33.043561 [debug] [Thread-1 (]: Timing info for test.customer360.custormers_test (execute): 20:49:33.022605 => 20:49:33.043191
[0m20:49:33.044056 [debug] [Thread-1 (]: On test.customer360.custormers_test: ROLLBACK
[0m20:49:33.044832 [debug] [Thread-1 (]: On test.customer360.custormers_test: Close
[0m20:49:33.045932 [info ] [Thread-1 (]: 17 of 17 PASS custormers_test .................................................. [[32mPASS[0m in 0.03s]
[0m20:49:33.046743 [debug] [Thread-1 (]: Finished running node test.customer360.custormers_test
[0m20:49:33.051103 [debug] [MainThread]: Using postgres connection "master"
[0m20:49:33.051604 [debug] [MainThread]: On master: BEGIN
[0m20:49:33.052028 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m20:49:33.084858 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m20:49:33.085419 [debug] [MainThread]: On master: COMMIT
[0m20:49:33.085892 [debug] [MainThread]: Using postgres connection "master"
[0m20:49:33.086345 [debug] [MainThread]: On master: COMMIT
[0m20:49:33.089690 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m20:49:33.090137 [debug] [MainThread]: On master: Close
[0m20:49:33.091085 [debug] [MainThread]: Connection 'master' was properly closed.
[0m20:49:33.091520 [debug] [MainThread]: Connection 'test.customer360.custormers_test' was properly closed.
[0m20:49:33.091963 [debug] [MainThread]: Connection 'model.customer360.customers' was properly closed.
[0m20:49:33.094169 [debug] [MainThread]: Connection 'model.customer360.sales_month_report' was properly closed.
[0m20:49:33.094785 [info ] [MainThread]: 
[0m20:49:33.095271 [info ] [MainThread]: Finished running 10 tests, 2 seeds, 4 table models, 1 view model in 0 hours 0 minutes and 1.46 seconds (1.46s).
[0m20:49:33.102839 [debug] [MainThread]: Command end result
[0m20:49:33.126482 [info ] [MainThread]: 
[0m20:49:33.127041 [info ] [MainThread]: [32mCompleted successfully[0m
[0m20:49:33.127522 [info ] [MainThread]: 
[0m20:49:33.127954 [info ] [MainThread]: Done. PASS=17 WARN=0 ERROR=0 SKIP=0 TOTAL=17
[0m20:49:33.133744 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 2.316462, "process_user_time": 3.934816, "process_kernel_time": 0.117648, "process_mem_max_rss": "115612", "process_out_blocks": "3032", "process_in_blocks": "0"}
[0m20:49:33.134437 [debug] [MainThread]: Command `dbt build` succeeded at 20:49:33.134242 after 2.32 seconds
[0m20:49:33.135062 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f44f8d73910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f44f8c10a10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f44f6d41790>]}
[0m20:49:33.135595 [debug] [MainThread]: Flushing usage events
[0m10:15:16.014805 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4b8f77ac50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4b8f7810d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4b8f783090>]}


============================== 10:15:16.017501 | 990ca00d-1d64-425d-8476-0c248d2f5417 ==============================
[0m10:15:16.017501 [info ] [MainThread]: Running with dbt=1.7.8
[0m10:15:16.018000 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/root/option1-customer360/integration_tests', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/root/option1-customer360/integration_tests/logs', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'target_path': 'None', 'invocation_command': 'dbt build', 'send_anonymous_usage_stats': 'True'}
[0m10:15:16.178708 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '990ca00d-1d64-425d-8476-0c248d2f5417', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4b8f6a69d0>]}
[0m10:15:16.261822 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '990ca00d-1d64-425d-8476-0c248d2f5417', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4b8f6a5d50>]}
[0m10:15:16.262600 [info ] [MainThread]: Registered adapter: postgres=1.7.8
[0m10:15:16.274631 [debug] [MainThread]: checksum: 67f0013ca5f0bd43af9a0873dd50792fde83ef69de63b71cacd0b4ac656c52e5, vars: {}, profile: , target: , version: 1.7.8
[0m10:15:16.297421 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 2 files added, 0 files changed.
[0m10:15:16.298014 [debug] [MainThread]: Partial parsing: added file: customer360://models/recommend/_recommend__models.yml
[0m10:15:16.298372 [debug] [MainThread]: Partial parsing: added file: customer360://models/recommend/top3_hot_categorys.sql
[0m10:15:16.554444 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '990ca00d-1d64-425d-8476-0c248d2f5417', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4b8d4a2010>]}
[0m10:15:16.564869 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '990ca00d-1d64-425d-8476-0c248d2f5417', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4b8da962d0>]}
[0m10:15:16.565371 [info ] [MainThread]: Found 2 seeds, 6 models, 12 tests, 2 sources, 0 exposures, 0 metrics, 403 macros, 0 groups, 0 semantic models
[0m10:15:16.567665 [info ] [MainThread]: 
[0m10:15:16.568445 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m10:15:16.569714 [debug] [ThreadPool]: Acquiring new postgres connection 'list_dbt'
[0m10:15:16.579454 [debug] [ThreadPool]: Using postgres connection "list_dbt"
[0m10:15:16.579753 [debug] [ThreadPool]: On list_dbt: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "connection_name": "list_dbt"} */

    select distinct nspname from pg_namespace
  
[0m10:15:16.580092 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:15:16.585020 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.0 seconds
[0m10:15:16.586236 [debug] [ThreadPool]: On list_dbt: Close
[0m10:15:16.589204 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dbt, now list_dbt_public)
[0m10:15:16.595161 [debug] [ThreadPool]: Using postgres connection "list_dbt_public"
[0m10:15:16.595489 [debug] [ThreadPool]: On list_dbt_public: BEGIN
[0m10:15:16.595774 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:15:16.599026 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m10:15:16.599366 [debug] [ThreadPool]: Using postgres connection "list_dbt_public"
[0m10:15:16.599736 [debug] [ThreadPool]: On list_dbt_public: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "connection_name": "list_dbt_public"} */
select
      'dbt' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'dbt' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'dbt' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m10:15:16.602676 [debug] [ThreadPool]: SQL status: SELECT 7 in 0.0 seconds
[0m10:15:16.603948 [debug] [ThreadPool]: On list_dbt_public: ROLLBACK
[0m10:15:16.604471 [debug] [ThreadPool]: On list_dbt_public: Close
[0m10:15:16.610991 [debug] [MainThread]: Using postgres connection "master"
[0m10:15:16.611441 [debug] [MainThread]: On master: BEGIN
[0m10:15:16.611697 [debug] [MainThread]: Opening a new connection, currently in state init
[0m10:15:16.615063 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m10:15:16.615389 [debug] [MainThread]: Using postgres connection "master"
[0m10:15:16.615747 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m10:15:16.626943 [debug] [MainThread]: SQL status: SELECT 2 in 0.0 seconds
[0m10:15:16.629008 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '990ca00d-1d64-425d-8476-0c248d2f5417', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4b8dd8d750>]}
[0m10:15:16.629432 [debug] [MainThread]: On master: ROLLBACK
[0m10:15:16.629968 [debug] [MainThread]: Using postgres connection "master"
[0m10:15:16.630253 [debug] [MainThread]: On master: BEGIN
[0m10:15:16.630964 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m10:15:16.631247 [debug] [MainThread]: On master: COMMIT
[0m10:15:16.631528 [debug] [MainThread]: Using postgres connection "master"
[0m10:15:16.631875 [debug] [MainThread]: On master: COMMIT
[0m10:15:16.632324 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m10:15:16.632684 [debug] [MainThread]: On master: Close
[0m10:15:16.633470 [info ] [MainThread]: Concurrency: 3 threads (target='local')
[0m10:15:16.633947 [info ] [MainThread]: 
[0m10:15:16.636451 [debug] [Thread-1 (]: Began running node seed.integration_tests.contacts
[0m10:15:16.636926 [debug] [Thread-2 (]: Began running node seed.integration_tests.transactions
[0m10:15:16.637366 [info ] [Thread-1 (]: 1 of 20 START seed file public.contacts ........................................ [RUN]
[0m10:15:16.637949 [info ] [Thread-2 (]: 2 of 20 START seed file public.transactions .................................... [RUN]
[0m10:15:16.638338 [debug] [Thread-3 (]: Began running node test.customer360.macro_test1
[0m10:15:16.639090 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dbt_public, now seed.integration_tests.contacts)
[0m10:15:16.640700 [debug] [Thread-1 (]: Began compiling node seed.integration_tests.contacts
[0m10:15:16.640217 [info ] [Thread-3 (]: 3 of 20 START test macro_test1 ................................................. [RUN]
[0m10:15:16.641113 [debug] [Thread-1 (]: Timing info for seed.integration_tests.contacts (compile): 10:15:16.640921 => 10:15:16.640924
[0m10:15:16.639823 [debug] [Thread-2 (]: Acquiring new postgres connection 'seed.integration_tests.transactions'
[0m10:15:16.641974 [debug] [Thread-3 (]: Acquiring new postgres connection 'test.customer360.macro_test1'
[0m10:15:16.642444 [debug] [Thread-1 (]: Began executing node seed.integration_tests.contacts
[0m10:15:16.642809 [debug] [Thread-2 (]: Began compiling node seed.integration_tests.transactions
[0m10:15:16.656553 [debug] [Thread-2 (]: Timing info for seed.integration_tests.transactions (compile): 10:15:16.656321 => 10:15:16.656326
[0m10:15:16.643204 [debug] [Thread-3 (]: Began compiling node test.customer360.macro_test1
[0m10:15:16.659414 [debug] [Thread-2 (]: Began executing node seed.integration_tests.transactions
[0m10:15:16.681498 [debug] [Thread-3 (]: Writing injected SQL for node "test.customer360.macro_test1"
[0m10:15:16.684089 [debug] [Thread-1 (]: Using postgres connection "seed.integration_tests.contacts"
[0m10:15:16.691756 [debug] [Thread-1 (]: On seed.integration_tests.contacts: BEGIN
[0m10:15:16.691288 [debug] [Thread-2 (]: Using postgres connection "seed.integration_tests.transactions"
[0m10:15:16.692660 [debug] [Thread-2 (]: On seed.integration_tests.transactions: BEGIN
[0m10:15:16.692116 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:15:16.693221 [debug] [Thread-3 (]: Timing info for test.customer360.macro_test1 (compile): 10:15:16.673194 => 10:15:16.692903
[0m10:15:16.694253 [debug] [Thread-3 (]: Began executing node test.customer360.macro_test1
[0m10:15:16.693582 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m10:15:16.708015 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m10:15:16.708595 [debug] [Thread-1 (]: Using postgres connection "seed.integration_tests.contacts"
[0m10:15:16.709185 [debug] [Thread-1 (]: On seed.integration_tests.contacts: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "seed.integration_tests.contacts"} */
truncate table "dbt"."public"."contacts"
[0m10:15:16.714838 [debug] [Thread-2 (]: SQL status: BEGIN in 0.0 seconds
[0m10:15:16.715337 [debug] [Thread-2 (]: Using postgres connection "seed.integration_tests.transactions"
[0m10:15:16.715911 [debug] [Thread-2 (]: On seed.integration_tests.transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "seed.integration_tests.transactions"} */
truncate table "dbt"."public"."transactions"
[0m10:15:16.717247 [debug] [Thread-3 (]: Writing runtime sql for node "test.customer360.macro_test1"
[0m10:15:16.720084 [debug] [Thread-3 (]: Using postgres connection "test.customer360.macro_test1"
[0m10:15:16.720610 [debug] [Thread-3 (]: On test.customer360.macro_test1: BEGIN
[0m10:15:16.721048 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m10:15:16.721502 [debug] [Thread-1 (]: SQL status: TRUNCATE TABLE in 0.0 seconds
[0m10:15:16.722005 [debug] [Thread-2 (]: SQL status: TRUNCATE TABLE in 0.0 seconds
[0m10:15:16.842529 [debug] [Thread-3 (]: SQL status: BEGIN in 0.0 seconds
[0m10:15:16.843210 [debug] [Thread-3 (]: Using postgres connection "test.customer360.macro_test1"
[0m10:15:16.843819 [debug] [Thread-3 (]: On test.customer360.macro_test1: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.macro_test1"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      with marco_result as (
    select 
    date_part('year', age(current_date, '2023-02-12'))
 as expect_result
)
select
    1
from marco_result
where expect_result <> 1
      
    ) dbt_internal_test
[0m10:15:16.867596 [debug] [Thread-3 (]: SQL status: SELECT 1 in 0.0 seconds
[0m10:15:16.870675 [debug] [Thread-3 (]: Timing info for test.customer360.macro_test1 (execute): 10:15:16.694572 => 10:15:16.870350
[0m10:15:16.871349 [debug] [Thread-3 (]: On test.customer360.macro_test1: ROLLBACK
[0m10:15:16.886564 [debug] [Thread-3 (]: On test.customer360.macro_test1: Close
[0m10:15:16.887905 [info ] [Thread-3 (]: 3 of 20 PASS macro_test1 ....................................................... [[32mPASS[0m in 0.25s]
[0m10:15:16.888845 [debug] [Thread-3 (]: Finished running node test.customer360.macro_test1
[0m10:15:16.889575 [debug] [Thread-3 (]: Began running node test.customer360.macro_test2
[0m10:15:16.890030 [info ] [Thread-3 (]: 4 of 20 START test macro_test2 ................................................. [RUN]
[0m10:15:16.890941 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.customer360.macro_test1, now test.customer360.macro_test2)
[0m10:15:16.891551 [debug] [Thread-3 (]: Began compiling node test.customer360.macro_test2
[0m10:15:16.911539 [debug] [Thread-1 (]: Using postgres connection "seed.integration_tests.contacts"
[0m10:15:16.912337 [debug] [Thread-1 (]: On seed.integration_tests.contacts: 
          insert into "dbt"."public"."contacts" ("id", "username", "name", "gender", "address", "mail", "birthdate", "_loaded_at_utc") values
          (%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s)
      ...
[0m10:15:16.924758 [debug] [Thread-3 (]: Writing injected SQL for node "test.customer360.macro_test2"
[0m10:15:16.925745 [debug] [Thread-3 (]: Timing info for test.customer360.macro_test2 (compile): 10:15:16.891855 => 10:15:16.925364
[0m10:15:16.926238 [debug] [Thread-3 (]: Began executing node test.customer360.macro_test2
[0m10:15:16.929940 [debug] [Thread-3 (]: Writing runtime sql for node "test.customer360.macro_test2"
[0m10:15:16.930681 [debug] [Thread-3 (]: Using postgres connection "test.customer360.macro_test2"
[0m10:15:16.931143 [debug] [Thread-3 (]: On test.customer360.macro_test2: BEGIN
[0m10:15:16.931677 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m10:15:16.932583 [debug] [Thread-1 (]: SQL status: INSERT 0 10 in 0.0 seconds
[0m10:15:16.957358 [debug] [Thread-1 (]: Writing runtime SQL for node "seed.integration_tests.contacts"
[0m10:15:16.995239 [debug] [Thread-1 (]: On seed.integration_tests.contacts: COMMIT
[0m10:15:16.995904 [debug] [Thread-1 (]: Using postgres connection "seed.integration_tests.contacts"
[0m10:15:16.996453 [debug] [Thread-1 (]: On seed.integration_tests.contacts: COMMIT
[0m10:15:16.997064 [debug] [Thread-3 (]: SQL status: BEGIN in 0.0 seconds
[0m10:15:16.997555 [debug] [Thread-3 (]: Using postgres connection "test.customer360.macro_test2"
[0m10:15:16.998138 [debug] [Thread-3 (]: On test.customer360.macro_test2: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.macro_test2"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      with marco_result as (
    select 
        to_timestamp('2023-02-27 21:00:00','YYYY-MM-DD HH24:MI:SS.MS') :: timestamp at TIME zone 'UTC'
     as expect_result
)
select
    1
from marco_result
where cast(pg_typeof(expect_result) as text) not like '%timestamp%'
      
    ) dbt_internal_test
[0m10:15:17.015636 [debug] [Thread-3 (]: SQL status: SELECT 1 in 0.0 seconds
[0m10:15:17.017830 [debug] [Thread-3 (]: Timing info for test.customer360.macro_test2 (execute): 10:15:16.926687 => 10:15:17.017526
[0m10:15:17.018418 [debug] [Thread-3 (]: On test.customer360.macro_test2: ROLLBACK
[0m10:15:17.018954 [debug] [Thread-1 (]: SQL status: COMMIT in 0.0 seconds
[0m10:15:17.020322 [debug] [Thread-1 (]: Timing info for seed.integration_tests.contacts (execute): 10:15:16.643532 => 10:15:17.019953
[0m10:15:17.020813 [debug] [Thread-1 (]: On seed.integration_tests.contacts: Close
[0m10:15:17.021833 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '990ca00d-1d64-425d-8476-0c248d2f5417', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4b8dd05a90>]}
[0m10:15:17.022613 [info ] [Thread-1 (]: 1 of 20 OK loaded seed file public.contacts .................................... [[32mINSERT 10[0m in 0.38s]
[0m10:15:17.023471 [debug] [Thread-1 (]: Finished running node seed.integration_tests.contacts
[0m10:15:17.024051 [debug] [Thread-1 (]: Began running node test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247
[0m10:15:17.024677 [info ] [Thread-1 (]: 5 of 20 START test source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors  [RUN]
[0m10:15:17.025749 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly seed.integration_tests.contacts, now test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247)
[0m10:15:17.026324 [debug] [Thread-1 (]: Began compiling node test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247
[0m10:15:17.036197 [debug] [Thread-3 (]: On test.customer360.macro_test2: Close
[0m10:15:17.037383 [info ] [Thread-3 (]: 4 of 20 PASS macro_test2 ....................................................... [[32mPASS[0m in 0.15s]
[0m10:15:17.038214 [debug] [Thread-3 (]: Finished running node test.customer360.macro_test2
[0m10:15:17.038745 [debug] [Thread-3 (]: Began running node test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d
[0m10:15:17.039447 [info ] [Thread-3 (]: 6 of 20 START test source_not_null_salesforce_contacts_id ...................... [RUN]
[0m10:15:17.040401 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.customer360.macro_test2, now test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d)
[0m10:15:17.040932 [debug] [Thread-3 (]: Began compiling node test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d
[0m10:15:17.069440 [debug] [Thread-1 (]: Writing injected SQL for node "test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247"
[0m10:15:17.070742 [debug] [Thread-1 (]: Timing info for test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247 (compile): 10:15:17.026665 => 10:15:17.070010
[0m10:15:17.071454 [debug] [Thread-1 (]: Began executing node test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247
[0m10:15:17.075429 [debug] [Thread-1 (]: Writing runtime sql for node "test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247"
[0m10:15:17.076490 [debug] [Thread-1 (]: Using postgres connection "test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247"
[0m10:15:17.077123 [debug] [Thread-1 (]: On test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247: BEGIN
[0m10:15:17.077664 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:15:17.091808 [debug] [Thread-3 (]: Writing injected SQL for node "test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d"
[0m10:15:17.092862 [debug] [Thread-3 (]: Timing info for test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d (compile): 10:15:17.048394 => 10:15:17.092432
[0m10:15:17.093833 [debug] [Thread-3 (]: Began executing node test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d
[0m10:15:17.097809 [debug] [Thread-3 (]: Writing runtime sql for node "test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d"
[0m10:15:17.098576 [debug] [Thread-3 (]: Using postgres connection "test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d"
[0m10:15:17.099043 [debug] [Thread-3 (]: On test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d: BEGIN
[0m10:15:17.099584 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m10:15:17.114935 [debug] [Thread-3 (]: SQL status: BEGIN in 0.0 seconds
[0m10:15:17.115647 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m10:15:17.116055 [debug] [Thread-3 (]: Using postgres connection "test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d"
[0m10:15:17.146830 [debug] [Thread-3 (]: On test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select id
from "dbt"."public"."contacts"
where id is null



      
    ) dbt_internal_test
[0m10:15:17.131353 [debug] [Thread-1 (]: Using postgres connection "test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247"
[0m10:15:17.153808 [debug] [Thread-1 (]: On test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

with all_values as (

    select
        category as value_field,
        count(*) as n_records

    from "dbt"."public"."transactions"
    group by category

)

select *
from all_values
where value_field not in (
    'Apps & Games','Beauty','Books','Clothing, Shoes & Accessories','Movies & TV','Sports, Fitness & Outdoors'
)



      
    ) dbt_internal_test
[0m10:15:17.159500 [debug] [Thread-3 (]: SQL status: SELECT 1 in 0.0 seconds
[0m10:15:17.166115 [debug] [Thread-3 (]: Timing info for test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d (execute): 10:15:17.094138 => 10:15:17.165883
[0m10:15:17.171707 [debug] [Thread-3 (]: On test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d: ROLLBACK
[0m10:15:17.182631 [debug] [Thread-3 (]: On test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d: Close
[0m10:15:17.183676 [info ] [Thread-3 (]: 6 of 20 PASS source_not_null_salesforce_contacts_id ............................ [[32mPASS[0m in 0.14s]
[0m10:15:17.184188 [debug] [Thread-3 (]: Finished running node test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d
[0m10:15:17.191381 [debug] [Thread-3 (]: Began running node test.customer360.source_not_null_web_transactions_id.88a47bf7e5
[0m10:15:17.191781 [info ] [Thread-3 (]: 7 of 20 START test source_not_null_web_transactions_id ......................... [RUN]
[0m10:15:17.202603 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d, now test.customer360.source_not_null_web_transactions_id.88a47bf7e5)
[0m10:15:17.203072 [debug] [Thread-3 (]: Began compiling node test.customer360.source_not_null_web_transactions_id.88a47bf7e5
[0m10:15:17.212340 [debug] [Thread-3 (]: Writing injected SQL for node "test.customer360.source_not_null_web_transactions_id.88a47bf7e5"
[0m10:15:17.231733 [debug] [Thread-2 (]: Using postgres connection "seed.integration_tests.transactions"
[0m10:15:17.232256 [debug] [Thread-2 (]: On seed.integration_tests.transactions: 
          insert into "dbt"."public"."transactions" ("contact_id", "id", "transaction_date", "amount", "item_count", "category", "_loaded_at_utc") values
          (%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%...
[0m10:15:17.232798 [debug] [Thread-3 (]: Timing info for test.customer360.source_not_null_web_transactions_id.88a47bf7e5 (compile): 10:15:17.208417 => 10:15:17.232571
[0m10:15:17.233977 [debug] [Thread-3 (]: Began executing node test.customer360.source_not_null_web_transactions_id.88a47bf7e5
[0m10:15:17.237505 [debug] [Thread-3 (]: Writing runtime sql for node "test.customer360.source_not_null_web_transactions_id.88a47bf7e5"
[0m10:15:17.237878 [debug] [Thread-2 (]: SQL status: INSERT 0 100 in 0.0 seconds
[0m10:15:17.238842 [debug] [Thread-2 (]: Writing runtime SQL for node "seed.integration_tests.transactions"
[0m10:15:17.240829 [debug] [Thread-2 (]: On seed.integration_tests.transactions: COMMIT
[0m10:15:17.241576 [debug] [Thread-3 (]: Using postgres connection "test.customer360.source_not_null_web_transactions_id.88a47bf7e5"
[0m10:15:17.242006 [debug] [Thread-2 (]: Using postgres connection "seed.integration_tests.transactions"
[0m10:15:17.242436 [debug] [Thread-3 (]: On test.customer360.source_not_null_web_transactions_id.88a47bf7e5: BEGIN
[0m10:15:17.242792 [debug] [Thread-2 (]: On seed.integration_tests.transactions: COMMIT
[0m10:15:17.243240 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m10:15:17.246652 [debug] [Thread-2 (]: SQL status: COMMIT in 0.0 seconds
[0m10:15:17.248109 [debug] [Thread-2 (]: Timing info for seed.integration_tests.transactions (execute): 10:15:16.684608 => 10:15:17.247727
[0m10:15:17.248562 [debug] [Thread-2 (]: On seed.integration_tests.transactions: Close
[0m10:15:17.249633 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '990ca00d-1d64-425d-8476-0c248d2f5417', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4b8dcfbc10>]}
[0m10:15:17.250339 [info ] [Thread-2 (]: 2 of 20 OK loaded seed file public.transactions ................................ [[32mINSERT 100[0m in 0.61s]
[0m10:15:17.251055 [debug] [Thread-2 (]: Finished running node seed.integration_tests.transactions
[0m10:15:17.251780 [debug] [Thread-2 (]: Began running node test.customer360.source_unique_salesforce_contacts_id.01cadaaf43
[0m10:15:17.252206 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.0 seconds
[0m10:15:17.254495 [debug] [Thread-1 (]: Timing info for test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247 (execute): 10:15:17.071769 => 10:15:17.254212
[0m10:15:17.254937 [debug] [Thread-1 (]: On test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247: ROLLBACK
[0m10:15:17.255359 [debug] [Thread-3 (]: SQL status: BEGIN in 0.0 seconds
[0m10:15:17.255766 [debug] [Thread-3 (]: Using postgres connection "test.customer360.source_not_null_web_transactions_id.88a47bf7e5"
[0m10:15:17.256101 [debug] [Thread-3 (]: On test.customer360.source_not_null_web_transactions_id.88a47bf7e5: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.source_not_null_web_transactions_id.88a47bf7e5"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select id
from "dbt"."public"."transactions"
where id is null



      
    ) dbt_internal_test
[0m10:15:17.252908 [info ] [Thread-2 (]: 8 of 20 START test source_unique_salesforce_contacts_id ........................ [RUN]
[0m10:15:17.256972 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly seed.integration_tests.transactions, now test.customer360.source_unique_salesforce_contacts_id.01cadaaf43)
[0m10:15:17.257343 [debug] [Thread-2 (]: Began compiling node test.customer360.source_unique_salesforce_contacts_id.01cadaaf43
[0m10:15:17.266032 [debug] [Thread-1 (]: On test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247: Close
[0m10:15:17.266968 [info ] [Thread-1 (]: 5 of 20 PASS source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors  [[32mPASS[0m in 0.24s]
[0m10:15:17.267588 [debug] [Thread-1 (]: Finished running node test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247
[0m10:15:17.267984 [debug] [Thread-1 (]: Began running node test.customer360.source_unique_web_transactions_id.ba28079761
[0m10:15:17.268668 [info ] [Thread-1 (]: 9 of 20 START test source_unique_web_transactions_id ........................... [RUN]
[0m10:15:17.269586 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247, now test.customer360.source_unique_web_transactions_id.ba28079761)
[0m10:15:17.270074 [debug] [Thread-1 (]: Began compiling node test.customer360.source_unique_web_transactions_id.ba28079761
[0m10:15:17.270523 [debug] [Thread-2 (]: Writing injected SQL for node "test.customer360.source_unique_salesforce_contacts_id.01cadaaf43"
[0m10:15:17.270880 [debug] [Thread-3 (]: SQL status: SELECT 1 in 0.0 seconds
[0m10:15:17.276543 [debug] [Thread-3 (]: Timing info for test.customer360.source_not_null_web_transactions_id.88a47bf7e5 (execute): 10:15:17.234320 => 10:15:17.276329
[0m10:15:17.276893 [debug] [Thread-3 (]: On test.customer360.source_not_null_web_transactions_id.88a47bf7e5: ROLLBACK
[0m10:15:17.274905 [debug] [Thread-1 (]: Writing injected SQL for node "test.customer360.source_unique_web_transactions_id.ba28079761"
[0m10:15:17.277670 [debug] [Thread-1 (]: Timing info for test.customer360.source_unique_web_transactions_id.ba28079761 (compile): 10:15:17.271099 => 10:15:17.277411
[0m10:15:17.278287 [debug] [Thread-2 (]: Timing info for test.customer360.source_unique_salesforce_contacts_id.01cadaaf43 (compile): 10:15:17.257570 => 10:15:17.277895
[0m10:15:17.278647 [debug] [Thread-1 (]: Began executing node test.customer360.source_unique_web_transactions_id.ba28079761
[0m10:15:17.278964 [debug] [Thread-3 (]: On test.customer360.source_not_null_web_transactions_id.88a47bf7e5: Close
[0m10:15:17.279437 [debug] [Thread-2 (]: Began executing node test.customer360.source_unique_salesforce_contacts_id.01cadaaf43
[0m10:15:17.281770 [debug] [Thread-1 (]: Writing runtime sql for node "test.customer360.source_unique_web_transactions_id.ba28079761"
[0m10:15:17.284599 [debug] [Thread-2 (]: Writing runtime sql for node "test.customer360.source_unique_salesforce_contacts_id.01cadaaf43"
[0m10:15:17.286384 [info ] [Thread-3 (]: 7 of 20 PASS source_not_null_web_transactions_id ............................... [[32mPASS[0m in 0.08s]
[0m10:15:17.287381 [debug] [Thread-3 (]: Finished running node test.customer360.source_not_null_web_transactions_id.88a47bf7e5
[0m10:15:17.287793 [debug] [Thread-3 (]: Began running node test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344
[0m10:15:17.288462 [info ] [Thread-3 (]: 10 of 20 START test source_relationships_web_transactions_contact_id__id__ref_contacts_  [RUN]
[0m10:15:17.289004 [debug] [Thread-1 (]: Using postgres connection "test.customer360.source_unique_web_transactions_id.ba28079761"
[0m10:15:17.289601 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.customer360.source_not_null_web_transactions_id.88a47bf7e5, now test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344)
[0m10:15:17.289991 [debug] [Thread-2 (]: Using postgres connection "test.customer360.source_unique_salesforce_contacts_id.01cadaaf43"
[0m10:15:17.290451 [debug] [Thread-1 (]: On test.customer360.source_unique_web_transactions_id.ba28079761: BEGIN
[0m10:15:17.290881 [debug] [Thread-3 (]: Began compiling node test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344
[0m10:15:17.291266 [debug] [Thread-2 (]: On test.customer360.source_unique_salesforce_contacts_id.01cadaaf43: BEGIN
[0m10:15:17.291658 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:15:17.300382 [debug] [Thread-3 (]: Writing injected SQL for node "test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344"
[0m10:15:17.301791 [debug] [Thread-3 (]: Timing info for test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344 (compile): 10:15:17.291966 => 10:15:17.301361
[0m10:15:17.302224 [debug] [Thread-3 (]: Began executing node test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344
[0m10:15:17.300852 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m10:15:17.305702 [debug] [Thread-3 (]: Writing runtime sql for node "test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344"
[0m10:15:17.307739 [debug] [Thread-3 (]: Using postgres connection "test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344"
[0m10:15:17.308228 [debug] [Thread-3 (]: On test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344: BEGIN
[0m10:15:17.308854 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m10:15:17.306939 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m10:15:17.310096 [debug] [Thread-1 (]: Using postgres connection "test.customer360.source_unique_web_transactions_id.ba28079761"
[0m10:15:17.310754 [debug] [Thread-1 (]: On test.customer360.source_unique_web_transactions_id.ba28079761: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.source_unique_web_transactions_id.ba28079761"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

select
    id as unique_field,
    count(*) as n_records

from "dbt"."public"."transactions"
where id is not null
group by id
having count(*) > 1



      
    ) dbt_internal_test
[0m10:15:17.311435 [debug] [Thread-2 (]: SQL status: BEGIN in 0.0 seconds
[0m10:15:17.311932 [debug] [Thread-2 (]: Using postgres connection "test.customer360.source_unique_salesforce_contacts_id.01cadaaf43"
[0m10:15:17.312545 [debug] [Thread-2 (]: On test.customer360.source_unique_salesforce_contacts_id.01cadaaf43: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.source_unique_salesforce_contacts_id.01cadaaf43"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

select
    id as unique_field,
    count(*) as n_records

from "dbt"."public"."contacts"
where id is not null
group by id
having count(*) > 1



      
    ) dbt_internal_test
[0m10:15:17.313474 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.0 seconds
[0m10:15:17.315675 [debug] [Thread-1 (]: Timing info for test.customer360.source_unique_web_transactions_id.ba28079761 (execute): 10:15:17.279671 => 10:15:17.315432
[0m10:15:17.316323 [debug] [Thread-1 (]: On test.customer360.source_unique_web_transactions_id.ba28079761: ROLLBACK
[0m10:15:17.316822 [debug] [Thread-3 (]: SQL status: BEGIN in 0.0 seconds
[0m10:15:17.317679 [debug] [Thread-3 (]: Using postgres connection "test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344"
[0m10:15:17.318482 [debug] [Thread-3 (]: On test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

with child as (
    select contact_id as from_field
    from "dbt"."public"."transactions"
    where contact_id is not null
),

parent as (
    select id as to_field
    from "dbt"."public"."contacts"
)

select
    from_field

from child
left join parent
    on child.from_field = parent.to_field

where parent.to_field is null



      
    ) dbt_internal_test
[0m10:15:17.318011 [debug] [Thread-1 (]: On test.customer360.source_unique_web_transactions_id.ba28079761: Close
[0m10:15:17.319666 [info ] [Thread-1 (]: 9 of 20 PASS source_unique_web_transactions_id ................................. [[32mPASS[0m in 0.05s]
[0m10:15:17.320569 [debug] [Thread-1 (]: Finished running node test.customer360.source_unique_web_transactions_id.ba28079761
[0m10:15:17.321238 [debug] [Thread-1 (]: Began running node model.customer360.top3_hot_categorys
[0m10:15:17.317357 [debug] [Thread-2 (]: SQL status: SELECT 1 in 0.0 seconds
[0m10:15:17.321904 [info ] [Thread-1 (]: 11 of 20 START sql view model public.top3_hot_categorys ........................ [RUN]
[0m10:15:17.322534 [debug] [Thread-3 (]: SQL status: SELECT 1 in 0.0 seconds
[0m10:15:17.324167 [debug] [Thread-2 (]: Timing info for test.customer360.source_unique_salesforce_contacts_id.01cadaaf43 (execute): 10:15:17.282119 => 10:15:17.323885
[0m10:15:17.324796 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.customer360.source_unique_web_transactions_id.ba28079761, now model.customer360.top3_hot_categorys)
[0m10:15:17.326337 [debug] [Thread-3 (]: Timing info for test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344 (execute): 10:15:17.302614 => 10:15:17.326060
[0m10:15:17.326736 [debug] [Thread-2 (]: On test.customer360.source_unique_salesforce_contacts_id.01cadaaf43: ROLLBACK
[0m10:15:17.327284 [debug] [Thread-1 (]: Began compiling node model.customer360.top3_hot_categorys
[0m10:15:17.330490 [debug] [Thread-1 (]: Writing injected SQL for node "model.customer360.top3_hot_categorys"
[0m10:15:17.327673 [debug] [Thread-3 (]: On test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344: ROLLBACK
[0m10:15:17.330915 [debug] [Thread-2 (]: On test.customer360.source_unique_salesforce_contacts_id.01cadaaf43: Close
[0m10:15:17.331678 [debug] [Thread-1 (]: Timing info for model.customer360.top3_hot_categorys (compile): 10:15:17.328010 => 10:15:17.331416
[0m10:15:17.332511 [debug] [Thread-1 (]: Began executing node model.customer360.top3_hot_categorys
[0m10:15:17.332089 [debug] [Thread-3 (]: On test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344: Close
[0m10:15:17.338462 [info ] [Thread-2 (]: 8 of 20 PASS source_unique_salesforce_contacts_id .............................. [[32mPASS[0m in 0.08s]
[0m10:15:17.340019 [debug] [Thread-2 (]: Finished running node test.customer360.source_unique_salesforce_contacts_id.01cadaaf43
[0m10:15:17.340541 [debug] [Thread-2 (]: Began running node model.customer360.stg_web__transactions
[0m10:15:17.341103 [info ] [Thread-2 (]: 12 of 20 START sql table model public.stg_web__transactions .................... [RUN]
[0m10:15:17.341792 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.customer360.source_unique_salesforce_contacts_id.01cadaaf43, now model.customer360.stg_web__transactions)
[0m10:15:17.339274 [info ] [Thread-3 (]: 10 of 20 PASS source_relationships_web_transactions_contact_id__id__ref_contacts_  [[32mPASS[0m in 0.05s]
[0m10:15:17.353487 [debug] [Thread-2 (]: Began compiling node model.customer360.stg_web__transactions
[0m10:15:17.368987 [debug] [Thread-1 (]: Writing runtime sql for node "model.customer360.top3_hot_categorys"
[0m10:15:17.369576 [debug] [Thread-3 (]: Finished running node test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344
[0m10:15:17.373100 [debug] [Thread-3 (]: Began running node model.customer360.stg_sf__contacts
[0m10:15:17.372475 [debug] [Thread-2 (]: Writing injected SQL for node "model.customer360.stg_web__transactions"
[0m10:15:17.373528 [info ] [Thread-3 (]: 13 of 20 START sql table model public.stg_sf__contacts ......................... [RUN]
[0m10:15:17.374401 [debug] [Thread-1 (]: Using postgres connection "model.customer360.top3_hot_categorys"
[0m10:15:17.374942 [debug] [Thread-2 (]: Timing info for model.customer360.stg_web__transactions (compile): 10:15:17.369820 => 10:15:17.374656
[0m10:15:17.375562 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344, now model.customer360.stg_sf__contacts)
[0m10:15:17.376037 [debug] [Thread-1 (]: On model.customer360.top3_hot_categorys: BEGIN
[0m10:15:17.376421 [debug] [Thread-2 (]: Began executing node model.customer360.stg_web__transactions
[0m10:15:17.376839 [debug] [Thread-3 (]: Began compiling node model.customer360.stg_sf__contacts
[0m10:15:17.377240 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:15:17.386648 [debug] [Thread-3 (]: Writing injected SQL for node "model.customer360.stg_sf__contacts"
[0m10:15:17.404361 [debug] [Thread-3 (]: Timing info for model.customer360.stg_sf__contacts (compile): 10:15:17.383697 => 10:15:17.403951
[0m10:15:17.404819 [debug] [Thread-3 (]: Began executing node model.customer360.stg_sf__contacts
[0m10:15:17.403473 [debug] [Thread-2 (]: Writing runtime sql for node "model.customer360.stg_web__transactions"
[0m10:15:17.410638 [debug] [Thread-2 (]: Using postgres connection "model.customer360.stg_web__transactions"
[0m10:15:17.409869 [debug] [Thread-3 (]: Writing runtime sql for node "model.customer360.stg_sf__contacts"
[0m10:15:17.411156 [debug] [Thread-2 (]: On model.customer360.stg_web__transactions: BEGIN
[0m10:15:17.411539 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m10:15:17.412532 [debug] [Thread-1 (]: Using postgres connection "model.customer360.top3_hot_categorys"
[0m10:15:17.412986 [debug] [Thread-1 (]: On model.customer360.top3_hot_categorys: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.top3_hot_categorys"} */

  create view "dbt"."public"."top3_hot_categorys__dbt_tmp"
    
    
  as (
    SELECT 
     category
    ,row_number() over (partition by 1 order by count(1) desc) as rank
FROM "dbt"."public"."transactions"
group by category
where rank <= 3
  );
[0m10:15:17.412080 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m10:15:17.413824 [debug] [Thread-3 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m10:15:17.414891 [debug] [Thread-3 (]: On model.customer360.stg_sf__contacts: BEGIN
[0m10:15:17.415289 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m10:15:17.414394 [debug] [Thread-1 (]: Postgres adapter: Postgres error: syntax error at or near "where"
LINE 12: where rank <= 3
         ^

[0m10:15:17.416221 [debug] [Thread-1 (]: On model.customer360.top3_hot_categorys: ROLLBACK
[0m10:15:17.417127 [debug] [Thread-1 (]: Timing info for model.customer360.top3_hot_categorys (execute): 10:15:17.332734 => 10:15:17.416812
[0m10:15:17.417611 [debug] [Thread-1 (]: On model.customer360.top3_hot_categorys: Close
[0m10:15:17.421949 [debug] [Thread-2 (]: SQL status: BEGIN in 0.0 seconds
[0m10:15:17.424682 [debug] [Thread-2 (]: Using postgres connection "model.customer360.stg_web__transactions"
[0m10:15:17.425206 [debug] [Thread-2 (]: On model.customer360.stg_web__transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_web__transactions"} */

  
    

  create  table "dbt"."public"."stg_web__transactions__dbt_tmp"
  
  
    as
  
  (
    with source as (
    select * from "dbt"."public"."transactions"
),

renamed as (
    select
        id,
        contact_id,
        
        to_timestamp(transaction_date,'YYYY-MM-DD HH24:MI:SS.MS') :: timestamp at TIME zone 'UTC'
     as transaction_date,
        amount,
        item_count,
        category, 
        _loaded_at_utc
    from source    
),

clean_older as (
    select * from renamed 
--    where transaction_date >= (current_date - 1)  过滤超过1天的数据
--    where transaction_date >= (to_date('2023-04-12','yyyy-MM-dd') - 1)  --测试用,假设跑数日期为2023-04-12
--    and transaction_date < to_date('2023-04-12','yyyy-MM-dd')
)

select * from clean_older
  );
  
[0m10:15:17.424256 [debug] [Thread-1 (]: Database Error in model top3_hot_categorys (models/recommend/top3_hot_categorys.sql)
  syntax error at or near "where"
  LINE 12: where rank <= 3
           ^
  compiled Code at target/run/customer360/models/recommend/top3_hot_categorys.sql
[0m10:15:17.425878 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '990ca00d-1d64-425d-8476-0c248d2f5417', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4b8d2f0cd0>]}
[0m10:15:17.426590 [error] [Thread-1 (]: 11 of 20 ERROR creating sql view model public.top3_hot_categorys ............... [[31mERROR[0m in 0.10s]
[0m10:15:17.428161 [debug] [Thread-1 (]: Finished running node model.customer360.top3_hot_categorys
[0m10:15:17.427340 [debug] [Thread-3 (]: SQL status: BEGIN in 0.0 seconds
[0m10:15:17.428884 [debug] [Thread-3 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m10:15:17.429538 [debug] [Thread-3 (]: On model.customer360.stg_sf__contacts: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_sf__contacts"} */

  
    

  create  table "dbt"."public"."stg_sf__contacts__dbt_tmp"
  
  
    as
  
  (
    with source as (
    select * from "dbt"."public"."contacts"
),

renamed as (
    select
        id,
        username as user_name,
        name,
        gender,
        address, 
        mail as email_address,
        birthdate as birth_date,
        _loaded_at_utc
    from source     
)

select * from renamed
  );
  
[0m10:15:17.430420 [debug] [Thread-1 (]: Began running node test.customer360.not_null_top3_hot_categorys_category.ac139b7415
[0m10:15:17.430996 [info ] [Thread-1 (]: 14 of 20 SKIP test not_null_top3_hot_categorys_category ........................ [[33mSKIP[0m]
[0m10:15:17.431604 [debug] [Thread-1 (]: Finished running node test.customer360.not_null_top3_hot_categorys_category.ac139b7415
[0m10:15:17.432135 [debug] [Thread-1 (]: Began running node test.customer360.unique_top3_hot_categorys_category.f6d49f4923
[0m10:15:17.434547 [info ] [Thread-1 (]: 15 of 20 SKIP test unique_top3_hot_categorys_category .......................... [[33mSKIP[0m]
[0m10:15:17.435147 [debug] [Thread-1 (]: Finished running node test.customer360.unique_top3_hot_categorys_category.f6d49f4923
[0m10:15:17.435960 [debug] [Thread-2 (]: SQL status: SELECT 100 in 0.0 seconds
[0m10:15:17.442559 [debug] [Thread-3 (]: SQL status: SELECT 10 in 0.0 seconds
[0m10:15:17.442861 [debug] [Thread-2 (]: Using postgres connection "model.customer360.stg_web__transactions"
[0m10:15:17.446935 [debug] [Thread-3 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m10:15:17.447424 [debug] [Thread-2 (]: On model.customer360.stg_web__transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_web__transactions"} */
alter table "dbt"."public"."stg_web__transactions" rename to "stg_web__transactions__dbt_backup"
[0m10:15:17.447818 [debug] [Thread-3 (]: On model.customer360.stg_sf__contacts: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_sf__contacts"} */
alter table "dbt"."public"."stg_sf__contacts" rename to "stg_sf__contacts__dbt_backup"
[0m10:15:17.449179 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m10:15:17.452072 [debug] [Thread-2 (]: Using postgres connection "model.customer360.stg_web__transactions"
[0m10:15:17.452468 [debug] [Thread-2 (]: On model.customer360.stg_web__transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_web__transactions"} */
alter table "dbt"."public"."stg_web__transactions__dbt_tmp" rename to "stg_web__transactions"
[0m10:15:17.452989 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m10:15:17.455770 [debug] [Thread-3 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m10:15:17.456247 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m10:15:17.456598 [debug] [Thread-3 (]: On model.customer360.stg_sf__contacts: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_sf__contacts"} */
alter table "dbt"."public"."stg_sf__contacts__dbt_tmp" rename to "stg_sf__contacts"
[0m10:15:17.463862 [debug] [Thread-2 (]: On model.customer360.stg_web__transactions: COMMIT
[0m10:15:17.464397 [debug] [Thread-2 (]: Using postgres connection "model.customer360.stg_web__transactions"
[0m10:15:17.464890 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m10:15:17.465229 [debug] [Thread-2 (]: On model.customer360.stg_web__transactions: COMMIT
[0m10:15:17.467314 [debug] [Thread-3 (]: On model.customer360.stg_sf__contacts: COMMIT
[0m10:15:17.467805 [debug] [Thread-3 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m10:15:17.468149 [debug] [Thread-3 (]: On model.customer360.stg_sf__contacts: COMMIT
[0m10:15:17.471555 [debug] [Thread-3 (]: SQL status: COMMIT in 0.0 seconds
[0m10:15:17.477463 [debug] [Thread-3 (]: Applying DROP to: "dbt"."public"."stg_sf__contacts__dbt_backup"
[0m10:15:17.482095 [debug] [Thread-3 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m10:15:17.482498 [debug] [Thread-3 (]: On model.customer360.stg_sf__contacts: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_sf__contacts"} */
drop table if exists "dbt"."public"."stg_sf__contacts__dbt_backup" cascade
[0m10:15:17.483108 [debug] [Thread-2 (]: SQL status: COMMIT in 0.0 seconds
[0m10:15:17.486020 [debug] [Thread-2 (]: Applying DROP to: "dbt"."public"."stg_web__transactions__dbt_backup"
[0m10:15:17.486892 [debug] [Thread-2 (]: Using postgres connection "model.customer360.stg_web__transactions"
[0m10:15:17.487331 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.0 seconds
[0m10:15:17.487647 [debug] [Thread-2 (]: On model.customer360.stg_web__transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_web__transactions"} */
drop table if exists "dbt"."public"."stg_web__transactions__dbt_backup" cascade
[0m10:15:17.489240 [debug] [Thread-3 (]: Timing info for model.customer360.stg_sf__contacts (execute): 10:15:17.405151 => 10:15:17.488944
[0m10:15:17.489733 [debug] [Thread-3 (]: On model.customer360.stg_sf__contacts: Close
[0m10:15:17.490579 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '990ca00d-1d64-425d-8476-0c248d2f5417', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4b8d54d950>]}
[0m10:15:17.491236 [info ] [Thread-3 (]: 13 of 20 OK created sql table model public.stg_sf__contacts .................... [[32mSELECT 10[0m in 0.12s]
[0m10:15:17.491898 [debug] [Thread-3 (]: Finished running node model.customer360.stg_sf__contacts
[0m10:15:17.494691 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.0 seconds
[0m10:15:17.496239 [debug] [Thread-2 (]: Timing info for model.customer360.stg_web__transactions (execute): 10:15:17.377492 => 10:15:17.496037
[0m10:15:17.496600 [debug] [Thread-2 (]: On model.customer360.stg_web__transactions: Close
[0m10:15:17.497465 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '990ca00d-1d64-425d-8476-0c248d2f5417', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4b8f691790>]}
[0m10:15:17.498158 [info ] [Thread-2 (]: 12 of 20 OK created sql table model public.stg_web__transactions ............... [[32mSELECT 100[0m in 0.16s]
[0m10:15:17.498969 [debug] [Thread-2 (]: Finished running node model.customer360.stg_web__transactions
[0m10:15:17.499848 [debug] [Thread-1 (]: Began running node model.customer360.contacts_joined_with_transactions
[0m10:15:17.500241 [debug] [Thread-3 (]: Began running node model.customer360.sales_month_report
[0m10:15:17.500669 [info ] [Thread-1 (]: 16 of 20 START sql view model public.contacts_joined_with_transactions ......... [RUN]
[0m10:15:17.501270 [info ] [Thread-3 (]: 17 of 20 START sql table model public.sales_month_report ....................... [RUN]
[0m10:15:17.501977 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.customer360.top3_hot_categorys, now model.customer360.contacts_joined_with_transactions)
[0m10:15:17.502587 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.customer360.stg_sf__contacts, now model.customer360.sales_month_report)
[0m10:15:17.503047 [debug] [Thread-1 (]: Began compiling node model.customer360.contacts_joined_with_transactions
[0m10:15:17.503433 [debug] [Thread-3 (]: Began compiling node model.customer360.sales_month_report
[0m10:15:17.506344 [debug] [Thread-1 (]: Writing injected SQL for node "model.customer360.contacts_joined_with_transactions"
[0m10:15:17.509208 [debug] [Thread-3 (]: Writing injected SQL for node "model.customer360.sales_month_report"
[0m10:15:17.510009 [debug] [Thread-1 (]: Timing info for model.customer360.contacts_joined_with_transactions (compile): 10:15:17.503668 => 10:15:17.509799
[0m10:15:17.510616 [debug] [Thread-3 (]: Timing info for model.customer360.sales_month_report (compile): 10:15:17.506698 => 10:15:17.510272
[0m10:15:17.510976 [debug] [Thread-1 (]: Began executing node model.customer360.contacts_joined_with_transactions
[0m10:15:17.511376 [debug] [Thread-3 (]: Began executing node model.customer360.sales_month_report
[0m10:15:17.515971 [debug] [Thread-1 (]: Writing runtime sql for node "model.customer360.contacts_joined_with_transactions"
[0m10:15:17.520111 [debug] [Thread-3 (]: Writing runtime sql for node "model.customer360.sales_month_report"
[0m10:15:17.520820 [debug] [Thread-1 (]: Using postgres connection "model.customer360.contacts_joined_with_transactions"
[0m10:15:17.521364 [debug] [Thread-3 (]: Using postgres connection "model.customer360.sales_month_report"
[0m10:15:17.521714 [debug] [Thread-1 (]: On model.customer360.contacts_joined_with_transactions: BEGIN
[0m10:15:17.522059 [debug] [Thread-3 (]: On model.customer360.sales_month_report: BEGIN
[0m10:15:17.522494 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:15:17.522830 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m10:15:17.527047 [debug] [Thread-3 (]: SQL status: BEGIN in 0.0 seconds
[0m10:15:17.527615 [debug] [Thread-3 (]: Using postgres connection "model.customer360.sales_month_report"
[0m10:15:17.527996 [debug] [Thread-3 (]: On model.customer360.sales_month_report: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.sales_month_report"} */

  
    

  create  table "dbt"."public"."sales_month_report__dbt_tmp"
  
  
    as
  
  (
    SELECT
     count(id)                                  as total_count
    ,cast(count(id) / 31 as decimal(24,2))      as day_avg_count
    ,sum(case when category = 'Apps & Games'                    then 1 else 0 end)   as apps_games_count
    ,sum(case when category = 'Beauty'                          then 1 else 0 end)   as beauty_count
    ,sum(case when category = 'Books'                           then 1 else 0 end)   as books_count
    ,sum(case when category = 'Clothing, Shoes & Accessories'   then 1 else 0 end)   as clothing_shoes_accessories_count
    ,sum(case when category = 'Movies & TV'                     then 1 else 0 end)   as movies_tv_count
    ,sum(case when category = 'Sports, Fitness & Outdoors'      then 1 else 0 end)   as sports_fitness_outdoors_count

    ,sum(amount) as total_expense
    ,cast(sum(amount) / 31 as decimal(24,4))    as day_avg_amount
    ,sum(case when category = 'Apps & Games'                    then amount else 0 end)   as apps_games_amount
    ,sum(case when category = 'Beauty'                          then amount else 0 end)   as beauty_amount
    ,sum(case when category = 'Books'                           then amount else 0 end)   as books_amount
    ,sum(case when category = 'Clothing, Shoes & Accessories'   then amount else 0 end)   as clothing_shoes_accessories_amount
    ,sum(case when category = 'Movies & TV'                     then amount else 0 end)   as movies_tv_amount
    ,sum(case when category = 'Sports, Fitness & Outdoors'      then amount else 0 end)   as sports_fitness_outdoors_amount
FROM  "dbt"."public"."stg_web__transactions"
where transaction_date between '2023-05-01' and '2023-05-31'  -- 样例，实际脚本可改成传参
  );
  
[0m10:15:17.530796 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m10:15:17.531242 [debug] [Thread-1 (]: Using postgres connection "model.customer360.contacts_joined_with_transactions"
[0m10:15:17.531667 [debug] [Thread-3 (]: SQL status: SELECT 1 in 0.0 seconds
[0m10:15:17.532085 [debug] [Thread-1 (]: On model.customer360.contacts_joined_with_transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.contacts_joined_with_transactions"} */

  create view "dbt"."public"."contacts_joined_with_transactions__dbt_tmp"
    
    
  as (
    SELECT 
    contacts.*,
    transactions.id as transaction_id,
    transactions.transaction_date,
    transactions.amount,
    transactions.item_count,
    transactions.category
FROM "dbt"."public"."stg_web__transactions" as transactions
LEFT JOIN "dbt"."public"."stg_sf__contacts" as contacts ON contacts.id = transactions.contact_id
  );
[0m10:15:17.535684 [debug] [Thread-3 (]: Using postgres connection "model.customer360.sales_month_report"
[0m10:15:17.536184 [debug] [Thread-3 (]: On model.customer360.sales_month_report: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.sales_month_report"} */
alter table "dbt"."public"."sales_month_report" rename to "sales_month_report__dbt_backup"
[0m10:15:17.536954 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m10:15:17.540343 [debug] [Thread-3 (]: Using postgres connection "model.customer360.sales_month_report"
[0m10:15:17.540810 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.0 seconds
[0m10:15:17.541168 [debug] [Thread-3 (]: On model.customer360.sales_month_report: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.sales_month_report"} */
alter table "dbt"."public"."sales_month_report__dbt_tmp" rename to "sales_month_report"
[0m10:15:17.545187 [debug] [Thread-1 (]: Using postgres connection "model.customer360.contacts_joined_with_transactions"
[0m10:15:17.545630 [debug] [Thread-1 (]: On model.customer360.contacts_joined_with_transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.contacts_joined_with_transactions"} */
alter table "dbt"."public"."contacts_joined_with_transactions__dbt_tmp" rename to "contacts_joined_with_transactions"
[0m10:15:17.546456 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m10:15:17.546891 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m10:15:17.548929 [debug] [Thread-3 (]: On model.customer360.sales_month_report: COMMIT
[0m10:15:17.550447 [debug] [Thread-1 (]: On model.customer360.contacts_joined_with_transactions: COMMIT
[0m10:15:17.550895 [debug] [Thread-3 (]: Using postgres connection "model.customer360.sales_month_report"
[0m10:15:17.551280 [debug] [Thread-1 (]: Using postgres connection "model.customer360.contacts_joined_with_transactions"
[0m10:15:17.551733 [debug] [Thread-3 (]: On model.customer360.sales_month_report: COMMIT
[0m10:15:17.552104 [debug] [Thread-1 (]: On model.customer360.contacts_joined_with_transactions: COMMIT
[0m10:15:17.554098 [debug] [Thread-3 (]: SQL status: COMMIT in 0.0 seconds
[0m10:15:17.556695 [debug] [Thread-3 (]: Applying DROP to: "dbt"."public"."sales_month_report__dbt_backup"
[0m10:15:17.557067 [debug] [Thread-1 (]: SQL status: COMMIT in 0.0 seconds
[0m10:15:17.557895 [debug] [Thread-3 (]: Using postgres connection "model.customer360.sales_month_report"
[0m10:15:17.560233 [debug] [Thread-1 (]: Applying DROP to: "dbt"."public"."contacts_joined_with_transactions__dbt_backup"
[0m10:15:17.560697 [debug] [Thread-3 (]: On model.customer360.sales_month_report: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.sales_month_report"} */
drop table if exists "dbt"."public"."sales_month_report__dbt_backup" cascade
[0m10:15:17.563731 [debug] [Thread-1 (]: Using postgres connection "model.customer360.contacts_joined_with_transactions"
[0m10:15:17.564178 [debug] [Thread-1 (]: On model.customer360.contacts_joined_with_transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.contacts_joined_with_transactions"} */
drop view if exists "dbt"."public"."contacts_joined_with_transactions__dbt_backup" cascade
[0m10:15:17.565080 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.0 seconds
[0m10:15:17.566720 [debug] [Thread-1 (]: Timing info for model.customer360.contacts_joined_with_transactions (execute): 10:15:17.511694 => 10:15:17.566527
[0m10:15:17.567068 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.0 seconds
[0m10:15:17.567545 [debug] [Thread-1 (]: On model.customer360.contacts_joined_with_transactions: Close
[0m10:15:17.569541 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '990ca00d-1d64-425d-8476-0c248d2f5417', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4b8d451690>]}
[0m10:15:17.568825 [debug] [Thread-3 (]: Timing info for model.customer360.sales_month_report (execute): 10:15:17.516242 => 10:15:17.568645
[0m10:15:17.570662 [debug] [Thread-3 (]: On model.customer360.sales_month_report: Close
[0m10:15:17.571313 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '990ca00d-1d64-425d-8476-0c248d2f5417', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4b8d4508d0>]}
[0m10:15:17.571893 [info ] [Thread-3 (]: 17 of 20 OK created sql table model public.sales_month_report .................. [[32mSELECT 1[0m in 0.07s]
[0m10:15:17.572563 [debug] [Thread-3 (]: Finished running node model.customer360.sales_month_report
[0m10:15:17.570024 [info ] [Thread-1 (]: 16 of 20 OK created sql view model public.contacts_joined_with_transactions .... [[32mCREATE VIEW[0m in 0.07s]
[0m10:15:17.573308 [debug] [Thread-1 (]: Finished running node model.customer360.contacts_joined_with_transactions
[0m10:15:17.578329 [debug] [Thread-2 (]: Began running node test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311
[0m10:15:17.578804 [info ] [Thread-2 (]: 18 of 20 START test not_null_contacts_joined_with_transactions_id .............. [RUN]
[0m10:15:17.579727 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.customer360.stg_web__transactions, now test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311)
[0m10:15:17.580197 [debug] [Thread-2 (]: Began compiling node test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311
[0m10:15:17.584577 [debug] [Thread-2 (]: Writing injected SQL for node "test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311"
[0m10:15:17.585281 [debug] [Thread-2 (]: Timing info for test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311 (compile): 10:15:17.580434 => 10:15:17.585009
[0m10:15:17.585639 [debug] [Thread-2 (]: Began executing node test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311
[0m10:15:17.587970 [debug] [Thread-2 (]: Writing runtime sql for node "test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311"
[0m10:15:17.588492 [debug] [Thread-2 (]: Using postgres connection "test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311"
[0m10:15:17.588914 [debug] [Thread-2 (]: On test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311: BEGIN
[0m10:15:17.589251 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m10:15:17.592934 [debug] [Thread-2 (]: SQL status: BEGIN in 0.0 seconds
[0m10:15:17.593600 [debug] [Thread-2 (]: Using postgres connection "test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311"
[0m10:15:17.594142 [debug] [Thread-2 (]: On test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select id
from "dbt"."public"."contacts_joined_with_transactions"
where id is null



      
    ) dbt_internal_test
[0m10:15:17.596201 [debug] [Thread-2 (]: SQL status: SELECT 1 in 0.0 seconds
[0m10:15:17.597773 [debug] [Thread-2 (]: Timing info for test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311 (execute): 10:15:17.585946 => 10:15:17.597557
[0m10:15:17.598114 [debug] [Thread-2 (]: On test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311: ROLLBACK
[0m10:15:17.598719 [debug] [Thread-2 (]: On test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311: Close
[0m10:15:17.599649 [info ] [Thread-2 (]: 18 of 20 PASS not_null_contacts_joined_with_transactions_id .................... [[32mPASS[0m in 0.02s]
[0m10:15:17.600419 [debug] [Thread-2 (]: Finished running node test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311
[0m10:15:17.601681 [debug] [Thread-1 (]: Began running node model.customer360.customers
[0m10:15:17.602111 [info ] [Thread-1 (]: 19 of 20 START sql table model public.customers ................................ [RUN]
[0m10:15:17.602806 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.customer360.contacts_joined_with_transactions, now model.customer360.customers)
[0m10:15:17.603132 [debug] [Thread-1 (]: Began compiling node model.customer360.customers
[0m10:15:17.606076 [debug] [Thread-1 (]: Writing injected SQL for node "model.customer360.customers"
[0m10:15:17.606780 [debug] [Thread-1 (]: Timing info for model.customer360.customers (compile): 10:15:17.603429 => 10:15:17.606543
[0m10:15:17.607095 [debug] [Thread-1 (]: Began executing node model.customer360.customers
[0m10:15:17.611484 [debug] [Thread-1 (]: Writing runtime sql for node "model.customer360.customers"
[0m10:15:17.611956 [debug] [Thread-1 (]: Using postgres connection "model.customer360.customers"
[0m10:15:17.612412 [debug] [Thread-1 (]: On model.customer360.customers: BEGIN
[0m10:15:17.612719 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:15:17.616271 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m10:15:17.616628 [debug] [Thread-1 (]: Using postgres connection "model.customer360.customers"
[0m10:15:17.617062 [debug] [Thread-1 (]: On model.customer360.customers: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.customers"} */

  
    

  create  table "dbt"."public"."customers__dbt_tmp"
  
  
    as
  
  (
    SELECT
    id,
    gender,
    
    date_part('year', age(current_date, birth_date))
 AS age,
    sum(amount) as total_expense,
    date(min(transaction_date)) as first_purchase_date,
    date(max(transaction_date)) as last_purchase_date,
    sum(case when category = 'Apps & Games' then amount else 0 end) as apps_games_amount,
    sum(case when category = 'Beauty' then amount else 0 end)   as beauty_amount,
    sum(case when category = 'Books' then amount else 0 end)   as books_amount,
    sum(case when category = 'Clothing, Shoes & Accessories' then amount else 0 end)   as clothing_shoes_accessories_amount,
    sum(case when category = 'Movies & TV' then amount else 0 end)   as movies_tv_amount,
    sum(case when category = 'Sports, Fitness & Outdoors' then amount else 0 end)   as sports_fitness_outdoors_amount
FROM  "dbt"."public"."contacts_joined_with_transactions"
GROUP BY
    1,2,3
  );
  
[0m10:15:17.623528 [debug] [Thread-1 (]: SQL status: SELECT 9 in 0.0 seconds
[0m10:15:17.626799 [debug] [Thread-1 (]: Using postgres connection "model.customer360.customers"
[0m10:15:17.627185 [debug] [Thread-1 (]: On model.customer360.customers: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.customers"} */
alter table "dbt"."public"."customers" rename to "customers__dbt_backup"
[0m10:15:17.628106 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m10:15:17.631076 [debug] [Thread-1 (]: Using postgres connection "model.customer360.customers"
[0m10:15:17.631528 [debug] [Thread-1 (]: On model.customer360.customers: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.customers"} */
alter table "dbt"."public"."customers__dbt_tmp" rename to "customers"
[0m10:15:17.632223 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m10:15:17.634247 [debug] [Thread-1 (]: On model.customer360.customers: COMMIT
[0m10:15:17.634647 [debug] [Thread-1 (]: Using postgres connection "model.customer360.customers"
[0m10:15:17.634952 [debug] [Thread-1 (]: On model.customer360.customers: COMMIT
[0m10:15:17.636816 [debug] [Thread-1 (]: SQL status: COMMIT in 0.0 seconds
[0m10:15:17.639250 [debug] [Thread-1 (]: Applying DROP to: "dbt"."public"."customers__dbt_backup"
[0m10:15:17.640102 [debug] [Thread-1 (]: Using postgres connection "model.customer360.customers"
[0m10:15:17.640517 [debug] [Thread-1 (]: On model.customer360.customers: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.customers"} */
drop table if exists "dbt"."public"."customers__dbt_backup" cascade
[0m10:15:17.642815 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.0 seconds
[0m10:15:17.644144 [debug] [Thread-1 (]: Timing info for model.customer360.customers (execute): 10:15:17.607397 => 10:15:17.643959
[0m10:15:17.644589 [debug] [Thread-1 (]: On model.customer360.customers: Close
[0m10:15:17.645481 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '990ca00d-1d64-425d-8476-0c248d2f5417', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4b8d429090>]}
[0m10:15:17.646094 [info ] [Thread-1 (]: 19 of 20 OK created sql table model public.customers ........................... [[32mSELECT 9[0m in 0.04s]
[0m10:15:17.646840 [debug] [Thread-1 (]: Finished running node model.customer360.customers
[0m10:15:17.647723 [debug] [Thread-2 (]: Began running node test.customer360.custormers_test
[0m10:15:17.648074 [info ] [Thread-2 (]: 20 of 20 START test custormers_test ............................................ [RUN]
[0m10:15:17.648776 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311, now test.customer360.custormers_test)
[0m10:15:17.649099 [debug] [Thread-2 (]: Began compiling node test.customer360.custormers_test
[0m10:15:17.652319 [debug] [Thread-2 (]: Writing injected SQL for node "test.customer360.custormers_test"
[0m10:15:17.652943 [debug] [Thread-2 (]: Timing info for test.customer360.custormers_test (compile): 10:15:17.649432 => 10:15:17.652689
[0m10:15:17.653518 [debug] [Thread-2 (]: Began executing node test.customer360.custormers_test
[0m10:15:17.656149 [debug] [Thread-2 (]: Writing runtime sql for node "test.customer360.custormers_test"
[0m10:15:17.656765 [debug] [Thread-2 (]: Using postgres connection "test.customer360.custormers_test"
[0m10:15:17.657186 [debug] [Thread-2 (]: On test.customer360.custormers_test: BEGIN
[0m10:15:17.657557 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m10:15:17.661669 [debug] [Thread-2 (]: SQL status: BEGIN in 0.0 seconds
[0m10:15:17.662100 [debug] [Thread-2 (]: Using postgres connection "test.customer360.custormers_test"
[0m10:15:17.662586 [debug] [Thread-2 (]: On test.customer360.custormers_test: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.custormers_test"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      select
    1
from
(
    SELECT
        sum(total_expense) as total_expense,
        date(min(first_purchase_date)) as first_purchase_date,
        date(max(last_purchase_date)) as last_purchase_date,
        sum(apps_games_amount) as apps_games_amount,
        sum(beauty_amount)   as beauty_amount,
        sum(books_amount)   as books_amount,
        sum(clothing_shoes_accessories_amount)   as clothing_shoes_accessories_amount,
        sum(movies_tv_amount)   as movies_tv_amount,
        sum(sports_fitness_outdoors_amount)   as sports_fitness_outdoors_amount
    FROM  "dbt"."public"."customers"
) t1
join (
    SELECT
        sum(amount) as total_expense,
        date(min(transaction_date)) as first_purchase_date,
        date(max(transaction_date)) as last_purchase_date,
        sum(case when category = 'Apps & Games' then amount else 0 end) as apps_games_amount,
        sum(case when category = 'Beauty' then amount else 0 end)   as beauty_amount,
        sum(case when category = 'Books' then amount else 0 end)   as books_amount,
        sum(case when category = 'Clothing, Shoes & Accessories' then amount else 0 end)   as clothing_shoes_accessories_amount,
        sum(case when category = 'Movies & TV' then amount else 0 end)   as movies_tv_amount,
        sum(case when category = 'Sports, Fitness & Outdoors' then amount else 0 end)   as sports_fitness_outdoors_amount
    FROM  "dbt"."public"."contacts_joined_with_transactions"
) t2
on 1 = 1
where (
     nullif(cast(t1.total_expense as decimal(15,1))                   ,0)  <> nullif(cast(t2.total_expense                      as decimal(15,1)) ,0)
  or nullif(t1.first_purchase_date               ,'9999-12-31')       <> nullif(t2.first_purchase_date               ,'9999-12-31')
  or nullif(t1.last_purchase_date               ,'9999-12-31')        <> nullif(t2.last_purchase_date               ,'9999-12-31')
  or nullif(cast(t1.apps_games_amount                 as decimal(15,1)),0) <> nullif(cast(t2.apps_games_amount                 as decimal(15,1)) ,0)
  or nullif(cast(t1.beauty_amount                     as decimal(15,1)),0) <> nullif(cast(t2.beauty_amount                     as decimal(15,1)) ,0)
  or nullif(cast(t1.books_amount                      as decimal(15,1)),0) <> nullif(cast(t2.books_amount                      as decimal(15,1)) ,0)
  or nullif(cast(t1.clothing_shoes_accessories_amount as decimal(15,1)),0) <> nullif(cast(t2.clothing_shoes_accessories_amount as decimal(15,1)) ,0)
  or nullif(cast(t1.movies_tv_amount                  as decimal(15,1)),0) <> nullif(cast(t2.movies_tv_amount                  as decimal(15,1)) ,0)
  or nullif(cast(t1.sports_fitness_outdoors_amount    as decimal(15,1)),0) <> nullif(cast(t2.sports_fitness_outdoors_amount    as decimal(15,1)) ,0)
)
      
    ) dbt_internal_test
[0m10:15:17.665720 [debug] [Thread-2 (]: SQL status: SELECT 1 in 0.0 seconds
[0m10:15:17.667478 [debug] [Thread-2 (]: Timing info for test.customer360.custormers_test (execute): 10:15:17.653721 => 10:15:17.667224
[0m10:15:17.667870 [debug] [Thread-2 (]: On test.customer360.custormers_test: ROLLBACK
[0m10:15:17.668423 [debug] [Thread-2 (]: On test.customer360.custormers_test: Close
[0m10:15:17.669448 [info ] [Thread-2 (]: 20 of 20 PASS custormers_test .................................................. [[32mPASS[0m in 0.02s]
[0m10:15:17.670205 [debug] [Thread-2 (]: Finished running node test.customer360.custormers_test
[0m10:15:17.672097 [debug] [MainThread]: Using postgres connection "master"
[0m10:15:17.672439 [debug] [MainThread]: On master: BEGIN
[0m10:15:17.672785 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m10:15:17.676419 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m10:15:17.676803 [debug] [MainThread]: On master: COMMIT
[0m10:15:17.677060 [debug] [MainThread]: Using postgres connection "master"
[0m10:15:17.677353 [debug] [MainThread]: On master: COMMIT
[0m10:15:17.677877 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m10:15:17.678153 [debug] [MainThread]: On master: Close
[0m10:15:17.678852 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:15:17.679106 [debug] [MainThread]: Connection 'model.customer360.customers' was properly closed.
[0m10:15:17.679415 [debug] [MainThread]: Connection 'test.customer360.custormers_test' was properly closed.
[0m10:15:17.679835 [debug] [MainThread]: Connection 'model.customer360.sales_month_report' was properly closed.
[0m10:15:17.680289 [info ] [MainThread]: 
[0m10:15:17.680775 [info ] [MainThread]: Finished running 12 tests, 2 seeds, 2 view models, 4 table models in 0 hours 0 minutes and 1.11 seconds (1.11s).
[0m10:15:17.683892 [debug] [MainThread]: Command end result
[0m10:15:17.693538 [info ] [MainThread]: 
[0m10:15:17.693911 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m10:15:17.694263 [info ] [MainThread]: 
[0m10:15:17.694629 [error] [MainThread]:   Database Error in model top3_hot_categorys (models/recommend/top3_hot_categorys.sql)
  syntax error at or near "where"
  LINE 12: where rank <= 3
           ^
  compiled Code at target/run/customer360/models/recommend/top3_hot_categorys.sql
[0m10:15:17.694954 [info ] [MainThread]: 
[0m10:15:17.695368 [info ] [MainThread]: Done. PASS=17 WARN=0 ERROR=1 SKIP=2 TOTAL=20
[0m10:15:17.696196 [debug] [MainThread]: Resource report: {"command_name": "build", "command_wall_clock_time": 1.7197632, "process_user_time": 3.59046, "process_kernel_time": 0.130254, "process_mem_max_rss": "110388", "process_in_blocks": "64", "process_out_blocks": "3120", "command_success": false}
[0m10:15:17.696699 [debug] [MainThread]: Command `dbt build` failed at 10:15:17.696564 after 1.72 seconds
[0m10:15:17.697102 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4b8f761890>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4b93c96190>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4b93bd2ad0>]}
[0m10:15:17.697488 [debug] [MainThread]: Flushing usage events
[0m10:16:27.709229 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fca006d5610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fca006d6650>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fca0068ac50>]}


============================== 10:16:27.713008 | 35ac2ffe-7aa8-4f71-b055-272d88af8448 ==============================
[0m10:16:27.713008 [info ] [MainThread]: Running with dbt=1.7.8
[0m10:16:27.713742 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/root/option1-customer360/integration_tests/logs', 'profiles_dir': '/root/option1-customer360/integration_tests', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt build', 'static_parser': 'True', 'log_format': 'default', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m10:16:28.156380 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '35ac2ffe-7aa8-4f71-b055-272d88af8448', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fca006a9a90>]}
[0m10:16:28.276306 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '35ac2ffe-7aa8-4f71-b055-272d88af8448', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fca005cddd0>]}
[0m10:16:28.277203 [info ] [MainThread]: Registered adapter: postgres=1.7.8
[0m10:16:28.293342 [debug] [MainThread]: checksum: 67f0013ca5f0bd43af9a0873dd50792fde83ef69de63b71cacd0b4ac656c52e5, vars: {}, profile: , target: , version: 1.7.8
[0m10:16:28.342139 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m10:16:28.343024 [debug] [MainThread]: Partial parsing: updated file: customer360://models/recommend/top3_hot_categorys.sql
[0m10:16:28.695742 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '35ac2ffe-7aa8-4f71-b055-272d88af8448', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc9fe304d50>]}
[0m10:16:28.704610 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '35ac2ffe-7aa8-4f71-b055-272d88af8448', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc9feadf650>]}
[0m10:16:28.705049 [info ] [MainThread]: Found 2 seeds, 6 models, 12 tests, 2 sources, 0 exposures, 0 metrics, 403 macros, 0 groups, 0 semantic models
[0m10:16:28.707167 [info ] [MainThread]: 
[0m10:16:28.707838 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m10:16:28.709090 [debug] [ThreadPool]: Acquiring new postgres connection 'list_dbt'
[0m10:16:28.718562 [debug] [ThreadPool]: Using postgres connection "list_dbt"
[0m10:16:28.718872 [debug] [ThreadPool]: On list_dbt: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "connection_name": "list_dbt"} */

    select distinct nspname from pg_namespace
  
[0m10:16:28.719134 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:16:28.723850 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.0 seconds
[0m10:16:28.725060 [debug] [ThreadPool]: On list_dbt: Close
[0m10:16:28.727182 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dbt, now list_dbt_public)
[0m10:16:28.732908 [debug] [ThreadPool]: Using postgres connection "list_dbt_public"
[0m10:16:28.733314 [debug] [ThreadPool]: On list_dbt_public: BEGIN
[0m10:16:28.733578 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:16:28.736647 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m10:16:28.736932 [debug] [ThreadPool]: Using postgres connection "list_dbt_public"
[0m10:16:28.737237 [debug] [ThreadPool]: On list_dbt_public: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "connection_name": "list_dbt_public"} */
select
      'dbt' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'dbt' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'dbt' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m10:16:28.740021 [debug] [ThreadPool]: SQL status: SELECT 7 in 0.0 seconds
[0m10:16:28.741250 [debug] [ThreadPool]: On list_dbt_public: ROLLBACK
[0m10:16:28.741735 [debug] [ThreadPool]: On list_dbt_public: Close
[0m10:16:28.747590 [debug] [MainThread]: Using postgres connection "master"
[0m10:16:28.747881 [debug] [MainThread]: On master: BEGIN
[0m10:16:28.748135 [debug] [MainThread]: Opening a new connection, currently in state init
[0m10:16:28.751174 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m10:16:28.751526 [debug] [MainThread]: Using postgres connection "master"
[0m10:16:28.751864 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m10:16:28.762411 [debug] [MainThread]: SQL status: SELECT 2 in 0.0 seconds
[0m10:16:28.764155 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '35ac2ffe-7aa8-4f71-b055-272d88af8448', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc9fe3f6090>]}
[0m10:16:28.764545 [debug] [MainThread]: On master: ROLLBACK
[0m10:16:28.765033 [debug] [MainThread]: Using postgres connection "master"
[0m10:16:28.765336 [debug] [MainThread]: On master: BEGIN
[0m10:16:28.765970 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m10:16:28.766251 [debug] [MainThread]: On master: COMMIT
[0m10:16:28.766531 [debug] [MainThread]: Using postgres connection "master"
[0m10:16:28.766791 [debug] [MainThread]: On master: COMMIT
[0m10:16:28.767208 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m10:16:28.767494 [debug] [MainThread]: On master: Close
[0m10:16:28.768092 [info ] [MainThread]: Concurrency: 3 threads (target='local')
[0m10:16:28.768449 [info ] [MainThread]: 
[0m10:16:28.771094 [debug] [Thread-1 (]: Began running node seed.integration_tests.contacts
[0m10:16:28.771525 [debug] [Thread-2 (]: Began running node seed.integration_tests.transactions
[0m10:16:28.771867 [debug] [Thread-3 (]: Began running node test.customer360.macro_test1
[0m10:16:28.772308 [info ] [Thread-1 (]: 1 of 20 START seed file public.contacts ........................................ [RUN]
[0m10:16:28.772816 [info ] [Thread-2 (]: 2 of 20 START seed file public.transactions .................................... [RUN]
[0m10:16:28.773225 [info ] [Thread-3 (]: 3 of 20 START test macro_test1 ................................................. [RUN]
[0m10:16:28.773946 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dbt_public, now seed.integration_tests.contacts)
[0m10:16:28.774764 [debug] [Thread-2 (]: Acquiring new postgres connection 'seed.integration_tests.transactions'
[0m10:16:28.775440 [debug] [Thread-3 (]: Acquiring new postgres connection 'test.customer360.macro_test1'
[0m10:16:28.775965 [debug] [Thread-1 (]: Began compiling node seed.integration_tests.contacts
[0m10:16:28.776326 [debug] [Thread-2 (]: Began compiling node seed.integration_tests.transactions
[0m10:16:28.776658 [debug] [Thread-3 (]: Began compiling node test.customer360.macro_test1
[0m10:16:28.777104 [debug] [Thread-1 (]: Timing info for seed.integration_tests.contacts (compile): 10:16:28.776905 => 10:16:28.776909
[0m10:16:28.777535 [debug] [Thread-2 (]: Timing info for seed.integration_tests.transactions (compile): 10:16:28.777348 => 10:16:28.777350
[0m10:16:28.784465 [debug] [Thread-3 (]: Writing injected SQL for node "test.customer360.macro_test1"
[0m10:16:28.784814 [debug] [Thread-1 (]: Began executing node seed.integration_tests.contacts
[0m10:16:28.785201 [debug] [Thread-2 (]: Began executing node seed.integration_tests.transactions
[0m10:16:28.818491 [debug] [Thread-1 (]: Using postgres connection "seed.integration_tests.contacts"
[0m10:16:28.820049 [debug] [Thread-2 (]: Using postgres connection "seed.integration_tests.transactions"
[0m10:16:28.820512 [debug] [Thread-3 (]: Timing info for test.customer360.macro_test1 (compile): 10:16:28.777749 => 10:16:28.820290
[0m10:16:28.820840 [debug] [Thread-1 (]: On seed.integration_tests.contacts: BEGIN
[0m10:16:28.821339 [debug] [Thread-2 (]: On seed.integration_tests.transactions: BEGIN
[0m10:16:28.821712 [debug] [Thread-3 (]: Began executing node test.customer360.macro_test1
[0m10:16:28.822057 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:16:28.822412 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m10:16:28.836952 [debug] [Thread-3 (]: Writing runtime sql for node "test.customer360.macro_test1"
[0m10:16:28.837930 [debug] [Thread-3 (]: Using postgres connection "test.customer360.macro_test1"
[0m10:16:28.838402 [debug] [Thread-3 (]: On test.customer360.macro_test1: BEGIN
[0m10:16:28.838935 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m10:16:28.842940 [debug] [Thread-3 (]: SQL status: BEGIN in 0.0 seconds
[0m10:16:28.843434 [debug] [Thread-3 (]: Using postgres connection "test.customer360.macro_test1"
[0m10:16:28.844233 [debug] [Thread-3 (]: On test.customer360.macro_test1: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.macro_test1"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      with marco_result as (
    select 
    date_part('year', age(current_date, '2023-02-12'))
 as expect_result
)
select
    1
from marco_result
where expect_result <> 1
      
    ) dbt_internal_test
[0m10:16:28.843883 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m10:16:28.844759 [debug] [Thread-1 (]: Using postgres connection "seed.integration_tests.contacts"
[0m10:16:28.845243 [debug] [Thread-1 (]: On seed.integration_tests.contacts: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "seed.integration_tests.contacts"} */
truncate table "dbt"."public"."contacts"
[0m10:16:28.846004 [debug] [Thread-3 (]: SQL status: SELECT 1 in 0.0 seconds
[0m10:16:28.848152 [debug] [Thread-3 (]: Timing info for test.customer360.macro_test1 (execute): 10:16:28.822650 => 10:16:28.847911
[0m10:16:28.848713 [debug] [Thread-2 (]: SQL status: BEGIN in 0.0 seconds
[0m10:16:28.850269 [debug] [Thread-3 (]: On test.customer360.macro_test1: ROLLBACK
[0m10:16:28.851309 [debug] [Thread-1 (]: SQL status: TRUNCATE TABLE in 0.0 seconds
[0m10:16:28.850841 [debug] [Thread-2 (]: Using postgres connection "seed.integration_tests.transactions"
[0m10:16:28.874990 [debug] [Thread-2 (]: On seed.integration_tests.transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "seed.integration_tests.transactions"} */
truncate table "dbt"."public"."transactions"
[0m10:16:28.934304 [debug] [Thread-3 (]: On test.customer360.macro_test1: Close
[0m10:16:28.935486 [info ] [Thread-3 (]: 3 of 20 PASS macro_test1 ....................................................... [[32mPASS[0m in 0.16s]
[0m10:16:28.936194 [debug] [Thread-3 (]: Finished running node test.customer360.macro_test1
[0m10:16:28.936866 [debug] [Thread-3 (]: Began running node test.customer360.macro_test2
[0m10:16:28.937335 [info ] [Thread-3 (]: 4 of 20 START test macro_test2 ................................................. [RUN]
[0m10:16:28.942915 [debug] [Thread-2 (]: SQL status: TRUNCATE TABLE in 0.0 seconds
[0m10:16:28.944230 [debug] [Thread-1 (]: Using postgres connection "seed.integration_tests.contacts"
[0m10:16:28.944850 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.customer360.macro_test1, now test.customer360.macro_test2)
[0m10:16:28.960716 [debug] [Thread-1 (]: On seed.integration_tests.contacts: 
          insert into "dbt"."public"."contacts" ("id", "username", "name", "gender", "address", "mail", "birthdate", "_loaded_at_utc") values
          (%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s)
      ...
[0m10:16:28.986390 [debug] [Thread-3 (]: Began compiling node test.customer360.macro_test2
[0m10:16:29.027269 [debug] [Thread-3 (]: Writing injected SQL for node "test.customer360.macro_test2"
[0m10:16:29.027732 [debug] [Thread-1 (]: SQL status: INSERT 0 10 in 0.0 seconds
[0m10:16:29.037943 [debug] [Thread-1 (]: Writing runtime SQL for node "seed.integration_tests.contacts"
[0m10:16:29.043799 [debug] [Thread-3 (]: Timing info for test.customer360.macro_test2 (compile): 10:16:29.023348 => 10:16:29.043577
[0m10:16:29.059602 [debug] [Thread-3 (]: Began executing node test.customer360.macro_test2
[0m10:16:29.068218 [debug] [Thread-1 (]: On seed.integration_tests.contacts: COMMIT
[0m10:16:29.077132 [debug] [Thread-3 (]: Writing runtime sql for node "test.customer360.macro_test2"
[0m10:16:29.095737 [debug] [Thread-1 (]: Using postgres connection "seed.integration_tests.contacts"
[0m10:16:29.130095 [debug] [Thread-1 (]: On seed.integration_tests.contacts: COMMIT
[0m10:16:29.129612 [debug] [Thread-2 (]: Using postgres connection "seed.integration_tests.transactions"
[0m10:16:29.130618 [debug] [Thread-3 (]: Using postgres connection "test.customer360.macro_test2"
[0m10:16:29.131028 [debug] [Thread-2 (]: On seed.integration_tests.transactions: 
          insert into "dbt"."public"."transactions" ("contact_id", "id", "transaction_date", "amount", "item_count", "category", "_loaded_at_utc") values
          (%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%...
[0m10:16:29.131452 [debug] [Thread-3 (]: On test.customer360.macro_test2: BEGIN
[0m10:16:29.133166 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m10:16:29.132713 [debug] [Thread-1 (]: SQL status: COMMIT in 0.0 seconds
[0m10:16:29.135226 [debug] [Thread-1 (]: Timing info for seed.integration_tests.contacts (execute): 10:16:28.785521 => 10:16:29.134866
[0m10:16:29.136057 [debug] [Thread-1 (]: On seed.integration_tests.contacts: Close
[0m10:16:29.136982 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '35ac2ffe-7aa8-4f71-b055-272d88af8448', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc9fea455d0>]}
[0m10:16:29.137652 [info ] [Thread-1 (]: 1 of 20 OK loaded seed file public.contacts .................................... [[32mINSERT 10[0m in 0.36s]
[0m10:16:29.138280 [debug] [Thread-1 (]: Finished running node seed.integration_tests.contacts
[0m10:16:29.138909 [debug] [Thread-1 (]: Began running node test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247
[0m10:16:29.139402 [info ] [Thread-1 (]: 5 of 20 START test source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors  [RUN]
[0m10:16:29.140161 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly seed.integration_tests.contacts, now test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247)
[0m10:16:29.140553 [debug] [Thread-1 (]: Began compiling node test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247
[0m10:16:29.135659 [debug] [Thread-2 (]: SQL status: INSERT 0 100 in 0.0 seconds
[0m10:16:29.158904 [debug] [Thread-2 (]: Writing runtime SQL for node "seed.integration_tests.transactions"
[0m10:16:29.157496 [debug] [Thread-3 (]: SQL status: BEGIN in 0.0 seconds
[0m10:16:29.161909 [debug] [Thread-3 (]: Using postgres connection "test.customer360.macro_test2"
[0m10:16:29.162400 [debug] [Thread-3 (]: On test.customer360.macro_test2: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.macro_test2"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      with marco_result as (
    select 
        to_timestamp('2023-02-27 21:00:00','YYYY-MM-DD HH24:MI:SS.MS') :: timestamp at TIME zone 'UTC'
     as expect_result
)
select
    1
from marco_result
where cast(pg_typeof(expect_result) as text) not like '%timestamp%'
      
    ) dbt_internal_test
[0m10:16:29.165236 [debug] [Thread-1 (]: Writing injected SQL for node "test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247"
[0m10:16:29.166077 [debug] [Thread-1 (]: Timing info for test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247 (compile): 10:16:29.140748 => 10:16:29.165743
[0m10:16:29.166630 [debug] [Thread-1 (]: Began executing node test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247
[0m10:16:29.161277 [debug] [Thread-2 (]: On seed.integration_tests.transactions: COMMIT
[0m10:16:29.170193 [debug] [Thread-1 (]: Writing runtime sql for node "test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247"
[0m10:16:29.170650 [debug] [Thread-3 (]: SQL status: SELECT 1 in 0.0 seconds
[0m10:16:29.170989 [debug] [Thread-2 (]: Using postgres connection "seed.integration_tests.transactions"
[0m10:16:29.172691 [debug] [Thread-3 (]: Timing info for test.customer360.macro_test2 (execute): 10:16:29.075135 => 10:16:29.172477
[0m10:16:29.173200 [debug] [Thread-1 (]: Using postgres connection "test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247"
[0m10:16:29.173576 [debug] [Thread-2 (]: On seed.integration_tests.transactions: COMMIT
[0m10:16:29.173956 [debug] [Thread-3 (]: On test.customer360.macro_test2: ROLLBACK
[0m10:16:29.174361 [debug] [Thread-1 (]: On test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247: BEGIN
[0m10:16:29.174879 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:16:29.176720 [debug] [Thread-3 (]: On test.customer360.macro_test2: Close
[0m10:16:29.177090 [debug] [Thread-2 (]: SQL status: COMMIT in 0.0 seconds
[0m10:16:29.178925 [debug] [Thread-2 (]: Timing info for seed.integration_tests.transactions (execute): 10:16:28.799118 => 10:16:29.178678
[0m10:16:29.179425 [debug] [Thread-2 (]: On seed.integration_tests.transactions: Close
[0m10:16:29.180322 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '35ac2ffe-7aa8-4f71-b055-272d88af8448', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc9feadce10>]}
[0m10:16:29.177875 [info ] [Thread-3 (]: 4 of 20 PASS macro_test2 ....................................................... [[32mPASS[0m in 0.23s]
[0m10:16:29.182029 [debug] [Thread-3 (]: Finished running node test.customer360.macro_test2
[0m10:16:29.182578 [debug] [Thread-3 (]: Began running node test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d
[0m10:16:29.183055 [info ] [Thread-3 (]: 6 of 20 START test source_not_null_salesforce_contacts_id ...................... [RUN]
[0m10:16:29.184432 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.customer360.macro_test2, now test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d)
[0m10:16:29.184906 [debug] [Thread-3 (]: Began compiling node test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d
[0m10:16:29.181232 [info ] [Thread-2 (]: 2 of 20 OK loaded seed file public.transactions ................................ [[32mINSERT 100[0m in 0.41s]
[0m10:16:29.192470 [debug] [Thread-2 (]: Finished running node seed.integration_tests.transactions
[0m10:16:29.193056 [debug] [Thread-2 (]: Began running node test.customer360.source_not_null_web_transactions_id.88a47bf7e5
[0m10:16:29.193659 [info ] [Thread-2 (]: 7 of 20 START test source_not_null_web_transactions_id ......................... [RUN]
[0m10:16:29.194484 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly seed.integration_tests.transactions, now test.customer360.source_not_null_web_transactions_id.88a47bf7e5)
[0m10:16:29.194944 [debug] [Thread-2 (]: Began compiling node test.customer360.source_not_null_web_transactions_id.88a47bf7e5
[0m10:16:29.202611 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m10:16:29.203139 [debug] [Thread-1 (]: Using postgres connection "test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247"
[0m10:16:29.203699 [debug] [Thread-1 (]: On test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

with all_values as (

    select
        category as value_field,
        count(*) as n_records

    from "dbt"."public"."transactions"
    group by category

)

select *
from all_values
where value_field not in (
    'Apps & Games','Beauty','Books','Clothing, Shoes & Accessories','Movies & TV','Sports, Fitness & Outdoors'
)



      
    ) dbt_internal_test
[0m10:16:29.206701 [debug] [Thread-3 (]: Writing injected SQL for node "test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d"
[0m10:16:29.207706 [debug] [Thread-3 (]: Timing info for test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d (compile): 10:16:29.185231 => 10:16:29.207140
[0m10:16:29.208189 [debug] [Thread-3 (]: Began executing node test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d
[0m10:16:29.211653 [debug] [Thread-3 (]: Writing runtime sql for node "test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d"
[0m10:16:29.214188 [debug] [Thread-2 (]: Writing injected SQL for node "test.customer360.source_not_null_web_transactions_id.88a47bf7e5"
[0m10:16:29.214931 [debug] [Thread-2 (]: Timing info for test.customer360.source_not_null_web_transactions_id.88a47bf7e5 (compile): 10:16:29.195229 => 10:16:29.214613
[0m10:16:29.215585 [debug] [Thread-2 (]: Began executing node test.customer360.source_not_null_web_transactions_id.88a47bf7e5
[0m10:16:29.218732 [debug] [Thread-2 (]: Writing runtime sql for node "test.customer360.source_not_null_web_transactions_id.88a47bf7e5"
[0m10:16:29.219384 [debug] [Thread-2 (]: Using postgres connection "test.customer360.source_not_null_web_transactions_id.88a47bf7e5"
[0m10:16:29.219858 [debug] [Thread-2 (]: On test.customer360.source_not_null_web_transactions_id.88a47bf7e5: BEGIN
[0m10:16:29.220329 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m10:16:29.221493 [debug] [Thread-3 (]: Using postgres connection "test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d"
[0m10:16:29.221970 [debug] [Thread-3 (]: On test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d: BEGIN
[0m10:16:29.222642 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m10:16:29.223290 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.0 seconds
[0m10:16:29.225007 [debug] [Thread-1 (]: Timing info for test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247 (execute): 10:16:29.166962 => 10:16:29.224683
[0m10:16:29.225554 [debug] [Thread-1 (]: On test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247: ROLLBACK
[0m10:16:29.227009 [debug] [Thread-1 (]: On test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247: Close
[0m10:16:29.228155 [info ] [Thread-1 (]: 5 of 20 PASS source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors  [[32mPASS[0m in 0.09s]
[0m10:16:29.228953 [debug] [Thread-1 (]: Finished running node test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247
[0m10:16:29.229524 [debug] [Thread-1 (]: Began running node test.customer360.source_unique_salesforce_contacts_id.01cadaaf43
[0m10:16:29.230020 [info ] [Thread-1 (]: 8 of 20 START test source_unique_salesforce_contacts_id ........................ [RUN]
[0m10:16:29.230872 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.customer360.source_accepted_values_web_transactions_category__Apps_Games__Beauty__Books__Clothing_Shoes_Accessories__Movies_TV__Sports_Fitness_Outdoors.23608d4247, now test.customer360.source_unique_salesforce_contacts_id.01cadaaf43)
[0m10:16:29.231385 [debug] [Thread-1 (]: Began compiling node test.customer360.source_unique_salesforce_contacts_id.01cadaaf43
[0m10:16:29.242463 [debug] [Thread-1 (]: Writing injected SQL for node "test.customer360.source_unique_salesforce_contacts_id.01cadaaf43"
[0m10:16:29.243400 [debug] [Thread-1 (]: Timing info for test.customer360.source_unique_salesforce_contacts_id.01cadaaf43 (compile): 10:16:29.231688 => 10:16:29.243059
[0m10:16:29.243898 [debug] [Thread-1 (]: Began executing node test.customer360.source_unique_salesforce_contacts_id.01cadaaf43
[0m10:16:29.248104 [debug] [Thread-1 (]: Writing runtime sql for node "test.customer360.source_unique_salesforce_contacts_id.01cadaaf43"
[0m10:16:29.248824 [debug] [Thread-1 (]: Using postgres connection "test.customer360.source_unique_salesforce_contacts_id.01cadaaf43"
[0m10:16:29.249337 [debug] [Thread-1 (]: On test.customer360.source_unique_salesforce_contacts_id.01cadaaf43: BEGIN
[0m10:16:29.249790 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:16:29.253014 [debug] [Thread-3 (]: SQL status: BEGIN in 0.0 seconds
[0m10:16:29.253517 [debug] [Thread-3 (]: Using postgres connection "test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d"
[0m10:16:29.253999 [debug] [Thread-3 (]: On test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select id
from "dbt"."public"."contacts"
where id is null



      
    ) dbt_internal_test
[0m10:16:29.256952 [debug] [Thread-3 (]: SQL status: SELECT 1 in 0.0 seconds
[0m10:16:29.259193 [debug] [Thread-3 (]: Timing info for test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d (execute): 10:16:29.208502 => 10:16:29.258584
[0m10:16:29.260616 [debug] [Thread-3 (]: On test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d: ROLLBACK
[0m10:16:29.263005 [debug] [Thread-2 (]: SQL status: BEGIN in 0.0 seconds
[0m10:16:29.263516 [debug] [Thread-2 (]: Using postgres connection "test.customer360.source_not_null_web_transactions_id.88a47bf7e5"
[0m10:16:29.264040 [debug] [Thread-2 (]: On test.customer360.source_not_null_web_transactions_id.88a47bf7e5: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.source_not_null_web_transactions_id.88a47bf7e5"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select id
from "dbt"."public"."transactions"
where id is null



      
    ) dbt_internal_test
[0m10:16:29.268050 [debug] [Thread-3 (]: On test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d: Close
[0m10:16:29.269180 [info ] [Thread-3 (]: 6 of 20 PASS source_not_null_salesforce_contacts_id ............................ [[32mPASS[0m in 0.09s]
[0m10:16:29.269965 [debug] [Thread-3 (]: Finished running node test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d
[0m10:16:29.270561 [debug] [Thread-3 (]: Began running node test.customer360.source_unique_web_transactions_id.ba28079761
[0m10:16:29.271049 [info ] [Thread-3 (]: 9 of 20 START test source_unique_web_transactions_id ........................... [RUN]
[0m10:16:29.271906 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.customer360.source_not_null_salesforce_contacts_id.c732d8a00d, now test.customer360.source_unique_web_transactions_id.ba28079761)
[0m10:16:29.272426 [debug] [Thread-3 (]: Began compiling node test.customer360.source_unique_web_transactions_id.ba28079761
[0m10:16:29.280429 [debug] [Thread-3 (]: Writing injected SQL for node "test.customer360.source_unique_web_transactions_id.ba28079761"
[0m10:16:29.281218 [debug] [Thread-3 (]: Timing info for test.customer360.source_unique_web_transactions_id.ba28079761 (compile): 10:16:29.272720 => 10:16:29.280932
[0m10:16:29.281765 [debug] [Thread-3 (]: Began executing node test.customer360.source_unique_web_transactions_id.ba28079761
[0m10:16:29.286781 [debug] [Thread-3 (]: Writing runtime sql for node "test.customer360.source_unique_web_transactions_id.ba28079761"
[0m10:16:29.287482 [debug] [Thread-3 (]: Using postgres connection "test.customer360.source_unique_web_transactions_id.ba28079761"
[0m10:16:29.287931 [debug] [Thread-3 (]: On test.customer360.source_unique_web_transactions_id.ba28079761: BEGIN
[0m10:16:29.288372 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m10:16:29.289414 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m10:16:29.289912 [debug] [Thread-1 (]: Using postgres connection "test.customer360.source_unique_salesforce_contacts_id.01cadaaf43"
[0m10:16:29.291127 [debug] [Thread-1 (]: On test.customer360.source_unique_salesforce_contacts_id.01cadaaf43: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.source_unique_salesforce_contacts_id.01cadaaf43"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

select
    id as unique_field,
    count(*) as n_records

from "dbt"."public"."contacts"
where id is not null
group by id
having count(*) > 1



      
    ) dbt_internal_test
[0m10:16:29.290394 [debug] [Thread-2 (]: SQL status: SELECT 1 in 0.0 seconds
[0m10:16:29.293221 [debug] [Thread-2 (]: Timing info for test.customer360.source_not_null_web_transactions_id.88a47bf7e5 (execute): 10:16:29.215890 => 10:16:29.292890
[0m10:16:29.293755 [debug] [Thread-2 (]: On test.customer360.source_not_null_web_transactions_id.88a47bf7e5: ROLLBACK
[0m10:16:29.294679 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.0 seconds
[0m10:16:29.296347 [debug] [Thread-1 (]: Timing info for test.customer360.source_unique_salesforce_contacts_id.01cadaaf43 (execute): 10:16:29.244192 => 10:16:29.296049
[0m10:16:29.296818 [debug] [Thread-1 (]: On test.customer360.source_unique_salesforce_contacts_id.01cadaaf43: ROLLBACK
[0m10:16:29.297651 [debug] [Thread-2 (]: On test.customer360.source_not_null_web_transactions_id.88a47bf7e5: Close
[0m10:16:29.298700 [info ] [Thread-2 (]: 7 of 20 PASS source_not_null_web_transactions_id ............................... [[32mPASS[0m in 0.10s]
[0m10:16:29.299455 [debug] [Thread-2 (]: Finished running node test.customer360.source_not_null_web_transactions_id.88a47bf7e5
[0m10:16:29.300001 [debug] [Thread-2 (]: Began running node test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344
[0m10:16:29.300584 [info ] [Thread-2 (]: 10 of 20 START test source_relationships_web_transactions_contact_id__id__ref_contacts_  [RUN]
[0m10:16:29.301424 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.customer360.source_not_null_web_transactions_id.88a47bf7e5, now test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344)
[0m10:16:29.301916 [debug] [Thread-2 (]: Began compiling node test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344
[0m10:16:29.309882 [debug] [Thread-1 (]: On test.customer360.source_unique_salesforce_contacts_id.01cadaaf43: Close
[0m10:16:29.310961 [info ] [Thread-1 (]: 8 of 20 PASS source_unique_salesforce_contacts_id .............................. [[32mPASS[0m in 0.08s]
[0m10:16:29.311718 [debug] [Thread-1 (]: Finished running node test.customer360.source_unique_salesforce_contacts_id.01cadaaf43
[0m10:16:29.312266 [debug] [Thread-1 (]: Began running node model.customer360.top3_hot_categorys
[0m10:16:29.312845 [info ] [Thread-1 (]: 11 of 20 START sql view model public.top3_hot_categorys ........................ [RUN]
[0m10:16:29.315417 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.customer360.source_unique_salesforce_contacts_id.01cadaaf43, now model.customer360.top3_hot_categorys)
[0m10:16:29.315917 [debug] [Thread-1 (]: Began compiling node model.customer360.top3_hot_categorys
[0m10:16:29.319591 [debug] [Thread-1 (]: Writing injected SQL for node "model.customer360.top3_hot_categorys"
[0m10:16:29.320379 [debug] [Thread-1 (]: Timing info for model.customer360.top3_hot_categorys (compile): 10:16:29.316199 => 10:16:29.320053
[0m10:16:29.320851 [debug] [Thread-1 (]: Began executing node model.customer360.top3_hot_categorys
[0m10:16:29.327744 [debug] [Thread-3 (]: SQL status: BEGIN in 0.0 seconds
[0m10:16:29.328257 [debug] [Thread-3 (]: Using postgres connection "test.customer360.source_unique_web_transactions_id.ba28079761"
[0m10:16:29.328778 [debug] [Thread-3 (]: On test.customer360.source_unique_web_transactions_id.ba28079761: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.source_unique_web_transactions_id.ba28079761"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

select
    id as unique_field,
    count(*) as n_records

from "dbt"."public"."transactions"
where id is not null
group by id
having count(*) > 1



      
    ) dbt_internal_test
[0m10:16:29.335087 [debug] [Thread-2 (]: Writing injected SQL for node "test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344"
[0m10:16:29.335901 [debug] [Thread-2 (]: Timing info for test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344 (compile): 10:16:29.302206 => 10:16:29.335593
[0m10:16:29.336432 [debug] [Thread-2 (]: Began executing node test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344
[0m10:16:29.339817 [debug] [Thread-2 (]: Writing runtime sql for node "test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344"
[0m10:16:29.340491 [debug] [Thread-2 (]: Using postgres connection "test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344"
[0m10:16:29.340957 [debug] [Thread-2 (]: On test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344: BEGIN
[0m10:16:29.341406 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m10:16:29.342555 [debug] [Thread-3 (]: SQL status: SELECT 1 in 0.0 seconds
[0m10:16:29.344434 [debug] [Thread-3 (]: Timing info for test.customer360.source_unique_web_transactions_id.ba28079761 (execute): 10:16:29.282050 => 10:16:29.344101
[0m10:16:29.344912 [debug] [Thread-3 (]: On test.customer360.source_unique_web_transactions_id.ba28079761: ROLLBACK
[0m10:16:29.351672 [debug] [Thread-3 (]: On test.customer360.source_unique_web_transactions_id.ba28079761: Close
[0m10:16:29.352898 [info ] [Thread-3 (]: 9 of 20 PASS source_unique_web_transactions_id ................................. [[32mPASS[0m in 0.08s]
[0m10:16:29.353673 [debug] [Thread-3 (]: Finished running node test.customer360.source_unique_web_transactions_id.ba28079761
[0m10:16:29.354207 [debug] [Thread-3 (]: Began running node model.customer360.stg_sf__contacts
[0m10:16:29.354805 [info ] [Thread-3 (]: 12 of 20 START sql table model public.stg_sf__contacts ......................... [RUN]
[0m10:16:29.357689 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.customer360.source_unique_web_transactions_id.ba28079761, now model.customer360.stg_sf__contacts)
[0m10:16:29.358214 [debug] [Thread-3 (]: Began compiling node model.customer360.stg_sf__contacts
[0m10:16:29.361786 [debug] [Thread-3 (]: Writing injected SQL for node "model.customer360.stg_sf__contacts"
[0m10:16:29.362899 [debug] [Thread-3 (]: Timing info for model.customer360.stg_sf__contacts (compile): 10:16:29.358502 => 10:16:29.362237
[0m10:16:29.363375 [debug] [Thread-3 (]: Began executing node model.customer360.stg_sf__contacts
[0m10:16:29.407904 [debug] [Thread-2 (]: SQL status: BEGIN in 0.0 seconds
[0m10:16:29.408496 [debug] [Thread-2 (]: Using postgres connection "test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344"
[0m10:16:29.409007 [debug] [Thread-2 (]: On test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

with child as (
    select contact_id as from_field
    from "dbt"."public"."transactions"
    where contact_id is not null
),

parent as (
    select id as to_field
    from "dbt"."public"."contacts"
)

select
    from_field

from child
left join parent
    on child.from_field = parent.to_field

where parent.to_field is null



      
    ) dbt_internal_test
[0m10:16:29.422534 [debug] [Thread-2 (]: SQL status: SELECT 1 in 0.0 seconds
[0m10:16:29.432583 [debug] [Thread-2 (]: Timing info for test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344 (execute): 10:16:29.336828 => 10:16:29.432340
[0m10:16:29.444613 [debug] [Thread-2 (]: On test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344: ROLLBACK
[0m10:16:29.438647 [debug] [Thread-3 (]: Writing runtime sql for node "model.customer360.stg_sf__contacts"
[0m10:16:29.445416 [debug] [Thread-3 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m10:16:29.445927 [debug] [Thread-3 (]: On model.customer360.stg_sf__contacts: BEGIN
[0m10:16:29.446601 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m10:16:29.447693 [debug] [Thread-2 (]: On test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344: Close
[0m10:16:29.448823 [info ] [Thread-2 (]: 10 of 20 PASS source_relationships_web_transactions_contact_id__id__ref_contacts_  [[32mPASS[0m in 0.15s]
[0m10:16:29.449725 [debug] [Thread-2 (]: Finished running node test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344
[0m10:16:29.450253 [debug] [Thread-2 (]: Began running node model.customer360.stg_web__transactions
[0m10:16:29.450855 [info ] [Thread-2 (]: 13 of 20 START sql table model public.stg_web__transactions .................... [RUN]
[0m10:16:29.451687 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.customer360.source_relationships_web_transactions_contact_id__id__ref_contacts_.92a61fe344, now model.customer360.stg_web__transactions)
[0m10:16:29.452174 [debug] [Thread-2 (]: Began compiling node model.customer360.stg_web__transactions
[0m10:16:29.457219 [debug] [Thread-2 (]: Writing injected SQL for node "model.customer360.stg_web__transactions"
[0m10:16:29.443052 [debug] [Thread-1 (]: Writing runtime sql for node "model.customer360.top3_hot_categorys"
[0m10:16:29.459043 [debug] [Thread-1 (]: Using postgres connection "model.customer360.top3_hot_categorys"
[0m10:16:29.459548 [debug] [Thread-1 (]: On model.customer360.top3_hot_categorys: BEGIN
[0m10:16:29.460038 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:16:29.458072 [debug] [Thread-2 (]: Timing info for model.customer360.stg_web__transactions (compile): 10:16:29.452995 => 10:16:29.457715
[0m10:16:29.462252 [debug] [Thread-2 (]: Began executing node model.customer360.stg_web__transactions
[0m10:16:29.469957 [debug] [Thread-2 (]: Writing runtime sql for node "model.customer360.stg_web__transactions"
[0m10:16:29.470758 [debug] [Thread-2 (]: Using postgres connection "model.customer360.stg_web__transactions"
[0m10:16:29.471311 [debug] [Thread-2 (]: On model.customer360.stg_web__transactions: BEGIN
[0m10:16:29.471772 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m10:16:29.493740 [debug] [Thread-3 (]: SQL status: BEGIN in 0.0 seconds
[0m10:16:29.494331 [debug] [Thread-3 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m10:16:29.494831 [debug] [Thread-3 (]: On model.customer360.stg_sf__contacts: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_sf__contacts"} */

  
    

  create  table "dbt"."public"."stg_sf__contacts__dbt_tmp"
  
  
    as
  
  (
    with source as (
    select * from "dbt"."public"."contacts"
),

renamed as (
    select
        id,
        username as user_name,
        name,
        gender,
        address, 
        mail as email_address,
        birthdate as birth_date,
        _loaded_at_utc
    from source     
)

select * from renamed
  );
  
[0m10:16:29.508744 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m10:16:29.509385 [debug] [Thread-1 (]: Using postgres connection "model.customer360.top3_hot_categorys"
[0m10:16:29.509856 [debug] [Thread-1 (]: On model.customer360.top3_hot_categorys: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.top3_hot_categorys"} */

  create view "dbt"."public"."top3_hot_categorys__dbt_tmp"
    
    
  as (
    select
     category
    ,rank
from (
    select 
         category
        ,row_number() over (partition by 1 order by count(1) desc) as rank
    from "dbt"."public"."transactions"
    group by category
) tmp
where rank <= 3
  );
[0m10:16:29.510480 [debug] [Thread-3 (]: SQL status: SELECT 10 in 0.0 seconds
[0m10:16:29.522787 [debug] [Thread-3 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m10:16:29.523387 [debug] [Thread-3 (]: On model.customer360.stg_sf__contacts: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_sf__contacts"} */
alter table "dbt"."public"."stg_sf__contacts" rename to "stg_sf__contacts__dbt_backup"
[0m10:16:29.523881 [debug] [Thread-2 (]: SQL status: BEGIN in 0.0 seconds
[0m10:16:29.524511 [debug] [Thread-2 (]: Using postgres connection "model.customer360.stg_web__transactions"
[0m10:16:29.524983 [debug] [Thread-2 (]: On model.customer360.stg_web__transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_web__transactions"} */

  
    

  create  table "dbt"."public"."stg_web__transactions__dbt_tmp"
  
  
    as
  
  (
    with source as (
    select * from "dbt"."public"."transactions"
),

renamed as (
    select
        id,
        contact_id,
        
        to_timestamp(transaction_date,'YYYY-MM-DD HH24:MI:SS.MS') :: timestamp at TIME zone 'UTC'
     as transaction_date,
        amount,
        item_count,
        category, 
        _loaded_at_utc
    from source    
),

clean_older as (
    select * from renamed 
--    where transaction_date >= (current_date - 1)  过滤超过1天的数据
--    where transaction_date >= (to_date('2023-04-12','yyyy-MM-dd') - 1)  --测试用,假设跑数日期为2023-04-12
--    and transaction_date < to_date('2023-04-12','yyyy-MM-dd')
)

select * from clean_older
  );
  
[0m10:16:29.525604 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.0 seconds
[0m10:16:29.535888 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m10:16:29.540277 [debug] [Thread-3 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m10:16:29.540841 [debug] [Thread-3 (]: On model.customer360.stg_sf__contacts: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_sf__contacts"} */
alter table "dbt"."public"."stg_sf__contacts__dbt_tmp" rename to "stg_sf__contacts"
[0m10:16:29.535212 [debug] [Thread-1 (]: Using postgres connection "model.customer360.top3_hot_categorys"
[0m10:16:29.541619 [debug] [Thread-1 (]: On model.customer360.top3_hot_categorys: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.top3_hot_categorys"} */
alter table "dbt"."public"."top3_hot_categorys__dbt_tmp" rename to "top3_hot_categorys"
[0m10:16:29.543488 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m10:16:29.545954 [debug] [Thread-1 (]: On model.customer360.top3_hot_categorys: COMMIT
[0m10:16:29.546449 [debug] [Thread-1 (]: Using postgres connection "model.customer360.top3_hot_categorys"
[0m10:16:29.546911 [debug] [Thread-1 (]: On model.customer360.top3_hot_categorys: COMMIT
[0m10:16:29.547429 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m10:16:29.556729 [debug] [Thread-2 (]: SQL status: SELECT 100 in 0.0 seconds
[0m10:16:29.561157 [debug] [Thread-2 (]: Using postgres connection "model.customer360.stg_web__transactions"
[0m10:16:29.561702 [debug] [Thread-2 (]: On model.customer360.stg_web__transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_web__transactions"} */
alter table "dbt"."public"."stg_web__transactions" rename to "stg_web__transactions__dbt_backup"
[0m10:16:29.562240 [debug] [Thread-1 (]: SQL status: COMMIT in 0.0 seconds
[0m10:16:29.572922 [debug] [Thread-3 (]: On model.customer360.stg_sf__contacts: COMMIT
[0m10:16:29.573459 [debug] [Thread-3 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m10:16:29.573917 [debug] [Thread-3 (]: On model.customer360.stg_sf__contacts: COMMIT
[0m10:16:29.574467 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m10:16:29.578508 [debug] [Thread-2 (]: Using postgres connection "model.customer360.stg_web__transactions"
[0m10:16:29.579000 [debug] [Thread-2 (]: On model.customer360.stg_web__transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_web__transactions"} */
alter table "dbt"."public"."stg_web__transactions__dbt_tmp" rename to "stg_web__transactions"
[0m10:16:29.579870 [debug] [Thread-3 (]: SQL status: COMMIT in 0.0 seconds
[0m10:16:29.583722 [debug] [Thread-3 (]: Applying DROP to: "dbt"."public"."stg_sf__contacts__dbt_backup"
[0m10:16:29.580280 [debug] [Thread-1 (]: Applying DROP to: "dbt"."public"."top3_hot_categorys__dbt_backup"
[0m10:16:29.596272 [debug] [Thread-1 (]: Using postgres connection "model.customer360.top3_hot_categorys"
[0m10:16:29.596781 [debug] [Thread-1 (]: On model.customer360.top3_hot_categorys: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.top3_hot_categorys"} */
drop view if exists "dbt"."public"."top3_hot_categorys__dbt_backup" cascade
[0m10:16:29.598155 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m10:16:29.601340 [debug] [Thread-2 (]: On model.customer360.stg_web__transactions: COMMIT
[0m10:16:29.601842 [debug] [Thread-2 (]: Using postgres connection "model.customer360.stg_web__transactions"
[0m10:16:29.602408 [debug] [Thread-2 (]: On model.customer360.stg_web__transactions: COMMIT
[0m10:16:29.603012 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.0 seconds
[0m10:16:29.605211 [debug] [Thread-1 (]: Timing info for model.customer360.top3_hot_categorys (execute): 10:16:29.321272 => 10:16:29.604894
[0m10:16:29.605719 [debug] [Thread-1 (]: On model.customer360.top3_hot_categorys: Close
[0m10:16:29.606697 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '35ac2ffe-7aa8-4f71-b055-272d88af8448', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc9feba5b10>]}
[0m10:16:29.607436 [info ] [Thread-1 (]: 11 of 20 OK created sql view model public.top3_hot_categorys ................... [[32mCREATE VIEW[0m in 0.29s]
[0m10:16:29.592396 [debug] [Thread-3 (]: Using postgres connection "model.customer360.stg_sf__contacts"
[0m10:16:29.610855 [debug] [Thread-3 (]: On model.customer360.stg_sf__contacts: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_sf__contacts"} */
drop table if exists "dbt"."public"."stg_sf__contacts__dbt_backup" cascade
[0m10:16:29.608199 [debug] [Thread-1 (]: Finished running node model.customer360.top3_hot_categorys
[0m10:16:29.611739 [debug] [Thread-1 (]: Began running node test.customer360.not_null_top3_hot_categorys_category.ac139b7415
[0m10:16:29.612266 [info ] [Thread-1 (]: 14 of 20 START test not_null_top3_hot_categorys_category ....................... [RUN]
[0m10:16:29.613198 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.customer360.top3_hot_categorys, now test.customer360.not_null_top3_hot_categorys_category.ac139b7415)
[0m10:16:29.613739 [debug] [Thread-1 (]: Began compiling node test.customer360.not_null_top3_hot_categorys_category.ac139b7415
[0m10:16:29.621631 [debug] [Thread-1 (]: Writing injected SQL for node "test.customer360.not_null_top3_hot_categorys_category.ac139b7415"
[0m10:16:29.624236 [debug] [Thread-1 (]: Timing info for test.customer360.not_null_top3_hot_categorys_category.ac139b7415 (compile): 10:16:29.614034 => 10:16:29.622172
[0m10:16:29.624773 [debug] [Thread-1 (]: Began executing node test.customer360.not_null_top3_hot_categorys_category.ac139b7415
[0m10:16:29.628124 [debug] [Thread-1 (]: Writing runtime sql for node "test.customer360.not_null_top3_hot_categorys_category.ac139b7415"
[0m10:16:29.628834 [debug] [Thread-1 (]: Using postgres connection "test.customer360.not_null_top3_hot_categorys_category.ac139b7415"
[0m10:16:29.629388 [debug] [Thread-1 (]: On test.customer360.not_null_top3_hot_categorys_category.ac139b7415: BEGIN
[0m10:16:29.629872 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:16:29.630757 [debug] [Thread-2 (]: SQL status: COMMIT in 0.0 seconds
[0m10:16:29.634340 [debug] [Thread-2 (]: Applying DROP to: "dbt"."public"."stg_web__transactions__dbt_backup"
[0m10:16:29.635459 [debug] [Thread-2 (]: Using postgres connection "model.customer360.stg_web__transactions"
[0m10:16:29.635943 [debug] [Thread-2 (]: On model.customer360.stg_web__transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.stg_web__transactions"} */
drop table if exists "dbt"."public"."stg_web__transactions__dbt_backup" cascade
[0m10:16:29.636589 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.0 seconds
[0m10:16:29.638543 [debug] [Thread-3 (]: Timing info for model.customer360.stg_sf__contacts (execute): 10:16:29.363657 => 10:16:29.638199
[0m10:16:29.639038 [debug] [Thread-3 (]: On model.customer360.stg_sf__contacts: Close
[0m10:16:29.640017 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '35ac2ffe-7aa8-4f71-b055-272d88af8448', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc9fe2ba710>]}
[0m10:16:29.640739 [info ] [Thread-3 (]: 12 of 20 OK created sql table model public.stg_sf__contacts .................... [[32mSELECT 10[0m in 0.28s]
[0m10:16:29.643602 [debug] [Thread-3 (]: Finished running node model.customer360.stg_sf__contacts
[0m10:16:29.644196 [debug] [Thread-3 (]: Began running node test.customer360.unique_top3_hot_categorys_category.f6d49f4923
[0m10:16:29.644690 [info ] [Thread-3 (]: 15 of 20 START test unique_top3_hot_categorys_category ......................... [RUN]
[0m10:16:29.645561 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.customer360.stg_sf__contacts, now test.customer360.unique_top3_hot_categorys_category.f6d49f4923)
[0m10:16:29.646002 [debug] [Thread-3 (]: Began compiling node test.customer360.unique_top3_hot_categorys_category.f6d49f4923
[0m10:16:29.652598 [debug] [Thread-3 (]: Writing injected SQL for node "test.customer360.unique_top3_hot_categorys_category.f6d49f4923"
[0m10:16:29.653404 [debug] [Thread-3 (]: Timing info for test.customer360.unique_top3_hot_categorys_category.f6d49f4923 (compile): 10:16:29.646271 => 10:16:29.653094
[0m10:16:29.653870 [debug] [Thread-3 (]: Began executing node test.customer360.unique_top3_hot_categorys_category.f6d49f4923
[0m10:16:29.657141 [debug] [Thread-3 (]: Writing runtime sql for node "test.customer360.unique_top3_hot_categorys_category.f6d49f4923"
[0m10:16:29.657829 [debug] [Thread-3 (]: Using postgres connection "test.customer360.unique_top3_hot_categorys_category.f6d49f4923"
[0m10:16:29.658281 [debug] [Thread-3 (]: On test.customer360.unique_top3_hot_categorys_category.f6d49f4923: BEGIN
[0m10:16:29.660397 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m10:16:29.661528 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.0 seconds
[0m10:16:29.663408 [debug] [Thread-2 (]: Timing info for model.customer360.stg_web__transactions (execute): 10:16:29.462566 => 10:16:29.663138
[0m10:16:29.663845 [debug] [Thread-2 (]: On model.customer360.stg_web__transactions: Close
[0m10:16:29.664705 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '35ac2ffe-7aa8-4f71-b055-272d88af8448', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc9feb9ddd0>]}
[0m10:16:29.665473 [info ] [Thread-2 (]: 13 of 20 OK created sql table model public.stg_web__transactions ............... [[32mSELECT 100[0m in 0.21s]
[0m10:16:29.667759 [debug] [Thread-2 (]: Finished running node model.customer360.stg_web__transactions
[0m10:16:29.668449 [debug] [Thread-2 (]: Began running node model.customer360.contacts_joined_with_transactions
[0m10:16:29.669003 [info ] [Thread-2 (]: 16 of 20 START sql view model public.contacts_joined_with_transactions ......... [RUN]
[0m10:16:29.669860 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.customer360.stg_web__transactions, now model.customer360.contacts_joined_with_transactions)
[0m10:16:29.670332 [debug] [Thread-2 (]: Began compiling node model.customer360.contacts_joined_with_transactions
[0m10:16:29.678477 [debug] [Thread-2 (]: Writing injected SQL for node "model.customer360.contacts_joined_with_transactions"
[0m10:16:29.679593 [debug] [Thread-2 (]: Timing info for model.customer360.contacts_joined_with_transactions (compile): 10:16:29.670639 => 10:16:29.679007
[0m10:16:29.680074 [debug] [Thread-2 (]: Began executing node model.customer360.contacts_joined_with_transactions
[0m10:16:29.686094 [debug] [Thread-2 (]: Writing runtime sql for node "model.customer360.contacts_joined_with_transactions"
[0m10:16:29.686778 [debug] [Thread-2 (]: Using postgres connection "model.customer360.contacts_joined_with_transactions"
[0m10:16:29.687290 [debug] [Thread-2 (]: On model.customer360.contacts_joined_with_transactions: BEGIN
[0m10:16:29.687996 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m10:16:29.691356 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m10:16:29.691857 [debug] [Thread-1 (]: Using postgres connection "test.customer360.not_null_top3_hot_categorys_category.ac139b7415"
[0m10:16:29.692333 [debug] [Thread-1 (]: On test.customer360.not_null_top3_hot_categorys_category.ac139b7415: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.not_null_top3_hot_categorys_category.ac139b7415"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select category
from "dbt"."public"."top3_hot_categorys"
where category is null



      
    ) dbt_internal_test
[0m10:16:29.695521 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.0 seconds
[0m10:16:29.697870 [debug] [Thread-1 (]: Timing info for test.customer360.not_null_top3_hot_categorys_category.ac139b7415 (execute): 10:16:29.625105 => 10:16:29.697549
[0m10:16:29.698385 [debug] [Thread-1 (]: On test.customer360.not_null_top3_hot_categorys_category.ac139b7415: ROLLBACK
[0m10:16:29.699187 [debug] [Thread-1 (]: On test.customer360.not_null_top3_hot_categorys_category.ac139b7415: Close
[0m10:16:29.700258 [info ] [Thread-1 (]: 14 of 20 PASS not_null_top3_hot_categorys_category ............................. [[32mPASS[0m in 0.09s]
[0m10:16:29.700992 [debug] [Thread-1 (]: Finished running node test.customer360.not_null_top3_hot_categorys_category.ac139b7415
[0m10:16:29.703444 [debug] [Thread-1 (]: Began running node model.customer360.sales_month_report
[0m10:16:29.704036 [info ] [Thread-1 (]: 17 of 20 START sql table model public.sales_month_report ....................... [RUN]
[0m10:16:29.704891 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.customer360.not_null_top3_hot_categorys_category.ac139b7415, now model.customer360.sales_month_report)
[0m10:16:29.705848 [debug] [Thread-1 (]: Began compiling node model.customer360.sales_month_report
[0m10:16:29.709886 [debug] [Thread-1 (]: Writing injected SQL for node "model.customer360.sales_month_report"
[0m10:16:29.710652 [debug] [Thread-1 (]: Timing info for model.customer360.sales_month_report (compile): 10:16:29.706152 => 10:16:29.710359
[0m10:16:29.711167 [debug] [Thread-1 (]: Began executing node model.customer360.sales_month_report
[0m10:16:29.717700 [debug] [Thread-1 (]: Writing runtime sql for node "model.customer360.sales_month_report"
[0m10:16:29.718432 [debug] [Thread-1 (]: Using postgres connection "model.customer360.sales_month_report"
[0m10:16:29.718918 [debug] [Thread-1 (]: On model.customer360.sales_month_report: BEGIN
[0m10:16:29.719388 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:16:29.720523 [debug] [Thread-2 (]: SQL status: BEGIN in 0.0 seconds
[0m10:16:29.721003 [debug] [Thread-2 (]: Using postgres connection "model.customer360.contacts_joined_with_transactions"
[0m10:16:29.721532 [debug] [Thread-2 (]: On model.customer360.contacts_joined_with_transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.contacts_joined_with_transactions"} */

  create view "dbt"."public"."contacts_joined_with_transactions__dbt_tmp"
    
    
  as (
    SELECT 
    contacts.*,
    transactions.id as transaction_id,
    transactions.transaction_date,
    transactions.amount,
    transactions.item_count,
    transactions.category
FROM "dbt"."public"."stg_web__transactions" as transactions
LEFT JOIN "dbt"."public"."stg_sf__contacts" as contacts ON contacts.id = transactions.contact_id
  );
[0m10:16:29.722094 [debug] [Thread-3 (]: SQL status: BEGIN in 0.0 seconds
[0m10:16:29.722605 [debug] [Thread-3 (]: Using postgres connection "test.customer360.unique_top3_hot_categorys_category.f6d49f4923"
[0m10:16:29.723103 [debug] [Thread-3 (]: On test.customer360.unique_top3_hot_categorys_category.f6d49f4923: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.unique_top3_hot_categorys_category.f6d49f4923"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

select
    category as unique_field,
    count(*) as n_records

from "dbt"."public"."top3_hot_categorys"
where category is not null
group by category
having count(*) > 1



      
    ) dbt_internal_test
[0m10:16:29.727090 [debug] [Thread-2 (]: SQL status: CREATE VIEW in 0.0 seconds
[0m10:16:29.731503 [debug] [Thread-2 (]: Using postgres connection "model.customer360.contacts_joined_with_transactions"
[0m10:16:29.732018 [debug] [Thread-2 (]: On model.customer360.contacts_joined_with_transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.contacts_joined_with_transactions"} */
alter table "dbt"."public"."contacts_joined_with_transactions__dbt_tmp" rename to "contacts_joined_with_transactions"
[0m10:16:29.732566 [debug] [Thread-3 (]: SQL status: SELECT 1 in 0.0 seconds
[0m10:16:29.734387 [debug] [Thread-3 (]: Timing info for test.customer360.unique_top3_hot_categorys_category.f6d49f4923 (execute): 10:16:29.654151 => 10:16:29.734063
[0m10:16:29.734870 [debug] [Thread-3 (]: On test.customer360.unique_top3_hot_categorys_category.f6d49f4923: ROLLBACK
[0m10:16:29.736485 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m10:16:29.738675 [debug] [Thread-2 (]: On model.customer360.contacts_joined_with_transactions: COMMIT
[0m10:16:29.739159 [debug] [Thread-2 (]: Using postgres connection "model.customer360.contacts_joined_with_transactions"
[0m10:16:29.739639 [debug] [Thread-2 (]: On model.customer360.contacts_joined_with_transactions: COMMIT
[0m10:16:29.741323 [debug] [Thread-3 (]: On test.customer360.unique_top3_hot_categorys_category.f6d49f4923: Close
[0m10:16:29.742353 [info ] [Thread-3 (]: 15 of 20 PASS unique_top3_hot_categorys_category ............................... [[32mPASS[0m in 0.10s]
[0m10:16:29.743201 [debug] [Thread-3 (]: Finished running node test.customer360.unique_top3_hot_categorys_category.f6d49f4923
[0m10:16:29.743840 [debug] [Thread-2 (]: SQL status: COMMIT in 0.0 seconds
[0m10:16:29.747369 [debug] [Thread-2 (]: Applying DROP to: "dbt"."public"."contacts_joined_with_transactions__dbt_backup"
[0m10:16:29.748883 [debug] [Thread-2 (]: Using postgres connection "model.customer360.contacts_joined_with_transactions"
[0m10:16:29.749368 [debug] [Thread-2 (]: On model.customer360.contacts_joined_with_transactions: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.contacts_joined_with_transactions"} */
drop view if exists "dbt"."public"."contacts_joined_with_transactions__dbt_backup" cascade
[0m10:16:29.750407 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m10:16:29.750841 [debug] [Thread-1 (]: Using postgres connection "model.customer360.sales_month_report"
[0m10:16:29.751400 [debug] [Thread-1 (]: On model.customer360.sales_month_report: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.sales_month_report"} */

  
    

  create  table "dbt"."public"."sales_month_report__dbt_tmp"
  
  
    as
  
  (
    SELECT
     count(id)                                  as total_count
    ,cast(count(id) / 31 as decimal(24,2))      as day_avg_count
    ,sum(case when category = 'Apps & Games'                    then 1 else 0 end)   as apps_games_count
    ,sum(case when category = 'Beauty'                          then 1 else 0 end)   as beauty_count
    ,sum(case when category = 'Books'                           then 1 else 0 end)   as books_count
    ,sum(case when category = 'Clothing, Shoes & Accessories'   then 1 else 0 end)   as clothing_shoes_accessories_count
    ,sum(case when category = 'Movies & TV'                     then 1 else 0 end)   as movies_tv_count
    ,sum(case when category = 'Sports, Fitness & Outdoors'      then 1 else 0 end)   as sports_fitness_outdoors_count

    ,sum(amount) as total_expense
    ,cast(sum(amount) / 31 as decimal(24,4))    as day_avg_amount
    ,sum(case when category = 'Apps & Games'                    then amount else 0 end)   as apps_games_amount
    ,sum(case when category = 'Beauty'                          then amount else 0 end)   as beauty_amount
    ,sum(case when category = 'Books'                           then amount else 0 end)   as books_amount
    ,sum(case when category = 'Clothing, Shoes & Accessories'   then amount else 0 end)   as clothing_shoes_accessories_amount
    ,sum(case when category = 'Movies & TV'                     then amount else 0 end)   as movies_tv_amount
    ,sum(case when category = 'Sports, Fitness & Outdoors'      then amount else 0 end)   as sports_fitness_outdoors_amount
FROM  "dbt"."public"."stg_web__transactions"
where transaction_date between '2023-05-01' and '2023-05-31'  -- 样例，实际脚本可改成传参
  );
  
[0m10:16:29.751986 [debug] [Thread-2 (]: SQL status: DROP VIEW in 0.0 seconds
[0m10:16:29.753838 [debug] [Thread-2 (]: Timing info for model.customer360.contacts_joined_with_transactions (execute): 10:16:29.680376 => 10:16:29.753546
[0m10:16:29.754333 [debug] [Thread-2 (]: On model.customer360.contacts_joined_with_transactions: Close
[0m10:16:29.755240 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '35ac2ffe-7aa8-4f71-b055-272d88af8448', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc9fe99ad50>]}
[0m10:16:29.761311 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.0 seconds
[0m10:16:29.765717 [debug] [Thread-1 (]: Using postgres connection "model.customer360.sales_month_report"
[0m10:16:29.766212 [debug] [Thread-1 (]: On model.customer360.sales_month_report: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.sales_month_report"} */
alter table "dbt"."public"."sales_month_report" rename to "sales_month_report__dbt_backup"
[0m10:16:29.755968 [info ] [Thread-2 (]: 16 of 20 OK created sql view model public.contacts_joined_with_transactions .... [[32mCREATE VIEW[0m in 0.09s]
[0m10:16:29.767135 [debug] [Thread-2 (]: Finished running node model.customer360.contacts_joined_with_transactions
[0m10:16:29.767860 [debug] [Thread-3 (]: Began running node test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311
[0m10:16:29.768380 [info ] [Thread-3 (]: 18 of 20 START test not_null_contacts_joined_with_transactions_id .............. [RUN]
[0m10:16:29.769279 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.customer360.unique_top3_hot_categorys_category.f6d49f4923, now test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311)
[0m10:16:29.769816 [debug] [Thread-3 (]: Began compiling node test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311
[0m10:16:29.775853 [debug] [Thread-3 (]: Writing injected SQL for node "test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311"
[0m10:16:29.776663 [debug] [Thread-3 (]: Timing info for test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311 (compile): 10:16:29.770107 => 10:16:29.776360
[0m10:16:29.777154 [debug] [Thread-3 (]: Began executing node test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311
[0m10:16:29.780675 [debug] [Thread-3 (]: Writing runtime sql for node "test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311"
[0m10:16:29.781325 [debug] [Thread-3 (]: Using postgres connection "test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311"
[0m10:16:29.781817 [debug] [Thread-3 (]: On test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311: BEGIN
[0m10:16:29.782277 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m10:16:29.783420 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m10:16:29.788410 [debug] [Thread-1 (]: Using postgres connection "model.customer360.sales_month_report"
[0m10:16:29.788880 [debug] [Thread-1 (]: On model.customer360.sales_month_report: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.sales_month_report"} */
alter table "dbt"."public"."sales_month_report__dbt_tmp" rename to "sales_month_report"
[0m10:16:29.789842 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m10:16:29.792867 [debug] [Thread-1 (]: On model.customer360.sales_month_report: COMMIT
[0m10:16:29.793373 [debug] [Thread-1 (]: Using postgres connection "model.customer360.sales_month_report"
[0m10:16:29.793844 [debug] [Thread-1 (]: On model.customer360.sales_month_report: COMMIT
[0m10:16:29.795840 [debug] [Thread-1 (]: SQL status: COMMIT in 0.0 seconds
[0m10:16:29.799437 [debug] [Thread-1 (]: Applying DROP to: "dbt"."public"."sales_month_report__dbt_backup"
[0m10:16:29.800611 [debug] [Thread-1 (]: Using postgres connection "model.customer360.sales_month_report"
[0m10:16:29.801111 [debug] [Thread-1 (]: On model.customer360.sales_month_report: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.sales_month_report"} */
drop table if exists "dbt"."public"."sales_month_report__dbt_backup" cascade
[0m10:16:29.803982 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.0 seconds
[0m10:16:29.806236 [debug] [Thread-1 (]: Timing info for model.customer360.sales_month_report (execute): 10:16:29.711912 => 10:16:29.805936
[0m10:16:29.806747 [debug] [Thread-1 (]: On model.customer360.sales_month_report: Close
[0m10:16:29.807833 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '35ac2ffe-7aa8-4f71-b055-272d88af8448', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc9fe2b0d10>]}
[0m10:16:29.808569 [info ] [Thread-1 (]: 17 of 20 OK created sql table model public.sales_month_report .................. [[32mSELECT 1[0m in 0.10s]
[0m10:16:29.811863 [debug] [Thread-1 (]: Finished running node model.customer360.sales_month_report
[0m10:16:29.814932 [debug] [Thread-3 (]: SQL status: BEGIN in 0.0 seconds
[0m10:16:29.815517 [debug] [Thread-3 (]: Using postgres connection "test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311"
[0m10:16:29.816012 [debug] [Thread-3 (]: On test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select id
from "dbt"."public"."contacts_joined_with_transactions"
where id is null



      
    ) dbt_internal_test
[0m10:16:29.818575 [debug] [Thread-3 (]: SQL status: SELECT 1 in 0.0 seconds
[0m10:16:29.820152 [debug] [Thread-3 (]: Timing info for test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311 (execute): 10:16:29.777741 => 10:16:29.819926
[0m10:16:29.820526 [debug] [Thread-3 (]: On test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311: ROLLBACK
[0m10:16:29.821577 [debug] [Thread-3 (]: On test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311: Close
[0m10:16:29.822609 [info ] [Thread-3 (]: 18 of 20 PASS not_null_contacts_joined_with_transactions_id .................... [[32mPASS[0m in 0.05s]
[0m10:16:29.823340 [debug] [Thread-3 (]: Finished running node test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311
[0m10:16:29.824289 [debug] [Thread-2 (]: Began running node model.customer360.customers
[0m10:16:29.824823 [info ] [Thread-2 (]: 19 of 20 START sql table model public.customers ................................ [RUN]
[0m10:16:29.825611 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.customer360.contacts_joined_with_transactions, now model.customer360.customers)
[0m10:16:29.826134 [debug] [Thread-2 (]: Began compiling node model.customer360.customers
[0m10:16:29.829452 [debug] [Thread-2 (]: Writing injected SQL for node "model.customer360.customers"
[0m10:16:29.830109 [debug] [Thread-2 (]: Timing info for model.customer360.customers (compile): 10:16:29.826394 => 10:16:29.829868
[0m10:16:29.830561 [debug] [Thread-2 (]: Began executing node model.customer360.customers
[0m10:16:29.836088 [debug] [Thread-2 (]: Writing runtime sql for node "model.customer360.customers"
[0m10:16:29.836610 [debug] [Thread-2 (]: Using postgres connection "model.customer360.customers"
[0m10:16:29.837067 [debug] [Thread-2 (]: On model.customer360.customers: BEGIN
[0m10:16:29.837417 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m10:16:29.840738 [debug] [Thread-2 (]: SQL status: BEGIN in 0.0 seconds
[0m10:16:29.841056 [debug] [Thread-2 (]: Using postgres connection "model.customer360.customers"
[0m10:16:29.841428 [debug] [Thread-2 (]: On model.customer360.customers: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.customers"} */

  
    

  create  table "dbt"."public"."customers__dbt_tmp"
  
  
    as
  
  (
    SELECT
    id,
    gender,
    
    date_part('year', age(current_date, birth_date))
 AS age,
    sum(amount) as total_expense,
    date(min(transaction_date)) as first_purchase_date,
    date(max(transaction_date)) as last_purchase_date,
    sum(case when category = 'Apps & Games' then amount else 0 end) as apps_games_amount,
    sum(case when category = 'Beauty' then amount else 0 end)   as beauty_amount,
    sum(case when category = 'Books' then amount else 0 end)   as books_amount,
    sum(case when category = 'Clothing, Shoes & Accessories' then amount else 0 end)   as clothing_shoes_accessories_amount,
    sum(case when category = 'Movies & TV' then amount else 0 end)   as movies_tv_amount,
    sum(case when category = 'Sports, Fitness & Outdoors' then amount else 0 end)   as sports_fitness_outdoors_amount
FROM  "dbt"."public"."contacts_joined_with_transactions"
GROUP BY
    1,2,3
  );
  
[0m10:16:29.848834 [debug] [Thread-2 (]: SQL status: SELECT 9 in 0.0 seconds
[0m10:16:29.851717 [debug] [Thread-2 (]: Using postgres connection "model.customer360.customers"
[0m10:16:29.852037 [debug] [Thread-2 (]: On model.customer360.customers: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.customers"} */
alter table "dbt"."public"."customers" rename to "customers__dbt_backup"
[0m10:16:29.852794 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m10:16:29.855315 [debug] [Thread-2 (]: Using postgres connection "model.customer360.customers"
[0m10:16:29.855640 [debug] [Thread-2 (]: On model.customer360.customers: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.customers"} */
alter table "dbt"."public"."customers__dbt_tmp" rename to "customers"
[0m10:16:29.856329 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m10:16:29.858205 [debug] [Thread-2 (]: On model.customer360.customers: COMMIT
[0m10:16:29.858532 [debug] [Thread-2 (]: Using postgres connection "model.customer360.customers"
[0m10:16:29.858866 [debug] [Thread-2 (]: On model.customer360.customers: COMMIT
[0m10:16:29.860219 [debug] [Thread-2 (]: SQL status: COMMIT in 0.0 seconds
[0m10:16:29.862502 [debug] [Thread-2 (]: Applying DROP to: "dbt"."public"."customers__dbt_backup"
[0m10:16:29.863258 [debug] [Thread-2 (]: Using postgres connection "model.customer360.customers"
[0m10:16:29.863594 [debug] [Thread-2 (]: On model.customer360.customers: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "model.customer360.customers"} */
drop table if exists "dbt"."public"."customers__dbt_backup" cascade
[0m10:16:29.865788 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.0 seconds
[0m10:16:29.867056 [debug] [Thread-2 (]: Timing info for model.customer360.customers (execute): 10:16:29.830837 => 10:16:29.866860
[0m10:16:29.867388 [debug] [Thread-2 (]: On model.customer360.customers: Close
[0m10:16:29.868282 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '35ac2ffe-7aa8-4f71-b055-272d88af8448', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc9fea5a9d0>]}
[0m10:16:29.868934 [info ] [Thread-2 (]: 19 of 20 OK created sql table model public.customers ........................... [[32mSELECT 9[0m in 0.04s]
[0m10:16:29.869593 [debug] [Thread-2 (]: Finished running node model.customer360.customers
[0m10:16:29.870386 [debug] [Thread-3 (]: Began running node test.customer360.custormers_test
[0m10:16:29.870739 [info ] [Thread-3 (]: 20 of 20 START test custormers_test ............................................ [RUN]
[0m10:16:29.871323 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.customer360.not_null_contacts_joined_with_transactions_id.4b4c841311, now test.customer360.custormers_test)
[0m10:16:29.871635 [debug] [Thread-3 (]: Began compiling node test.customer360.custormers_test
[0m10:16:29.874593 [debug] [Thread-3 (]: Writing injected SQL for node "test.customer360.custormers_test"
[0m10:16:29.875238 [debug] [Thread-3 (]: Timing info for test.customer360.custormers_test (compile): 10:16:29.871818 => 10:16:29.875021
[0m10:16:29.875585 [debug] [Thread-3 (]: Began executing node test.customer360.custormers_test
[0m10:16:29.877569 [debug] [Thread-3 (]: Writing runtime sql for node "test.customer360.custormers_test"
[0m10:16:29.878038 [debug] [Thread-3 (]: Using postgres connection "test.customer360.custormers_test"
[0m10:16:29.878389 [debug] [Thread-3 (]: On test.customer360.custormers_test: BEGIN
[0m10:16:29.878681 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m10:16:29.881968 [debug] [Thread-3 (]: SQL status: BEGIN in 0.0 seconds
[0m10:16:29.882321 [debug] [Thread-3 (]: Using postgres connection "test.customer360.custormers_test"
[0m10:16:29.882743 [debug] [Thread-3 (]: On test.customer360.custormers_test: /* {"app": "dbt", "dbt_version": "1.7.8", "profile_name": "integration_tests", "target_name": "local", "node_id": "test.customer360.custormers_test"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      select
    1
from
(
    SELECT
        sum(total_expense) as total_expense,
        date(min(first_purchase_date)) as first_purchase_date,
        date(max(last_purchase_date)) as last_purchase_date,
        sum(apps_games_amount) as apps_games_amount,
        sum(beauty_amount)   as beauty_amount,
        sum(books_amount)   as books_amount,
        sum(clothing_shoes_accessories_amount)   as clothing_shoes_accessories_amount,
        sum(movies_tv_amount)   as movies_tv_amount,
        sum(sports_fitness_outdoors_amount)   as sports_fitness_outdoors_amount
    FROM  "dbt"."public"."customers"
) t1
join (
    SELECT
        sum(amount) as total_expense,
        date(min(transaction_date)) as first_purchase_date,
        date(max(transaction_date)) as last_purchase_date,
        sum(case when category = 'Apps & Games' then amount else 0 end) as apps_games_amount,
        sum(case when category = 'Beauty' then amount else 0 end)   as beauty_amount,
        sum(case when category = 'Books' then amount else 0 end)   as books_amount,
        sum(case when category = 'Clothing, Shoes & Accessories' then amount else 0 end)   as clothing_shoes_accessories_amount,
        sum(case when category = 'Movies & TV' then amount else 0 end)   as movies_tv_amount,
        sum(case when category = 'Sports, Fitness & Outdoors' then amount else 0 end)   as sports_fitness_outdoors_amount
    FROM  "dbt"."public"."contacts_joined_with_transactions"
) t2
on 1 = 1
where (
     nullif(cast(t1.total_expense as decimal(15,1))                   ,0)  <> nullif(cast(t2.total_expense                      as decimal(15,1)) ,0)
  or nullif(t1.first_purchase_date               ,'9999-12-31')       <> nullif(t2.first_purchase_date               ,'9999-12-31')
  or nullif(t1.last_purchase_date               ,'9999-12-31')        <> nullif(t2.last_purchase_date               ,'9999-12-31')
  or nullif(cast(t1.apps_games_amount                 as decimal(15,1)),0) <> nullif(cast(t2.apps_games_amount                 as decimal(15,1)) ,0)
  or nullif(cast(t1.beauty_amount                     as decimal(15,1)),0) <> nullif(cast(t2.beauty_amount                     as decimal(15,1)) ,0)
  or nullif(cast(t1.books_amount                      as decimal(15,1)),0) <> nullif(cast(t2.books_amount                      as decimal(15,1)) ,0)
  or nullif(cast(t1.clothing_shoes_accessories_amount as decimal(15,1)),0) <> nullif(cast(t2.clothing_shoes_accessories_amount as decimal(15,1)) ,0)
  or nullif(cast(t1.movies_tv_amount                  as decimal(15,1)),0) <> nullif(cast(t2.movies_tv_amount                  as decimal(15,1)) ,0)
  or nullif(cast(t1.sports_fitness_outdoors_amount    as decimal(15,1)),0) <> nullif(cast(t2.sports_fitness_outdoors_amount    as decimal(15,1)) ,0)
)
      
    ) dbt_internal_test
[0m10:16:29.885705 [debug] [Thread-3 (]: SQL status: SELECT 1 in 0.0 seconds
[0m10:16:29.887045 [debug] [Thread-3 (]: Timing info for test.customer360.custormers_test (execute): 10:16:29.875776 => 10:16:29.886845
[0m10:16:29.887390 [debug] [Thread-3 (]: On test.customer360.custormers_test: ROLLBACK
[0m10:16:29.887875 [debug] [Thread-3 (]: On test.customer360.custormers_test: Close
[0m10:16:29.888833 [info ] [Thread-3 (]: 20 of 20 PASS custormers_test .................................................. [[32mPASS[0m in 0.02s]
[0m10:16:29.889539 [debug] [Thread-3 (]: Finished running node test.customer360.custormers_test
[0m10:16:29.892440 [debug] [MainThread]: Using postgres connection "master"
[0m10:16:29.892837 [debug] [MainThread]: On master: BEGIN
[0m10:16:29.893200 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m10:16:29.902564 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m10:16:29.903073 [debug] [MainThread]: On master: COMMIT
[0m10:16:29.903483 [debug] [MainThread]: Using postgres connection "master"
[0m10:16:29.903774 [debug] [MainThread]: On master: COMMIT
[0m10:16:29.904830 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m10:16:29.905154 [debug] [MainThread]: On master: Close
[0m10:16:29.905836 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:16:29.906090 [debug] [MainThread]: Connection 'model.customer360.sales_month_report' was properly closed.
[0m10:16:29.906350 [debug] [MainThread]: Connection 'model.customer360.customers' was properly closed.
[0m10:16:29.906592 [debug] [MainThread]: Connection 'test.customer360.custormers_test' was properly closed.
[0m10:16:29.906945 [info ] [MainThread]: 
[0m10:16:29.907238 [info ] [MainThread]: Finished running 12 tests, 2 seeds, 2 view models, 4 table models in 0 hours 0 minutes and 1.20 seconds (1.20s).
[0m10:16:29.911408 [debug] [MainThread]: Command end result
[0m10:16:29.922177 [info ] [MainThread]: 
[0m10:16:29.922715 [info ] [MainThread]: [32mCompleted successfully[0m
[0m10:16:29.923163 [info ] [MainThread]: 
[0m10:16:29.923786 [info ] [MainThread]: Done. PASS=20 WARN=0 ERROR=0 SKIP=0 TOTAL=20
[0m10:16:29.924759 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 2.3164937, "process_user_time": 3.697128, "process_kernel_time": 0.112243, "process_mem_max_rss": "110084", "process_out_blocks": "3168", "process_in_blocks": "0"}
[0m10:16:29.925400 [debug] [MainThread]: Command `dbt build` succeeded at 10:16:29.925220 after 2.32 seconds
[0m10:16:29.925873 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fca006a3f90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fca04afaad0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fca02acad50>]}
[0m10:16:29.926367 [debug] [MainThread]: Flushing usage events
